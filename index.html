<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#000000">
  <title>Govhoo - Federal Contract Intelligence & Sales Planning</title>
  
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-sankey/0.12.3/d3-sankey.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-T343V4RFHV"></script>
  <script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-T343V4RFHV');
</script>
<style>
:root{--bg-app:#000;--bg-card:#121212;--bg-input:#1a1a1a;--border:#333;--text-primary:#e6e6e6;--text-muted:#888;--accent:#d4c4a8;--accent-dim:rgba(212,196,168,0.1);--link:#8da0cb;--success:#66c2a5;--danger:#fb8072;--q1-color:#958bb6;--q2-color:#6f8a74;--q3-color:#8fb6d0;--q4-color:#c27e5c;--safe-top:env(safe-area-inset-top,20px);--safe-bottom:env(safe-area-inset-bottom,20px)}*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}body{margin:0;padding:0;font-family:Inter,sans-serif;background:var(--bg-app);color:var(--text-primary);min-height:100vh;overflow-x:hidden}.hero-view{position:fixed;inset:0;z-index:200;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;padding:2rem;padding-top:max(8vh,var(--safe-top));transition:transform .5s cubic-bezier(.16,1,.3,1);overflow-y:auto}.hero-view.slide-up{transform:translateY(-100%)}.hero-view.hidden{display:none}.terminal-logo{font-family:JetBrains Mono,monospace;font-size:2.5rem;font-weight:700;margin-bottom:.5rem;color:var(--text-primary);letter-spacing:-1px;text-align:center}.terminal-logo span{color:var(--accent)}.hero-subtitle{color:var(--text-muted);margin-bottom:2rem;text-align:center}.search-box-container{position:relative;z-index:210;width:100%;max-width:500px;margin-top:1.5rem}.main-input{width:100%;background:var(--bg-input);border:1px solid var(--border);padding:1.25rem 1rem;font-size:1.1rem;color:#fff;border-radius:4px;font-family:Inter,sans-serif;transition:border-color .2s;-webkit-appearance:none}.main-input:focus{outline:none;border-color:var(--accent);background:#222}.btn-row{display:flex;gap:.75rem;margin-top:1rem}.btn-primary,.btn-secondary{flex:1;padding:1rem;font-weight:700;border:none;border-radius:4px;font-size:.9rem;cursor:pointer;text-transform:uppercase;letter-spacing:1px;display:flex;align-items:center;justify-content:center;gap:.5rem}.btn-primary{background:var(--accent);color:#000}.btn-secondary{background:transparent;color:var(--accent);border:1px solid var(--accent)}.btn-primary:hover,.btn-secondary:hover{opacity:.9}.search-tips{margin-top:1.5rem;width:100%;max-width:500px;background:hsla(0,0%,100%,.03);border:1px solid var(--border);border-radius:4px;padding:1rem;font-family:JetBrains Mono,monospace;font-size:.75rem;color:var(--text-muted)}.tip-header{color:var(--accent);font-weight:700;margin-bottom:.75rem;display:flex;align-items:center;gap:.5rem;text-transform:uppercase;letter-spacing:1px}.tip-row{display:flex;align-items:flex-start;gap:.75rem;margin-bottom:.6rem;line-height:1.4}.cmd-hl{color:var(--text-primary);background:hsla(0,0%,100%,.1);padding:2px 6px;border-radius:2px;white-space:nowrap}.app-header{position:sticky;top:0;z-index:100;background:rgba(0,0,0,.95);backdrop-filter:blur(10px);padding:.75rem 1rem;padding-top:max(.75rem,var(--safe-top));border-bottom:1px solid var(--border);justify-content:space-between}.app-header,.header-left{display:flex;align-items:center;gap:1rem}.header-left{flex:1;min-width:0}.logo-btn{font-family:JetBrains Mono;font-weight:700;color:#fff;cursor:pointer;flex-shrink:0}.logo-btn:hover{color:var(--accent)}.mini-search{background:var(--bg-input);border:1px solid var(--border);color:#fff;padding:.5rem 1rem;border-radius:4px;font-size:.9rem;flex:1;min-width:0}.mini-search:focus{outline:none;border-color:var(--accent)}.header-actions{display:flex;gap:.5rem;flex-shrink:0}.icon-btn{background:var(--bg-input);border:1px solid var(--border);color:var(--text-muted);width:36px;height:36px;border-radius:4px;display:flex;align-items:center;justify-content:center;cursor:pointer}.icon-btn.active,.icon-btn:hover{border-color:var(--accent);color:var(--accent)}.icon-btn.active{background:var(--accent-dim)}.dashboard-container{padding:1rem;padding-bottom:calc(2rem + var(--safe-bottom));max-width:1400px;margin:0 auto;display:none}.dashboard-container.active{display:block;animation:fadeIn .8s forwards}@keyframes fadeIn{to{opacity:1}}.mode-toggle{display:flex;gap:.5rem;margin-bottom:1.5rem;background:var(--bg-card);padding:.5rem;border-radius:4px;border:1px solid var(--border)}.mode-btn{flex:1;padding:.75rem;background:transparent;border:none;color:var(--text-muted);font-family:JetBrains Mono;font-size:.85rem;cursor:pointer;border-radius:4px;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:.5rem}.mode-btn.active{background:var(--accent-dim);color:var(--accent)}.mode-btn:hover:not(.active){color:var(--text-primary)}.stats-row{display:grid;grid-template-columns:repeat(4,1fr);gap:1rem;margin-bottom:1.5rem}.stat-item{background:var(--bg-card);padding:1rem;border-radius:4px;border:1px solid var(--border);text-align:center}.stat-label{font-size:.7rem;color:var(--text-muted);text-transform:uppercase;margin-bottom:.5rem}.stat-val{font-size:1.25rem;font-weight:700;font-family:JetBrains Mono;color:#fff}.stat-sub{font-size:.7rem;color:var(--success);margin-top:4px}.stat-sub.neutral{color:var(--text-muted)}.section-header{justify-content:space-between;margin:2rem 0 1rem;border-bottom:1px solid var(--border);padding-bottom:.5rem;flex-wrap:wrap}.section-header,.section-title-group{display:flex;align-items:center;gap:.5rem}.section-title{font-family:JetBrains Mono,monospace;font-size:.9rem;font-weight:700;color:var(--accent);text-transform:uppercase;letter-spacing:1px}.header-controls{display:flex;gap:.75rem;align-items:center}.time-badge{color:var(--text-muted);border:1px solid var(--border);border-radius:4px}.filter-badge,.time-badge{font-family:JetBrains Mono,monospace;font-size:.7rem;padding:4px 8px}.filter-badge{display:none;background:var(--accent-dim);color:var(--accent);border:1px solid var(--accent);border-radius:4px;cursor:pointer;align-items:center;gap:6px}.filter-badge:hover{background:rgba(212,196,168,.2)}.chart-wrapper{background:var(--bg-card);border:1px solid var(--border);border-radius:4px;padding:1rem;width:100%;overflow-x:auto;overflow-y:visible}.chart-container{width:100%;min-height:500px;height:auto;display:block}.feed-grid{display:flex;flex-direction:column;gap:1rem}.deal-card{background:var(--bg-card);border:1px solid var(--border);border-radius:4px;padding:1.25rem;transition:transform .1s}.deal-card:active{transform:scale(.99)}.deal-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:.75rem}.deal-agency{font-size:.75rem;color:var(--text-muted);font-weight:600;text-transform:uppercase;background:hsla(0,0%,100%,.05);padding:2px 6px;border-radius:4px}.deal-amount{font-family:JetBrains Mono,monospace;color:var(--accent);font-weight:700;font-size:1rem}.deal-desc{font-size:1rem;font-weight:600;margin-bottom:.5rem;line-height:1.4;color:#fff}.deal-vendor{font-size:.85rem;color:#8da0cb;margin-bottom:.75rem;font-family:JetBrains Mono,monospace}.deal-meta{display:flex;flex-wrap:wrap;gap:.5rem;margin-bottom:1rem}.meta-tag{font-size:.65rem;font-family:JetBrains Mono,monospace;padding:3px 8px;border-radius:3px;background:hsla(0,0%,100%,.05);color:var(--text-muted);border:1px solid var(--border)}.meta-tag.naics{background:rgba(102,194,165,.15);border-color:rgba(102,194,165,.3);color:#66c2a5}.meta-tag.psc{background:rgba(141,160,203,.15);border-color:rgba(141,160,203,.3);color:#8da0cb}.deal-footer{display:flex;justify-content:space-between;align-items:center;padding-top:1rem;border-top:1px solid #222}.deal-date{font-size:.75rem;color:var(--text-muted)}.action-btn{background:var(--bg-input);color:var(--accent);text-decoration:none;padding:.5rem 1rem;border-radius:4px;font-size:.8rem;font-weight:600;border:1px solid var(--border);display:flex;align-items:center;gap:6px}.action-btn:hover{border-color:var(--accent);background:var(--accent-dim)}.forecast-table-wrapper{background:var(--bg-card);border:1px solid var(--border);overflow-x:auto;border-radius:4px}.forecast-table{width:100%;border-collapse:collapse;font-family:JetBrains Mono;font-size:.8rem}.forecast-table th{text-align:left;color:var(--text-muted)}.forecast-table td,.forecast-table th{padding:1rem;border-bottom:1px solid var(--border)}.forecast-table td{color:var(--text-primary)}.trend-pill{padding:2px 6px;border-radius:2px;font-size:.7rem;font-weight:700}.trend-up{color:var(--success);background:rgba(102,194,165,.1)}.trend-down{color:var(--danger);background:rgba(251,128,114,.1)}.insight-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;margin-bottom:2rem}.insight-card{background:var(--bg-card);border:1px solid var(--border);padding:1rem;border-radius:4px}.insight-val{font-size:1.1rem;color:var(--text-primary);font-weight:700;font-family:JetBrains Mono}.insight-label{font-size:.7rem;color:var(--text-muted);text-transform:uppercase;margin-bottom:.5rem}.view-section{display:none}.view-section.active{display:block}.loader{position:fixed;inset:0;z-index:300;background:rgba(0,0,0,.9);display:none;flex-direction:column;align-items:center;justify-content:center}.spinner{width:40px;height:40px;border:2px solid #333;border-top:2px solid var(--accent);border-radius:50%;animation:spin .8s linear infinite}@keyframes spin{to{transform:rotate(1turn)}}.methodology-card{background:var(--bg-card);border:1px solid var(--border);border-radius:4px;padding:1.5rem;display:grid;grid-template-columns:repeat(2,1fr);gap:1.5rem}.method-item{padding-bottom:1rem;border-bottom:1px solid var(--border)}.method-item:nth-last-child(-n+2){border-bottom:none;padding-bottom:0}.method-title{font-family:JetBrains Mono,monospace;font-size:.85rem;font-weight:700;color:var(--accent);margin-bottom:.5rem;display:flex;align-items:center;gap:.5rem}.method-title i{font-size:.75rem;opacity:.7}.method-desc{font-size:.8rem;color:var(--text-muted);line-height:1.5}.method-desc code{background:hsla(0,0%,100%,.1);padding:2px 6px;border-radius:3px;font-family:JetBrains Mono,monospace;font-size:.75rem}.method-desc code,.method-desc strong{color:var(--text-primary)}.drill-breadcrumb{padding:.75rem 1rem;background:linear-gradient(90deg,rgba(212,196,168,.1),transparent);border:1px solid var(--border);border-radius:4px;margin-bottom:1rem;font-family:JetBrains Mono,monospace;font-size:.8rem;overflow-x:auto;white-space:nowrap}.breadcrumb-item,.drill-breadcrumb{display:flex;align-items:center;gap:.5rem}.breadcrumb-item{color:var(--text-muted);cursor:pointer;padding:4px 8px;border-radius:4px;transition:all .2s}.breadcrumb-item:hover{background:hsla(0,0%,100%,.05);color:var(--accent)}.breadcrumb-item.active{background:var(--accent-dim);color:var(--accent);cursor:default}.breadcrumb-separator{color:var(--border);font-size:.7rem}.breadcrumb-icon,.drill-hint{font-size:.75rem}.drill-hint{display:flex;align-items:center;justify-content:center;gap:.5rem;padding:.5rem;background:rgba(212,196,168,.05);border:1px dashed var(--border);border-radius:4px;margin-top:.5rem;color:var(--text-muted)}.drill-hint i{color:var(--accent)}.subagency-panel{background:var(--bg-card);border:1px solid var(--border);border-radius:4px;margin-top:1.5rem;overflow:hidden}.subagency-header{display:flex;align-items:center;justify-content:space-between;padding:1rem;background:linear-gradient(90deg,rgba(212,196,168,.08),transparent);border-bottom:1px solid var(--border)}.subagency-header-left{display:flex;align-items:center;gap:.75rem}.subagency-header-icon{width:36px;height:36px;display:flex;align-items:center;justify-content:center;background:var(--accent-dim);border:1px solid var(--accent);border-radius:4px;color:var(--accent)}.subagency-header-text h3{margin:0;font-family:JetBrains Mono,monospace;font-size:.9rem;color:var(--text-primary);font-weight:600}.subagency-header-text span{font-size:.75rem;color:var(--text-muted)}.subagency-stats{display:flex;gap:1.5rem;font-family:JetBrains Mono,monospace}.subagency-stat{text-align:right}.subagency-stat-val{font-size:1rem;font-weight:700;color:var(--accent)}.subagency-stat-label{font-size:.65rem;color:var(--text-muted);text-transform:uppercase}.subagency-list{max-height:400px;overflow-y:auto}.subagency-item{display:flex;align-items:center;justify-content:space-between;padding:1rem;border-bottom:1px solid var(--border);cursor:pointer;transition:all .15s}.subagency-item:hover{background:hsla(0,0%,100%,.02)}.subagency-item:last-child{border-bottom:none}.subagency-item-left{display:flex;align-items:center;gap:1rem;flex:1;min-width:0}.subagency-rank{width:28px;height:28px;display:flex;align-items:center;justify-content:center;background:hsla(0,0%,100%,.05);border-radius:4px;font-family:JetBrains Mono,monospace;font-size:.75rem;color:var(--text-muted);flex-shrink:0}.subagency-rank.top-3{background:var(--accent-dim);color:var(--accent);border:1px solid rgba(212,196,168,.3)}.subagency-info{flex:1;min-width:0}.subagency-name{font-size:.9rem;color:var(--text-primary);font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.subagency-contracts{font-size:.75rem;color:var(--text-muted);margin-top:2px}.subagency-item-right{display:flex;align-items:center;gap:1rem;flex-shrink:0}.subagency-bar-container{width:120px;height:8px;background:hsla(0,0%,100%,.05);border-radius:4px;overflow:hidden}.subagency-bar{height:100%;background:linear-gradient(90deg,var(--accent),rgba(212,196,168,.5));border-radius:4px;transition:width .3s ease}.subagency-amount{font-family:JetBrains Mono,monospace;font-size:.9rem;font-weight:700;color:var(--accent);min-width:80px;text-align:right}.subagency-drill-icon{color:var(--text-muted);font-size:.8rem;opacity:0;transition:all .15s}.subagency-item:hover .subagency-drill-icon{opacity:1;color:var(--accent);transform:translateX(2px)}.drill-level-indicator{display:inline-flex;align-items:center;gap:.25rem;padding:2px 6px;background:rgba(102,194,165,.1);border:1px solid rgba(102,194,165,.3);border-radius:4px;font-size:.65rem;color:var(--success);margin-left:.5rem}.node-drillable{cursor:pointer}.node-drillable:hover{filter:brightness(1.2)}.empty-drill-state{text-align:center;padding:3rem 2rem;color:var(--text-muted)}.empty-drill-state i{font-size:2rem;color:var(--border);margin-bottom:1rem}.empty-drill-state p{margin:.5rem 0}.sales-plan-card{background:linear-gradient(135deg,rgba(212,196,168,.15),rgba(212,196,168,.05));border:1px solid var(--accent);border-radius:4px;padding:1rem;cursor:pointer;transition:all .3s ease;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center}.sales-plan-card:hover{transform:translateY(-4px);box-shadow:0 8px 30px rgba(212,196,168,.4);border-color:var(--accent);background:linear-gradient(135deg,rgba(212,196,168,.25),rgba(212,196,168,.1))}.sales-plan-card-icon{font-size:1.5rem;color:var(--accent);margin-bottom:.5rem}.sales-plan-card-title{font-size:.85rem;font-weight:700;color:var(--accent);margin-bottom:.25rem;text-transform:uppercase;letter-spacing:1px}.sales-plan-card-subtitle{font-size:.85rem;color:var(--text-primary);line-height:1.4;margin-bottom:.75rem}.sales-plan-card-action{display:inline-flex;align-items:center;gap:.5rem;font-size:.75rem;color:var(--accent);text-transform:uppercase;letter-spacing:1px;font-weight:600}.channel-marking-modal{position:fixed;top:0;left:0;right:0;bottom:0;background:transparent;z-index:500;padding:2rem;overflow-y:auto;display:flex;align-items:flex-start;justify-content:center;opacity:0;visibility:hidden;transition:opacity .25s ease,background .25s ease,visibility .25s}.channel-marking-modal.active{opacity:1;visibility:visible;background:rgba(0,0,0,.9)}.channel-modal-content{background:var(--bg-card);border:1px solid var(--border);border-radius:8px;max-width:800px;width:100%;margin:2rem auto;transform:translateY(-20px) scale(.98);transition:transform .25s ease-out}.channel-marking-modal.active .channel-modal-content{transform:translateY(0) scale(1)}.channel-modal-header{padding:1.5rem;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}.channel-modal-title{font-size:1.3rem;font-weight:700;color:var(--accent);font-family:JetBrains Mono,monospace}.channel-modal-close{background:transparent;border:none;color:var(--text-muted);font-size:1.5rem;cursor:pointer;width:40px;height:40px;display:flex;align-items:center;justify-content:center;border-radius:4px}.channel-modal-close:hover{background:hsla(0,0%,100%,.05);color:var(--accent)}.channel-modal-body{padding:1.5rem;max-height:60vh;overflow-y:auto}.channel-explanation{background:rgba(212,196,168,.1);border-left:3px solid var(--accent);padding:1rem;margin-bottom:1.5rem;font-size:.9rem;color:var(--text-primary);line-height:1.6}.vendor-list-item{display:flex;align-items:center;justify-content:space-between;padding:.75rem 1rem;border:1px solid var(--border);border-radius:4px;margin-bottom:.5rem;transition:all .2s}.vendor-list-item:hover{background:hsla(0,0%,100%,.02);border-color:var(--accent)}.vendor-info{flex:1;min-width:0}.vendor-name{font-weight:600;color:var(--text-primary);margin-bottom:.25rem}.vendor-stats{font-size:.75rem;color:var(--text-muted)}.vendor-toggle{display:flex;align-items:center;gap:.5rem}.toggle-switch{position:relative;width:50px;height:26px;background:#333;border-radius:13px;cursor:pointer;transition:background .3s}.toggle-switch.active{background:var(--accent)}.toggle-slider{position:absolute;top:3px;left:3px;width:20px;height:20px;background:#fff;border-radius:50%;transition:transform .3s}.toggle-switch.active .toggle-slider{transform:translateX(24px)}.toggle-label{font-size:.75rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:.5px;min-width:80px}.toggle-switch.active+.toggle-label{color:var(--accent);font-weight:600}.channel-modal-footer{padding:1.5rem;border-top:1px solid var(--border);display:flex;gap:1rem;justify-content:flex-end}.modal-btn{padding:.75rem 1.5rem;border-radius:4px;font-weight:600;cursor:pointer;transition:all .2s;text-transform:uppercase;letter-spacing:1px;font-size:.85rem}.modal-btn-cancel{background:transparent;border:1px solid var(--border);color:var(--text-muted)}.modal-btn-cancel:hover{border-color:var(--accent);color:var(--accent)}.modal-btn-primary{background:var(--accent);border:none;color:#000}.modal-btn-primary:hover{opacity:.9;transform:translateY(-1px)}.channel-link{display:inline-flex;align-items:center;gap:.25rem;font-size:.75rem;color:var(--text-muted);margin-top:.5rem;cursor:pointer;text-decoration:underline}.channel-link:hover{color:var(--accent)}@media (max-width:900px){.insight-grid{grid-template-columns:1fr}}@media (max-width:768px){.methodology-card{grid-template-columns:1fr}.method-item{border-bottom:1px solid var(--border);padding-bottom:1rem}.method-item:last-child{border-bottom:none;padding-bottom:0}.subagency-bar-container{display:none}.subagency-stats{flex-direction:column;gap:.5rem}.subagency-stat{text-align:left}.stats-row{grid-template-columns:1fr 1fr}.btn-row{flex-direction:column}}@media (max-width:600px){.stats-row{grid-template-columns:1fr;gap:.5rem}.stat-item{display:flex;justify-content:space-between;align-items:center;padding:.75rem 1rem}.stat-label{margin-bottom:0}.chart-container{height:400px;min-width:600px}.chart-wrapper{overflow-x:auto}.mode-toggle{flex-direction:column}.channel-marking-modal{padding:0}.channel-modal-content{margin:0;border-radius:0;max-height:100vh;height:100vh;max-width:100%}.channel-modal-body{max-height:calc(100vh - 180px)}.channel-modal-footer{flex-wrap:wrap;gap:.5rem;padding:1rem}.channel-modal-footer .modal-btn{flex:1 1 auto;min-width:120px;padding:.6rem 1rem;font-size:.75rem}.step-grid{grid-template-columns:1fr!important}.ai-link-btn{padding:.75rem .25rem;font-size:.65rem}}.chart-wrapper::-webkit-scrollbar{height:8px;width:8px}.chart-wrapper::-webkit-scrollbar-track{background:var(--bg-card);border-radius:4px}.chart-wrapper::-webkit-scrollbar-thumb{background:#333;border-radius:4px;border:1px solid var(--bg-card)}.chart-wrapper::-webkit-scrollbar-thumb:hover{background:var(--accent)}#spIntentBanner{display:none;background:hsla(0,0%,100%,.02);border-bottom:1px solid var(--border);padding:1rem 1.5rem}.intent-banner-content{display:flex;align-items:flex-start;gap:.75rem}.intent-banner-icon{font-size:1.25rem;color:var(--accent);opacity:.9;width:24px;text-align:center;flex-shrink:0}.intent-banner-text{flex:1}.intent-banner-title{font-family:JetBrains Mono,monospace;font-size:.7rem;font-weight:700;color:var(--text-muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:.25rem}.intent-banner-desc{font-size:.95rem;color:var(--text-primary);margin-bottom:.5rem;font-weight:500}.intent-banner-focus{display:flex;flex-wrap:wrap;align-items:center;gap:.4rem}.focus-label{font-family:JetBrains Mono,monospace;font-size:.6rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:.5px}.focus-tag{font-size:.65rem;background:transparent;border:none;color:var(--text-muted);padding:0}.focus-tag:before{content:"•";margin-right:.35rem;color:var(--accent)}.intent-change-btn{background:var(--bg-input);border:1px solid var(--border);color:var(--accent);padding:6px 12px;border-radius:4px;cursor:pointer;font-size:.7rem;font-family:JetBrains Mono,monospace;text-transform:uppercase;transition:all .2s}.intent-change-btn:hover{border-color:var(--accent);background:var(--accent-dim)}.ai-link-btn{display:flex;align-items:center;justify-content:center;gap:.5rem;padding:.75rem 1rem;border-radius:4px;color:#fff;text-decoration:none;font-family:Inter,sans-serif;font-size:.8rem;font-weight:600;border:none;transition:transform .1s,opacity .2s}.ai-link-btn:hover{transform:translateY(-1px);opacity:.9}.ai-link-btn svg{width:18px;height:18px;flex-shrink:0}.ai-link-btn.claude{background:#c15f3c}.ai-link-btn.chatgpt{background:#4796e3}.ai-link-btn.gemini{background:#9177c7}#copySuccessModal .channel-modal-content{border:1px solid var(--accent);box-shadow:0 0 30px rgba(0,0,0,.5)}#copySuccessModal kbd{background:var(--bg-app);border:1px solid var(--border);color:var(--accent);font-family:JetBrains Mono,monospace;padding:2px 4px;border-radius:3px}
</style>
</head>
<body>
<!-- ==================== HERO VIEW ==================== -->
<div id="heroView" class="hero-view">
  <div class="terminal-logo"><span>>_</span>Govhoo</div>
  <p class="hero-subtitle">Follow the Money in Federal Sales. For Free.</p>
  
  <div class="search-box-container">
    <input 
      type="text" 
      id="mainSearchInput" 
      class="main-input" 
      placeholder="Search keywords, company, or agency..." 
      autocomplete="off"
    >
    <div class="btn-row">
      <button id="searchBtn" class="btn-primary">
        <i class="fas fa-search"></i> SEARCH
      </button>
      <button id="forecastBtn" class="btn-secondary">
        <i class="fas fa-chart-line"></i> FORECAST
      </button>
    </div>
  </div>

  <div class="search-tips">
    <div class="tip-header"><i class="fas fa-terminal"></i> SEARCH_TIPS</div>
    <div class="tip-row">
      <span class="cmd-hl">cloud computing</span>
      <span>Search award descriptions, vendors, and agencies.</span>
    </div>
    <div class="tip-row">
      <span class="cmd-hl">Company A, Company B</span>
      <span>Compare multiple competitors side-by-side.</span>
    </div>
    <div class="tip-row">
      <span class="cmd-hl">Fuzzy Search</span>
      <span>Quotes are ignored. "Pizza" returns pizza contracts AND Pizzaro's Construction. ¯\_(ツ)_/¯</span>
    </div>
    <div class="tip-row">
      <span class="cmd-hl">Search Mode</span>
      <span>Drill down by Agency to see Award flow for past 12 months.</span>
    </div>
    <div class="tip-row">
      <span class="cmd-hl">Forecast Mode</span>
      <span>Estimates TAM using historical data. Features per-quarter outlier detection and volatility risk scoring.</span>
    </div>
    <div class="tip-row">
      <span class="cmd-hl">Sales Plan Prompt</span>
      <span>Generates a downloadable prompt you can paste into your LLM of choice to produce a sales plan based on your search.</span>
    </div>
    <div class="tip-row">
      <span class="cmd-hl">Questions or Requests?</span>
      <span>DM me on <a href="https://www.linkedin.com/in/markflournoy/" target="_blank" style="color: var(--accent); text-decoration: underline;">LinkedIn</a></span>
    </div>
    <div class="tip-row">
      <span class="cmd-hl">Data sourced live from USASpending.gov</span>
    </div>
  </div>
</div>


<!-- ==================== APP VIEW ==================== -->
<div id="appView" style="display:none;">
  
  <!-- Header -->
  <header class="app-header">
    <div class="header-left">
      <span class="logo-btn" onclick="App.showHero()">>_Govhoo</span>
      <input type="text" id="miniSearch" class="mini-search" placeholder="New search...">
    </div>
    <div class="header-actions">
      <button class="icon-btn" id="toggleModeBtn" onclick="App.toggleMode()" title="Toggle Mode">
        <i class="fas fa-exchange-alt"></i>
      </button>
      <button class="icon-btn" onclick="App.shareLink(this)" title="Copy Share Link">
        <i class="fas fa-link"></i>
      </button>
      <button class="icon-btn" onclick="App.exportCSV(this)" title="Export CSV">
        <i class="fas fa-download"></i>
      </button>
    </div>
  </header>

  <!-- Dashboard Container -->
  <div id="dashboardContainer" class="dashboard-container">
    
    <!-- Mode Toggle -->
    <div class="mode-toggle">
      <button class="mode-btn active" id="modeSearchBtn" onclick="App.setMode('search')">
        <i class="fas fa-project-diagram"></i> Agency Award Flow
      </button>
      <button class="mode-btn" id="modeForecastBtn" onclick="App.setMode('forecast')">
        <i class="fas fa-brain"></i> Annual Forecast (BETA)
      </button>
    </div>


    <!-- ==================== SEARCH MODE VIEW ==================== -->
    <div id="searchModeView" class="view-section active">
      
      <!-- Stats Row -->
      <div class="stats-row" id="searchStats">
        <div class="stat-item">
          <div class="stat-label">TCV Awarded</div>
          <div class="stat-val" id="stat-vol">-</div>
          <div class="stat-sub neutral">Past 12 Months</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Contract Count</div>
          <div class="stat-val" id="stat-count">-</div>
          <div class="stat-sub neutral">Past 12 Months</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Prime Vendors</div>
          <div class="stat-val" id="stat-vendors">-</div>
          <div class="stat-sub neutral">Unique Recipients</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Agencies</div>
          <div class="stat-val" id="stat-agencies">-</div>
          <div class="stat-sub neutral">Awarding Agencies</div>
        </div>
      </div>

      <!-- Drill Breadcrumb -->
      <div id="drillBreadcrumb" class="drill-breadcrumb" style="display: none;">
        <div class="breadcrumb-item" onclick="App.resetDrill()">
          <i class="fas fa-globe breadcrumb-icon"></i>
          <span>All Agencies</span>
        </div>
      </div>

      <!-- Award Flow Section -->
      <div class="section-header">
        <div class="section-title-group">
          <i class="fas fa-project-diagram" style="color:var(--accent)"></i>
          <span class="section-title">Award Flow</span>
          <span id="drillLevelBadge" class="drill-level-indicator" style="display:none;">
            <i class="fas fa-layer-group"></i>
            <span id="drillLevelText">Level 1</span>
          </span>
        </div>
        <div class="header-controls">
          <div id="filterBadge" class="filter-badge" onclick="App.clearFilter()">
            <span id="filterName">FILTER</span>
            <i class="fas fa-times"></i>
          </div>
          <div class="time-badge">PAST 12 MONTHS</div>
        </div>
      </div>
      
      <div class="chart-wrapper">
        <div id="chartContainer" class="chart-container"></div>
      </div>
      
      <div id="drillHint" class="drill-hint">
        <i class="fas fa-mouse-pointer"></i>
        <span>Click an <strong>agency bar</strong> to drill into sub-agencies</span>
      </div>

      <!-- Sub-Agency Panel -->
      <div id="subagencyPanel" class="subagency-panel" style="display: none;">
        <div class="subagency-header">
          <div class="subagency-header-left">
            <div class="subagency-header-icon">
              <i class="fas fa-building"></i>
            </div>
            <div class="subagency-header-text">
              <h3 id="subagencyParentName">Department of Defense</h3>
              <span id="subagencyParentType">Parent Agency</span>
            </div>
          </div>
          <div class="subagency-stats">
            <div class="subagency-stat">
              <div class="subagency-stat-val" id="subagencyTotalAmount">$0</div>
              <div class="subagency-stat-label">Total Value</div>
            </div>
            <div class="subagency-stat">
              <div class="subagency-stat-val" id="subagencyCount">0</div>
              <div class="subagency-stat-label">Sub-Agencies</div>
            </div>
          </div>
        </div>
        <div class="subagency-list" id="subagencyList"></div>
      </div>

      <!-- Contract Feed Section -->
      <div class="section-header">
        <div class="section-title-group">
          <i class="fas fa-list-ul" style="color:var(--accent)"></i>
          <span class="section-title">Contract Award Feed</span>
        </div>
      </div>
      <div id="feedGrid" class="feed-grid"></div>
      
    </div>


    <!-- ==================== FORECAST MODE VIEW ==================== -->
    <div id="forecastModeView" class="view-section">
      
      <!-- Forecast Stats Row -->
      <div class="stats-row" id="forecastStats">
        <div class="stat-item">
          <div class="stat-label" style="color:var(--accent); font-weight:700;">Estimated TAM</div>
          <div class="stat-val" id="stat-baseline">-</div>
          <div class="stat-sub neutral">FY Projected Volume</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Market</div>
          <div class="stat-val" id="stat-market">-</div>
          <div class="stat-sub" id="stat-hhi">-</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Peak Season</div>
          <div class="stat-val" id="stat-peak">-</div>
          <div class="stat-sub neutral">Seasonal Index</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Recompetes</div>
          <div class="stat-val" id="stat-recompetes">-</div>
          <div class="stat-sub" style="color:var(--danger)">Expiring < 2Y</div>
        </div>
      </div>

      <!-- Intelligent Forecast Section -->
      <div class="section-header">
        <div class="section-title-group">
          <i class="fas fa-brain" style="color:var(--accent)"></i>
          <span class="section-title">Intelligent Forecast</span>
        </div>
      </div>
      <div id="marketInsights" class="insight-grid"></div>

      <!-- Forecast Table -->
      <div class="forecast-table-wrapper">
        <table class="forecast-table">
          <thead>
            <tr>
              <th>Period</th>
              <th>Predicted</th>
              <th>Hist. Avg</th>
              <th>Trend</th>
              <th>Confidence</th>
            </tr>
          </thead>
          <tbody id="forecastTableBody"></tbody>
        </table>
      </div>

      <!-- Historical Performance Section -->
      <div class="section-header" style="margin-top:2rem;">
        <div class="section-title-group">
          <i class="fas fa-chart-bar" style="color:var(--accent)"></i>
          <span class="section-title">Historical Performance</span>
        </div>
      </div>
      <div class="chart-wrapper chart-wrapper-sm">
        <canvas id="spendingChart"></canvas>
      </div>

      <!-- Strategic Analysis Section -->
      <div id="strategySection" style="margin-top: 2rem; display:none;">
        <div class="section-header">
          <div class="section-title-group">
            <i class="fas fa-chess-knight" style="color:var(--accent)"></i>
            <span class="section-title">Strategic Analysis</span>
          </div>
        </div>

        <!-- Outlook Card -->
        <div class="deal-card" style="border-left: 4px solid var(--accent); margin-bottom: 1.5rem; background: linear-gradient(to right, rgba(212, 196, 168, 0.05), transparent);">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:0.75rem;">
            <span style="font-size:0.75rem; color:var(--accent); font-weight:700; letter-spacing:1px;">OUTLOOK</span>
            <span id="strat-outlook" style="font-size:1rem; font-weight:700; color:#fff;">--</span>
          </div>
          <div id="strat-text" style="font-size: 0.9rem; color: #ccc; margin-bottom: 1.25rem; line-height: 1.5;"></div>
          <div style="padding-top:1rem; border-top:1px solid rgba(255,255,255,0.1);">
            <div style="font-size:0.7rem; color:#888; text-transform:uppercase; margin-bottom:4px;">Recommended Action</div>
            <div id="strat-action" style="font-size:0.95rem; color:white; font-weight:500;"></div>
          </div>
        </div>

        <!-- Strategy Matrix Cards -->
        <div class="insight-grid" style="grid-template-columns: repeat(3, 1fr); gap:0.75rem; margin-bottom: 1.5rem;">
          <div class="insight-card" style="padding: 0.75rem;">
            <div class="insight-label">BD Investment</div>
            <div id="matrix-bd" style="font-size:0.9rem; font-weight:600; color:white; margin:4px 0;">--</div>
            <div class="stat-sub neutral" style="font-size:0.65rem;">vs. Growth Trend</div>
          </div>
          <div class="insight-card" style="padding: 0.75rem;">
            <div class="insight-label">Capture Strategy</div>
            <div id="matrix-strat" style="font-size:0.9rem; font-weight:600; color:white; margin:4px 0;">--</div>
            <div class="stat-sub neutral" style="font-size:0.65rem;">vs. Competition</div>
          </div>
          <div class="insight-card" style="padding: 0.75rem;">
            <div class="insight-label">Pipeline Focus</div>
            <div id="matrix-pipe" style="font-size:0.9rem; font-weight:600; color:white; margin:4px 0;">--</div>
            <div class="stat-sub neutral" style="font-size:0.65rem;">vs. Opportunity</div>
          </div>
        </div>

        <!-- Model Limitations -->
        <div style="background:rgba(255,255,255,0.02); padding:1rem; border:1px solid #333; border-radius:4px; margin-bottom: 2rem;">
          <div style="display:flex; align-items:center; gap:8px; margin-bottom:0.75rem; color:var(--text-muted); font-size:0.75rem; font-weight:700; letter-spacing:0.5px;">
            <i class="fas fa-info-circle"></i> MODEL LIMITATIONS & LOGIC
          </div>
          <ul style="margin:0; padding-left:1.2rem; color:#888; font-size:0.8rem; line-height:1.6;">
            <li style="margin-bottom:4px;">
              <strong>TAM (Total Addressable Market):</strong>
              Projected annual volume based on <em>aggregate historical obligations</em> from USASpending. Uses a recency-weighted average of completed Fiscal Years.
            </li>
            <li style="margin-bottom:4px;">
              <strong>Awards vs. Forecast Gap:</strong>
              "Total Awards" reflects <em>Total Contract Value (Ceiling)</em>. "Forecast" projects <em>Actual Obligated Spending</em> (cash flow). Large deltas represent unfunded ceiling capacity.
            </li>
            <li style="margin-bottom:4px;">
              <strong>Historical Basis:</strong>
              Forecasts rely entirely on seasonal trends. The model cannot predict budget cuts, policy shifts, or CRs.
            </li>
            <li>
              <strong>Confidence Score:</strong>
              Based solely on data availability and volatility. "High" requires 3+ years of consistent growth or stable trends.
            </li>
          </ul>
        </div>
      </div>

      <!-- Methodology Section -->
      <div class="section-header">
        <div class="section-title-group">
          <i class="fas fa-code-branch" style="color:var(--accent)"></i>
          <span class="section-title">Forecast Methodology</span>
        </div>
      </div>
      <div class="methodology-card" style="grid-template-columns: repeat(2, 1fr); gap:1rem;">
        <div class="method-item" style="border:none;">
          <div class="method-title"><i class="fas fa-layer-group"></i> Top-Down Volume</div>
          <div class="method-desc">
            Forecasts <strong>Total Annual Spending</strong> using a weighted average of the last 3 fiscal years to create a stable baseline.
          </div>
        </div>
        <div class="method-item" style="border:none;">
          <div class="method-title"><i class="fas fa-chart-area"></i> Seasonality</div>
          <div class="method-desc">
            Analyzes historical spending patterns to determine the unique "shape" of the fiscal year and distributes annual forecast accordingly.
          </div>
        </div>
        <div class="method-item" style="border:none;">
          <div class="method-title"><i class="fas fa-filter"></i> Outlier Removal</div>
          <div class="method-desc">
            Anomalies are filtered on a <strong>per-quarter basis</strong> to distinguish between seasonal spikes and one-off events.
          </div>
        </div>
        <div class="method-item" style="border:none;">
          <div class="method-title"><i class="fas fa-balance-scale"></i> Market Context</div>
          <div class="method-desc">
            Calculates <strong>Herfindahl-Hirschman Index (HHI)</strong> to measure market concentration and competitive density.
          </div>
        </div>
      </div>

      <!-- Recompetes List -->
      <div id="recompetesList" style="margin-top:2rem;"></div>
      
    </div>

  </div>
</div>


<!-- ==================== LOADER OVERLAY ==================== -->
<div id="loader" class="loader">
  <div class="spinner"></div>
  <p id="loaderText" style="margin-top:1rem; font-family:'JetBrains Mono'; color:var(--accent);">
    RETRIEVING DATA...
  </p>
  <p id="loaderSubtext" style="color:#666; font-size:0.8rem; margin-top:0.5rem;"></p>
</div>


<!-- ==================== SALES PLAN MODAL ==================== -->
<div id="salesPlanModal" class="channel-marking-modal">
  <div class="channel-modal-content" style="max-width: 900px; max-height: 85vh; display:flex; flex-direction:column;">
    
    <!-- Modal Header -->
    <div class="channel-modal-header">
      <div class="channel-modal-title">
        <i class="fas fa-rocket"></i> Generate Sales Plan
      </div>
      <button class="channel-modal-close" onclick="SalesPlanManager.close()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <!-- Modal Body -->
    <div class="channel-modal-body" style="flex:1; overflow-y:auto; padding:0;">
      
      <!-- Intent Detection Banner -->
      <div id="spIntentBanner"></div>
      
      <!-- Step 1: Scope -->
      <div style="padding:1.5rem; border-bottom:1px solid var(--border);">
        <div style="font-size:0.75rem; color:var(--text-muted); font-weight:600; margin-bottom:1rem; text-transform:uppercase; letter-spacing:1px;">
          Step 1: Define Plan Scope
        </div>
        <div class="step-grid" style="display:grid; grid-template-columns: 1fr 1fr; gap:1.5rem;">
          <div>
            <label style="display:block; font-size:0.7rem; color:var(--text-muted); margin-bottom:0.5rem; font-weight:600; text-transform:uppercase; letter-spacing:0.5px;">
              Plan Scope / Sector
            </label>
            <select id="spScope" class="main-input" style="padding:0.6rem; font-size:0.9rem; background:var(--bg-app);">
              <option value="all">Entire Market (All Results)</option>
              <option value="defense">Defense (DoD & Branches)</option>
              <option value="civilian">Federal Civilian (Non-DoD)</option>
              <optgroup label="Specific Agencies" id="spSpecificAgencies"></optgroup>
            </select>
          </div>
          <div>
            <label style="display:block; font-size:0.7rem; color:var(--text-muted); margin-bottom:0.5rem; font-weight:600; text-transform:uppercase; letter-spacing:0.5px;">
              Strategic Goal
              <span style="cursor:help; margin-left:4px;" title="Growth = New business pursuit&#10;Retention = Defend existing contracts&#10;Partnership = Channel/partner optimization">ⓘ</span>
            </label>
            <select id="spFocus" class="main-input" style="padding:0.6rem; font-size:0.9rem; background:var(--bg-app);">
              <option value="Growth">Aggressive Growth (New Business)</option>
              <option value="Retention">Retention (Defend Incumbency)</option>
              <option value="Partnership">Partner/Channel Strategy</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Step 2: Vendor Classification -->
      <div style="padding:1.5rem;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
          <div style="font-size:0.75rem; color:var(--text-muted); font-weight:600; text-transform:uppercase; letter-spacing:1px;">
            Step 2: Classify Vendors
          </div>
          <div id="spBulkActionContainer"></div>
        </div>
        
        <div style="background:rgba(255,255,255,0.03); padding:0.75rem; border-radius:4px; margin-bottom:1.5rem; font-size:0.8rem; color:var(--text-muted);">
          <i class="fas fa-magic" style="color:var(--accent); margin-right:0.5rem;"></i>
          <strong>Smart Detection:</strong> We've pre-identified likely resellers based on known patterns. Accept our suggestions or customize below.
        </div>

        <div id="spVendorList"></div>
      </div>
    </div>

    <!-- Modal Footer -->
    <div class="channel-modal-footer" style="background:var(--bg-card); border-top:1px solid var(--border);">
      <div style="flex:1; font-size:0.75rem; color:var(--text-muted); display:flex; align-items:center; gap:0.5rem;">
        <div id="spDataStatus"></div>
      </div>
      <button class="modal-btn modal-btn-cancel" onclick="SalesPlanManager.close()">
        Cancel
      </button>
      <button class="modal-btn modal-btn-cancel" onclick="SalesPlanManager.generate()" title="Download as .txt file">
        <i class="fas fa-download"></i> Download .txt
      </button>
      <button id="btnCopyPrompt" class="modal-btn modal-btn-primary" onclick="SalesPlanManager.copyPrompt()" style="min-width: 180px;">
        <i class="fas fa-copy"></i> Copy → Paste to AI
      </button>
    </div>
    
  </div>
</div>
<script>
const Utils={money:e=>e||0===e?e>=1e9?"$"+(e/1e9).toFixed(1)+"B":e>=1e6?"$"+(e/1e6).toFixed(1)+"M":e>=1e3?"$"+(e/1e3).toFixed(0)+"K":"$"+Math.round(e).toLocaleString():"-",trunc:(e,t)=>e&&e.length>t?e.substring(0,t)+"...":e||"No Description",date:e=>e?new Date(e).toLocaleDateString():"—",formatDateISO:e=>e.toISOString().split("T")[0],getCurrentFY:()=>{const e=new Date;return e.getMonth()>=9?e.getFullYear()+1:e.getFullYear()},getCurrentQuarter:()=>{const e=(new Date).getMonth();return e>=9?1:e<=2?2:e<=5?3:4},getColor:e=>{const t=["#958BB6","#6F8A74","#C27E5C","#8FB6D0","#B0C4DE","#D9B48F"];let n=0;for(let t=0;t<e.length;t++)n=e.charCodeAt(t)+((n<<5)-n);return t[Math.abs(n)%t.length]}},ModalUtils={activeModal:null,previousFocus:null,open(e){const t=document.getElementById(e);if(!t)return;this.previousFocus=document.activeElement,document.body.style.overflow="hidden",t.classList.add("active"),this.activeModal=t;const n=t.querySelector("button, input, select, textarea");n&&setTimeout((()=>n.focus()),50),this._boundKeydown=this.handleKeydown.bind(this),this._boundBackdrop=this.handleBackdropClick.bind(this),document.addEventListener("keydown",this._boundKeydown),t.addEventListener("click",this._boundBackdrop)},close(){if(!this.activeModal)return;const e=this.activeModal;e.classList.remove("active"),document.body.style.overflow="",this.previousFocus&&this.previousFocus.focus&&this.previousFocus.focus(),document.removeEventListener("keydown",this._boundKeydown),e.removeEventListener("click",this._boundBackdrop),this.activeModal=null},handleKeydown(e){if("Escape"!==e.key){if("Tab"===e.key&&this.activeModal){const t=this.activeModal.querySelectorAll('button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])');if(0===t.length)return;const n=t[0],a=t[t.length-1];e.shiftKey&&document.activeElement===n?(e.preventDefault(),a.focus()):e.shiftKey||document.activeElement!==a||(e.preventDefault(),n.focus())}}else this.close()},handleBackdropClick(e){e.target===this.activeModal&&this.close()}},API={baseUrl:"https://api.usaspending.gov/api/v2",async searchAwards(e){const t=new Date,n=new Date;n.setFullYear(t.getFullYear()-1);const a={start_date:Utils.formatDateISO(n),end_date:Utils.formatDateISO(t)},r=e.split(",").map((e=>e.trim())).filter((e=>e.length>0)).map((e=>fetch(`${this.baseUrl}/search/spending_by_award/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filters:{keywords:[e],time_period:[a],award_type_codes:["A","B","C","D"]},fields:["Award ID","Recipient Name","Awarding Agency","Awarding Sub Agency","Award Amount","Description","generated_internal_id","Start Date","End Date","NAICS Code","NAICS Description","PSC Code","PSC Description"],limit:100,sort:"Award Amount",order:"desc"})}).then((e=>e.json())))),i=await Promise.all(r);let s=[];i.forEach((e=>{e.results&&(s=s.concat(e.results))}));const o=new Map;return s.forEach((e=>{o.has(e["Award ID"])||o.set(e["Award ID"],e)})),Array.from(o.values()).sort(((e,t)=>t["Award Amount"]-e["Award Amount"]))},async getSpendingOverTime(e,t=4){const n=Utils.getCurrentFY(),a=[];for(let e=n-t;e<=n;e++)a.push({start_date:e-1+"-10-01",end_date:`${e}-09-30`});const r=await fetch(`${this.baseUrl}/search/spending_over_time/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({group:"quarter",filters:{keywords:[e],time_period:a,award_type_codes:["A","B","C","D"]}})});return(await r.json()).results||[]},async getAgencyData(e,t=3){const n=Utils.getCurrentFY(),a=[{start_date:n-t-1+"-10-01",end_date:`${n}-09-30`}],r=await fetch(`${this.baseUrl}/search/spending_by_category/awarding_agency`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({category:"awarding_agency",filters:{keywords:[e],time_period:a,award_type_codes:["A","B","C","D"]},limit:100})});return(await r.json()).results||[]},async getAwardsForForecast(e,t=3){const n=Utils.getCurrentFY(),a=[{start_date:n-t-1+"-10-01",end_date:`${n+5}-09-30`}],r=await fetch(`${this.baseUrl}/search/spending_by_award/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filters:{keywords:[e],time_period:a,award_type_codes:["A","B","C","D"]},fields:["Award ID","Recipient Name","Description","Start Date","End Date","Award Amount","Awarding Agency","Awarding Sub Agency","generated_internal_id","NAICS Code","NAICS Description","PSC Code","PSC Description"],limit:100,sort:"Award Amount",order:"desc"})});return(await r.json()).results||[]}},ForecastEngine={analyze(e,t,n){const a=this.organizeByQuarter(e),r=this.filterOutliers(a),i=this.calculateSeasonalProfile(r),s=this.calculateAnnualForecast(r),o=this.detectRecompetes(t),c=this.analyzeMarketConcentration(n),l=this.generateForecasts(s,i,r),d=this.generateStrategy(l,c.hhi,o);return{forecasts:l,recompetes:o,baseline:s,marketStatus:c.level,hhi:c.hhi,indices:i,byFY:a.byFY,strategy:d}},organizeByQuarter(e){const t={byFY:{},byQuarter:{},totalByFY:{},allAmounts:[]};return e.forEach((e=>{const n=parseInt(e.time_period?.quarter),a=parseInt(e.time_period?.fiscal_year),r=e.aggregated_amount||0;n&&a&&(t.byFY[a]||(t.byFY[a]={1:0,2:0,3:0,4:0}),t.byFY[a][n]=r,t.byQuarter[n]||(t.byQuarter[n]=[]),t.byQuarter[n].push({fy:a,amt:r}),t.totalByFY[a]=(t.totalByFY[a]||0)+r,t.allAmounts.push({fy:a,q:n,amt:r}))})),t},filterOutliers(e){const t={byFY:{},byQuarter:{},totalByFY:{},allAmounts:[]};Object.keys(e.byFY).forEach((e=>t.byFY[e]={}));for(let n=1;n<=4;n++){const a=e.byQuarter[n]||[],r=a.map((e=>e.amt));if(r.length<3){a.forEach((e=>{t.byQuarter[n]=t.byQuarter[n]||[],t.byQuarter[n].push(e),t.byFY[e.fy][n]=e.amt,t.totalByFY[e.fy]=(t.totalByFY[e.fy]||0)+e.amt}));continue}const i=r.reduce(((e,t)=>e+t),0)/r.length,s=r.reduce(((e,t)=>e+Math.pow(t-i,2)),0)/r.length,o=Math.sqrt(s),c=i+2*o;a.forEach((e=>{e.amt<=c&&(t.byQuarter[n]=t.byQuarter[n]||[],t.byQuarter[n].push(e),t.byFY[e.fy][n]=e.amt,t.totalByFY[e.fy]=(t.totalByFY[e.fy]||0)+e.amt)}))}return t},calculateSeasonalProfile(e){const t={1:0,2:0,3:0,4:0},n={1:0,2:0,3:0,4:0};Object.keys(e.totalByFY).forEach((a=>{const r=e.totalByFY[a];if(r<=0)return;if(!(Object.values(e.byFY[a]).filter((e=>e>0)).length<3))for(let i=1;i<=4;i++){const s=e.byFY[a][i]||0;t[i]+=s/r,n[i]++}}));const a={};let r=0;for(let e=1;e<=4;e++)a[e]=n[e]?t[e]/n[e]:.25,r+=a[e];for(let e=1;e<=4;e++)a[e]=a[e]/r;return a},calculateAnnualForecast(e){const t=Utils.getCurrentFY(),n=Object.keys(e.totalByFY).map(Number).sort(((e,t)=>e-t)).filter((n=>n<t&&e.totalByFY[n]>0));if(0===n.length)return 0;let a=0,r=0;n.forEach(((t,n)=>{const i=n+1;a+=e.totalByFY[t]*i,r+=i}));let i=a/r;if(n.length>=2){i=.7*i+.3*e.totalByFY[n[n.length-1]]}return i},analyzeMarketConcentration(e){const t=e.reduce(((e,t)=>e+t.amount),0);let n=0;e.forEach((e=>{const a=e.amount/t*100;n+=a*a}));let a="Competitive";return n>2500?a="Concentrated":n>1500&&(a="Moderate"),{hhi:Math.round(n),level:a}},detectRecompetes(e){const t=new Date,n=new Date;n.setMonth(t.getMonth()+6);const a=new Date;return a.setFullYear(t.getFullYear()+2),e.filter((e=>{const t=new Date(e["End Date"]);return t>n&&t<a&&e["Award Amount"]>5e4})).slice(0,15)},generateForecasts(e,t,n){const a=[];let r=Utils.getCurrentFY(),i=Utils.getCurrentQuarter();for(let s=0;s<4;s++){const s=e*t[i],o=n.byQuarter[i]||[],c=o.filter((e=>e.amt>0)).sort(((e,t)=>e.fy-t.fy)),l=o.length?o.reduce(((e,t)=>e+t.amt),0)/o.length:0;let d=0;if(c.length>1){const e=c.reduce(((e,t)=>e+t.amt),0)/c.length,t=c.reduce(((t,n)=>t+Math.pow(n.amt-e,2)),0)/(c.length-1);d=Math.sqrt(t)/e}let p=!1;if(c.length>=3){p=!0;for(let e=1;e<c.length;e++)if(c[e].amt<=c[e-1].amt){p=!1;break}}let u=0;l>0?u=(s-l)/l*100:s>0&&(u=100);let m="Low",g="Insufficient Data";if(0===o.length)m="Low",g="No History";else if(0===c.length)m="Low",g="Inactive";else{const e=c.length>=3,t=c.length<o.length;e&&!t?p?(m="High",g="Consistent Growth"):d<.5?(m="High",g="Stable Trend"):d<1?(m="Med",g="Moderate Variance"):(m="Low",g="High Volatility"):e&&t?(m="Med",g="Intermittent"):d<.2?(m="Med",g="Limited but Stable"):(m="Low",g="Limited History")}a.push({period:`FY${r} Q${i}`,predicted:s,histAvg:l,trend:u>0?`+${u.toFixed(1)}`:u.toFixed(1),confidence:{label:m,reason:g}}),i++,i>4&&(i=1,r++)}return a},generateStrategy(e,t,n){if(!e||e.length<2)return null;const a=e.slice(0,2),r=a.reduce(((e,t)=>e+parseFloat(t.trend)),0)/a.length;let i="Moderate";r>30?i="High Growth":r<-20&&(i="Decline");let s="Moderate";t>2500?s="Concentrated":t<1500&&(s="Competitive");let o="",c="";"High Growth"===i?(o=`The model projects positive variance (+${r.toFixed(1)}% avg) compared to historical baselines. While data suggests upward momentum, users should verify if this is due to new funding or statistical anomalies in prior years.`,c="Validate pipeline depth. Assess capacity before committing additional resources."):"Decline"===i?(o=`The model projects a softening trend (${r.toFixed(1)}% avg). Volume may be lower than historical norms for this period.`,c="Focus business development efforts strictly on high-probability recompetes and existing relationships."):(o="The model suggests stability, with projected volume tracking close to historical averages.",c="Maintain consistent business development cadence. Focus on capture quality over volume."),"Concentrated"===s?(o+=" High concentration (HHI > 2500) suggests incumbent dominance.",c+=" Teaming with incumbents is recommended."):"Competitive"===s&&(o+=" Low concentration (HHI < 1500) implies a fragmented landscape.",c+=" A broader prospecting approach may yield results.");return{title:"High Growth"===i?"Growth Projected":"Decline"===i?"Softening Projected":"Stable Outlook",text:o,action:c,matrix:{bd:"High Growth"===i?"Validate & Assess":"Decline"===i?"Selective Focus":"Maintain Steady",strat:"Concentrated"===s?"Relationship Focus":"Competitive"===s?"Volume Bidding":"Balanced Approach",pipe:n.length>5?"Incumbent Displacement":"New Requirements"}}}},KnownVendors={vars:new Set(["CARAHSOFT TECHNOLOGY CORP","CARAHSOFT TECHNOLOGY CORPORATION","CDW GOVERNMENT LLC","CDW-G","SHI INTERNATIONAL CORP","SHI GOVERNMENT SOLUTIONS","INSIGHT PUBLIC SECTOR INC","INSIGHT DIRECT USA INC","GOVPLACE, LLC","GOVPLACE LLC","IMMIX GROUP INC","IMMIXGROUP INC","DLT SOLUTIONS LLC","DLT SOLUTIONS","THUNDERCAT TECHNOLOGY, LLC","THUNDERCAT TECHNOLOGY LLC","WORLD WIDE TECHNOLOGY LLC","WWT GOVERNMENT SERVICES","PRESIDIO NETWORKED SOLUTIONS","PRESIDIO GOVERNMENT SOLUTIONS","CONNECTION","PC CONNECTION","PCMG INC","EN POINTE TECHNOLOGIES","STERLING COMPUTERS CORPORATION","STERLING COMPUTERS","MERLIN INTERNATIONAL","RED RIVER TECHNOLOGY","MYTHICS INC","MYTHICS LLC","FOUR POINTS TECHNOLOGY","FOUR POINTS TECHNOLOGY LLC","SILOTECH GROUP INC","DECISIVE COMMUNICATIONS INC","FCN INC","FCN, INC.","SOFTCHOICE CORPORATION","SOFTCHOICE","TRACE3","OPTIV SECURITY INC","OPTIV SECURITY","FEDSTORE CORPORATION","FEDSTORE","GOVSMART INC","GOVSMART, INC.","NEW TECH SOLUTIONS","NEW TECH SOLUTIONS, INC.","PANAMERICA COMPUTERS","PANAMERICA COMPUTERS, INC.","SOFTWARE INFORMATION RESOURCE CORP","ACCESSAGILITY LLC","BLUE TECH INC","BLUE TECH INC.","DH TECHNOLOGIES","DH TECHNOLOGIES, INC.","IT1 SOURCE LLC","ENTERPRISE TECHNOLOGY SOLUTIONS","ENTERPRISE TECHNOLOGY SOLUTIONS, INC.","DISTRIBUTED TECHNOLOGY GROUP LLC","ARCHITECHTURE SOLUTIONS LLC","ADVANCED COMPUTER CONCEPTS","ADVANCED COMPUTER CONCEPTS, INC.","4 STAR TECHNOLOGIES","4 STAR TECHNOLOGIES, INC.","THREE WIRE SYSTEMS","THREE WIRE SYSTEMS, LLC","C & C INTERNATIONAL COMPUTERS"]),primes:new Set(["BOOZ ALLEN HAMILTON","BOOZ ALLEN HAMILTON INC","GENERAL DYNAMICS INFORMATION TECHNOLOGY","GENERAL DYNAMICS IT","GDIT","LEIDOS INC","LEIDOS HOLDINGS","LEIDOS","SAIC","SCIENCE APPLICATIONS INTERNATIONAL","NORTHROP GRUMMAN","RAYTHEON","LOCKHEED MARTIN","LOCKHEED MARTIN CORPORATION","BAE SYSTEMS","L3HARRIS TECHNOLOGIES","CACI INTERNATIONAL","CACI INC","MANTECH INTERNATIONAL","MANTECH","PERATON INC","PERATON","ACCENTURE FEDERAL SERVICES","ACCENTURE","DELOITTE CONSULTING","DELOITTE","IBM CORPORATION","IBM","KPMG","CGI FEDERAL","CGI TECHNOLOGIES","MAXIMUS INC","MAXIMUS FEDERAL","ICF INTERNATIONAL","ICF INC","SERCO INC","SERCO","PAE INCORPORATED","AMENTUM","JACOBS TECHNOLOGY","KBR INC"]),classify(e){const t=e.toUpperCase().trim();if(this.vars.has(t))return"var";if(this.primes.has(t))return"prime";for(const e of this.vars)if(t.includes(e)||e.includes(t))return"var";for(const e of this.primes)if(t.includes(e)||e.includes(t))return"prime";const n=[/\b(TECHNOLOGY|TECHNOLOGIES)\s*(CORP|LLC|INC)/i,/\b(COMPUTERS?|COMPUTING)\s*(CORP|LLC|INC)/i,/\bSOLUTIONS?\s*(CORP|LLC|INC)/i,/\bGOV(PLACE|SMART|STORE)/i,/\bFEDERAL\s*(SOLUTIONS|TECHNOLOGY)/i];for(const e of n)if(e.test(t))return"likely_var";return"unknown"}},SalesPlanManager={channels:new Set,currentVendors:[],detectedIntent:null,init(){const e=localStorage.getItem("govhoo_channels");e&&(this.channels=new Set(JSON.parse(e)))},isChannel(e){return this.channels.has(e)},detectIntent(e){const t=App.currentQuery||"",n={};let a=0;e.forEach((e=>{const t=e["Recipient Name"]||"Unknown",r=parseFloat(e["Award Amount"])||0;n[t]=(n[t]||0)+r,a+=r}));const r=Object.entries(n).map((([e,t])=>({name:e,spend:t,share:t/a}))).sort(((e,t)=>t.spend-e.spend));let i=0,s=0;r.forEach((e=>{this.isChannel(e.name)&&(i+=e.spend,s++)}));const o=a>0?i/a:0;if(o>.7&&s>=3)return{type:"product_oem",icon:"fa-box",title:"PRODUCT / OEM CHANNEL",description:`${(100*o).toFixed(1)}% of revenue flows through ${s} channel partners`,focusAreas:["Channel performance & rankings","Partner enablement priorities","Recompete defense by partner","Agency coverage gaps"],suggestedGoal:"Partnership"};const c=r[0];if(c&&t.toLowerCase().includes(c.name.toLowerCase().split(" ")[0]))return{type:"own_company",icon:"fa-building",title:"YOUR COMPANY ANALYSIS",description:`Analyzing your market position: ${Utils.money(c.spend)} (${(100*c.share).toFixed(1)}% share)`,focusAreas:["Defend existing contracts","Identify growth opportunities","Competitive threats to your position","Recompete calendar & defense"],suggestedGoal:"Retention"};return["department","agency","administration","commission","bureau"].some((e=>t.toLowerCase().includes(e)))?{type:"agency",icon:"fa-landmark",title:"AGENCY PENETRATION",description:"Analyzing how to enter or expand within this customer",focusAreas:["Agency mission & budget priorities","Current vendor landscape","Entry points & opportunities","Key contracting vehicles"],suggestedGoal:"Growth"}:{type:"market_keyword",icon:"fa-chart-line",title:"MARKET ANALYSIS",description:`Analyzing the "${t}" market landscape`,focusAreas:["Market size & growth trends","Competitive landscape","Top agencies & opportunities","Entry strategy recommendations"],suggestedGoal:"Growth"}},open(){const e=App.forecastData.awards||App.searchData.raw||[];if(!e.length)return void alert("No award data loaded. Please run a search or forecast first.");this.detectedIntent=this.detectIntent(e);const t={};e.forEach((e=>{const n=e["Awarding Agency"];n&&(t[n]=(t[n]||0)+1)}));const n=Object.entries(t).sort(((e,t)=>t[1]-e[1])).map((([e,t])=>`<option value="${e}">${e} (${t} awards)</option>`)).join("");document.getElementById("spSpecificAgencies").innerHTML=n,document.getElementById("spScope").value="all",document.getElementById("spFocus").value=this.detectedIntent.suggestedGoal,this.prepareVendorList(e),this.renderIntentBanner(),this.updateStatus(e.length,"Entire Market"),this.renderSmartVendorList(),ModalUtils.open("salesPlanModal")},close(){ModalUtils.close();const e=document.getElementById("copySuccessModal");e&&e.classList.remove("active")},renderIntentBanner(){const e=document.getElementById("spIntentBanner");if(!e||!this.detectedIntent)return;const t=this.detectedIntent;e.innerHTML=`\n      <div class="intent-banner-content">\n        <div class="intent-banner-icon"><i class="fas ${t.icon}"></i></div>\n        <div class="intent-banner-text">\n          <div class="intent-banner-title">${t.title}</div>\n          <div class="intent-banner-desc">${t.description}</div>\n          <div class="intent-banner-focus">\n            ${t.focusAreas.map((e=>`<span class="focus-tag">${e}</span>`)).join("")}\n          </div>\n        </div>\n      </div>\n    `,e.style.display="block"},showIntentOptions(){const e=document.getElementById("spFocus");e.focus(),e.style.outline="2px solid var(--accent)",setTimeout((()=>e.style.outline=""),2e3)},getFilteredData(){const e=document.getElementById("spScope").value,t=document.getElementById("spFocus").value,n=App.forecastData.awards||App.searchData.raw||[];let a=[],r="Entire Market";if("all"===e?a=n:"defense"===e?(a=n.filter((e=>/defense|army|navy|air force|marine|space force/i.test(e["Awarding Agency"]))),r="Defense Sector"):"civilian"===e?(a=n.filter((e=>!/defense|army|navy|air force|marine|space force/i.test(e["Awarding Agency"]))),r="Federal Civilian Sector"):(a=n.filter((t=>t["Awarding Agency"]===e)),r=e),0===a.length)throw new Error("No awards found for the selected scope.");return{filteredAwards:a,scopeName:r,focus:t}},generate(){App.showLoader("GENERATING PLAN...","Filtering data & packaging prompt..."),setTimeout((()=>{try{const{filteredAwards:e,scopeName:t,focus:n}=this.getFilteredData(),a=PromptPackageGenerator.buildPackage(e,null,{scope:t,focus:n});PromptPackageGenerator.downloadPackage(a),this.close()}catch(e){console.error(e),alert(e.message||"Error generating plan")}finally{App.hideLoader()}}),500)},async copyPrompt(){const e=document.getElementById("btnCopyPrompt");if(!e)return;const t=e.innerHTML;e.innerHTML='<i class="fas fa-spinner fa-spin"></i> Generating...',e.style.opacity="0.7",e.style.pointerEvents="none";try{const{filteredAwards:n,scopeName:a,focus:r}=this.getFilteredData(),i=PromptPackageGenerator.buildPackage(n,null,{scope:a,focus:r});await navigator.clipboard.writeText(i),this.showCopySuccessModal(i.length),e.innerHTML=t,e.style.opacity="1",e.style.pointerEvents="auto"}catch(n){console.error(n),alert(n.message||"Error copying prompt"),e.innerHTML=t,e.style.opacity="1",e.style.pointerEvents="auto"}},showCopySuccessModal(e){let t=document.getElementById("copySuccessModal");t||(t=document.createElement("div"),t.id="copySuccessModal",t.className="channel-marking-modal",document.body.appendChild(t));const n=Math.round(e/4);t.innerHTML=`\n      <div class="channel-modal-content" style="max-width: 420px; height: auto;">\n        <div class="channel-modal-header" style="border-bottom-color: var(--success);">\n          <div class="channel-modal-title" style="color: var(--success);">\n            <i class="fas fa-check-circle"></i> Copied to Clipboard\n          </div>\n          <button class="channel-modal-close" onclick="SalesPlanManager.closeSuccessModal()">\n            <i class="fas fa-times"></i>\n          </button>\n        </div>\n        \n        <div class="channel-modal-body" style="padding: 1.5rem;">\n          <div style="margin-bottom: 1.25rem;">\n            <div style="font-size: 0.95rem; color: #fff; font-weight: 500; margin-bottom: 0.25rem;">Your prompt is ready</div>\n            <div style="font-size: 0.8rem; color: var(--text-muted);">\n              ${e.toLocaleString()} chars · ~${n.toLocaleString()} tokens\n            </div>\n          </div>\n          \n          <div style="font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.5rem;">\n            Open in\n          </div>\n          <div style="display: flex; flex-direction: column; gap: 0.5rem; margin-bottom: 1.25rem;">\n            <a href="https://claude.ai/new" target="_blank" class="ai-link-btn claude">\n              Claude\n            </a>\n            <a href="https://chat.openai.com" target="_blank" class="ai-link-btn chatgpt">\n              ChatGPT\n            </a>\n            <a href="https://gemini.google.com" target="_blank" class="ai-link-btn gemini">\n              Gemini\n            </a>\n          </div>\n          \n          <div style="font-size: 0.75rem; color: var(--text-muted); line-height: 1.5;">\n            Paste with <kbd>Ctrl+V</kbd> (or <kbd>⌘V</kbd>) to generate your sales plan.\n          </div>\n        </div>\n        \n        <div class="channel-modal-footer" style="justify-content: flex-end;">\n          <button class="modal-btn modal-btn-cancel" onclick="SalesPlanManager.closeSuccessModal()">\n            Done\n          </button>\n        </div>\n      </div>\n    `,ModalUtils.open("copySuccessModal")},closeSuccessModal(){ModalUtils.close(),document.getElementById("salesPlanModal").classList.remove("active"),document.body.style.overflow=""},async copyAgain(){try{const{filteredAwards:e,scopeName:t,focus:n}=this.getFilteredData(),a=PromptPackageGenerator.buildPackage(e,null,{scope:t,focus:n});await navigator.clipboard.writeText(a);const r=document.querySelector("#copySuccessModal .modal-btn-primary");if(r){const e=r.innerHTML;r.innerHTML='<i class="fas fa-check"></i> Copied!',setTimeout((()=>r.innerHTML=e),1500)}}catch(e){alert("Failed to copy: "+e.message)}},prepareVendorList(e){const t={};let n=0;e.forEach((e=>{const a=e["Recipient Name"]||"Unknown",r=parseFloat(e["Award Amount"])||0;t[a]=(t[a]||0)+r,n+=r})),this.currentVendors=Object.entries(t).map((([t,a])=>({vendor:t,spend:a,marketShare:n>0?(a/n*100).toFixed(2):"0.00",contractCount:e.filter((e=>e["Recipient Name"]===t)).length,classification:KnownVendors.classify(t)}))).sort(((e,t)=>t.spend-e.spend)).slice(0,30)},updateStatus(e,t){const n=document.getElementById("spDataStatus");if(!n)return;const a=this.currentVendors.filter((e=>this.isChannel(e.vendor))).length,r=this.currentVendors.length;n.innerHTML=`\n      <span style="color:var(--success); display:flex; align-items:center; gap:6px;">\n        <i class="fas fa-check-circle"></i> Ready\n      </span>\n      <span style="margin-left:8px; opacity:0.3;">|</span>\n      <span style="margin-left:8px;">${t}</span>\n      <span style="margin-left:8px; opacity:0.3;">|</span>\n      <span style="margin-left:8px;">${e} awards</span>\n      <span style="margin-left:8px; opacity:0.3;">|</span>\n      <span style="margin-left:8px; color: var(--accent);">${a}/${r} channels</span>\n    `},toggleChannel(e){this.channels.has(e)?this.channels.delete(e):this.channels.add(e),this.save(),this.updateStatus(App.forecastData.awards?.length||App.searchData.raw?.length||0,"all"===document.getElementById("spScope")?.value?"Entire Market":document.getElementById("spScope")?.value)},toggleAll(){this.currentVendors.every((e=>this.isChannel(e.vendor)))?this.currentVendors.forEach((e=>this.channels.delete(e.vendor))):this.currentVendors.forEach((e=>this.channels.add(e.vendor))),this.save(),this.renderSmartVendorList(),this.updateStatus(App.forecastData.awards?.length||App.searchData.raw?.length||0,"all"===document.getElementById("spScope")?.value?"Entire Market":document.getElementById("spScope")?.value)},acceptSuggested(){this.currentVendors.forEach((e=>{"var"!==e.classification&&"likely_var"!==e.classification||this.channels.add(e.vendor)})),this.save(),this.renderSmartVendorList(),this.updateStatus(App.forecastData.awards?.length||App.searchData.raw?.length||0,"all"===document.getElementById("spScope")?.value?"Entire Market":document.getElementById("spScope")?.value)},save(){localStorage.setItem("govhoo_channels",JSON.stringify([...this.channels]))},renderSmartVendorList(){const e=document.getElementById("spVendorList"),t=document.getElementById("spBulkActionContainer");if(!e||!t)return;const n=this.currentVendors.filter((e=>("var"===e.classification||"likely_var"===e.classification)&&!this.isChannel(e.vendor))),a=this.currentVendors.filter((e=>"prime"===e.classification)),r=this.currentVendors.filter((e=>"unknown"===e.classification&&!this.isChannel(e.vendor))),i=this.currentVendors.filter((e=>this.isChannel(e.vendor))),s=this.currentVendors.length>0&&this.currentVendors.every((e=>this.isChannel(e.vendor)));if(t.innerHTML=`\n      <div style="display: flex; gap: 0.5rem;">\n        ${n.length>0?`\n          <button onclick="SalesPlanManager.acceptSuggested()" style="background: rgba(76, 175, 80, 0.1); border: 1px solid var(--success); color: var(--success); padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 0.7rem; font-family: 'JetBrains Mono'; display: flex; align-items: center; gap: 6px;">\n            <i class="fas fa-magic"></i> ACCEPT SUGGESTIONS (${n.length})\n          </button>\n        `:""}\n        <button onclick="SalesPlanManager.toggleAll()" style="background: transparent; border: 1px solid var(--border); color: var(--accent); padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 0.7rem; font-family: 'JetBrains Mono'; display: flex; align-items: center; gap: 6px;">\n          <i class="far ${s?"fa-square":"fa-check-square"}"></i> ${s?"UNMARK ALL":"MARK ALL"}\n        </button>\n      </div>\n    `,0===this.currentVendors.length)return void(e.innerHTML='<div style="text-align:center; padding:1rem; color:#666;">No vendors found in this scope.</div>');let o="";i.length>0&&(o+=this.renderVendorSection("✅ MARKED AS CHANNELS","These vendors are already marked as your channel partners",i,"success")),n.length>0&&(o+=this.renderVendorSection("🎯 SUGGESTED CHANNELS","We detected these as likely resellers/VARs based on known patterns",n,"accent")),r.length>0&&(o+=this.renderVendorSection("❓ NEEDS REVIEW","We couldn't automatically classify these vendors",r,"muted")),a.length>0&&(o+=this.renderVendorSection("🏢 LIKELY PRIMES/SIs","These appear to be system integrators or large primes",a,"muted")),e.innerHTML=o},renderVendorSection(e,t,n,a){const r={success:"var(--success)",accent:"var(--accent)",muted:"#666"}[a]||"#666";return`\n      <div style="margin-bottom: 1.5rem;">\n        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">\n          <span style="font-size: 0.8rem; font-weight: 700; color: ${r}; text-transform: uppercase; letter-spacing: 0.5px;">\n            ${e}\n          </span>\n          <span style="font-size: 0.7rem; color: #666;">(${n.length})</span>\n        </div>\n        <div style="font-size: 0.75rem; color: #888; margin-bottom: 0.75rem;">${t}</div>\n        <div style="border: 1px solid var(--border); border-radius: 6px; overflow: hidden; border-left: 3px solid ${r};">\n          ${n.map((e=>this.renderVendorRow(e))).join("")}\n        </div>\n      </div>\n    `},renderVendorRow(e){const t=this.isChannel(e.vendor);return`\n      <div class="vendor-list-item" style="border-bottom: 1px solid var(--border); padding: 0.6rem 0.75rem;">\n        <div class="vendor-info" style="flex: 1;">\n          <div class="vendor-name" style="font-size: 0.85rem; font-weight: 600; color: #fff;">${e.vendor}</div>\n          <div class="vendor-stats" style="font-size: 0.7rem; color: #888;">\n            ${e.contractCount} contracts • ${Utils.money(e.spend)} • ${e.marketShare}% share\n          </div>\n        </div>\n        <div class="vendor-toggle" style="display: flex; align-items: center; gap: 0.5rem;">\n          <div class="toggle-switch ${t?"active":""}" onclick="SalesPlanManager.toggleItem('${e.vendor.replace(/'/g,"\\'")}', this)">\n            <div class="toggle-slider"></div>\n          </div>\n          <div class="toggle-label" style="font-size: 0.7rem; width: 70px; color: ${t?"var(--success)":"#888"};">\n            ${t?"Channel":"Competitor"}\n          </div>\n        </div>\n      </div>\n    `},toggleItem(e,t){this.toggleChannel(e);const n=t,a=t.nextElementSibling;this.isChannel(e)?(n.classList.add("active"),a.textContent="Channel",a.style.color="var(--success)"):(n.classList.remove("active"),a.textContent="Competitor",a.style.color="#888"),setTimeout((()=>this.renderSmartVendorList()),300)},renderList(){this.renderSmartVendorList()}},App={mode:"search",currentQuery:"",searchData:{raw:[],active:[],filter:null,loaded:!1},forecastData:{spending:null,agencies:null,awards:null,analysis:null,loaded:!1},drillState:{level:0,path:[],currentAgency:null,currentSubAgency:null},init(){SalesPlanManager.init(),document.getElementById("searchBtn").onclick=()=>App.runSearch(),document.getElementById("forecastBtn").onclick=()=>App.runForecast(),document.getElementById("mainSearchInput").addEventListener("keypress",(e=>{"Enter"===e.key&&App.runSearch()})),document.getElementById("miniSearch").addEventListener("keypress",(e=>{"Enter"===e.key&&(document.getElementById("mainSearchInput").value=e.target.value,"forecast"===App.mode?App.runForecast(e.target.value):App.runSearch(e.target.value))})),window.addEventListener("resize",(()=>{setTimeout((()=>{App.searchData.active.length>0&&"search"===App.mode&&App.renderSankey()}),200)}));const e=new URLSearchParams(window.location.search),t=e.get("q"),n=e.get("mode");t&&(document.getElementById("mainSearchInput").value=t,"forecast"===n?App.runForecast(t):App.runSearch(t))},showHero(){document.getElementById("appView").style.display="none";const e=document.getElementById("heroView");e.style.display="flex",e.classList.remove("hidden"),setTimeout((()=>e.classList.remove("slide-up")),10)},setMode(e){App.mode=e,document.getElementById("modeSearchBtn").classList.toggle("active","search"===e),document.getElementById("modeForecastBtn").classList.toggle("active","forecast"===e),document.getElementById("searchModeView").classList.toggle("active","search"===e),document.getElementById("forecastModeView").classList.toggle("active","forecast"===e),App.currentQuery&&("search"!==e||App.searchData.loaded?"forecast"!==e||App.forecastData.loaded||App.runForecast(App.currentQuery):App.runSearch(App.currentQuery))},toggleMode(){App.setMode("search"===App.mode?"forecast":"search")},async runSearch(e){const t=e||document.getElementById("mainSearchInput").value;if(t){t!==App.currentQuery&&(App.searchData={raw:[],active:[],filter:null,loaded:!1},App.forecastData={loaded:!1},App.resetDrill()),App.currentQuery=t,App.mode="search",App.showLoader("RETRIEVING DATA...","Searching USASpending API");try{App.searchData.raw=await API.searchAwards(t),App.searchData.active=App.searchData.raw,App.searchData.loaded=!0,App.transitionToApp(),App.setMode("search"),App.updateSearchDashboard(),requestAnimationFrame((()=>App.renderSankey()))}catch(e){console.error(e),alert("Error retrieving data.")}finally{App.hideLoader()}}},updateSearchDashboard(){const e=App.searchData.active;document.getElementById("stat-vol").innerText=Utils.money(e.reduce(((e,t)=>e+(t["Award Amount"]||0)),0)),document.getElementById("stat-count").innerText=e.length,document.getElementById("stat-vendors").innerText=new Set(e.map((e=>e["Recipient Name"]))).size,document.getElementById("stat-agencies").innerText=new Set(e.map((e=>e["Awarding Agency"]))).size;const t=document.getElementById("filterBadge");App.searchData.filter?(t.style.display="inline-flex",document.getElementById("filterName").innerText=App.searchData.filter):t.style.display="none",App.renderFeed(),App.updateDrillUI()},resetDrill(){App.drillState={level:0,path:[],currentAgency:null,currentSubAgency:null},App.searchData.filter=null,App.searchData.active=App.searchData.raw,App.updateSearchDashboard(),App.renderSankey()},updateDrillUI(){const e=document.getElementById("drillBreadcrumb"),t=document.getElementById("drillHint"),n=document.getElementById("drillLevelBadge");if(0===App.drillState.level)e.style.display="none",t.style.display="flex",n.style.display="none",document.getElementById("subagencyPanel").style.display="none",t.innerHTML='<i class="fas fa-mouse-pointer"></i><span>Click an <strong>agency bar</strong> to drill into sub-agencies</span>';else{e.style.display="flex",n.style.display="inline-flex";let a='<div class="breadcrumb-item" onclick="App.resetDrill()"><i class="fas fa-globe breadcrumb-icon"></i><span>All Agencies</span></div>';App.drillState.path.forEach(((e,t)=>a+=`<span class="breadcrumb-separator"><i class="fas fa-chevron-right"></i></span><div class="breadcrumb-item ${t===App.drillState.path.length-1?"active":""}" onclick="${t===App.drillState.path.length-1?"":`App.drillToLevel(${t+1})`}"><span>${Utils.trunc(e.name,25)}</span></div>`)),e.innerHTML=a,document.getElementById("drillLevelText").innerText=1===App.drillState.level?"Agency View":"Sub-Agency View",1===App.drillState.level?(t.innerHTML='<i class="fas fa-layer-group"></i><span>Click a <strong>sub-agency</strong> to see vendor breakdown</span>',App.renderSubAgencyPanel()):(document.getElementById("subagencyPanel").style.display="none",t.innerHTML='<i class="fas fa-check-circle" style="color:var(--success)"></i><span>Viewing vendor breakdown</span>')}},renderSubAgencyPanel(){const e=document.getElementById("subagencyList"),t=App.searchData.raw.filter((e=>e["Awarding Agency"]===App.drillState.currentAgency)),n={};t.forEach((e=>{const t=e["Awarding Sub Agency"]||"Unknown";n[t]=n[t]||{amount:0,count:0},n[t].amount+=e["Award Amount"]||0,n[t].count++}));const a=Object.entries(n).map((([e,t])=>({name:e,...t}))).sort(((e,t)=>t.amount-e.amount));document.getElementById("subagencyParentName").innerText=Utils.trunc(App.drillState.currentAgency,40),document.getElementById("subagencyTotalAmount").innerText=Utils.money(a.reduce(((e,t)=>e+t.amount),0)),document.getElementById("subagencyCount").innerText=a.length,e.innerHTML=a.map(((e,t)=>`<div class="subagency-item" onclick="App.drillToSubAgency('${e.name.replace(/'/g,"\\'")}')"><div class="subagency-item-left"><div class="subagency-rank ${t<3?"top-3":""}">${t+1}</div><div class="subagency-info"><div class="subagency-name">${e.name}</div><div class="subagency-contracts">${e.count} contracts</div></div></div><div class="subagency-item-right"><div class="subagency-bar-container"><div class="subagency-bar" style="width:${e.amount/a[0].amount*100}%"></div></div><div class="subagency-amount">${Utils.money(e.amount)}</div><i class="fas fa-chevron-right subagency-drill-icon"></i></div></div>`)).join(""),document.getElementById("subagencyPanel").style.display="block"},drillToAgency(e){App.drillState={level:1,currentAgency:e,currentSubAgency:null,path:[{type:"agency",name:e}]},App.searchData.active=App.searchData.raw.filter((t=>t["Awarding Agency"]===e)),App.searchData.filter=e,App.updateSearchDashboard(),App.renderSankey()},drillToSubAgency(e){App.drillState.level=2,App.drillState.currentSubAgency=e,App.drillState.path=[{type:"agency",name:App.drillState.currentAgency},{type:"sub",name:e}],App.searchData.active=App.searchData.raw.filter((t=>t["Awarding Agency"]===App.drillState.currentAgency&&t["Awarding Sub Agency"]===e)),App.searchData.filter=e,App.updateSearchDashboard(),App.renderSankey()},drillToLevel(e){1===e?App.drillToAgency(App.drillState.path[0].name):App.resetDrill()},drillDown(e){App.searchData.raw.some((t=>t["Awarding Agency"]===e))&&0===App.drillState.level?App.drillToAgency(e):App.searchData.raw.some((t=>t["Awarding Sub Agency"]===e))&&1===App.drillState.level?App.drillToSubAgency(e):(App.searchData.filter=e,App.searchData.active=App.searchData.active.filter((t=>t["Recipient Name"]===e)),App.updateSearchDashboard(),App.renderSankey())},clearFilter(){App.drillState.level>0?App.resetDrill():(App.searchData.filter=null,App.searchData.active=App.searchData.raw,App.updateSearchDashboard(),App.renderSankey())},renderSankey(){const e=document.getElementById("chartContainer");e.innerHTML="";const t=App.searchData.active;if(!t.length)return void(e.innerHTML='<div style="text-align:center; padding:4rem; color:#666">No data</div>');e.innerHTML='<svg id="sankeySvg"></svg>';const n=0===App.drillState.level,a={};t.forEach((e=>{e["Award Amount"]>0&&(a[(n?e["Awarding Agency"]:e["Awarding Sub Agency"]||"Unknown")+"|||"+(e["Recipient Name"]||"Unknown")]=(a[(n?e["Awarding Agency"]:e["Awarding Sub Agency"]||"Unknown")+"|||"+(e["Recipient Name"]||"Unknown")]||0)+e["Award Amount"])}));const r=Object.entries(a).sort(((e,t)=>t[1]-e[1])),i=App.drillState.level>0?50:25,s=r.slice(0,i),o=r.slice(i),c=new Set,l=[];if(s.forEach((([e,t])=>{const[n,a]=e.split("|||");c.add(n),c.add(a),l.push({source:n,target:a,value:t})})),o.length){const e={};o.forEach((([t,n])=>{const[a]=t.split("|||");c.has(a)&&(e[a]=(e[a]||0)+n)})),Object.entries(e).forEach((([e,t])=>{const n=`Other (${o.length})`;c.add(n),l.push({source:e,target:n,value:t})}))}const d=Array.from(c).map((e=>({name:e}))),p=new Map(d.map(((e,t)=>[e.name,t]))),u=l.map((e=>({source:p.get(e.source),target:p.get(e.target),value:e.value}))),m=e.offsetWidth||800,g=Math.max(500,30*d.length),h=d3.select("#sankeySvg").attr("width",m).attr("height",g),y=d3.sankey().nodeId((e=>e.index)).nodeWidth(20).nodePadding(20).extent([[1,1],[m-1,g-6]]),{nodes:A,links:f}=y({nodes:d.map((e=>Object.assign({},e))),links:u.map((e=>Object.assign({},e)))}),v=e=>!e.startsWith("Other")&&(0===App.drillState.level?App.searchData.raw.some((t=>t["Awarding Agency"]===e)):1===App.drillState.level&&App.searchData.raw.some((t=>t["Awarding Sub Agency"]===e)));h.append("g").selectAll("rect").data(A).join("rect").attr("x",(e=>e.x0)).attr("y",(e=>e.y0)).attr("height",(e=>e.y1-e.y0)).attr("width",(e=>e.x1-e.x0)).attr("fill",(e=>Utils.getColor(e.name))).attr("opacity",.8).attr("stroke",(e=>v(e.name)?"var(--accent)":"none")).attr("stroke-width",(e=>v(e.name)?2:0)).style("cursor",(e=>v(e.name)?"pointer":"default")).on("click",((e,t)=>{v(t.name)&&App.drillDown(t.name)})).append("title").text((e=>`${e.name}\n${Utils.money(e.value)}`));const S=h.append("defs");f.forEach(((e,t)=>{const n=S.append("linearGradient").attr("id","g"+t).attr("gradientUnits","userSpaceOnUse").attr("x1",e.source.x1).attr("x2",e.target.x0);n.append("stop").attr("offset","0%").attr("stop-color",Utils.getColor(e.source.name)),n.append("stop").attr("offset","100%").attr("stop-color",Utils.getColor(e.target.name))})),h.append("g").attr("fill","none").selectAll("path").data(f).join("path").attr("d",d3.sankeyLinkHorizontal()).attr("stroke",((e,t)=>"url(#g"+t+")")).attr("stroke-width",(e=>Math.max(1,e.width))).attr("stroke-opacity",.4),h.append("g").selectAll("text").data(A).join("text").attr("x",(e=>e.x0<m/2?e.x1+6:e.x0-6)).attr("y",(e=>(e.y1+e.y0)/2)).attr("dy","0.35em").attr("text-anchor",(e=>e.x0<m/2?"start":"end")).text((e=>Utils.trunc(e.name,40))).style("font-size","11px").style("fill","#fff").style("pointer-events","none")},renderFeed(){const e=document.getElementById("feedGrid"),t=App.searchData.active;0!==t.length?e.innerHTML=t.map((e=>{const t=e.generated_internal_id;let n="#";t?n=`https://www.usaspending.gov/award/${t}`:e["Award ID"]&&(n=`https://www.usaspending.gov/search/?hash=&filters=${encodeURIComponent(JSON.stringify({keyword:e["Award ID"]}))}`);let a="";e["NAICS Code"]&&(a+=`<span class="meta-tag naics" title="${e["NAICS Description"]||""}">NAICS: ${e["NAICS Code"]}</span>`),e["PSC Code"]&&(a+=`<span class="meta-tag psc" title="${e["PSC Description"]||""}">PSC: ${e["PSC Code"]}</span>`);const r=e["Awarding Sub Agency"];return`<div class="deal-card">\n        <div class="deal-header"><span class="deal-agency">${r&&r!==e["Awarding Agency"]?`${Utils.trunc(e["Awarding Agency"],20)} → ${Utils.trunc(r,20)}`:Utils.trunc(e["Awarding Agency"],35)}</span><span class="deal-amount">${Utils.money(e["Award Amount"])}</span></div>\n        <div class="deal-desc">${Utils.trunc(e.Description,100)}</div>\n        <div class="deal-vendor">${e["Recipient Name"]}</div>\n        ${a?`<div class="deal-meta">${a}</div>`:""}\n        <div class="deal-footer"><span class="deal-date">Start: ${Utils.date(e["Start Date"])}${e["End Date"]?" → "+Utils.date(e["End Date"]):""}</span><a href="${n}" target="_blank" class="action-btn">OPEN AWARD <i class="fas fa-external-link-alt"></i></a></div>\n      </div>`})).join(""):e.innerHTML='<div style="text-align:center; padding:2rem; color:#666">No contracts found.</div>'},async runForecast(e){const t=e||document.getElementById("mainSearchInput").value;if(!t)return;t!==App.currentQuery&&(App.searchData={loaded:!1},App.forecastData={spending:null,agencies:null,awards:null,analysis:null,loaded:!1});const n=Chart.getChart("spendingChart");n&&n.destroy(),App.currentQuery=t,App.mode="forecast",App.showLoader("CRUNCHING NUMBERS...","Applying Recency-Weighted Seasonality");try{const[e,n,a]=await Promise.all([API.getSpendingOverTime(t),API.getAgencyData(t),API.getAwardsForForecast(t)]);App.forecastData={spending:e,agencies:n,awards:a,analysis:ForecastEngine.analyze(e,a,n),loaded:!0},App.transitionToApp(),App.setMode("forecast"),App.renderForecastDashboard()}catch(e){console.error(e),App.showToast("Error fetching forecast data.","error")}finally{App.hideLoader()}},renderForecastDashboard(){const e=App.forecastData.analysis,t=App.forecastData.awards;if(!e)return;document.getElementById("stat-baseline").innerText=Utils.money(e.baseline),document.getElementById("stat-market").innerText=e.marketStatus,document.getElementById("stat-hhi").innerText=`HHI: ${e.hhi}`;let n=1,a=0;for(let t=1;t<=4;t++)e.indices[t]>a&&(a=e.indices[t],n=t);document.getElementById("stat-peak").innerText=`Q${n}`,document.getElementById("stat-recompetes").innerText=e.recompetes.length;document.getElementById("marketInsights").innerHTML=`\n      <div class="insight-card">\n        <div class="insight-label">Market Concentration</div>\n        <div class="insight-val" style="color:${e.hhi>2500?"var(--danger)":"var(--success)"}">${e.marketStatus}</div>\n        <div style="font-size:0.8rem; color:#666; margin-top:5px">HHI Score: ${e.hhi}</div>\n      </div>\n      \n      <div class="insight-card">\n        <div class="insight-label">Top Incumbent</div>\n        <div class="insight-val" style="font-size:0.9rem">${Utils.trunc(t[0]?t[0]["Recipient Name"]:"Unknown",30)}</div>\n      </div>\n\n      <div class="insight-card sales-plan-card" onclick="SalesPlanManager.open()">\n        <div class="sales-plan-card-icon"><i class="fas fa-file-export"></i></div>\n        <div class="sales-plan-card-title">Generate Sales Strategy Prompt</div>\n        <div class="sales-plan-card-subtitle">\n          Create an AI prompt package from these results you can paste into your preferred AI tool (ChatGPT, Claude, Gemini, etc.) to build an Annual Sales Plan.\n        </div>\n      </div>\n    `;const r=document.getElementById("forecastTableBody");r.innerHTML="",e.forecasts.forEach((e=>{const t=e.trend.includes("+"),n="High"===e.confidence.label?"var(--success)":"Med"===e.confidence.label?"#FDD835":"#888";r.innerHTML+=`\n        <tr>\n          <td><b>${e.period}</b></td>\n          <td style="color:var(--accent); font-weight:700">${Utils.money(e.predicted)}</td>\n          <td style="color:#666">${Utils.money(e.histAvg)}</td>\n          <td><span class="trend-pill ${t?"trend-up":"trend-down"}">${t?"▲":"▼"} ${e.trend}%</span></td>\n          <td>\n            <div style="color:${n}; font-weight:700;">${e.confidence.label}</div>\n            <div style="font-size:0.65rem; color:#666;">${e.confidence.reason}</div>\n          </td>\n        </tr>`}));const i=document.getElementById("spendingChart").getContext("2d"),s=Object.keys(e.byFY).sort();new Chart(i,{type:"bar",data:{labels:s.map((e=>`FY${e}`)),datasets:[{label:"Q1",data:s.map((t=>e.byFY[t][1]||0)),backgroundColor:"#958BB6"},{label:"Q2",data:s.map((t=>e.byFY[t][2]||0)),backgroundColor:"#6F8A74"},{label:"Q3",data:s.map((t=>e.byFY[t][3]||0)),backgroundColor:"#8FB6D0"},{label:"Q4",data:s.map((t=>e.byFY[t][4]||0)),backgroundColor:"#C27E5C"}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{grid:{display:!1}},y:{grid:{color:"#333"}}},plugins:{legend:{labels:{color:"#888"}}}}});const o=e.strategy;o&&(document.getElementById("strategySection").style.display="block",document.getElementById("strat-outlook").innerText=o.title,document.getElementById("strat-text").innerText=o.text,document.getElementById("strat-action").innerText=o.action,document.getElementById("matrix-bd").innerText=o.matrix.bd,document.getElementById("matrix-strat").innerText=o.matrix.strat,document.getElementById("matrix-pipe").innerText=o.matrix.pipe),document.getElementById("recompetesList").innerHTML=e.recompetes.length?'<div class="section-header"><div class="section-title-group"><i class="fas fa-exclamation-triangle" style="color:var(--danger)"></i><span class="section-title" style="color:var(--danger)">Recompete Opportunities</span></div></div>'+e.recompetes.map((e=>`\n        <div class="deal-card" style="margin-bottom:1rem">\n          <div class="deal-header">\n            <span class="deal-agency">${Utils.trunc(e["Awarding Agency"],40)}</span>\n            <span class="deal-amount">${Utils.money(e["Award Amount"])}</span>\n          </div>\n          <div class="deal-desc">${Utils.trunc(e.Description,80)}</div>\n          <div style="font-size:0.8rem; color:var(--danger)">Expires: ${Utils.date(e["End Date"])}</div>\n          <div style="font-size:0.8rem; color:#666">${e["Recipient Name"]}</div>\n        </div>`)).join(""):""},exportCSV(e){const t="search"===App.mode?App.searchData.active:App.forecastData.awards||[];if(!t.length){if(e){const t=e.innerHTML;e.style.color="var(--danger)",e.style.borderColor="var(--danger)",e.innerHTML='<i class="fas fa-times"></i>',setTimeout((()=>{e.style.color="",e.style.borderColor="",e.innerHTML=t}),2e3)}return}const n=t.map((e=>{const t=e.generated_internal_id;let n="";return t?n=`https://www.usaspending.gov/award/${t}`:e["Award ID"]&&(n=`https://www.usaspending.gov/search/?hash=&filters=${encodeURIComponent(JSON.stringify({keyword:e["Award ID"]}))}`),[`"${(e["Recipient Name"]||"").replace(/"/g,'""')}"`,`"${(e["Awarding Agency"]||"").replace(/"/g,'""')}"`,`"${(e["Awarding Sub Agency"]||"").replace(/"/g,'""')}"`,e["Award Amount"]||0,`"${(e.Description||"").replace(/"/g,'""')}"`,e["Start Date"]||"",e["End Date"]||"",e["Award ID"]||"",n]})),a=[["Recipient","Agency","Sub-Agency","Amount","Description","Start Date","End Date","Award ID","Award Link"].join(","),...n.map((e=>e.join(",")))].join("\n"),r=new Blob([a],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(r),s=document.createElement("a");if(s.setAttribute("href",i),s.setAttribute("download",`govhoo_${App.mode}_${App.currentQuery}.csv`),document.body.appendChild(s),s.click(),document.body.removeChild(s),e){const t=e.innerHTML;e.style.color="var(--success)",e.style.borderColor="var(--success)",e.innerHTML='<i class="fas fa-check"></i>',setTimeout((()=>{e.style.color="",e.style.borderColor="",e.innerHTML=t}),2e3)}},showLoader(e,t){document.getElementById("loaderText").innerText=e,document.getElementById("loaderSubtext").innerText=t||"",document.getElementById("loader").style.display="flex"},hideLoader(){document.getElementById("loader").style.display="none"},transitionToApp(){const e=document.getElementById("heroView");e.classList.add("slide-up"),document.getElementById("appView").style.display="block",document.getElementById("miniSearch").value=App.currentQuery,document.getElementById("dashboardContainer").classList.add("active"),setTimeout((()=>{e.style.display="none",e.classList.add("hidden")}),500)},shareLink(e){const t=new URL(window.location);t.searchParams.set("q",App.currentQuery),t.searchParams.set("mode",App.mode),navigator.clipboard.writeText(t.toString()).then((()=>{if(e){const t=e.innerHTML;e.style.color="var(--success)",e.style.borderColor="var(--success)",e.innerHTML='<i class="fas fa-check"></i>',setTimeout((()=>{e.style.color="",e.style.borderColor="",e.innerHTML=t}),2e3)}}))}},PromptPackageGenerator={classifySearchIntent(e,t,n){const a=e.toLowerCase().trim(),r={},i={};let s=0;t.forEach((e=>{const t=e["Recipient Name"]||"Unknown",n=e["Awarding Agency"]||"Unknown",a=parseFloat(e["Award Amount"])||0;r[t]=(r[t]||0)+a,i[n]=(i[n]||0)+a,s+=a}));const o=Object.entries(r).map((([e,t])=>({name:e,spend:t,share:t/s*100,isChannel:n.has(e)}))).sort(((e,t)=>t.spend-e.spend)),c=Object.entries(i).map((([e,t])=>({name:e,spend:t,share:t/s*100}))).sort(((e,t)=>t.spend-e.spend)),l=o.filter((e=>e.isChannel)),d=o.filter((e=>!e.isChannel)),p=l.reduce(((e,t)=>e+t.share),0),u=d.reduce(((e,t)=>e+t.share),0),m=o.find((e=>e.name.toLowerCase().includes(a)||a.includes(e.name.toLowerCase().split(" ")[0]))),g=c.find((e=>e.name.toLowerCase().includes(a)||a.includes(e.name.toLowerCase().replace("department of ","")))),h=["cyber","cloud","ai","artificial intelligence","machine learning","ml","data","analytics","software","it services","infrastructure","network","security","zero trust","devops","devsecops","modernization","digital","transformation","agile","sap","oracle","healthcare","logistics","training","simulation","c4isr","satellite","space","communications","mobility","wireless"].some((e=>a.includes(e)));if(p>70&&l.length>=3)return{type:"product_oem",confidence:"high",details:{productName:e,totalMarketValue:s,channelCount:l.length,channelShare:p.toFixed(1),topChannel:l[0]?.name,topChannelShare:l[0]?.share.toFixed(1),agencyCount:c.length,topAgency:c[0]?.name,topAgencyShare:c[0]?.share.toFixed(1),directSalesCount:d.length,directSalesShare:u.toFixed(1)}};if(m&&m.share>30){return n.has(m.name)?{type:"partner",confidence:"high",details:{entityName:m.name,entityShare:m.share.toFixed(1),entityValue:m.spend,relationship:"Marked as channel/partner"}}:{type:"own_company",confidence:"medium",details:{entityName:m.name,entityShare:m.share.toFixed(1),entityValue:m.spend,suggestion:"If this is YOUR company, the plan will focus on defending position. If a COMPETITOR, mark as such in settings."}}}return m&&m.share>5?{type:"competitor",confidence:"medium",details:{entityName:m.name,entityShare:m.share.toFixed(1),entityValue:m.spend,competitorCount:o.filter((e=>e.share>1)).length}}:g?{type:"agency",confidence:"high",details:{entityName:g.name,entityShare:g.share.toFixed(1),entityValue:g.spend,vendorCount:new Set(t.filter((e=>e["Awarding Agency"]===g.name)).map((e=>e["Recipient Name"]))).size}}:h||o.length>5?{type:"market_keyword",confidence:"high",details:{keyword:e,totalMarketValue:s,vendorCount:o.length,agencyCount:c.length,topVendor:o[0]?.name,topAgency:c[0]?.name}}:{type:"market_keyword",confidence:"low",details:{keyword:e,totalMarketValue:s,note:"Search intent unclear - defaulting to market analysis"}}},extractAllData(e,t,n={}){const a=Utils.getCurrentFY(),r=Utils.getCurrentQuarter(),i={};let s=0;e.forEach((e=>{const t=e["Recipient Name"]||"Unknown",n=parseFloat(e["Award Amount"])||0;i[t]||(i[t]={spend:0,contracts:[],agencies:new Set,subAgencies:new Set,naicsCodes:new Set,pscCodes:new Set}),i[t].spend+=n,i[t].contracts.push(e),e["Awarding Agency"]&&i[t].agencies.add(e["Awarding Agency"]),e["Awarding Sub Agency"]&&i[t].subAgencies.add(e["Awarding Sub Agency"]);const a=e["NAICS Code"]||e.naics_code||e.NAICS||e.naics;a&&i[t].naicsCodes.add(a);const r=e["PSC Code"]||e.psc_code||e.PSC||e.psc||e["Product Service Code"];r&&i[t].pscCodes.add(r),s+=n}));const o=Object.entries(i).map((([e,t])=>({vendor:e,spend:t.spend,marketShare:(t.spend/s*100).toFixed(2),contractCount:t.contracts.length,avgContractSize:t.spend/t.contracts.length,agencyDiversity:t.agencies.size,subAgencyReach:t.subAgencies.size,naicsCodes:Array.from(t.naicsCodes),pscCodes:Array.from(t.pscCodes),isChannel:SalesPlanManager.isChannel(e),expiringContracts:t.contracts.filter((e=>{if(!e["End Date"])return!1;const t=(new Date(e["End Date"])-new Date)/2592e6;return t>0&&t<=18})),expiringValue:t.contracts.filter((e=>{if(!e["End Date"])return!1;const t=(new Date(e["End Date"])-new Date)/2592e6;return t>0&&t<=18})).reduce(((e,t)=>e+(parseFloat(t["Award Amount"])||0)),0)}))).sort(((e,t)=>t.spend-e.spend)),c=o.filter((e=>!e.isChannel)),l=o.filter((e=>e.isChannel)),d={};e.forEach((e=>{const t=e["Awarding Agency"]||"Unknown",n=e["Awarding Sub Agency"]||"General",a=parseFloat(e["Award Amount"])||0;d[t]||(d[t]={spend:0,contracts:[],subAgencies:{},topVendors:{}}),d[t].spend+=a,d[t].contracts.push(e),d[t].subAgencies[n]||(d[t].subAgencies[n]={spend:0,count:0}),d[t].subAgencies[n].spend+=a,d[t].subAgencies[n].count++;const r=e["Recipient Name"]||"Unknown";d[t].topVendors[r]=(d[t].topVendors[r]||0)+a}));const p=Object.entries(d).map((([e,t])=>({agency:e,spend:t.spend,percentage:(t.spend/s*100).toFixed(1),contractCount:t.contracts.length,subAgencyCount:Object.keys(t.subAgencies).length,subAgencies:Object.entries(t.subAgencies).map((([e,t])=>({name:e,...t}))).sort(((e,t)=>t.spend-e.spend)).slice(0,5),topVendors:Object.entries(t.topVendors).map((([e,t])=>({name:e,spend:t}))).sort(((e,t)=>t.spend-e.spend)).slice(0,3),incumbentVendor:Object.entries(t.topVendors).sort(((e,t)=>t[1]-e[1]))[0]?.[0]}))).sort(((e,t)=>t.spend-e.spend)),u=new Date,m={immediate:[],nearTerm:[],pipeline:[]};e.forEach((e=>{if(!e["End Date"])return;const t=(new Date(e["End Date"])-u)/2592e6;t>0&&t<=6?m.immediate.push(e):t>6&&t<=12?m.nearTerm.push(e):t>12&&t<=18&&m.pipeline.push(e)})),Object.keys(m).forEach((e=>{m[e].sort(((e,t)=>(t["Award Amount"]||0)-(e["Award Amount"]||0)))}));const g={},h={};e.forEach((e=>{const t=e["NAICS Code"]||e.naics_code||e.NAICS||e.naics,n=e["NAICS Description"]||e.naics_description||e["NAICS Desc"]||"",a=e["PSC Code"]||e.psc_code||e.PSC||e.psc||e["Product Service Code"],r=e["PSC Description"]||e.psc_description||e["PSC Desc"]||e["Product Service Description"]||"",i=parseFloat(e["Award Amount"])||0;t&&(g[t]||(g[t]={code:t,description:n,spend:0,count:0}),g[t].spend+=i,g[t].count++),a&&(h[a]||(h[a]={code:a,description:r,spend:0,count:0}),h[a].spend+=i,h[a].count++)}));let y=0;o.forEach((e=>{const t=e.spend/s*100;y+=t*t})),y=Math.round(y);let A=0;p.forEach((e=>{const t=parseFloat(e.percentage);A+=t*t})),A=Math.round(A);const f={vendorHHI:y,agencyHHI:A,analysisHHI:t?.hhi||null,status:y>2500?"Highly Concentrated":y>1500?"Moderately Concentrated":"Competitive",top3Share:c.slice(0,3).reduce(((e,t)=>e+parseFloat(t.marketShare)),0).toFixed(1),top5Share:c.slice(0,5).reduce(((e,t)=>e+parseFloat(t.marketShare)),0).toFixed(1),top10Share:c.slice(0,10).reduce(((e,t)=>e+parseFloat(t.marketShare)),0).toFixed(1),vendorCount:o.length,vendorInterpretation:y>2500?"Vendor market dominated by few incumbents. Teaming or niche strategies required.":y>1500?"Moderate vendor competition. Both displacement and new opportunity strategies viable.":"Fragmented vendor landscape. Volume bidding and broad prospecting may succeed.",agencyInterpretation:A>2500?"Spending concentrated in few agencies. Deep account focus recommended.":A>1500?"Moderate agency concentration. Balance depth and breadth.":"Spending spread across many agencies. Broad coverage strategy viable."};let v=null;if(t&&(v={baseline:t.baseline,quarterlyForecasts:t.forecasts||[],seasonalIndices:t.indices||{},peakQuarter:this.getPeakQuarter(t),growthRate:this.calculateGrowthRate(t),historicalByFY:t.byFY||{},strategy:t.strategy||null,marketStatus:t.marketStatus||"Unknown"},t.byFY)){const e=Object.keys(t.byFY).sort();if(e.length>=2){const n=e[e.length-1],a=e[e.length-2],r=Object.values(t.byFY[n]).reduce(((e,t)=>e+t),0),i=Object.values(t.byFY[a]).reduce(((e,t)=>e+t),0);v.yoyChange=i>0?((r-i)/i*100).toFixed(1):null}}return{metadata:{generatedDate:(new Date).toISOString(),fiscalYear:a,currentQuarter:r,marketQuery:App.currentQuery,totalContracts:e.length,totalMarketValue:s,channelsIdentified:l.length,competitorsIdentified:c.length,dataSource:t?"Forecast Mode":"Search Mode",sampleFields:e.length>0?Object.keys(e[0]):[]},marketConcentration:f,competitors:{all:c,top5:c.slice(0,5),top10:c.slice(0,10)},channels:{all:l,totalValue:l.reduce(((e,t)=>e+t.spend),0)},agencies:{all:p,top5:p.slice(0,5),top10:p.slice(0,10)},recompetes:m,naicsBreakdown:Object.values(g).sort(((e,t)=>t.spend-e.spend)).slice(0,10),pscBreakdown:Object.values(h).sort(((e,t)=>t.spend-e.spend)).slice(0,10),forecastInsights:v}},calculateGrowthRate(e){if(!e||!e.byFY)return null;const t=Object.keys(e.byFY).map(Number).sort(((e,t)=>e-t));if(t.length<2)return null;const n=Utils.getCurrentFY(),a=Utils.getCurrentQuarter(),r=t.filter((e=>e<n));if(r.length>=2){const t=r[r.length-1],n=r[r.length-2],a=Object.values(e.byFY[t]).reduce(((e,t)=>e+t),0),i=Object.values(e.byFY[n]).reduce(((e,t)=>e+t),0);if(i>0)return{value:((a-i)/i*100).toFixed(1),comparison:`FY${t} vs FY${n}`,type:"full_year"}}if(t.includes(n)&&t.includes(n-1)){const t=e.byFY[n],r=e.byFY[n-1];let i=0,s=0,o=[];for(let e=1;e<=a;e++)t[e]>0&&r[e]>0&&(i+=t[e],s+=r[e],o.push(`Q${e}`));if(s>0&&o.length>0)return{value:((i-s)/s*100).toFixed(1),comparison:`FY${n} ${o.join("+")} vs FY${n-1} ${o.join("+")}`,type:"quarter_comparison"}}return null},getPeakQuarter(e){if(!e||!e.indices)return null;let t=1,n=0;for(let a=1;a<=4;a++)e.indices[a]>n&&(n=e.indices[a],t=a);return{quarter:t,index:(100*n).toFixed(1)}},getStrategyInterpretation(e,t){if(!t)return"";const n={product_oem:{header:"**How to interpret for OEM/Channel Sales:**",mappings:{"Incumbent Displacement":"Protect renewals from competitive products; ensure partners are engaged before recompetes","New Requirements":"Identify agencies not yet using your product; expand partner coverage to white space","Relationship Focus":"Strengthen ties with top-performing partners; joint business planning with key accounts","Volume Bidding":"Enable more partners to quote; simplify pricing and reduce friction","Validate & Assess":"Verify partner pipeline accuracy; confirm renewals are tracked","Selective Focus":"Concentrate enablement on top partners; deprioritize low performers","Maintain Steady":"Continue current partner programs; monitor for competitive threats"}},own_company:{header:"**How to interpret for your business:**",mappings:{"Incumbent Displacement":"Competitors are targeting your contracts; strengthen customer relationships before recompetes","New Requirements":"Look for new opportunities beyond your current base","Relationship Focus":"Leverage existing customer relationships for sole-source or follow-on work","Volume Bidding":"Cast a wide net; pursue multiple opportunities to improve win rate odds","Validate & Assess":"Confirm your pipeline is real; verify funding and timing","Selective Focus":"Focus on highest-probability wins; don't spread resources thin","Maintain Steady":"Keep doing what's working; stay close to customers"}},competitor:{header:"**How to interpret for competitive strategy:**",mappings:{"Incumbent Displacement":"This competitor has contracts expiring - opportunity to displace them","New Requirements":"Market is growing with new opportunities not yet locked up","Relationship Focus":"Competitor relies on relationships; you need inside access to compete","Volume Bidding":"Many opportunities available; compete broadly against this player","Validate & Assess":"Verify this competitor is actually vulnerable before investing pursuit resources","Selective Focus":"Pick your battles carefully against this competitor","Maintain Steady":"Competitor is stable; look for specific weaknesses or niche opportunities"}},agency:{header:"**How to interpret for agency penetration:**",mappings:{"Incumbent Displacement":"Current vendors have contracts expiring; position for recompetes","New Requirements":"Agency has new initiatives or budget; pursue new starts","Relationship Focus":"Build relationships with program offices and contracting officers","Volume Bidding":"Agency buys frequently; pursue multiple vehicles and opportunities","Validate & Assess":"Confirm agency budget and priorities before investing in pursuit","Selective Focus":"Focus on specific programs or sub-agencies with best fit","Maintain Steady":"Agency spending is stable; focus on getting on contract vehicles"}},partner:{header:"**How to interpret for partner strategy:**",mappings:{"Incumbent Displacement":"Partner may face competition on renewals; support their recompetes","New Requirements":"Help partner pursue new opportunities; joint capture efforts","Relationship Focus":"Deepen partnership; joint account planning and executive engagement","Volume Bidding":"Partner can pursue many deals; ensure they have capacity and enablement","Validate & Assess":"Verify partner pipeline is real; align on priorities","Selective Focus":"Focus partnership on highest-value opportunities","Maintain Steady":"Partnership is performing well; continue current engagement model"}},market_keyword:{header:"**How to interpret for market strategy:**",mappings:{"Incumbent Displacement":"Market has established players with expiring contracts; target recompetes","New Requirements":"Market is growing; pursue new opportunities and emerging requirements","Relationship Focus":"Success requires agency relationships; invest in customer engagement","Volume Bidding":"Fragmented market with many opportunities; broad pursuit strategy","Validate & Assess":"Verify market opportunity is real before major investment","Selective Focus":"Pick specific niches or agencies to focus on","Maintain Steady":"Stable market; consistent business development approach"}}},a=n[e.type]||n.market_keyword,r=[];return t.matrix&&["bd","strat","pipe"].forEach((e=>{const n=t.matrix[e];n&&a.mappings[n]&&r.push(`- *${n}*: ${a.mappings[n]}`)})),0===r.length?"":`\n${a.header}\n${r.join("\n")}`},generatePrompt(e,t,n={}){const a=e=>Utils.money(e),r=n.scope||"Entire Market",i=n.focus||"Growth",s=t.metadata.marketQuery;let o="",c="",l="";switch(e.type){case"own_company":o=`\n**SEARCH CONTEXT: OWN COMPANY ANALYSIS**\nThe user searched for "${s}" which appears to be their own company or primary entity.\n- Entity: ${e.details.entityName}\n- Current Market Share: ${e.details.entityShare}%\n- Current Contract Value: ${a(e.details.entityValue)}\n\n**STRATEGIC INTENT:** The user wants to understand their competitive position and defend/grow their market share.`,c="\n**FRAMEWORK: INCUMBENT DEFENSE & GROWTH**\n1. **Protect Base**: Identify expiring contracts and recompete risks\n2. **Expand Footprint**: Find adjacent agencies/sub-agencies to penetrate\n3. **Competitive Intelligence**: Understand who is threatening your position\n4. **Channel Leverage**: Identify partners who can extend your reach",l="\n**SPECIFIC DELIVERABLES:**\n1. **Position Assessment**: Your current standing vs. competitors\n2. **Risk Register**: Contracts expiring in next 18 months with displacement probability\n3. **Expansion Opportunities**: Agencies where you're underrepresented vs. competitors\n4. **Competitive Threats**: Who is growing in your space and how to counter\n5. **Defense Playbook**: Actions to protect recompetes";break;case"competitor":o=`\n**SEARCH CONTEXT: COMPETITOR ANALYSIS**\nThe user searched for "${s}" which identifies a specific competitor.\n- Competitor: ${e.details.entityName}\n- Their Market Share: ${e.details.entityShare}%\n- Their Contract Value: ${a(e.details.entityValue)}\n\n**STRATEGIC INTENT:** The user wants to understand this competitor's position to displace them or compete effectively.`,c="\n**FRAMEWORK: COMPETITIVE DISPLACEMENT**\n1. **Know the Enemy**: Deep dive on competitor's strengths and weaknesses\n2. **Find Vulnerabilities**: Expiring contracts, unhappy customers, delivery issues\n3. **Counter-Position**: Develop messaging that highlights your advantages\n4. **Team or Compete**: Identify where to team vs. go head-to-head",l=`\n**SPECIFIC DELIVERABLES:**\n1. **Competitor Profile**: Full analysis of ${e.details.entityName}\n2. **Vulnerability Assessment**: Their expiring contracts (your opportunities)\n3. **Agency Overlap**: Where you both compete for the same customers\n4. **Displacement Strategy**: How to win their contracts at recompete\n5. **Battle Cards**: Win themes and competitive differentiators`;break;case"partner":o=`\n**SEARCH CONTEXT: PARTNER/CHANNEL ANALYSIS**\nThe user searched for "${s}" which is marked as a channel partner.\n- Partner: ${e.details.entityName}\n- Their Federal Revenue: ${a(e.details.entityValue)}\n- Relationship: ${e.details.relationship}\n\n**STRATEGIC INTENT:** The user wants to understand how to leverage this partner relationship for growth.`,c="\n**FRAMEWORK: CHANNEL OPTIMIZATION**\n1. **Partner Value**: Understand their reach and capabilities\n2. **Joint Opportunities**: Identify deals where teaming makes sense\n3. **Enablement**: How to help them sell your solutions\n4. **Expansion**: Where else they can take you",l="\n**SPECIFIC DELIVERABLES:**\n1. **Partner Profile**: Their federal presence and agency relationships\n2. **Joint Pipeline**: Recompetes and new opportunities for teaming\n3. **Agency Introduction Map**: Where they have relationships you don't\n4. **Enablement Plan**: How to arm them to represent you\n5. **Revenue Targets**: Realistic joint revenue goals by quarter";break;case"agency":o=`\n**SEARCH CONTEXT: AGENCY/CUSTOMER ANALYSIS**\nThe user searched for "${s}" which is a federal agency.\n- Agency: ${e.details.entityName}\n- Total Spend: ${a(e.details.entityValue)}\n- Active Vendors: ${e.details.vendorCount}\n\n**STRATEGIC INTENT:** The user wants to penetrate or expand within this specific agency.`,c="\n**FRAMEWORK: AGENCY PENETRATION**\n1. **Know the Customer**: Understand their mission and priorities\n2. **Map the Landscape**: Who's the incumbent? Who's winning?\n3. **Find Entry Points**: Recompetes, new requirements, set-asides\n4. **Build Relationships**: Key contracting offices and program managers",l="\n**SPECIFIC DELIVERABLES:**\n1. **Agency Profile**: Mission, budget trends, IT priorities\n2. **Competitive Map**: Who holds the contracts you want\n3. **Entry Strategy**: Specific opportunities to pursue\n4. **Sub-Agency Breakdown**: Where are the best opportunities\n5. **Timeline**: Key dates and procurement cycles";break;case"product_oem":o=`\n**SEARCH CONTEXT: PRODUCT/OEM CHANNEL ANALYSIS**\nThe user searched for "${s}" which appears to be a **product or software** they sell through channel partners.\n- Product/Software: ${s.toUpperCase()}\n- Total Federal Revenue: ${a(e.details.totalMarketValue)}\n- Active Channel Partners: ${e.details.channelCount}\n- Channel Share: ${e.details.channelShare}% of revenue through partners\n- Top Channel Partner: ${e.details.topChannel} (${e.details.topChannelShare}%)\n- Top Buying Agency: ${e.details.topAgency} (${e.details.topAgencyShare}%)\n${e.details.directSalesCount>0?`- Direct/Other Sales: ${e.details.directSalesCount} vendors (${e.details.directSalesShare}%)`:""}\n\n**STRATEGIC INTENT:** The user is an OEM/ISV who sells through channel partners and wants to:\n1. Understand which partners are performing best\n2. Identify agencies with highest adoption\n3. Find recompete opportunities to protect/grow\n4. Optimize channel coverage and performance`,c="\n**FRAMEWORK: CHANNEL PERFORMANCE & OPTIMIZATION**\n1. **Channel Scorecard**: Rank partners by revenue, growth, and agency coverage\n2. **Agency Penetration**: Which agencies have adopted? Who's missing?\n3. **Recompete Defense**: Protect existing installs through partner coordination\n4. **White Space**: Agencies/sub-agencies with no current coverage\n5. **Partner Enablement**: Who needs support to close more deals?",l=`\n**SPECIFIC DELIVERABLES:**\n1. **Channel Performance Report**: Rank all partners by revenue and growth\n2. **Agency Adoption Map**: Which agencies use ${s}? Coverage gaps?\n3. **Recompete Calendar**: All renewals in next 18 months with assigned partners\n4. **Partner Coverage Matrix**: Which partners cover which agencies?\n5. **Enablement Priorities**: Partners who need training, support, or incentives\n6. **Competitive Threats**: Are there direct competitors or alternative products?`;break;default:o=`\n**SEARCH CONTEXT: MARKET/TECHNOLOGY ANALYSIS**\nThe user searched for "${s}" which represents a market segment or technology area.\n- Total Addressable Market: ${a(e.details.totalMarketValue)}\n- Active Vendors: ${e.details.vendorCount||t.metadata.competitorsIdentified}\n- Active Agencies: ${e.details.agencyCount||t.agencies.all.length}\n- Top Vendor: ${e.details.topVendor||t.competitors.top5[0]?.vendor}\n- Top Agency: ${e.details.topAgency||t.agencies.top5[0]?.agency}\n\n**STRATEGIC INTENT:** The user wants to understand this market to enter or expand their presence.`,c="\n**FRAMEWORK: MARKET ENTRY/EXPANSION**\n1. **Size the Prize**: Understand TAM and growth trajectory\n2. **Know the Players**: Who dominates? Who's growing?\n3. **Find Your Lane**: Where do you have competitive advantage?\n4. **Build the Pipeline**: Specific opportunities to pursue",l="\n**SPECIFIC DELIVERABLES:**\n1. **Market Overview**: Size, growth, concentration analysis\n2. **Competitive Landscape**: Top players and their positioning\n3. **Agency Priorities**: Who's buying and why\n4. **Opportunity Pipeline**: Specific recompetes and new requirements\n5. **Go-to-Market Strategy**: How to win in this market"}return`# FEDERAL SALES INTELLIGENCE REPORT\n## Query: "${s.toUpperCase()}" | Scope: ${r} | Focus: ${i}\n## Generated: ${(new Date).toLocaleDateString()} | FY${t.metadata.fiscalYear} Q${t.metadata.currentQuarter}\n\n---\n\n${o}\n\n${c}\n\n---\n\n## INSTRUCTIONS FOR AI ASSISTANT\n\nCreate a comprehensive, actionable federal sales plan (4-6 pages) based on the data and context below. The plan should be executive-ready with specific actions, timelines, and measurable targets.\n\n${l}\n\n---\n\n## MARKET DATA\n\n### MARKET OVERVIEW\n- **Total ${"product_oem"===e.type?"Federal Revenue":"Addressable Market (TAM)"}:** ${a(t.metadata.totalMarketValue)}\n- **Total Active Contracts:** ${t.metadata.totalContracts}\n- **Average Contract Size:** ${a(t.metadata.totalMarketValue/t.metadata.totalContracts)}\n- **${"product_oem"===e.type?"Channel Partners":"Active Competitors"}:** ${"product_oem"===e.type?t.channels.all.length:t.metadata.competitorsIdentified}\n- **Active Agencies:** ${t.agencies.all.length}\n\n${"product_oem"===e.type?`### CHANNEL PARTNER PERFORMANCE (Ranked by Revenue)\n${t.channels.all.length>0?t.channels.all.map(((e,t)=>`${t+1}. **${e.vendor}**\n   - Revenue: ${a(e.spend)} (${e.marketShare}% share)\n   - Contracts: ${e.contractCount} | Avg Deal: ${a(e.avgContractSize)}\n   - Agency Reach: ${e.agencyDiversity} agencies | ${e.subAgencyReach} sub-agencies\n   - Expiring (18mo): ${e.expiringContracts.length} contracts worth ${a(e.expiringValue)}`)).join("\n"):"No channel partners identified. Mark resellers/VARs in the channel modal."}\n\n### CHANNEL CONCENTRATION\n- **Total Channel Revenue:** ${a(t.channels.totalValue)}\n- **Top Partner Share:** ${t.channels.all[0]?t.channels.all[0].marketShare:0}%\n- **Top 3 Partners Share:** ${t.channels.all.slice(0,3).reduce(((e,t)=>e+parseFloat(t.marketShare)),0).toFixed(1)}%\n- **Top 5 Partners Share:** ${t.channels.all.slice(0,5).reduce(((e,t)=>e+parseFloat(t.marketShare)),0).toFixed(1)}%\n\n${t.competitors.all.length>0?`### DIRECT SALES / OTHER VENDORS\nThese vendors are NOT marked as channel partners - they may be direct sales, competitors, or unidentified resellers:\n${t.competitors.top5.map(((e,t)=>`${t+1}. **${e.vendor}**: ${a(e.spend)} (${e.marketShare}% share, ${e.contractCount} contracts)`)).join("\n")}`:""}`:`### MARKET CONCENTRATION ANALYSIS\n\n**Vendor Concentration** (Who's winning the work):\n- **Vendor HHI:** ${t.marketConcentration.vendorHHI} (${t.marketConcentration.status})\n- **Top 3 Vendor Share:** ${t.marketConcentration.top3Share}%\n- **Top 5 Vendor Share:** ${t.marketConcentration.top5Share}%\n- **Top 10 Vendor Share:** ${t.marketConcentration.top10Share}%\n- **Implication:** ${t.marketConcentration.vendorInterpretation}\n\n**Agency Concentration** (Who's buying):\n- **Agency HHI:** ${t.marketConcentration.agencyHHI}\n- **Implication:** ${t.marketConcentration.agencyInterpretation}\n\n*Note: HHI < 1500 = Competitive, 1500-2500 = Moderate, > 2500 = Highly Concentrated*\n\n### TOP COMPETITORS (by Contract Value)\n${t.competitors.top5.map(((e,t)=>`${t+1}. **${e.vendor}**\n   - Market Share: ${e.marketShare}% | Value: ${a(e.spend)}\n   - Contracts: ${e.contractCount} | Avg Size: ${a(e.avgContractSize)}\n   - Agency Reach: ${e.agencyDiversity} agencies | ${e.subAgencyReach} sub-agencies\n   - Expiring (18mo): ${e.expiringContracts.length} contracts worth ${a(e.expiringValue)}\n   - NAICS: ${e.naicsCodes.slice(0,3).join(", ")||"N/A"}`)).join("\n")}\n\n${t.channels.all.length>0?`### CHANNEL PARTNERS (User-Identified)\n${t.channels.all.map((e=>`- **${e.vendor}**: ${a(e.spend)} (${e.contractCount} contracts, ${e.marketShare}% share)`)).join("\n")}\n- **Total Channel Value:** ${a(t.channels.totalValue)}`:"### NO CHANNEL PARTNERS IDENTIFIED\nConsider marking VARs, resellers, or teaming partners in the channel modal."}`}\n\n### TOP AGENCIES (by Spend)\n${t.agencies.top5.map(((t,n)=>`${n+1}. **${t.agency}**\n   - Spend: ${a(t.spend)} (${t.percentage}% of market)\n   - Contracts: ${t.contractCount} | Sub-Agencies: ${t.subAgencyCount}\n   - ${"product_oem"===e.type?"Top Partner":"Incumbent"}: ${t.incumbentVendor||"Various"}\n   - Top Sub-Agencies: ${t.subAgencies.slice(0,3).map((e=>e.name)).join(", ")}`)).join("\n")}\n\n### RECOMPETE INTELLIGENCE (18-Month Pipeline)\n\n**IMMEDIATE (0-6 Months) - ${t.recompetes.immediate.length} Opportunities - ${a(t.recompetes.immediate.reduce(((e,t)=>e+(t["Award Amount"]||0)),0))} at Risk**\n${t.recompetes.immediate.slice(0,5).map((e=>`- ${e["Awarding Agency"]}: ${a(e["Award Amount"])} | Incumbent: ${e["Recipient Name"]} | Ends: ${Utils.date(e["End Date"])}`)).join("\n")||"None identified"}\n\n**NEAR-TERM (6-12 Months) - ${t.recompetes.nearTerm.length} Opportunities - ${a(t.recompetes.nearTerm.reduce(((e,t)=>e+(t["Award Amount"]||0)),0))} at Risk**\n${t.recompetes.nearTerm.slice(0,5).map((e=>`- ${e["Awarding Agency"]}: ${a(e["Award Amount"])} | Incumbent: ${e["Recipient Name"]} | Ends: ${Utils.date(e["End Date"])}`)).join("\n")||"None identified"}\n\n**PIPELINE (12-18 Months) - ${t.recompetes.pipeline.length} Opportunities - ${a(t.recompetes.pipeline.reduce(((e,t)=>e+(t["Award Amount"]||0)),0))} at Risk**\n${t.recompetes.pipeline.slice(0,5).map((e=>`- ${e["Awarding Agency"]}: ${a(e["Award Amount"])} | Incumbent: ${e["Recipient Name"]} | Ends: ${Utils.date(e["End Date"])}`)).join("\n")||"None identified"}\n\n${t.naicsBreakdown.length>0?`### NAICS CODE BREAKDOWN\n${t.naicsBreakdown.slice(0,5).map((e=>`- **${e.code}** (${e.description||"No description"}): ${a(e.spend)} | ${e.count} contracts`)).join("\n")}`:`### NAICS CODE BREAKDOWN\n*No NAICS data available. API fields in this dataset: ${t.metadata.sampleFields?.join(", ")||"Unknown"}*`}\n\n${t.pscBreakdown.length>0?`### PSC CODE BREAKDOWN\n${t.pscBreakdown.slice(0,5).map((e=>`- **${e.code}** (${e.description||"No description"}): ${a(e.spend)} | ${e.count} contracts`)).join("\n")}`:"### PSC CODE BREAKDOWN\n*No PSC data available.*"}\n\n${t.forecastInsights?`### FORECAST & TREND ANALYSIS\n- **Baseline Annual Forecast:** ${a(t.forecastInsights.baseline)}\n- **YoY Growth Rate:** ${t.forecastInsights.growthRate?`${t.forecastInsights.growthRate.value}% (${t.forecastInsights.growthRate.comparison})`:"Insufficient complete year data"}\n- **Peak Spending Quarter:** Q${t.forecastInsights.peakQuarter?.quarter||"N/A"} (${t.forecastInsights.peakQuarter?.index||"N/A"}% of annual)\n- **Market Status:** ${t.forecastInsights.marketStatus}\n\n**Quarterly Forecasts:**\n${t.forecastInsights.quarterlyForecasts.map((e=>`- **${e.period}:** ${a(e.predicted)} (${e.trend}% vs historical avg) | Confidence: ${e.confidence?.label||"N/A"} - ${e.confidence?.reason||""}`)).join("\n")}\n\n**Seasonal Indices:**\n${Object.entries(t.forecastInsights.seasonalIndices).map((([e,t])=>`- Q${e}: ${(100*t).toFixed(1)}% of annual spend`)).join("\n")}\n\n${t.forecastInsights.strategy?`**AI Strategy Recommendation:**\n- **Outlook:** ${t.forecastInsights.strategy.title}\n- **Analysis:** ${t.forecastInsights.strategy.text}\n- **Recommended Action:** ${t.forecastInsights.strategy.action}\n- **BD Focus:** ${t.forecastInsights.strategy.matrix?.bd||"N/A"}\n- **Strategic Approach:** ${t.forecastInsights.strategy.matrix?.strat||"N/A"}\n- **Pipeline Focus:** ${t.forecastInsights.strategy.matrix?.pipe||"N/A"}\n\n${this.getStrategyInterpretation(e,t.forecastInsights.strategy)}`:""}\n\n**Historical Spending by Fiscal Year:**\n${Object.entries(t.forecastInsights.historicalByFY||{}).map((([e,t])=>`- FY${e}: ${a(Object.values(t).reduce(((e,t)=>e+t),0))} (Q1: ${a(t[1]||0)}, Q2: ${a(t[2]||0)}, Q3: ${a(t[3]||0)}, Q4: ${a(t[4]||0)})`)).join("\n")}`:"### NO FORECAST DATA AVAILABLE\nRun in Forecast Mode to get predictive analytics and trend analysis."}\n\n---\n\n## OUTPUT REQUIREMENTS\n\nGenerate an **executive-ready GTM playbook** (4-6 pages) using the **OneTeam collaborative approach**. Every section must include concrete actions, owners, and decision gates.\n\n### PART 1: EXECUTIVE SUMMARY (1/2 page)\n- Key findings from the data above\n- Primary opportunities (ranked by value and probability)\n- Recommended strategy in one paragraph\n- Critical success factors\n\n### PART 2: ${"product_oem"===e.type?"CHANNEL":"MARKET"} ANALYSIS (1 page)\n${"product_oem"===e.type?"- Channel performance scorecard (tier partners by revenue and growth)\n- Agency adoption map with coverage gaps\n- Partner concentration risk assessment\n- White space opportunities":"- Market size, growth trajectory, and concentration analysis\n- Competitive landscape and positioning\n- Agency priorities and budget signals\n- Entry points and timing considerations"}\n\n### PART 3: STAKEHOLDER PERSPECTIVES (OneTeam Format)\nProvide **1-2 actionable paragraphs** from each perspective:\n\n${this.getOneTeamPerspectives(e,s)}\n\n### PART 4: COMPETITIVE INTELLIGENCE\nCreate a table with this structure:\n| Competitor | Strengths | Weaknesses | Our Counter-Positioning |\n|------------|-----------|------------|------------------------|\n| [From data above] | [Specific advantage] | [Specific gap] | [How we differentiate] |\n\n${"product_oem"===e.type?"Also address: Are there alternative products agencies might consider? What triggers switching?":"Also address: DIY/In-House option - perceived control vs. hidden costs and talent risk."}\n\n### PART 5: 90-DAY CRITICAL PATH\n\n**Phase 1 — Discovery (Days 1–30)**\n${"product_oem"===e.type?"- Validate partner pipeline accuracy for all recompetes\n- Identify coverage gaps by agency/sub-agency\n- Assess partner enablement needs":"- Validate BANT (Budget, Authority, Need, Timeline) for top opportunities\n- Map stakeholders and decision-makers\n- Conduct gap analysis vs. incumbents"}\n**Gate 1:** ${"product_oem"===e.type?"Proceed if renewals tracked and partners engaged":"Proceed to pursuit if budget and champion confirmed"}\n\n**Phase 2 — ${"product_oem"===e.type?"Enablement":"Engagement"} (Days 31–60)**\n${"product_oem"===e.type?"- Execute partner training on new features/pricing\n- Joint account planning with top 5 partners\n- Develop co-branded collateral for key agencies":"- Execute targeted outreach to decision-makers\n- Conduct technical validation / PoC if applicable\n- Draft value proposition and ROI framework"}\n**Gate 2:** ${"product_oem"===e.type?"Advance if partners demonstrate pipeline growth":"Advance if success criteria met and business case approved"}\n\n**Phase 3 — ${"product_oem"===e.type?"Execution":"Pursuit"} (Days 61–90)**\n${"product_oem"===e.type?"- Support partners on active recompetes\n- Track win/loss on renewals\n- Build reference stories from wins":"- Finalize proposal strategy and pricing\n- Engage executives for relationship leverage\n- Submit response / negotiate terms"}\n**Gate 3:** ${"product_oem"===e.type?"Scale if renewal win rate > 80%":"Award or lessons learned capture"}\n\n### PART 6: RISK REGISTER\nCreate a table with this structure:\n| Risk | Impact (H/M/L) | Probability (H/M/L) | Mitigation Plan | Owner |\n|------|----------------|---------------------|-----------------|-------|\n${"product_oem"===e.type?"| Partner capacity constraints | H | M | Cross-train backup partners | Partner Lead |\n| Competitive product displacement | H | M | Accelerate feature parity + exec engagement | Product |\n| Renewal slippage | M | H | Early engagement 6mo before expiry | Channel Sales |":"| Technical non-compliance | H | M | Accelerate FedRAMP/security validation | Solution Architect |\n| Competitive displacement | H | M | Partner alignment + exec sponsorship | Sales |\n| Budget delay or CR | M | H | Identify bridge funding or carryover | Finance |"}\n[Add 2-3 more specific to the data above]\n\n### PART 7: RACI MATRIX\n| Workstream | Responsible | Accountable | Consulted | Informed |\n|------------|-------------|-------------|-----------|----------|\n${"product_oem"===e.type?"| Channel strategy | Partner Lead | Sales VP | Marketing, Product | Leadership |\n| Partner enablement | Enablement Mgr | Partner Lead | Product, Sales | Marketing |\n| Renewal tracking | Channel Sales | Partner Lead | Finance | Leadership |\n| Agency expansion | Sales Lead | Sales VP | Partner, Marketing | Product |":"| Account strategy | Sales Lead | BD Lead | SA, Marketing | Leadership |\n| Technical validation | SA Lead | BD Lead | Sales, Partner | Leadership |\n| Marketing campaign | Marketing Lead | BD Lead | Sales, Exec | Partner |\n| Pricing & negotiation | Sales Lead | Leadership | Finance | BD Lead |"}\n\n### PART 8: SUCCESS METRICS\n**Leading Indicators (Activity):**\n${"product_oem"===e.type?"- Partner pipeline reported ($)\n- Partners trained (#)\n- Joint meetings conducted (#)\n- Coverage gaps closed (#)":"- Qualified meetings held (#)\n- PoC/pilots initiated (#)\n- Champions identified (#)\n- Proposals submitted (#)"}\n\n**Lagging Indicators (Results):**\n${"product_oem"===e.type?"- Renewal win rate (%)\n- Channel revenue growth ($)\n- New agency logos (#)\n- Partner satisfaction score":"- Pipeline generated ($)\n- Win rate (%)\n- ARR/TCV closed ($)\n- References created (#)"}\n\n---\n\n## FY26 FEDERAL CONTEXT\n\n${this.getFY26Context(t.agencies.top5)}\n\n---\n\n## VALIDATION CRITERIA\n\n- **Specificity:** Reference actual ${"product_oem"===e.type?"partner":"vendor"}/agency names from the data\n- **Accountability:** Every action has an owner and timeline\n- **Federal-Savvy:** Address procurement realities (FAR, vehicles, budget cycles)\n- **No Filler:** Every sentence must advance execution\n- **Measurable:** Include quantified targets where possible\n- Plan must align with search intent: **${e.type}**`},getFY26Context(e){const t={"Department of Defense":"**DoD FY26 Priorities:**\n- Zero Trust implementation mandate by FY27\n- JADC2 (Joint All-Domain Command and Control) expansion\n- Software factory and DevSecOps acceleration\n- CMMC 2.0 compliance requirements\n- **Key Vehicles:** JWCC, Alliant 3, SEWP VI, OTA consortia (NSTXL, AFWERX)\n- **Budget:** $14B+ cyber budget across RDT&E and O&M","Department of Homeland Security":"**DHS FY26 Priorities:**\n- Cybersecurity and critical infrastructure protection\n- Border technology modernization\n- Identity and access management (ICAM)\n- Cloud migration and Zero Trust\n- **Key Vehicles:** EAGLE II, FirstSource III, SEWP VI, GSA MAS\n- **Budget:** Focus on CISA funding and component modernization","General Services Administration":"**GSA FY26 Priorities:**\n- Government-wide shared services expansion\n- FedRAMP authorization acceleration\n- Acquisition modernization and e-commerce\n- Login.gov and identity services\n- **Key Vehicles:** GSA MAS, Alliant 3, OASIS+, SEWP VI\n- **Budget:** TMF allocations and working capital fund","Department of Veterans Affairs":"**VA FY26 Priorities:**\n- EHR modernization (Oracle Health) stabilization\n- Veteran-facing digital services\n- Cybersecurity and Zero Trust\n- AI for claims processing and scheduling\n- **Key Vehicles:** T4NG2, SEWP VI, GSA MAS\n- **Budget:** $4B+ IT budget with modernization focus","Department of Health and Human Services":"**HHS FY26 Priorities:**\n- Public health data modernization\n- AI governance for medical applications\n- Interoperability and data sharing\n- Cybersecurity resilience\n- **Key Vehicles:** CIO-SP4, NIH LTASC, SEWP VI\n- **Budget:** CDC DMI funding, NIH STRIDES program","Department of the Treasury":"**Treasury FY26 Priorities:**\n- IRS modernization (IRA funding)\n- Financial crimes and fraud detection\n- Cloud migration and Zero Trust\n- Customer experience improvement\n- **Key Vehicles:** Alliant 3, SEWP VI, GSA MAS\n- **Budget:** IRA technology modernization funds","Department of Commerce":"**Commerce FY26 Priorities:**\n- CHIPS Act implementation support\n- Weather and climate data systems\n- Cybersecurity and export control systems\n- Cloud modernization\n- **Key Vehicles:** SEWP VI, GSA MAS, Alliant 3\n- **Budget:** CHIPS funding and bureau modernization","Department of Energy":"**DOE FY26 Priorities:**\n- Grid modernization and resilience\n- AI for scientific computing (exascale)\n- Cybersecurity for critical infrastructure\n- Climate modeling and clean energy data\n- **Key Vehicles:** DOE BPAs, SEWP VI, Lab IDIQs\n- **Budget:** IIJA extensions and OCIO modernization","Department of State":"**State FY26 Priorities:**\n- Diplomatic technology modernization\n- Cybersecurity and secure communications\n- Cloud migration (IL4/IL5 environments)\n- Consular systems modernization\n- **Key Vehicles:** GSA MAS, Alliant 3, SEWP VI\n- **Budget:** Diplomatic technology fund","Securities and Exchange Commission":"**SEC FY26 Priorities:**\n- Market surveillance and analytics modernization\n- Cybersecurity for financial data protection\n- Cloud migration and data management\n- Digital submission and processing systems\n- **Key Vehicles:** GSA MAS, SEWP VI, CIO-SP4\n- **Budget:** IT modernization and enforcement technology","Social Security Administration":"**SSA FY26 Priorities:**\n- Customer service modernization\n- Fraud detection and prevention\n- Legacy system modernization\n- Cloud and cybersecurity improvements\n- **Key Vehicles:** GSA MAS, SEWP VI, CIO-SP4\n- **Budget:** IT modernization fund and customer experience","Department of Justice":"**DOJ FY26 Priorities:**\n- Law enforcement technology modernization\n- Cybersecurity and data protection\n- Case management system upgrades\n- Cloud migration and Zero Trust\n- **Key Vehicles:** GSA MAS, ITES-3S, SEWP VI\n- **Budget:** IT working capital fund","Department of Agriculture":"**USDA FY26 Priorities:**\n- Farm and rural service delivery modernization\n- Cybersecurity and data protection\n- Cloud migration initiatives\n- Customer experience improvements\n- **Key Vehicles:** GSA MAS, SEWP VI, Alliant 3\n- **Budget:** OCIO modernization and FPAC systems","Federal Communications Commission":"**FCC FY26 Priorities:**\n- Spectrum management system modernization\n- Broadband mapping and data systems\n- Cybersecurity improvements\n- Public-facing digital services\n- **Key Vehicles:** GSA MAS, SEWP VI\n- **Budget:** IT modernization and enforcement systems"};let n="**Relevant FY26 Agency Priorities:**\n\n";const a=new Set;return e.forEach((e=>{const r=e.agency.toLowerCase();for(const[e,i]of Object.entries(t)){const t=e.toLowerCase(),s=e.split(" ").filter((e=>"Department"!==e&&"of"!==e&&"the"!==e));if((r.includes(t)||s.some((e=>e.length>3&&r.includes(e.toLowerCase()))))&&!a.has(e)){n+=i+"\n\n",a.add(e);break}}})),0===a.size&&(n+="*No specific agency context available. See Universal Requirements below.*\n\n"),n+="**Universal FY26 Compliance Requirements:**\n- OMB M-24-14: Cybersecurity Priorities\n- Zero Trust Architecture implementation\n- FedRAMP High / IL4-IL5 for cloud\n- CMMC 2.0 for defense contractors\n- EO 14110: AI Safety and Governance\n- TIC 3.0 network security",n},getOneTeamPerspectives(e,t){const n={product_oem:"\n**Sales (Channel Account Manager):** Assess partner pipeline health, identify which partners need support on active opportunities, flag any relationship risks or competitive threats at the account level.\n\n**Marketing (Channel Marketing):** Develop co-branded campaigns and content for top agencies, plan joint events or webinars, create partner-ready battle cards and ROI tools.\n\n**Solution Architect (Technical Enablement):** Identify integration requirements at key accounts, ensure partners are certified on latest features, develop technical win strategies for competitive situations.\n\n**Partner Lead (Channel Strategy):** Evaluate partner tier structure, assess coverage gaps, recommend partner recruitment or pruning, align incentives with strategic priorities.\n\n**Finance (Channel Operations):** Analyze deal registration and margin by partner, recommend pricing or incentive adjustments, forecast channel revenue by quarter.\n\n**Leadership (Executive Sponsor):** Determine strategic importance of this product line, allocate executive engagement for key renewals, set go/no-go criteria for partner investments.",own_company:"\n**Sales (Account Executive):** Provide current relationship status, identify champions and blockers, flag active RFPs or budget signals, assess competitive threats to existing contracts.\n\n**Marketing (Demand Generation):** Develop agency-specific messaging and value propositions, plan ABM campaigns and executive briefings, create case studies from recent wins.\n\n**Solution Architect (Technical Lead):** Validate technical alignment with agency requirements, identify compliance gaps (FedRAMP, CMMC, Zero Trust), scope PoC or pilot approach.\n\n**Partner Lead (Ecosystem Strategy):** Recommend teaming arrangements with SIs or ISVs, identify subcontracting opportunities, assess partner conflicts.\n\n**Finance (Deal Strategy):** Develop pricing strategy aligned with budget cycles, create ROI framework, recommend contract vehicle and structure.\n\n**Leadership (Executive Sponsor):** Confirm account tier and resource allocation, engage for executive-to-executive relationships, set pursuit go/no-go criteria.",competitor:"\n**Sales (Competitive Intelligence):** Document competitor's current positions, relationships, and contract expiration dates. Identify accounts where they are vulnerable.\n\n**Marketing (Competitive Positioning):** Develop \"why us vs. them\" messaging, create competitor battle cards, plan targeted campaigns against their install base.\n\n**Solution Architect (Technical Differentiation):** Identify technical gaps in competitor's solution, develop proof points for our advantages, create migration/displacement approach.\n\n**Partner Lead (Ecosystem Gaps):** Identify partners currently aligned with competitor, assess potential to flip partnerships, find SI/ISVs who prefer our solution.\n\n**Finance (Competitive Pricing):** Analyze competitor's pricing model, develop competitive pricing strategy, identify TCO advantages.\n\n**Leadership (Strategic Priority):** Determine investment level for competitive displacement, allocate resources for targeted pursuits.",agency:"\n**Sales (Account Development):** Map organizational structure and key stakeholders, identify budget owners and technical evaluators, assess current vendor relationships and satisfaction.\n\n**Marketing (Agency Marketing):** Develop mission-aligned messaging for this agency, plan targeted events and thought leadership, identify relevant case studies from similar agencies.\n\n**Solution Architect (Technical Alignment):** Map solution to agency technical environment, identify integration requirements, assess compliance posture (FedRAMP, IL level, etc.).\n\n**Partner Lead (Agency Relationships):** Identify SIs with strong agency relationships, assess teaming opportunities, recommend partner-led vs. direct approach.\n\n**Finance (Budget Intelligence):** Research agency budget and appropriations, identify funding sources (base budget, TMF, working capital), align pricing to fiscal year timing.\n\n**Leadership (Executive Engagement):** Plan executive-to-executive engagement strategy, identify industry days or speaking opportunities, set account penetration milestones.",partner:"\n**Sales (Joint Selling):** Identify joint opportunities in partner's pipeline, assess deal registration and support needs, plan co-selling activities.\n\n**Marketing (Partner Marketing):** Develop co-branded content and campaigns, plan joint events, create partner success stories.\n\n**Solution Architect (Integration):** Ensure technical integration between solutions, develop joint reference architecture, support partner technical enablement.\n\n**Partner Lead (Relationship Management):** Assess partnership health and alignment, develop joint business plan, identify expansion opportunities.\n\n**Finance (Partner Economics):** Analyze margin and deal structure, recommend incentive adjustments, forecast joint revenue.\n\n**Leadership (Strategic Partnership):** Confirm partnership tier and investment level, engage for executive alignment, set partnership success metrics.",market_keyword:"\n**Sales (Market Development):** Identify highest-potential agencies and accounts in this market, assess current relationships and entry points, prioritize pursuit targets.\n\n**Marketing (Market Strategy):** Develop market-specific messaging and positioning, plan awareness campaigns and thought leadership, create market-relevant content and case studies.\n\n**Solution Architect (Solution Fit):** Validate solution alignment with market requirements, identify compliance or integration gaps, develop market-specific reference architectures.\n\n**Partner Lead (Go-to-Market):** Identify partners with market expertise and relationships, recommend channel strategy, assess build vs. partner decision.\n\n**Finance (Market Sizing):** Validate TAM and growth assumptions, develop pricing strategy for market, create ROI frameworks relevant to this market's buyers.\n\n**Leadership (Market Investment):** Determine strategic priority of this market, allocate resources and headcount, set market share and revenue targets."};return n[e.type]||n.market_keyword},buildPackage(e,t,n={}){const a=this.classifySearchIntent(App.currentQuery,e,SalesPlanManager.channels),r=this.extractAllData(e,t,n);return this.generatePrompt(a,r,n)},downloadPackage(e){const t=new Blob([e],{type:"text/plain;charset=utf-8"}),n=document.createElement("a");n.href=URL.createObjectURL(t),n.download=`Sales_Plan_FY${Utils.getCurrentFY()}_${App.currentQuery.replace(/\s+/g,"_")}.txt`,document.body.appendChild(n),n.click(),document.body.removeChild(n)}};App.init();
</script>
</body>
</html>