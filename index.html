<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#000000">
  
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 rx=%2220%22 fill=%22%23000000%22/><text y=%2250%%22 x=%2250%%22 font-size=%2285%22 font-family=%22'JetBrains Mono', monospace%22 font-weight=%22700%22 fill=%22%23D4C4A8%22 text-anchor=%22middle%22 dominant-baseline=%22central%22>G</text></svg>">
  <title>Govhoo - Federal Contract Intelligence & Sales Planning</title>
  <meta name="title" content="Govhoo - Federal Contract Intelligence & Sales Planning">
  <meta name="description" content="Free Federal Sales Intelligence & FY2026 Strategic Planning. Follow the money with live USASpending data analysis.">
  <meta name="keywords" content="federal sales, usaspending search, government contracts, defense contracts, federal jobs, expiring contracts, federal territory planning, incumbent search">
  
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://govhoo.com/">
  <meta property="og:title" content="Govhoo | Follow the Money">
  <meta property="og:description" content="Analyze federal agency award flow and generate AI-ready sales plans.">
  <meta property="og:image" content="https://govhoo.com/social.png">
  
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:title" content="Govhoo | Federal Contract Intelligence">
  <meta property="twitter:description" content="Build your federal sales plan with live obligation data and trend forecasting.">
  
  <link rel="canonical" href="https://govhoo.com/">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <script src="https://kit.fontawesome.com/8ef6ca8a5d.js" crossorigin="anonymous"></script>
  
  <link rel="preconnect" href="https://api.usaspending.gov">
  <link rel="dns-prefetch" href="https://api.usaspending.gov">
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js" as="script">
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/d3-sankey/0.12.3/d3-sankey.min.js" as="script">
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js" as="script">
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-T343V4RFHV"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-T343V4RFHV');
  </script>
<style>
:root{--bg-app:#000;--bg-card:#121212;--bg-input:#1a1a1a;--border:#333;--text-primary:#eee7e4;--text-muted:#9a9a9a;--accent:#999;--accent-dim:hsla(0,0%,60%,0.1);--link:#8da0cb;--success:#5f8055;--danger:#a64438;--safe-top:env(safe-area-inset-top,20px);--safe-bottom:env(safe-area-inset-bottom,20px)}*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}body{margin:0;padding:0;font-family:Inter,sans-serif;background:var(--bg-app);color:var(--text-primary);min-height:100vh;overflow-x:hidden;width:100%}::-webkit-scrollbar{width:6px;height:6px}::-webkit-scrollbar-track{background:var(--bg-app)}::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}::-webkit-scrollbar-thumb:hover{background:var(--accent)}.view-section{display:none}.view-section.active{display:block}.loader{position:fixed;inset:0;z-index:300;background:rgba(0,0,0,.9);display:none;flex-direction:column;align-items:center;justify-content:center}.spinner{width:40px;height:40px;border:2px solid #333;border-top:2px solid var(--accent);border-radius:50%;animation:spin .8s linear infinite}@keyframes spin{to{transform:rotate(1turn)}}@keyframes fadeIn{to{opacity:1}}.buyer-name,.geo-state-name,.vendor-name{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:180px}.main-input{width:100%;background:var(--bg-input);border:1px solid var(--border);padding:1.25rem 1rem;font-size:1.1rem;color:#fff;border-radius:4px;font-family:Inter,sans-serif;transition:border-color .2s;-webkit-appearance:none}.main-input:focus{outline:none;border-color:var(--accent);background:#222}.btn-row{display:flex;gap:.75rem;margin-top:1rem}.btn-primary,.btn-secondary{flex:1;padding:1rem;font-weight:700;border:none;border-radius:4px;font-size:.9rem;cursor:pointer;text-transform:uppercase;letter-spacing:1px;display:flex;align-items:center;justify-content:center;gap:.5rem}.btn-primary{background:var(--accent);color:#000}.btn-secondary{background:transparent;color:var(--accent);border:1px solid var(--accent)}.btn-primary:hover,.btn-secondary:hover{opacity:.9}.action-btn{background:var(--bg-input);color:var(--accent);text-decoration:none;padding:.5rem 1rem;border-radius:4px;font-size:.8rem;font-weight:600;border:1px solid var(--border);display:flex;align-items:center;gap:6px}.action-btn:hover{border-color:var(--accent);background:var(--accent-dim)}.input-clear{position:absolute;right:12px;top:50%;transform:translateY(-50%);background:none;border:none;color:var(--text-muted);font-size:1.25rem;cursor:pointer;display:none;padding:4px 8px;z-index:215}.input-clear:hover{color:var(--accent)}.input-clear.visible{display:block}.hero-view{position:fixed;inset:0;z-index:200;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;padding:2rem;padding-top:max(8vh,var(--safe-top));transition:transform .5s cubic-bezier(.16,1,.3,1);overflow-y:auto}.hero-view.slide-up{transform:translateY(-100%)}.hero-view.hidden{display:none}.terminal-logo{font-family:JetBrains Mono,monospace;font-size:2.5rem;font-weight:700;margin-bottom:.5rem;color:var(--text-primary);letter-spacing:-1px;text-align:center}.terminal-logo span{color:var(--accent)}.hero-subtitle{margin-bottom:2rem;text-align:center;font-family:JetBrains Mono,monospace;font-size:.85rem;color:var(--text-muted)}.search-box-container{position:relative;z-index:210;width:100%;max-width:500px;margin-top:1.5rem}.autocomplete-wrapper{position:relative}.autocomplete-dropdown{position:absolute;top:100%;left:0;right:0;z-index:220;background:var(--bg-card);border:1px solid var(--border);border-top:none;border-radius:0 0 4px 4px;max-height:320px;overflow-y:auto;display:none}.autocomplete-dropdown.active{display:block}.autocomplete-section{padding:.5rem 0;border-bottom:1px solid var(--border)}.autocomplete-section:last-child{border-bottom:none}.autocomplete-section-label{padding:.25rem 1rem;font-size:.65rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:1px;font-family:JetBrains Mono,monospace}.autocomplete-item{padding:.6rem 1rem;cursor:pointer;display:flex;align-items:center;gap:.75rem;font-size:.9rem;color:var(--text-primary);transition:background .1s}.autocomplete-item.selected,.autocomplete-item:hover{background:hsla(0,0%,100%,.05)}.autocomplete-item i{color:var(--text-muted);width:16px;text-align:center;font-size:.8rem}.autocomplete-item-text{flex:1;min-width:0}.autocomplete-item-main{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.autocomplete-item-sub{font-size:.7rem;color:var(--text-muted);margin-top:2px}.autocomplete-empty{padding:1rem;text-align:center;color:var(--text-muted);font-size:.85rem}.app-header{position:sticky;top:0;z-index:100;background:rgba(0,0,0,.95);backdrop-filter:blur(10px);padding:.75rem 1rem;padding-top:max(.75rem,var(--safe-top));border-bottom:1px solid var(--border);justify-content:space-between}.app-header,.header-left{display:flex;align-items:center;gap:1rem}.header-left{flex:1;min-width:0}.logo-btn{font-family:JetBrains Mono;font-weight:700;color:#fff;cursor:pointer;flex-shrink:0}.logo-btn:hover{color:var(--accent)}.mini-search{background:var(--bg-input);border:1px solid var(--border);color:#fff;padding:.5rem 1rem;border-radius:4px;font-size:.9rem;flex:1;min-width:0}.mini-search:focus{outline:none;border-color:var(--accent)}.header-actions{display:flex;gap:.5rem;flex-shrink:0}.header-controls{gap:.75rem}.header-controls,.icon-btn{display:flex;align-items:center}.icon-btn{background:var(--bg-input);border:1px solid var(--border);color:var(--text-muted);width:36px;height:36px;border-radius:4px;justify-content:center;cursor:pointer}.icon-btn.active,.icon-btn:hover{border-color:var(--accent);color:var(--accent)}.icon-btn.active{background:var(--accent-dim)}.dashboard-container{padding:1rem;padding-bottom:calc(2rem + var(--safe-bottom));max-width:1400px;margin:0 auto;display:none;width:100%}.dashboard-container.active{display:block;animation:fadeIn .8s forwards}.mode-toggle{display:flex;gap:.5rem;margin-bottom:1.5rem;background:var(--bg-card);padding:.5rem;border-radius:4px;border:1px solid var(--border)}.mode-btn{flex:1;padding:.75rem;background:transparent;border:none;color:var(--text-muted);font-family:JetBrains Mono;font-size:.85rem;cursor:pointer;border-radius:4px;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:.5rem}.mode-btn.active{background:var(--accent);color:#000;font-weight:700}.mode-btn:hover:not(.active){color:var(--text-primary)}.section-header{justify-content:space-between;margin:2rem 0 1rem;border-bottom:1px solid var(--border);padding-bottom:.5rem;flex-wrap:wrap}.section-header,.section-title-group{display:flex;align-items:center;gap:.5rem}.section-title{font-family:JetBrains Mono,monospace;font-size:.9rem;font-weight:700;color:var(--accent);text-transform:uppercase;letter-spacing:1px}.section-subtitle{font-size:.75rem;color:var(--text-muted);font-style:italic}.stats-row{display:grid;grid-template-columns:repeat(4,1fr);gap:1rem;margin-bottom:1.5rem}.stat-item{background:var(--bg-card);padding:1rem;border-radius:4px;border:1px solid var(--border);text-align:center}.stat-label{font-size:.7rem;color:var(--text-muted);text-transform:uppercase;margin-bottom:.5rem}.stat-val{font-size:1.25rem;font-weight:700;font-family:JetBrains Mono;color:#fff}.stat-sub{font-size:.7rem;color:var(--success);margin-top:4px}.stat-sub.neutral{color:var(--text-muted)}.stat-item-action:hover{background:var(--accent-dim);border-color:var(--accent)!important}.chart-wrapper{background:var(--bg-card);border:1px solid var(--border);border-radius:4px;padding:1rem;width:100%;overflow-x:auto;overflow-y:visible}.chart-container{width:100%;min-height:500px;height:auto;display:block}.feed-grid{display:flex;flex-direction:column;gap:1rem}.deal-card{background:var(--bg-card);border:1px solid var(--border);border-radius:4px;padding:1.25rem;transition:transform .1s}.deal-card:active{transform:scale(.99)}.deal-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:.75rem}.deal-agency{font-size:.75rem;color:var(--text-muted);font-weight:600;text-transform:uppercase;background:hsla(0,0%,100%,.05);padding:2px 6px;border-radius:4px}.deal-amount{font-family:JetBrains Mono,monospace;color:var(--accent);font-weight:700;font-size:1rem}.deal-desc{font-size:1rem;font-weight:600;margin-bottom:.5rem;line-height:1.4;color:#fff}.deal-vendor{font-size:.85rem;color:#8da0cb;margin-bottom:.75rem;font-family:JetBrains Mono,monospace}.deal-meta{display:flex;flex-wrap:wrap;gap:.5rem;margin-bottom:1rem}.deal-footer{display:flex;justify-content:space-between;align-items:center;padding-top:1rem;border-top:1px solid #222}.deal-date{font-size:.75rem}.deal-date,.meta-tag{color:var(--text-muted)}.meta-tag{font-size:.65rem;font-family:JetBrains Mono,monospace;padding:3px 8px;border-radius:3px;background:hsla(0,0%,100%,.05);border:1px solid var(--border)}.meta-tag.psc{background:rgba(143,182,208,.15);border-color:rgba(143,182,208,.3);color:#8fb6d0}.meta-tag.naics{background:rgba(180,143,208,.15);border-color:rgba(180,143,208,.3);color:#b48fd0}.meta-tag.mission-gap{font-weight:600}.meta-tag.mission-gap.high{background:rgba(251,128,114,.15);border-color:rgba(251,128,114,.4);color:var(--danger)}.meta-tag.mission-gap.medium{background:rgba(253,216,53,.15);border-color:rgba(253,216,53,.4);color:#fdd835}.meta-tag.mission-gap.low{background:hsla(0,0%,100%,.05);border-color:var(--border);color:var(--text-muted)}.time-badge{color:var(--text-muted);border:1px solid var(--border);border-radius:4px}.filter-badge,.time-badge{font-family:JetBrains Mono,monospace;font-size:.7rem;padding:4px 8px}.filter-badge{display:none;background:var(--accent-dim);color:var(--accent);border:1px solid var(--accent);border-radius:4px;cursor:pointer;align-items:center;gap:6px}.filter-badge:hover{background:rgba(212,196,168,.2)}.mission-gap-signals{font-size:.7rem;color:var(--text-muted);margin-top:6px;font-style:italic}.mission-gap-filter{display:flex;align-items:center;gap:.5rem}.mission-gap-toggle{display:flex;align-items:center;gap:.4rem;padding:4px 10px;background:transparent;border:1px solid var(--border);border-radius:4px;font-size:.7rem;font-family:JetBrains Mono,monospace;color:var(--text-muted);cursor:pointer;transition:all .2s}.mission-gap-toggle:hover{border-color:var(--accent);color:var(--accent)}.mission-gap-toggle.active{background:rgba(251,128,114,.15);border-color:var(--danger);color:var(--danger)}.mission-gap-toggle i{font-size:.65rem}.buyer-list{display:flex;flex-direction:column;gap:0;width:100%}.buyer-item{display:flex;align-items:center;gap:.75rem;padding:.75rem 0;border-bottom:1px solid hsla(0,0%,100%,.05);width:100%}.buyer-item:last-child{border-bottom:none}.buyer-rank{width:24px;height:24px;background:var(--accent-dim);color:var(--accent);border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:JetBrains Mono,monospace;font-size:.7rem;font-weight:700;flex-shrink:0}.buyer-info{flex:1;min-width:0}.buyer-name{font-size:.85rem;color:var(--text-primary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.buyer-stats{font-size:.7rem;color:var(--text-muted);margin-top:2px}.buyer-amount{text-align:right;flex-shrink:0}.buyer-spend{font-family:JetBrains Mono,monospace;font-size:.85rem;font-weight:600;color:var(--accent)}.buyer-share{font-size:.7rem;color:var(--text-muted)}.projection-summary{margin-top:1rem;padding:1.5rem;background:linear-gradient(135deg,rgba(212,196,168,.1),#121212);border:1px solid var(--accent);border-radius:4px;position:relative;overflow:hidden}.forecast-table-wrapper{background:var(--bg-card);border:1px solid var(--border);overflow-x:auto;border-radius:4px;width:100%}.forecast-table{width:100%;border-collapse:collapse;font-family:JetBrains Mono;font-size:.8rem}.forecast-table th{text-align:left;color:var(--text-muted)}.forecast-table td,.forecast-table th{padding:1rem;border-bottom:1px solid var(--border)}.forecast-table td{color:var(--text-primary)}.trend-pill{padding:2px 6px;border-radius:2px;font-size:.7rem;font-weight:700;white-space:nowrap;display:inline-flex;align-items:center;gap:2px}.trend-up{color:var(--success);background:rgba(102,194,165,.1)}.trend-down{color:var(--danger);background:rgba(251,128,114,.1)}.insight-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;margin-bottom:2rem}.insight-card{background:var(--bg-card);border:1px solid var(--border);padding:1rem;border-radius:4px}.insight-val{font-size:1.1rem;color:var(--text-primary);font-weight:700;font-family:JetBrains Mono}.insight-label{font-size:.7rem;color:var(--text-muted);text-transform:uppercase;margin-bottom:.5rem}.methodology-card{background:var(--bg-card);border:1px solid var(--border);border-radius:4px;padding:1.5rem;display:grid;grid-template-columns:repeat(2,1fr);gap:1.5rem}.method-item{padding-bottom:1rem;border-bottom:1px solid var(--border)}.method-item:nth-last-child(-n+2){border-bottom:none;padding-bottom:0}.method-title{font-family:JetBrains Mono,monospace;font-size:.85rem;font-weight:700;color:var(--accent);margin-bottom:.5rem;display:flex;align-items:center;gap:.5rem}.method-title i{font-size:.75rem;opacity:.7}.method-desc{font-size:.8rem;color:var(--text-muted);line-height:1.5}.method-desc code{background:hsla(0,0%,100%,.1);padding:2px 6px;border-radius:3px;font-family:JetBrains Mono,monospace;font-size:.75rem}.method-desc code,.method-desc strong{color:var(--text-primary)}.geo-map-container{background:var(--bg-card);border:1px solid var(--border);border-radius:4px;padding:1rem;margin-bottom:1.5rem;width:100%}.geo-map-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.geo-map-title{font-size:.75rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:1px}.geo-map-title,.geo-map-total{font-family:JetBrains Mono,monospace}.geo-map-total{font-size:.85rem;color:var(--accent);font-weight:600}.geo-states-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:.5rem;max-height:300px;overflow-y:auto;width:100%}.geo-state-item{display:flex;align-items:center;justify-content:space-between;gap:.5rem;padding:.5rem .75rem;background:hsla(0,0%,100%,.02);border-radius:4px;font-size:.8rem}.geo-state-name{color:var(--text-primary);font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1;min-width:0}.geo-state-amount{color:var(--accent);font-family:JetBrains Mono,monospace;font-size:.75rem;flex-shrink:0}.analysis-panel{background:var(--bg-card);border:1px solid var(--border);border-radius:4px;overflow:hidden;width:100%}.analysis-panel-header{padding:.75rem 1rem;background:hsla(0,0%,100%,.02);border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}.analysis-panel-title{font-family:JetBrains Mono,monospace;font-size:.7rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:1px;display:flex;align-items:center;gap:.5rem}.analysis-panel-badge{font-size:.65rem;padding:2px 8px;border-radius:10px;font-weight:600;font-family:JetBrains Mono,monospace}.analysis-panel-badge.high{background:rgba(102,194,165,.2);color:var(--success)}.analysis-panel-badge.medium{background:rgba(253,216,53,.2);color:#fdd835}.analysis-panel-badge.low{background:rgba(239,83,80,.2);color:var(--danger)}.analysis-panel-badge.neutral{background:hsla(0,0%,100%,.1);color:var(--text-muted)}.analysis-panel-body{padding:1rem;width:100%}.analysis-metric{display:flex;justify-content:space-between;align-items:center;padding:.5rem 0;border-bottom:1px solid hsla(0,0%,100%,.05)}.analysis-metric:last-child{border-bottom:none}.analysis-metric-label{font-size:.8rem;color:var(--text-muted)}.analysis-metric-value{font-family:JetBrains Mono,monospace;font-size:.85rem;font-weight:600;color:var(--text-primary)}.analysis-insight{margin-top:.75rem;padding:.75rem;background:rgba(212,196,168,.05);border-left:2px solid var(--accent);font-size:.8rem;color:var(--text-muted);line-height:1.5}.drill-breadcrumb{padding:.75rem 1rem;background:linear-gradient(90deg,rgba(212,196,168,.1),transparent);border:1px solid var(--border);border-radius:4px;margin-bottom:1rem;font-family:JetBrains Mono,monospace;font-size:.8rem;overflow-x:auto;white-space:nowrap}.breadcrumb-item,.drill-breadcrumb{display:flex;align-items:center;gap:.5rem}.breadcrumb-item{color:var(--text-muted);cursor:pointer;padding:4px 8px;border-radius:4px;transition:all .2s}.breadcrumb-item:hover{background:var(--accent);color:#000}.breadcrumb-item.active{background:var(--accent-dim);color:var(--accent);border:1px solid var(--accent);cursor:default}.breadcrumb-separator{color:var(--border);font-size:.7rem}.breadcrumb-icon,.drill-hint{font-size:.75rem}.drill-hint{display:flex;align-items:center;justify-content:center;gap:.5rem;padding:.5rem;background:rgba(212,196,168,.05);border:1px dashed var(--border);border-radius:4px;margin-top:.5rem;color:var(--text-muted)}.drill-hint i{color:var(--accent)}.subagency-panel{background:var(--bg-card);border:1px solid var(--border);border-radius:4px;margin-top:1.5rem;overflow:hidden}.subagency-header{display:flex;align-items:center;justify-content:space-between;padding:1rem;background:linear-gradient(90deg,rgba(212,196,168,.08),transparent);border-bottom:1px solid var(--border)}.subagency-header-left{display:flex;align-items:center;gap:.75rem}.subagency-header-icon{width:36px;height:36px;display:flex;align-items:center;justify-content:center;background:var(--accent-dim);border:1px solid var(--accent);border-radius:4px;color:var(--accent)}.subagency-header-text h3{margin:0;font-family:JetBrains Mono,monospace;font-size:.9rem;color:var(--text-primary);font-weight:600}.subagency-header-text span{font-size:.75rem;color:var(--text-muted)}.subagency-stats{display:flex;gap:1.5rem;font-family:JetBrains Mono,monospace}.subagency-stat{text-align:right}.subagency-stat-val{font-size:1rem;font-weight:700;color:var(--accent)}.subagency-stat-label{font-size:.65rem;color:var(--text-muted);text-transform:uppercase}.subagency-list{max-height:400px;overflow-y:auto}.subagency-item{display:flex;align-items:center;justify-content:space-between;padding:1rem;border-bottom:1px solid var(--border);cursor:pointer;transition:all .15s}.subagency-item:hover{background:hsla(0,0%,100%,.02)}.subagency-item:last-child{border-bottom:none}.subagency-item-left{display:flex;align-items:center;gap:1rem;flex:1;min-width:0}.subagency-rank{width:28px;height:28px;display:flex;align-items:center;justify-content:center;background:hsla(0,0%,100%,.05);border-radius:4px;font-family:JetBrains Mono,monospace;font-size:.75rem;color:var(--text-muted);flex-shrink:0}.subagency-rank.top-3{background:var(--accent-dim);color:var(--accent);border:1px solid rgba(212,196,168,.3)}.subagency-info{flex:1;min-width:0}.subagency-name{font-size:.9rem;color:var(--text-primary);font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.subagency-contracts{font-size:.75rem;color:var(--text-muted);margin-top:2px}.subagency-item-right{display:flex;align-items:center;gap:1rem;flex-shrink:0}.subagency-bar-container{width:120px;height:8px;background:hsla(0,0%,100%,.05);border-radius:4px;overflow:hidden}.subagency-bar{height:100%;background:linear-gradient(90deg,var(--accent),hsla(0,0%,60%,.3));border-radius:4px;transition:width .3s ease}.subagency-amount{font-family:JetBrains Mono,monospace;font-size:.9rem;font-weight:700;color:var(--accent);min-width:80px;text-align:right}.subagency-drill-icon{color:var(--text-muted);font-size:.8rem;opacity:0;transition:all .15s}.subagency-item:hover .subagency-drill-icon{opacity:1;color:var(--accent);transform:translateX(2px)}.drill-level-indicator{display:inline-flex;align-items:center;gap:.25rem;padding:2px 6px;background:rgba(102,194,165,.1);border:1px solid rgba(102,194,165,.3);border-radius:4px;font-size:.65rem;color:var(--success);margin-left:.5rem}.node-drillable{cursor:pointer}.node-drillable:hover{filter:brightness(1.2)}.empty-drill-state{text-align:center;padding:3rem 2rem;color:var(--text-muted)}.empty-drill-state i{font-size:2rem;color:var(--border);margin-bottom:1rem}.empty-drill-state p{margin:.5rem 0}.sales-plan-card{background:linear-gradient(135deg,rgba(212,196,168,.15),rgba(212,196,168,.05));border:1px solid var(--accent);border-radius:4px;padding:1rem;cursor:pointer;transition:all .3s ease;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center}.sales-plan-card:hover{transform:translateY(-4px);box-shadow:0 8px 30px rgba(212,196,168,.4);border-color:var(--accent);background:linear-gradient(135deg,rgba(212,196,168,.25),rgba(212,196,168,.1))}.sales-plan-card-icon{font-size:1.5rem;color:var(--accent);margin-bottom:.5rem}.sales-plan-card-title{font-size:.85rem;font-weight:700;color:var(--accent);margin-bottom:.25rem;text-transform:uppercase;letter-spacing:1px}.sales-plan-card-subtitle{font-size:.85rem;color:var(--text-primary);line-height:1.4;margin-bottom:.75rem}.sales-plan-card-action{display:inline-flex;align-items:center;gap:.5rem;font-size:.75rem;color:var(--accent);text-transform:uppercase;letter-spacing:1px;font-weight:600}.hero-growth-label{font-family:JetBrains Mono,monospace;font-size:.7rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:2px;margin-bottom:.5rem}.hero-growth-value{font-size:2.5rem;font-weight:800;font-family:JetBrains Mono,monospace;line-height:1}.strategic-narrative-card{background:var(--bg-card);border-left:4px solid var(--accent);padding:1.25rem;margin:1.5rem 0;font-size:.9rem;line-height:1.6}.job-intel-panel{background:linear-gradient(135deg,rgba(141,160,203,.05),rgba(212,196,168,.05));border:1px solid var(--border);border-radius:6px;padding:1rem}.job-link{font-size:.65rem;color:var(--link);text-decoration:none;display:inline-flex;align-items:center;gap:3px;padding:2px 6px;border-radius:3px;background:rgba(141,160,203,.1);border:1px solid rgba(141,160,203,.2);transition:all .15s}.job-link:hover{background:rgba(141,160,203,.2);border-color:rgba(141,160,203,.4);color:#fff}.job-link i{font-size:.6rem}.skills-demand{margin-top:1rem;padding:1rem;background:var(--bg-card);border:1px solid var(--border);border-radius:4px}.skills-header{font-family:JetBrains Mono,monospace;font-size:.7rem;color:var(--accent);text-transform:uppercase;letter-spacing:1px;margin-bottom:.75rem;display:flex;align-items:center;gap:.5rem}.skill-bar-container{margin-bottom:.5rem}.skill-bar-label{display:flex;justify-content:space-between;font-size:.75rem;margin-bottom:4px}.skill-bar-name{color:var(--text-primary);font-weight:500}.skill-bar-pct{color:var(--text-muted);font-family:JetBrains Mono,monospace;font-size:.7rem}.skill-bar{height:8px;background:hsla(0,0%,100%,.08);border-radius:4px;overflow:hidden;position:relative}.skill-bar-fill{height:100%;background:linear-gradient(90deg,#8da0cb,#d4c4a8);border-radius:4px;transition:width .4s ease-out;min-width:2px}.compact-winner-list{display:flex;flex-direction:column;gap:.6rem}.compact-winner-item{display:flex;align-items:flex-start;gap:.6rem;padding:.5rem;border-radius:4px;background:hsla(0,0%,100%,.02)}.compact-winner-item:hover{background:hsla(0,0%,100%,.05)}.compact-winner-rank{width:20px;height:20px;background:var(--accent-dim);color:var(--accent);border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:JetBrains Mono,monospace;font-size:.6rem;font-weight:700;flex-shrink:0;margin-top:2px}.compact-winner-info{flex:1;min-width:0}.compact-winner-name{font-size:.8rem;color:var(--text-primary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-weight:500}.compact-winner-meta{font-size:.65rem;color:var(--text-muted);font-family:JetBrains Mono,monospace;margin-top:2px}.compact-location-list{display:flex;flex-direction:column;gap:.5rem}.compact-location-item{display:flex;align-items:center;gap:.6rem;padding:.4rem .5rem;border-radius:4px;background:hsla(0,0%,100%,.02)}.compact-location-item:hover{background:hsla(0,0%,100%,.05)}.compact-location-rank{width:18px;height:18px;background:rgba(141,160,203,.2);color:var(--link);border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:JetBrains Mono,monospace;font-size:.55rem;font-weight:700;flex-shrink:0}.compact-location-info{flex:1;min-width:0}.compact-location-name{font-size:.75rem;color:var(--text-primary);font-weight:500}.compact-location-meta{font-size:.6rem;color:var(--text-muted);font-family:JetBrains Mono,monospace}.intelligence-banner{margin:1.5rem 0 .5rem;padding:1rem;background:rgba(214,109,100,.1);border:1px solid rgba(214,109,100,.3);border-left:4px solid #d66d64;border-radius:4px;display:flex;gap:1rem;align-items:flex-start;font-size:.75rem;color:var(--text-muted);line-height:1.5}.intel-icon{color:#d66d64;font-size:1.1rem;margin-top:2px;flex-shrink:0}.intel-content strong{color:#fff;font-family:JetBrains Mono,monospace;font-size:.75rem;text-transform:uppercase;letter-spacing:.5px}.intel-tip{margin-top:.5rem;padding-top:.5rem;border-top:1px solid rgba(214,109,100,.2);color:#e0e0e0}#spIntentBanner{display:none;background:hsla(0,0%,100%,.02);border-bottom:1px solid var(--border);padding:1rem 1.5rem}.intent-banner-content{display:flex;align-items:flex-start;gap:.75rem}.intent-banner-icon{font-size:1.25rem;color:var(--accent);opacity:.9;width:24px;text-align:center;flex-shrink:0}.intent-banner-text{flex:1}.intent-banner-title{font-family:JetBrains Mono,monospace;font-size:.7rem;font-weight:700;color:var(--text-muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:.25rem}.intent-banner-desc{font-size:.95rem;color:var(--text-primary);margin-bottom:.5rem;font-weight:500}.intent-banner-focus{display:flex;flex-wrap:wrap;align-items:center;gap:.4rem}.focus-label{font-family:JetBrains Mono,monospace;font-size:.6rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:.5px}.focus-tag{font-size:.65rem;background:transparent;border:none;color:var(--text-muted);padding:0}.focus-tag:before{content:"•";margin-right:.35rem;color:var(--accent)}.channel-marking-modal{position:fixed;top:0;left:0;right:0;bottom:0;background:transparent;z-index:500;padding:2rem;overflow-y:auto;display:flex;align-items:flex-start;justify-content:center;opacity:0;visibility:hidden;transition:opacity .25s ease,background .25s ease,visibility .25s}.channel-marking-modal.active{opacity:1;visibility:visible;background:rgba(0,0,0,.9)}.channel-modal-content{background:var(--bg-card);border:1px solid var(--border);border-radius:8px;max-width:800px;width:100%;margin:2rem auto;transform:translateY(-20px) scale(.98);transition:transform .25s ease-out;display:flex;flex-direction:column;max-height:85vh}.channel-marking-modal.active .channel-modal-content{transform:translateY(0) scale(1)}.channel-modal-header{padding:1.5rem;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}.channel-modal-title{font-size:1.3rem;font-weight:700;color:var(--accent);font-family:JetBrains Mono,monospace}.channel-modal-close{background:transparent;border:none;color:var(--text-muted);font-size:1.5rem;cursor:pointer;width:40px;height:40px;display:flex;align-items:center;justify-content:center;border-radius:4px}.channel-modal-close:hover{background:hsla(0,0%,100%,.05);color:var(--accent)}.channel-modal-body{padding:1.5rem;flex:1;overflow-y:auto;min-height:0}.channel-explanation{background:rgba(212,196,168,.1);border-left:3px solid var(--accent);padding:1rem;margin-bottom:1.5rem;font-size:.9rem;color:var(--text-primary);line-height:1.6}.vendor-list-item{display:flex;align-items:center;justify-content:space-between;padding:.75rem 1rem;border:1px solid var(--border);border-radius:4px;margin-bottom:.5rem;transition:all .2s}.vendor-list-item:hover{background:hsla(0,0%,100%,.02);border-color:var(--accent)}.vendor-info{flex:1;min-width:0}.vendor-name{font-weight:600;color:var(--text-primary);margin-bottom:.25rem}.vendor-stats{font-size:.75rem;color:var(--text-muted)}.vendor-toggle{display:flex;align-items:center;gap:.5rem}.toggle-switch{position:relative;width:50px;height:26px;background:#333;border-radius:13px;cursor:pointer;transition:background .3s}.toggle-switch.active{background:var(--accent)}.toggle-slider{position:absolute;top:3px;left:3px;width:20px;height:20px;background:#fff;border-radius:50%;transition:transform .3s}.toggle-switch.active .toggle-slider{transform:translateX(24px)}.toggle-label{font-size:.75rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:.5px;min-width:80px}.toggle-switch.active+.toggle-label{color:var(--accent);font-weight:600}.channel-modal-footer{padding:1rem 1.5rem;border-top:1px solid var(--border);display:flex;gap:1rem;justify-content:space-between;align-items:center;flex-shrink:0;background:var(--bg-card)}.modal-footer-buttons{display:flex;gap:.75rem;align-items:center}.modal-footer-secondary{display:flex;gap:.5rem}.modal-status-line{font-size:.75rem;color:var(--text-muted)}.modal-btn{padding:.75rem 1.5rem;border-radius:4px;font-weight:600;cursor:pointer;transition:all .2s;text-transform:uppercase;letter-spacing:1px;font-size:.85rem}.modal-btn-cancel{background:transparent;border:1px solid var(--border);color:var(--text-muted)}.modal-btn-cancel:hover{border-color:var(--accent);color:var(--accent)}.modal-btn-primary{background:var(--accent);border:none;color:#000}.modal-btn-primary:hover{opacity:.9;transform:translateY(-1px)}.channel-link{display:inline-flex;align-items:center;gap:.25rem;font-size:.75rem;color:var(--text-muted);margin-top:.5rem;cursor:pointer;text-decoration:underline}.channel-link:hover{color:var(--accent)}.ai-link-btn{display:flex;align-items:center;justify-content:center;gap:.5rem;padding:.75rem 1rem;border-radius:4px;color:#fff;text-decoration:none;font-family:Inter,sans-serif;font-size:.8rem;font-weight:600;border:none;transition:transform .1s,opacity .2s}.ai-link-btn:hover{transform:translateY(-1px);opacity:.9}.ai-link-btn.claude{background:#c15f3c}.ai-link-btn.chatgpt{background:#4796e3}.ai-link-btn.gemini{background:#9177c7}.pipeline-builder-btn{display:flex;align-items:center;gap:.5rem;padding:.75rem 1.25rem;border-radius:4px;background:linear-gradient(135deg,#5f8055,#4a6b42);color:#fff;border:none;cursor:pointer;font-family:JetBrains Mono,monospace;font-size:.8rem;font-weight:600;text-transform:uppercase;letter-spacing:.5px;transition:all .2s ease}.pipeline-builder-btn:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(95,128,85,.3)}.pipeline-builder-btn i{font-size:1rem}.pipeline-modal{position:fixed;top:0;left:0;right:0;bottom:0;background:transparent;z-index:500;padding:2rem;overflow-y:auto;display:flex;align-items:flex-start;justify-content:center;opacity:0;visibility:hidden;transition:opacity .25s ease,background .25s ease,visibility .25s}.pipeline-modal.active{opacity:1;visibility:visible;background:rgba(0,0,0,.9)}.pipeline-modal-content{background:var(--bg-card);border:1px solid var(--border);border-radius:8px;max-width:1100px;width:100%;margin:2rem auto;transform:translateY(-20px) scale(.98);transition:transform .25s ease-out;display:flex;flex-direction:column;max-height:90vh}.pipeline-modal.active .pipeline-modal-content{transform:translateY(0) scale(1)}.pipeline-progress{display:flex;align-items:center;justify-content:center;gap:.5rem;padding:2rem;color:var(--accent)}.pipeline-progress .spinner{width:24px;height:24px;border:2px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin 1s linear infinite}.pipeline-results-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:1rem;margin-bottom:1.5rem}.pipeline-stat{background:hsla(0,0%,100%,.02);border:1px solid var(--border);border-radius:4px;padding:1rem;text-align:center}.pipeline-stat-label{font-size:.65rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:.5rem}.pipeline-stat-value{font-family:JetBrains Mono,monospace;font-size:1.25rem;font-weight:700;color:var(--accent)}.pipeline-stat-sub{font-size:.7rem;color:var(--text-muted);margin-top:.25rem}.pipeline-table-wrapper{overflow-x:auto;max-height:400px;overflow-y:auto;border:1px solid var(--border);border-radius:4px}.pipeline-table{width:100%;border-collapse:collapse;font-size:.8rem}.pipeline-table th{position:sticky;top:0;background:var(--bg-card);padding:.75rem .5rem;text-align:left;font-weight:600;color:var(--accent);border-bottom:2px solid var(--border);font-family:JetBrains Mono,monospace;font-size:.7rem;text-transform:uppercase;letter-spacing:.5px;white-space:nowrap}.pipeline-table td{padding:.6rem .5rem;border-bottom:1px solid hsla(0,0%,100%,.05);color:var(--text-primary)}.pipeline-table tr:hover{background:hsla(0,0%,100%,.02)}.pipeline-table .amount{font-family:JetBrains Mono,monospace;color:var(--success);font-weight:600}.pipeline-table .date{font-family:JetBrains Mono,monospace;color:var(--text-muted);font-size:.75rem}.pipeline-table .agency{color:var(--link)}.pipeline-table .stage{display:inline-block;padding:2px 6px;border-radius:3px;font-size:.65rem;font-weight:600;text-transform:uppercase}.pipeline-table .stage.prospecting{background:rgba(141,160,203,.2);color:#8da0cb}.pipeline-table .stage.qualification{background:rgba(233,196,106,.2);color:#e9c46a}.pipeline-quarter-badge{display:inline-block;padding:2px 6px;border-radius:3px;font-size:.65rem;font-weight:600;background:rgba(95,128,85,.2);color:var(--success);font-family:JetBrains Mono,monospace}.pipeline-source-tag{display:inline-block;padding:1px 4px;border-radius:2px;font-size:.6rem;background:rgba(212,196,168,.1);color:var(--text-muted);margin-left:4px}.pipeline-config-row{display:grid;grid-template-columns:1fr 1fr 1fr;gap:1rem;margin-bottom:1rem}.pipeline-config-item label{display:block;font-size:.7rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:.5rem;font-weight:600}.pipeline-config-item input,.pipeline-config-item select{width:100%;padding:.6rem;background:var(--bg-app);border:1px solid var(--border);border-radius:4px;color:var(--text-primary);font-size:.85rem}.pipeline-config-item input:focus,.pipeline-config-item select:focus{outline:none;border-color:var(--accent)}.convo-starters-btn{display:flex;align-items:center;gap:.5rem;padding:.6rem 1rem;border-radius:4px;background:linear-gradient(135deg,#8da0cb,#6b7fb3);color:#fff;border:none;cursor:pointer;font-family:JetBrains Mono,monospace;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.5px;transition:all .2s ease;white-space:nowrap}.convo-starters-btn:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(141,160,203,.3)}.convo-starters-btn:disabled{opacity:.5;cursor:not-allowed;transform:none}.convo-modal{position:fixed;top:0;left:0;right:0;bottom:0;background:transparent;z-index:500;padding:1rem;overflow-y:auto;display:flex;align-items:flex-start;justify-content:center;opacity:0;visibility:hidden;transition:opacity .25s ease,background .25s ease,visibility .25s}.convo-modal.active{opacity:1;visibility:visible;background:rgba(0,0,0,.9)}.convo-modal-content{background:var(--bg-card);border:1px solid var(--border);border-radius:8px;max-width:700px;width:100%;margin:1rem auto;transform:translateY(-20px) scale(.98);transition:transform .25s ease-out;display:flex;flex-direction:column;max-height:90vh}.convo-modal.active .convo-modal-content{transform:translateY(0) scale(1)}.convo-card{background:hsla(0,0%,100%,.02);border:1px solid var(--border);border-left:3px solid #8da0cb;border-radius:4px;padding:1rem;margin-bottom:.75rem;position:relative}.convo-card:hover{background:hsla(0,0%,100%,.04)}.convo-card-label{font-family:JetBrains Mono,monospace;font-size:.65rem;color:#8da0cb;text-transform:uppercase;letter-spacing:.5px;margin-bottom:.5rem;display:flex;align-items:center;gap:.5rem}.convo-card-label i{font-size:.7rem}.convo-card-text{font-size:.9rem;color:var(--text-primary);line-height:1.5;padding-right:2rem}.convo-card-copy{position:absolute;top:.75rem;right:.75rem;background:transparent;border:1px solid var(--border);color:var(--text-muted);width:28px;height:28px;border-radius:4px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:.75rem;transition:all .15s}.convo-card-copy:hover{border-color:#8da0cb;color:#8da0cb;background:rgba(141,160,203,.1)}.convo-card-copy.copied{border-color:var(--success);color:var(--success);background:rgba(95,128,85,.1)}.convo-empty{text-align:center;padding:2rem;color:var(--text-muted)}.convo-empty i{font-size:2rem;margin-bottom:1rem;opacity:.5}.convo-focus-toggle{display:flex;gap:.5rem;margin-bottom:1rem}.convo-focus-btn{flex:1;padding:.6rem;background:var(--bg-input);border:1px solid var(--border);color:var(--text-muted);border-radius:4px;cursor:pointer;font-family:JetBrains Mono,monospace;font-size:.75rem;text-transform:uppercase;transition:all .15s}.convo-focus-btn.active{background:rgba(141,160,203,.15);border-color:#8da0cb;color:#8da0cb}.convo-focus-btn:hover:not(.active){border-color:var(--text-muted);color:var(--text-primary)}.convo-results-scroll{max-height:400px;overflow-y:auto;padding-right:.5rem}#copySuccessModal .channel-modal-content{border:1px solid var(--border);box-shadow:0 0 30px rgba(0,0,0,.5)}#copySuccessModal kbd{background:var(--bg-app);border:1px solid var(--border);color:var(--accent);font-family:JetBrains Mono,monospace;padding:2px 4px;border-radius:3px}.hero-footer{width:100%;max-width:1200px;margin:3rem auto 0;padding-top:2rem}.dashboard-container .hero-footer{margin:4rem auto 0;padding-bottom:2rem;animation:fadeIn 1s forwards}.dashboard-container .hero-footer .footer-grid{gap:2rem}.footer-grid{display:grid;grid-template-columns:1fr;gap:2rem}@media (min-width:768px){.footer-grid{grid-template-columns:1fr 1fr 1fr;gap:2rem}.footer-section{border-bottom:none;padding-bottom:0}}.footer-section{padding-bottom:1.5rem;border-bottom:1px solid hsla(0,0%,100%,.1)}.footer-section:last-child{border-bottom:none;padding-bottom:0}.footer-label{font-family:JetBrains Mono,monospace;font-size:.65rem;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--accent);margin-bottom:.75rem}.footer-heading{font-size:1rem;font-weight:600;color:var(--text-primary);margin-bottom:.75rem;letter-spacing:-.01em}.footer-text{overflow:hidden;font-size:.8rem;line-height:1.6;color:var(--text-muted);margin-bottom:.75rem}.footer-text:last-child{margin-bottom:0}.footer-links{display:flex;gap:1rem;flex-wrap:wrap;margin-top:1rem}.footer-link{font-family:JetBrains Mono,monospace;font-size:.7rem;color:var(--accent);text-decoration:none;text-transform:uppercase;letter-spacing:.5px;font-weight:700;padding-bottom:2px;border-bottom:1px solid var(--accent);transition:opacity .2s ease}.footer-link:hover{opacity:.7}.footer-bottom{margin-top:2rem;padding-top:1.5rem;text-align:center}.footer-copyright{font-family:JetBrains Mono,monospace;font-size:.65rem;color:var(--text-muted);letter-spacing:.5px}.use-cases{display:flex;flex-direction:column;gap:1rem}.use-case{padding:.875rem;background:hsla(0,0%,100%,.02);border-left:2px solid var(--accent)}.use-case-title{font-family:JetBrains Mono,monospace;font-size:.7rem;font-weight:700;color:var(--text-primary);margin-bottom:.375rem;text-transform:uppercase;letter-spacing:.5px}.use-case-desc{font-size:.75rem;color:var(--text-muted);line-height:1.5}.feature-list{display:flex;flex-direction:column;gap:.75rem}.feature-item{display:flex;align-items:flex-start;gap:.75rem;font-size:.75rem;line-height:1.5}.feature-tag{font-family:JetBrains Mono,monospace;font-size:.65rem;font-weight:700;color:var(--text-primary);background:hsla(0,0%,100%,.1);padding:.2rem .5rem;border-radius:2px;white-space:nowrap;flex-shrink:0}.feature-desc{color:var(--text-muted)}.data-source{display:flex;align-items:flex-start;gap:.75rem;padding:.75rem;background:hsla(0,0%,100%,.02);border:1px solid var(--border);border-radius:4px;margin-top:1rem}.data-source-icon{font-size:1rem;color:var(--text-muted);margin-top:2px}.data-source-text{font-size:.7rem;color:var(--text-muted);line-height:1.5}.data-source-text a{color:var(--accent);text-decoration:none}.data-source-text a:hover{text-decoration:underline}.pro-tip-box{font-family:JetBrains Mono,monospace;background:rgba(212,196,168,.08);border:1px solid var(--accent);border-radius:4px;padding:.75rem;margin-top:1rem}.pro-tip-label{font-size:.6rem;font-weight:700;color:var(--accent);text-transform:uppercase;letter-spacing:1px;margin-bottom:.5rem}.pro-tip-code{font-size:.75rem;color:var(--text-primary);background:rgba(0,0,0,.3);padding:.375rem .5rem;border-radius:2px;display:inline-block;margin-top:.25rem}.tip-bio-img{width:48px;height:48px;border-radius:50%;filter:grayscale(1) contrast(1.1);flex-shrink:0;float:left;margin-right:12px;margin-bottom:4px}.steps-list{counter-reset:step;list-style:none;padding:0;margin:0}.steps-list li{position:relative;padding-left:1.75rem;margin-bottom:.625rem;font-size:.75rem;color:var(--text-muted);line-height:1.5}.steps-list li:before{counter-increment:step;content:counter(step);position:absolute;left:0;top:0;width:1.125rem;height:1.125rem;background:var(--accent);color:#000;font-size:.6rem;font-weight:700;display:flex;align-items:center;justify-content:center;border-radius:2px}.disclaimer-text{margin-top:1.5rem;padding:1rem;font-size:.7rem;color:var(--text-muted);border-top:1px solid var(--border);line-height:1.4;font-style:italic}@media (max-width:900px){.insight-grid,.market-structure-grid,.scenario-grid{grid-template-columns:1fr}.scenario-grid{gap:.5rem}.chart-wrapper{overflow-x:scroll!important;-webkit-overflow-scrolling:touch}}@media (max-width:768px){.pipeline-results-grid{grid-template-columns:repeat(2,1fr)}.methodology-card,.pipeline-config-row{grid-template-columns:1fr}.subagency-bar-container{display:none}.subagency-stats{flex-direction:column;gap:.5rem}.subagency-stat{text-align:left}.stats-row{grid-template-columns:1fr!important;gap:.75rem!important}.stat-item{display:flex!important;justify-content:space-between!important;align-items:center!important;padding:1rem!important;text-align:left!important}.stat-label{margin-bottom:0!important}.stat-item-action{grid-column:span 1!important}#forecastModeView div[style*="display: grid"]{grid-template-columns:1fr!important;gap:1rem!important;width:100%!important;overflow:hidden!important}.dashboard-container{padding-left:1rem!important;padding-right:1rem!important;overflow-x:hidden!important}.analysis-panel,.analysis-panel-body,.buyer-list,.dashboard-container{width:100%!important;max-width:100%!important}.job-intel-panel>div{grid-template-columns:1fr!important}.forecast-table td,.forecast-table th{padding:.75rem .25rem!important;font-size:.75rem}.forecast-table td:last-child{padding-right:0!important}.geo-states-grid{grid-template-columns:1fr!important}.btn-row{flex-direction:column}.chart-container{min-width:auto;width:100%}.chart-wrapper{padding:0!important;border:none!important}.sankey-panel{padding:.5rem!important}}@media (max-width:600px){.mode-toggle{flex-direction:column}.app-header{gap:.5rem;padding:.5rem .75rem}.header-left{gap:.5rem}.mini-search{max-width:140px;padding:.5rem .6rem;font-size:.8rem}.logo-btn{font-size:.9rem}.icon-btn{width:32px;height:32px}.header-actions{gap:.35rem}.channel-marking-modal{padding:0}.channel-modal-content{margin:0;border-radius:0;height:100%;max-height:100%;max-width:100%;display:flex;flex-direction:column}.channel-modal-header{flex-shrink:0;padding:1rem}.channel-modal-title{font-size:1.1rem}.channel-modal-body{flex:1;overflow-y:auto;min-height:0}.channel-modal-footer{flex-direction:column;gap:.75rem;padding:1rem 1rem max(1rem,env(safe-area-inset-bottom))}.modal-footer-buttons{flex-direction:column;width:100%;gap:.5rem}.modal-footer-buttons .modal-btn-primary{width:100%;padding:.875rem}.modal-footer-secondary{width:100%;gap:.5rem}.modal-footer-secondary .modal-btn{flex:1;padding:.75rem}.modal-status-line{text-align:center;font-size:.7rem;opacity:.7;padding-top:.5rem;border-top:1px solid var(--border)}.step-grid{grid-template-columns:1fr!important}.hero-growth-value{font-size:2rem}div[style*="grid-template-columns: 1fr 1fr"]{grid-template-columns:1fr!important}}
</style>
</head>
<body>

<div id="heroView" class="hero-view">
  <div class="terminal-logo"><span>>_</span>Govhoo</div>
  <p class="hero-subtitle">Follow the Money. For Free.</p>
  
  <div class="search-box-container">
  <input type="text" id="mainSearchInput" class="main-input" placeholder="Search keywords, company, or agency..." autocomplete="off">
  <button class="input-clear" onclick="document.getElementById('mainSearchInput').value=''; document.getElementById('mainSearchInput').focus();" aria-label="Clear search">×</button>
    <div class="btn-row">
      <button id="searchBtn" class="btn-primary" data-action="search">
        <i class="fas fa-search"></i> SEARCH
      </button>
      <button id="forecastBtn" class="btn-secondary" data-action="forecast">
        <i class="fas fa-chart-line"></i> FORECAST
      </button>
    </div>
  </div>

<!-- Hero Footer -->
<footer class="hero-footer">
  <div class="footer-grid">
<div class="footer-section">
  <div class="footer-label mono text-xs accent upper">Search Tips</div>
  <div class="feature-list">

    <div class="feature-item">
      <span class="feature-tag mono">Keywords</span>
      <span class="feature-desc muted">Think like a KO. Search for scope terms like <a href="?q=DevSecOps" style="color: #fff; text-decoration: underline;">DevSecOps</a>, <a href="?q=Zero+Trust" style="color: #fff; text-decoration: underline;">Zero Trust</a>, or <a href="?q=Cloud+Migration" style="color: #fff; text-decoration: underline;">Cloud Migration</a> to find funded programs.</span>
    </div>

    <div class="feature-item">
      <span class="feature-tag mono">Names</span>
      <span class="feature-desc muted"><strong>For VARs/Channel:</strong> Search the OEM or Prime's name (e.g., <a href="?q=Amazon" style="color: #fff; text-decoration: underline;">Amazon</a>) to find where products or services are being sold through.</span>
    </div>

    <div class="feature-item">
      <span class="feature-tag mono">PSC Codes</span>
      <span class="feature-desc muted">Use codes like <a href="?q=DA10" style="color: #fff; text-decoration: underline;">DA10</a> (IT App Dev), <a href="?q=7A21" style="color: #fff; text-decoration: underline;">7A21</a> (SW Perpetual License), and <a href="?q=R499" style="color: #fff; text-decoration: underline;">R499</a> (Other Professional Services).</span>
    </div>
    
    <div class="feature-item">
      <span class="feature-tag mono">NAICS Codes</span>
      <span class="feature-desc muted">Search by industry: <a href="?q=541512" style="color: #fff; text-decoration: underline;">541512</a> (Computer Systems Design), <a href="?q=541519" style="color: #fff; text-decoration: underline;">541519</a> (Other IT Services), <a href="?q=541330" style="color: #fff; text-decoration: underline;">541330</a> (Engineering).</span>
    </div>
    
    <div class="feature-item">
      <span class="feature-tag mono">Multi</span>
      <span class="feature-desc muted">Stack your search with commas: <a href="?q=Amazon,+Microsoft,+Google" style="color: #fff; text-decoration: underline;">Amazon, Microsoft, Google</a>. Then drill into specific agencies or vendors on the Sankey chart.</span>
    </div>

    <div class="pro-tip-box" style="margin-top: 0.5rem; border: 1px dashed var(--border); background: rgba(255,255,255,0.02);">
      <div class="pro-tip-label" style="color: var(--text-muted); margin-bottom: 0.25rem;">Data Intelligence Note</div>
      <div class="feature-desc muted" style="font-size: 0.7rem; line-height: 1.4;">
        We query the live USASpending database to capture Prime Obligations. To keep results actionable, we fetch the <strong>top 100 most relevant awards</strong> based on your criteria. This view shows direct Government-to-Prime spend.
      </div>
    </div>

  </div>
</div>
    <!-- Use Cases -->
<div class="footer-section">
  <div class="footer-label mono text-xs accent upper">Use Cases</div>
  <div class="use-cases">
    <div class="use-case">
      <div class="use-case-title">Defend</div>
      <div class="use-case-desc">Protect your base. Monitor your expiring contracts and agency relationships well before the recompete RFP hits.</div>
    </div>
    <div class="use-case">
      <div class="use-case-title">Displace</div>
      <div class="use-case-desc">Identify vulnerable incumbents. See who is winning work you should have won and position early for the takeaway.</div>
    </div>
    <div class="use-case">
      <div class="use-case-title">Expand</div>
      <div class="use-case-desc">Find "White Space." Discover agencies buying your competitors or identify teaming partners (Primes) holding the contract vehicles you need.</div>
    </div>
   <div class="use-case">
  <div class="use-case-title">Connect</div>
  <div class="use-case-desc">Find the people behind the contracts with pre-filtered LinkedIn search links to current employees (for networking), past employees (for recruiting), and active job openings (for your next career move), as well as USAJobs links for federal positions.</div>
</div>
  </div>
</div>
   
     <!-- About -->
    <div class="footer-section">
      <div class="footer-label mono text-xs accent upper">About</div>
      <h3 class="footer-heading">Built by a Sales Guy</h3>
      <p class="footer-text">
<img src="https://govhoo.com/images/oldmark.jpg" alt="Mark Flournoy" class="tip-bio-img">Hi, I'm Mark, a retired federal sales guy and Marine. Over decades of selling at AWS, F5, and Red Hat, I spent too much time bouncing between USASpending, SAM.gov, and industry days just to figure out who the incumbents were and when contracts were coming up for recompete. So I built Govhoo. It uses real award data to surface expiring contracts and mission gaps, so you can focus on the right customer conversations at the right time. It's free to use, and I hope it helps you win. Good luck out there.
      </p>
      
       <p class="footer-text">Questions or want to collaborate? DM me on <a href="https://www.linkedin.com/in/markflournoy/" target="_blank" style="color: var(--accent); text-decoration: underline;">LinkedIn</a>. Be sure to check out my other sites <a href="https://askarti.com" target="_blank" style="color: var(--accent); text-decoration: underline;">AskArti</a> (free sales prompts) and <a href="https://subhoo.com" target="_blank" style="color: var(--accent); text-decoration: underline;">Subhoo</a> (Primes with Subcontracting Plans).</p>
	   <!-- Help CTA - Matches Conversation Starters layout -->
<div id="helpSessionPanel" style="margin: 1.5rem 0; padding: 1rem 1.25rem; background: linear-gradient(135deg, rgba(95, 128, 85, 0.12) 0%, rgba(95, 128, 85, 0.06) 100%); border: 1px solid rgba(95, 128, 85, 0.35); border-radius: 6px; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 1rem;">

  <div style="display: flex; align-items: center; gap: 1rem;">
    <div style="width: 44px; height: 44px; background: rgba(95, 128, 85, 0.18); border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
      <i class="fas fa-life-ring" style="color: #5f8055; font-size: 1.25rem;"></i>
    </div>
    <div>
       <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; font-weight: 700; color: #5f8055; text-transform: uppercase; letter-spacing: 0.5px;">
        Need help?
      </div>
      <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 2px;">
        Book 30 minutes with me. Just $19. We'll look at an agency, vendor, or market and figure out what to do next for your GTM or pipeline.
      </div>
    </div>
  </div>

  <a
    href="https://calendly.com/markflournoy/govhoo"
    target="_blank"
    style="text-decoration:none;"
  >
    <button class="convo-starters-btn"
      style="
        padding: 0.75rem 1.5rem;
        font-size: 0.85rem;
        background: #5f8055;
        border: 1px solid #5f8055;
        color: #ffffff;
        border-radius: 6px;
        cursor: pointer;
      ">
      <i class="fas fa-calendar-check"></i> Book 30 minutes
    </button>
  </a>
</div>
    </div>
  </div>
  <div class="footer-bottom">
    <div class="footer-copyright">© 2025 GOVHOO — DATA VIA USASPENDING.GOV</div>
  </div>
</footer>
</div>

<div id="appView" style="display:none;">
  <header class="app-header">
    <div class="header-left">
      <span class="logo-btn" data-action="showHero">>_Govhoo</span>
      <div class="mini-search-wrapper">
  <input type="text" id="miniSearch" class="mini-search" placeholder="New search...">
</div>
    </div>
    <div class="header-actions">
      <button class="icon-btn" id="toggleModeBtn" data-action="toggleMode" title="Toggle Mode">
        <i class="fas fa-exchange-alt"></i>
      </button>
      <button class="icon-btn" data-action="shareLink" title="Copy Share Link">
  <i class="fas fa-link"></i>
</button>

<button class="icon-btn" title="Export CSV" data-action="exportCSV">
  <i class="fas fa-download"></i>
</button>
    </div>
  </header>

  <div id="dashboardContainer" class="dashboard-container">
    
    <div class="mode-toggle">
      <button class="mode-btn active" id="modeSearchBtn" data-action="setModeSearch">
        <i class="fas fa-project-diagram"></i> Agency Award Flow
      </button>
      <button class="mode-btn" id="modeForecastBtn" data-action="setModeForecast">
        <i class="fas fa-eye"></i> Forecast & Strategy
      </button>
    </div>
    <div id="searchModeView" class="view-section active">
      
      <!-- Drill Navigation Controls - Separate from main visualization -->
      <div id="drillControlsBar" class="drill-controls-bar" style="display: none; margin-bottom: 1rem; padding: 0.75rem 1rem; background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 6px; overflow: hidden;">
        <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 0.5rem;">
          <div id="drillBreadcrumb" class="drill-breadcrumb" style="display: flex; margin: 0; flex-wrap: wrap; min-width: 0;">
            <div class="breadcrumb-item" data-action="resetDrill">
              <i class="fas fa-globe breadcrumb-icon"></i>
              <span>All Agencies</span>
            </div>
          </div>
          <!-- Hidden but needed for JS -->
          <div style="display: none;">
            <span id="drillLevelBadge" class="drill-level-indicator">
              <i class="fas fa-layer-group"></i>
              <span id="drillLevelText">Level 1</span>
            </span>
            <div id="filterBadge" class="filter-badge" data-action="clearFilter">
              <span id="filterName">FILTER</span> <i class="fas fa-times"></i>
            </div>
          </div>
        </div>
      </div>

      <!-- Screenshot-Ready Visualization Panel -->
      <div id="sankeyPanel" class="sankey-panel" style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; padding: 1.25rem; margin-bottom: 1rem; overflow: hidden;">
        
        <!-- Panel Header with Title and Time Badge -->
        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; padding-bottom: 0.75rem; border-bottom: 1px solid var(--border); flex-wrap: wrap; gap: 0.5rem;">
          <div style="display: flex; align-items: center; gap: 0.5rem; min-width: 0;">
            <i class="fas fa-project-diagram" style="color: var(--accent); flex-shrink: 0;"></i>
            <span class="mono bold upper" style="color: var(--accent); font-size: 0.8rem; letter-spacing: 0.5px;">Agency to Prime Award Flow</span>
          </div>
          <div class="time-badge mono text-xs muted" style="flex-shrink: 0;">PAST 12 MONTHS</div>
        </div>
        
      
        
        <!-- Sankey Chart -->
        <div class="chart-wrapper" style="border: none; padding: 0; background: transparent; overflow-x: auto; overflow-y: visible;">
          <div id="chartContainer" class="chart-container"></div>
        </div>
		
          <!-- Stats Row - Clean and Compact -->
        <div class="stats-row" id="searchStats" style="margin-bottom: 1rem; margin-top: 1rem;">
           <div class="stat-item">
            <div class="stat-label">Total Value</div>
            <div class="stat-val" id="stat-vol">-</div>
          </div>
		  <div class="stat-item">
            <div class="stat-label">Agencies</div>
            <div class="stat-val" id="stat-agencies">-</div>   
          </div>
          <div class="stat-item">
            <div class="stat-label">Contracts</div>
            <div class="stat-val" id="stat-count">-</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Vendors</div>
            <div class="stat-val" id="stat-vendors">-</div>
          </div>
        </div>
        <!-- Subtle Branding for Screenshots -->
        <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 1rem; padding-top: 0.75rem; border-top: 1px solid var(--border); font-size: 0.65rem; color: var(--text-muted);">
          <span>Data: USASpending.gov</span>
          <span style="font-family: 'JetBrains Mono', monospace;">>_Govhoo.com</span>
        </div>
      </div>
      
      <!-- Drill Hint - Below the panel -->
      <div id="drillHint" class="drill-hint">
        <i class="fas fa-mouse-pointer"></i>
        <span>Click an <strong>agency bar</strong> to drill into sub-agencies</span>
      </div>
      
      <!-- Event Prep CTA - Prominent placement after Sankey -->
      <div id="convoStartersPanel" style="margin: 1.5rem 0; padding: 1rem 1.25rem; background: linear-gradient(135deg, rgba(141, 160, 203, 0.12) 0%, rgba(107, 127, 179, 0.08) 100%); border: 1px solid rgba(141, 160, 203, 0.3); border-radius: 6px; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 1rem;">
        <div style="display: flex; align-items: center; gap: 1rem;">
          <div style="width: 44px; height: 44px; background: rgba(141, 160, 203, 0.2); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
            <i class="fas fa-comments" style="color: #8DA0CB; font-size: 1.25rem;"></i>
          </div>
          <div>
            <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; font-weight: 700; color: #8DA0CB; text-transform: uppercase; letter-spacing: 0.5px;">Event Prep</div>
            <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 2px;">Generate talking points for AFCEA, AUSA, and industry events</div>
          </div>
        </div>
        <button class="convo-starters-btn" data-action="openConvoStarters" id="convoStartersBtn" disabled style="padding: 0.75rem 1.5rem; font-size: 0.85rem;">
          <i class="fas fa-magic"></i> Conversation Starters
        </button>
      </div>
      <!-- Job Seeker Intelligence Panel (Search View) -->
<div id="searchJobPanel" class="job-intel-panel" style="margin: 1.5rem 0;">
  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
    
    <!-- Top Buyers with LinkedIn Links -->
    <div>
      <div class="section-header" style="margin: 0 0 0.75rem 0;">
        <div class="section-title-group">
          <i class="fas fa-landmark accent"></i>
          <span class="section-title mono bold accent upper text-xs">Top Agency Buyers</span>
          <span class="section-subtitle" style="margin-left: 6px;">Agency Contacts</span>
        </div>
      </div>
      <div class="analysis-panel" style="min-height: auto;">
        <div class="analysis-panel-body" id="searchTopBuyersBody" style="padding: 0.75rem;">
          <div class="muted text-xs" style="text-align:center;">Run a search to see top agencies</div>
        </div>
      </div>
    </div>
    
    <!-- Top Awardees with Job Links -->
    <div>
      <div class="section-header" style="margin: 0 0 0.75rem 0;">
        <div class="section-title-group">
          <i class="fas fa-dollar-sign accent"></i><i class="fas fa-dollar-sign accent"></i><i class="fas fa-dollar-sign accent"></i>
          <span class="section-title mono bold accent upper text-xs">Top Prime Contractors</span>
          <span class="section-subtitle" style="margin-left: 6px;">Vendor Contacts</span>
        </div>
      </div>
      <div class="analysis-panel" style="min-height: auto;">
        <div class="analysis-panel-body" id="searchTopWinnersBody" style="padding: 0.75rem;">
          <div class="muted text-xs" style="text-align:center;">Run a search to see top vendors</div>
        </div>
      </div>
    </div>
    
    <!-- Place of Performance -->
    <div>
      <div class="section-header" style="margin: 0 0 0.75rem 0;">
        <div class="section-title-group">
          <i class="fas fa-map-marker-alt accent"></i>
          <span class="section-title mono bold accent upper text-xs">Place of Performance</span>
          <span class="section-subtitle" style="margin-left: 6px;">Where the Work Is</span>
        </div>
      </div>
      <div class="analysis-panel" style="min-height: auto;">
        <div class="analysis-panel-body" id="searchLocationsBody" style="padding: 0.75rem;">
          <div class="muted text-xs" style="text-align:center;">Run a search to see locations</div>
        </div>
      </div>
    </div>
    
    <!-- Skills in Demand -->
    <div>
      <div class="section-header" style="margin: 0 0 0.75rem 0;">
        <div class="section-title-group">
          <i class="fas fa-code accent"></i>
          <span class="section-title mono bold accent upper text-xs">Skills in Demand</span>
          <span class="section-subtitle" style="margin-left: 6px;">Resume Keywords</span>
        </div>
      </div>
      <div class="analysis-panel" style="min-height: auto;">
        <div class="analysis-panel-body" id="searchSkillsBody" style="padding: 0.75rem;">
          <div class="muted text-xs" style="text-align:center;">Run a search to see in-demand skills</div>
        </div>
      </div>
    </div>
    
  </div>
</div>

      <div id="subawardWrapper" style="display: none;">      
        <div style="margin-top: 1.5rem;">
          <div class="section-header" style="margin: 0 0 1rem 0;">
            <div class="section-title-group">
              <i class="fas fa-stream accent"></i>
              <span class="section-title mono bold accent upper">Prime to Sub Flow</span>
            </div>
            <div id="subcontractingStats" class="section-subtitle"></div>
          </div>
          <div id="subcontractingPanel" class="analysis-panel" style="min-height: 420px;">
            <div class="analysis-panel-body" id="subcontractingBody" style="padding: 0.5rem; position: relative;">
              </div>
          </div>
        </div>
      </div>

      <!-- Subcontract Conversation Starters CTA -->
      <div id="subConvoStartersPanel" style="margin: 1.5rem 0; padding: 1rem 1.25rem; background: linear-gradient(135deg, rgba(229, 192, 123, 0.12) 0%, rgba(209, 172, 103, 0.08) 100%); border: 1px solid rgba(229, 192, 123, 0.3); border-radius: 6px; display: none; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 1rem;">
        <div style="display: flex; align-items: center; gap: 1rem;">
          <div style="width: 44px; height: 44px; background: rgba(229, 192, 123, 0.2); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
            <i class="fas fa-handshake" style="color: #E5C07B; font-size: 1.25rem;"></i>
          </div>
          <div>
            <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; font-weight: 700; color: #E5C07B; text-transform: uppercase; letter-spacing: 0.5px;">Teaming Event Prep</div>
            <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 2px;">Talking points for prime contractors and potential teaming partners</div>
          </div>
        </div>
        <button class="convo-starters-btn" data-action="openSubConvoStarters" id="subConvoStartersBtn" style="padding: 0.75rem 1.5rem; font-size: 0.85rem; background: linear-gradient(135deg, #E5C07B 0%, #D1AC67 100%);">
          <i class="fas fa-magic"></i> Teaming Starters
        </button>
      </div>

      <div id="subagencyPanel" class="subagency-panel" style="display: none;">
        <div class="subagency-header">
          <div class="subagency-header-left">
            <div class="subagency-header-icon">
              <i class="fas fa-building"></i>
            </div>
            <div class="subagency-header-text">
              <h3 id="subagencyParentName">Department of Defense</h3>
              <span id="subagencyParentType">Parent Agency</span>
            </div>
          </div>
          <div class="subagency-stats">
            <div class="subagency-stat">
              <div class="subagency-stat-val" id="subagencyTotalAmount">$0</div>
              <div class="subagency-stat-label">Total Value</div>
            </div>
            <div class="subagency-stat">
              <div class="subagency-stat-val" id="subagencyCount">0</div>
              <div class="subagency-stat-label">Sub-Agencies</div>
            </div>
          </div>
        </div>
        <div class="subagency-list" id="subagencyList"></div>
      </div>

      <!-- Contracting Offices Panel - shows at sub-agency level -->
      <div id="officesPanel" class="subagency-panel" style="display: none;">
        <div class="subagency-header" style="background: linear-gradient(135deg, #3a3d4a 0%, #2d2f38 100%);">
          <div class="subagency-header-left">
            <div class="subagency-header-icon" style="background: rgba(141, 160, 203, 0.2);">
              <i class="fas fa-briefcase" style="color: #8DA0CB;"></i>
            </div>
            <div class="subagency-header-text">
              <h3 id="officesSubAgencyName">Sub-Agency</h3>
              <span id="officesParentType">Contracting Offices</span>
            </div>
          </div>
          <div class="subagency-stats">
            <div class="subagency-stat">
              <div class="subagency-stat-val" id="officesTotalAmount">$0</div>
              <div class="subagency-stat-label">Total Value</div>
            </div>
            <div class="subagency-stat">
              <div class="subagency-stat-val" id="officesCount">0</div>
              <div class="subagency-stat-label">Offices</div>
            </div>
          </div>
        </div>
        <div class="subagency-list" id="officesList"></div>
      </div>

      <!-- Subcontract Awardees Panel -->
<div id="searchSubcontractPanel" class="job-intel-panel" style="margin: 1.5rem 0;">
  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
    
    <!-- Top Primes with LinkedIn Links -->
    <div>
      <div class="section-header" style="margin: 0 0 0.75rem 0;">
        <div class="section-title-group">
          <i class="fas fa-building accent"></i>
          <span class="section-title mono bold accent upper text-xs">Top Primes who Subcontract</span>
          <span class="section-subtitle" style="margin-left: 6px;">Primes</span>
        </div>
      </div>
      <div class="analysis-panel" style="min-height: auto;">
        <div class="analysis-panel-body" id="searchTopPrimesBody" style="padding: 0.75rem;">
          <div class="muted text-xs" style="text-align:center;">Run a search to see top primes</div>
        </div>
      </div>
    </div>
    
    <!-- Top Subs with LinkedIn Links -->
    <div>
      <div class="section-header" style="margin: 0 0 0.75rem 0;">
        <div class="section-title-group">
          <i class="fas fa-handshake accent"></i>
          <span class="section-title mono bold accent upper text-xs">Top Subcontractors</span>
          <span class="section-subtitle" style="margin-left: 6px;">Subcontractors</span>
        </div>
      </div>
      <div class="analysis-panel" style="min-height: auto;">
        <div class="analysis-panel-body" id="searchTopSubsBody" style="padding: 0.75rem;">
          <div class="muted text-xs" style="text-align:center;">Run a search to see top subs</div>
        </div>
      </div>
    </div>
    
  </div>
</div>

      <div class="section-header">
        <div class="section-title-group">
          <i class="fas fa-list-ul accent"></i>
          <span class="section-title mono bold accent upper">Contract Award Feed</span>
        </div>
      </div>
      <div id="feedGrid" class="feed-grid"></div>

    </div> <div id="forecastModeView" class="view-section">
      
      <div class="stats-row" id="forecastStats" style="grid-template-columns: repeat(4, 1fr);">
        <div class="stat-item">
          <div class="stat-label">Awards</div>
          <div class="stat-val" id="stat-total-awards">-</div>
          <div class="stat-sub neutral">Last 12 Months</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Obligations</div>
          <div class="stat-val" id="stat-total-obligations">-</div>
          <div class="stat-sub neutral">Last Complete FY</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">YoY Trend</div>
          <div class="stat-val" id="stat-yoy-change">-</div>
          <div class="stat-sub" id="stat-yoy-direction">-</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Expiring Soon</div>
          <div class="stat-val" id="stat-recompetes">-</div>
          <div class="stat-sub" style="color:var(--danger)">Next 24 Months</div>
        </div>
      </div>
      
      <!-- Action Buttons Row -->
      <div style="display: flex; gap: 0.75rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
        <button class="pipeline-builder-btn" data-action="openSalesPlan" style="background: linear-gradient(135deg, var(--accent) 0%, #7a7a6a 100%); flex: 1; min-width: 150px; justify-content: center;">
          <i class="fas fa-file-export"></i> GTM Plan
        </button>
        <button class="pipeline-builder-btn" data-action="openPipelineBuilder" style="flex: 1; min-width: 150px; justify-content: center;">
          <i class="fas fa-chart-line"></i> Pipeline Builder
        </button>
      </div>

      <div id="projectionSummary" class="projection-summary"></div>
      
      <div class="section-header" style="margin-top:1.5rem;">
        <div class="section-title-group">
          <i class="fas fa-calculator accent"></i>
          <span class="section-title mono bold accent upper">Quarterly Projection</span>
        </div>
        <span class="section-subtitle text-sm muted">Based on obligation history (not contract ceilings)</span>
      </div>
        
      <div id="forecastTableContainer" class="forecast-table-wrapper">
        <table class="forecast-table">
          <thead>
            <tr>
              <th>Quarter</th>
              <th>3-Year Avg</th>
              <th>Last Year</th>
              <th>Projection</th>
            </tr>
          </thead>
          <tbody id="forecastTableBody"></tbody>
        </table>
      </div>
     
      <div style="margin-top: 1.5rem;">
        <div class="chart-wrapper">
          <div class="section-title mono bold accent upper text-xs" style="margin-bottom:1rem;">Historical Spend</div>
          <canvas id="spendingChart" style="max-height: 300px;"></canvas>
        </div>
      </div>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-top: 1.5rem;">
        <div>
          <div class="section-header" style="margin: 0 0 1rem 0;">
            <div class="section-title-group">
              <i class="fas fa-landmark accent"></i>
              <span class="section-title mono bold accent upper">Top Agency Buyers</span>
            </div>
          </div>
          <div id="topBuyersPanel" class="analysis-panel">
            <div class="analysis-panel-body" id="topBuyersBody">
              <div class="muted" style="text-align:center; padding:1rem;">Loading...</div>
            </div>
          </div>
        </div>

        <div>
          <div class="section-header" style="margin: 0 0 1rem 0;">
            <div class="section-title-group">
              <i class="fas fa-dollar"></i><i class="fas fa-dollar"></i><i class="fas fa-dollar"></i>
              <span class="section-title mono bold accent upper">Top Prime Contractors</span>
            </div>
          </div>
          <div id="topWinnersPanel" class="analysis-panel">
            <div class="analysis-panel-body" id="topWinnersBody">
              <div class="muted" style="text-align:center; padding:1rem;">Loading...</div>
            </div>
          </div>
        </div>
      </div>


      <div id="recompetesList" style="margin-top:2rem;"></div>

    </div> </div>
</div>
<div id="loader" class="loader">
  <div class="spinner"></div>
  <p id="loaderText" style="margin-top:1rem; font-family:'JetBrains Mono'; color:var(--accent);">RETRIEVING DATA...</p>
  <p id="loaderSubtext" style="color:#666; font-size:0.8rem; margin-top:0.5rem;"></p>
</div>

<div id="salesPlanModal" class="channel-marking-modal">
  <div class="channel-modal-content" style="max-width: 900px;">
    <div class="channel-modal-header">
      <div class="channel-modal-title"><i class="fas fa-rocket"></i> GTM PLAN PROMPT</div>
      <button class="channel-modal-close" data-action="closeSalesPlan"><i class="fas fa-times"></i></button>
    </div>
    
    <div class="channel-modal-body" style="flex:1; overflow-y:auto; padding:0;">
      
      <!-- NEW: Intent Detection Banner -->
      <div id="spIntentBanner"></div>
      
      <!-- Step 1: Scope -->
      <div style="padding:1.5rem; border-bottom:1px solid var(--border); background:rgba(255,255,255,0.02);">
        <div style="font-size:0.85rem; color:var(--accent); font-weight:700; margin-bottom:1rem; text-transform:uppercase; letter-spacing:1px;">
          <i class="fas fa-bullseye"></i> Step 1: Define Plan Scope
        </div>
        <div class="step-grid" style="display:grid; grid-template-columns: 1fr 1fr; gap:1.5rem;">
          <div>
            <label style="display:block; font-size:0.75rem; color:var(--text-muted); margin-bottom:0.5rem; font-weight:600;">
              PLAN SCOPE / SECTOR
            </label>
            <select id="spScope" class="main-input" style="padding:0.6rem; font-size:0.9rem; background:var(--bg-app);">
              <option value="all">Entire Market (All Results)</option>
              <option value="defense">Defense (DoD & Branches)</option>
              <option value="civilian">Federal Civilian (Non-DoD)</option>
              <optgroup label="Specific Agencies" id="spSpecificAgencies"></optgroup>
            </select>
          </div>
          <div>
            <label style="display:block; font-size:0.75rem; color:var(--text-muted); margin-bottom:0.5rem; font-weight:600;">
              STRATEGIC GOAL
              <span style="cursor:help; margin-left:4px;" title="Growth = New business pursuit&#10;Retention = Defend existing contracts&#10;Partnership = Channel/partner optimization">ⓘ</span>
            </label>
            <select id="spFocus" class="main-input" style="padding:0.6rem; font-size:0.9rem; background:var(--bg-app);">
              <option value="Growth">Aggressive Growth (New Business)</option>
              <option value="Retention">Retention (Defend Incumbency)</option>
              <option value="Partnership">Partner/Channel Strategy</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Step 2: Vendor Classification -->
      <div style="padding:1.5rem;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
          <div style="font-size:0.85rem; color:var(--accent); font-weight:700; text-transform:uppercase; letter-spacing:1px;">
            <i class="fas fa-sitemap"></i> Step 2: Classify Vendors
          </div>
          <div id="spBulkActionContainer"></div>
        </div>
        
        <div style="background:rgba(212, 196, 168, 0.05); padding:0.75rem; border-radius:4px; margin-bottom:1.5rem; font-size:0.8rem; color:var(--text-muted); border-left:2px solid var(--accent);">
          <i class="fas fa-magic" style="color:var(--accent);"></i>
          <strong>Smart Detection:</strong> We've pre-identified likely resellers based on known patterns. Accept our suggestions or customize below.
        </div>

        <div id="spVendorList"></div>
      </div>
    </div>

    <!-- Footer -->
    <div class="channel-modal-footer">
      <div class="modal-footer-buttons">
        <button id="btnCopyPrompt" class="modal-btn modal-btn-primary" data-action="copyPrompt">
          <i class="fas fa-copy"></i> Copy Prompt
        </button>
        <div class="modal-footer-secondary">
          <button class="modal-btn modal-btn-cancel" data-action="closeSalesPlan">Cancel</button>
          <button class="modal-btn modal-btn-cancel" data-action="generateDownload" title="Download as .txt file">
            <i class="fas fa-download"></i> .TXT
          </button>
        </div>
      </div>
      <div id="spDataStatus" class="modal-status-line"></div>
    </div>
  </div>
</div>

<!-- Pipeline Builder Modal -->
<div id="pipelineBuilderModal" class="pipeline-modal">
  <div class="pipeline-modal-content">
    <div class="channel-modal-header">
      <div class="channel-modal-title"><i class="fas fa-chart-line" style="color:var(--success);"></i> ANNUAL PIPELINE BUILDER</div>
      <button class="channel-modal-close" data-action="closePipelineBuilder"><i class="fas fa-times"></i></button>
    </div>
    
    <div class="channel-modal-body" style="flex:1; overflow-y:auto; padding:1.5rem;">
      <!-- Configuration -->
      <div style="background:rgba(95, 128, 85, 0.1); border-left:3px solid var(--success); padding:1rem; margin-bottom:1.5rem; font-size:0.85rem; color:var(--text-primary); line-height:1.5;">
        <strong><i class="fas fa-info-circle" style="color:var(--success);"></i> How it works:</strong> 
        This tool analyzes historical USAspending data to identify cyclic spending patterns and generates potential pipeline opportunities for the upcoming fiscal year. Opportunities are projected based on real historical awards—not placeholders.
      </div>
      
      <div class="pipeline-config-row">
        <div class="pipeline-config-item">
          <label>Target Fiscal Year</label>
          <select id="pipelineTargetFY">
            <!-- Options populated dynamically -->
          </select>
        </div>
        <div class="pipeline-config-item">
          <label>Historical Years to Analyze</label>
          <select id="pipelineHistoryYears">
            <option value="2">2 Years</option>
            <option value="3" selected>3 Years</option>
            <option value="4">4 Years</option>
            <option value="5">5 Years</option>
          </select>
        </div>
        <div class="pipeline-config-item">
          <label>Probability Multiplier</label>
          <select id="pipelineProbMultiplier">
            <option value="0.5">Conservative (50%)</option>
            <option value="0.7" selected>Moderate (70%)</option>
            <option value="0.9">Aggressive (90%)</option>
            <option value="1.0">Full Historical (100%)</option>
          </select>
        </div>
      </div>
      
      <div class="pipeline-config-row">
        <div class="pipeline-config-item">
          <label>Minimum Deal Size</label>
          <select id="pipelineMinDeal">
            <option value="0">No Minimum</option>
            <option value="25000">$25K+</option>
            <option value="50000" selected>$50K+</option>
            <option value="100000">$100K+</option>
            <option value="250000">$250K+</option>
            <option value="500000">$500K+</option>
            <option value="1000000">$1M+</option>
          </select>
        </div>
        <div class="pipeline-config-item">
          <label>Focus Agency (Optional)</label>
          <select id="pipelineFocusAgency">
            <option value="">All Agencies in Results</option>
            <!-- Populated dynamically -->
          </select>
        </div>
        <div class="pipeline-config-item">
          <label>&nbsp;</label>
          <button class="pipeline-builder-btn" style="width:100%;" data-action="generatePipeline">
            <i class="fas fa-magic"></i> Generate Pipeline
          </button>
        </div>
      </div>
      
      <!-- Results Area -->
      <div id="pipelineResultsArea" style="display:none;">
        <div class="section-header" style="margin:1.5rem 0 1rem 0;">
          <div class="section-title-group">
            <i class="fas fa-clipboard-list" style="color:var(--success);"></i>
            <span class="section-title mono bold upper" style="color:var(--success);">Generated Pipeline</span>
          </div>
          <span id="pipelineResultCount" class="section-subtitle"></span>
        </div>
        
        <div id="pipelineStatsGrid" class="pipeline-results-grid"></div>
        
        <div id="pipelineTableContainer" class="pipeline-table-wrapper"></div>
      </div>
      
      <!-- Loading State -->
      <div id="pipelineLoading" class="pipeline-progress" style="display:none;">
        <div class="spinner"></div>
        <span>Analyzing historical spending patterns...</span>
      </div>
    </div>
    
    <!-- Footer -->
    <div class="channel-modal-footer">
      <div class="modal-footer-buttons">
        <button id="btnDownloadPipeline" class="modal-btn modal-btn-primary" data-action="downloadPipelineCSV" style="background:var(--success);" disabled>
          <i class="fas fa-download"></i> Download CSV (Salesforce Ready)
        </button>
        <div class="modal-footer-secondary">
          <button class="modal-btn modal-btn-cancel" data-action="closePipelineBuilder">Close</button>
        </div>
      </div>
      <div id="pipelineDataStatus" class="modal-status-line">Configure options and click Generate to build your pipeline.</div>
    </div>
  </div>
</div>

<!-- Conversation Starters Modal -->
<div id="convoStartersModal" class="convo-modal">
  <div class="convo-modal-content">
    <div class="channel-modal-header">
      <div class="channel-modal-title"><i class="fas fa-comments" style="color: #8DA0CB;"></i> CONVERSATION STARTERS</div>
      <button class="channel-modal-close" data-action="closeConvoStarters"><i class="fas fa-times"></i></button>
    </div>
    
    <div class="channel-modal-body" style="flex:1; overflow-y:auto; padding:1.25rem;">
      <!-- Focus Toggle -->
      <div class="convo-focus-toggle">
        <button class="convo-focus-btn active" data-convo-focus="agencies" onclick="ConvoStarters.setFocus('agencies')">
          <i class="fas fa-landmark"></i> Agencies
        </button>
        <button class="convo-focus-btn" data-convo-focus="vendors" onclick="ConvoStarters.setFocus('vendors')">
          <i class="fas fa-building"></i> Vendors
        </button>
        <button class="convo-focus-btn" data-convo-focus="both" onclick="ConvoStarters.setFocus('both')">
          <i class="fas fa-users"></i> Both
        </button>
      </div>
      
      <!-- Results Area -->
      <div id="convoResultsArea" class="convo-results-scroll">
        <div class="convo-empty">
          <i class="fas fa-spinner fa-spin"></i>
          <p>Generating talking points...</p>
        </div>
      </div>
    </div>
    
    <!-- Footer -->
    <div class="channel-modal-footer">
      <div class="modal-footer-buttons">
        <button class="modal-btn modal-btn-primary" data-action="copyAllConvo" style="background: #8DA0CB;">
          <i class="fas fa-copy"></i> Copy All
        </button>
        <button class="modal-btn modal-btn-cancel" data-action="downloadConvoPDF" title="Download as .txt file to send to your phone">
          <i class="fas fa-download"></i> Download .txt
        </button>
        <div class="modal-footer-secondary">
          <button class="modal-btn modal-btn-cancel" data-action="closeConvoStarters">Close</button>
        </div>
      </div>
      <div id="convoDataStatus" class="modal-status-line">Based on <span id="convoAwardCount">0</span> awards from your search.</div>
    </div>
  </div>
</div>

<script>
const US_STATES={AL:"Alabama",AK:"Alaska",AZ:"Arizona",AR:"Arkansas",CA:"California",CO:"Colorado",CT:"Connecticut",DE:"Delaware",FL:"Florida",GA:"Georgia",HI:"Hawaii",ID:"Idaho",IL:"Illinois",IN:"Indiana",IA:"Iowa",KS:"Kansas",KY:"Kentucky",LA:"Louisiana",ME:"Maine",MD:"Maryland",MA:"Massachusetts",MI:"Michigan",MN:"Minnesota",MS:"Mississippi",MO:"Missouri",MT:"Montana",NE:"Nebraska",NV:"Nevada",NH:"New Hampshire",NJ:"New Jersey",NM:"New Mexico",NY:"New York",NC:"North Carolina",ND:"North Dakota",OH:"Ohio",OK:"Oklahoma",OR:"Oregon",PA:"Pennsylvania",RI:"Rhode Island",SC:"South Carolina",SD:"South Dakota",TN:"Tennessee",TX:"Texas",UT:"Utah",VT:"Vermont",VA:"Virginia",WA:"Washington",WV:"West Virginia",WI:"Wisconsin",WY:"Wyoming",DC:"Washington DC",PR:"Puerto Rico",GU:"Guam",VI:"Virgin Islands"},LibLoader={d3Loaded:!1,chartLoaded:!1,loading:{d3:null,chart:null},async loadD3(){return this.d3Loaded&&window.d3&&window.d3.sankey?Promise.resolve():(this.loading.d3||(this.loading.d3=new Promise(((e,t)=>{const n=document.createElement("script");n.src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js",n.onload=()=>{const n=document.createElement("script");n.src="https://cdnjs.cloudflare.com/ajax/libs/d3-sankey/0.12.3/d3-sankey.min.js",n.onload=()=>{this.d3Loaded=!0,e()},n.onerror=t,document.head.appendChild(n)},n.onerror=t,document.head.appendChild(n)}))),this.loading.d3)},async loadChart(){return this.chartLoaded&&window.Chart?Promise.resolve():(this.loading.chart||(this.loading.chart=new Promise(((e,t)=>{const n=document.createElement("script");n.src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js",n.onload=()=>{this.chartLoaded=!0,e()},n.onerror=t,document.head.appendChild(n)}))),this.loading.chart)},async ensureAll(){await Promise.all([this.loadD3(),this.loadChart()])},preloadWhenIdle(){"requestIdleCallback"in window?requestIdleCallback((()=>this.ensureAll()),{timeout:2e3}):setTimeout((()=>this.ensureAll()),100)}},Utils={money:e=>e||0===e?e>=1e9?"$"+(e/1e9).toFixed(1)+"B":e>=1e6?"$"+(e/1e6).toFixed(1)+"M":e>=1e3?"$"+(e/1e3).toFixed(0)+"K":"$"+Math.round(e).toLocaleString():"-",trunc:(e,t)=>e&&e.length>t?e.substring(0,t)+"...":e||"No Description",date:e=>e?new Date(e).toLocaleDateString():"—",formatDateISO:e=>e.toISOString().split("T")[0],getCurrentFY:()=>{const e=new Date;return e.getMonth()>=9?e.getFullYear()+1:e.getFullYear()},getCurrentQuarter:()=>{const e=(new Date).getMonth();return e>=9?1:e<=2?2:e<=5?3:4},getColor:e=>{const t=["#D66D64","#E3B66D","#6B8E88","#8D769A","#D99368","#7A8869","#708BA3"];let n=0;for(let t=0;t<e.length;t++)n=e.charCodeAt(t)+((n<<5)-n);return t[Math.abs(n)%t.length]},queryAliases:{aws:"Amazon",gcp:"Google Cloud",msft:"Microsoft",ibm:"International Business Machines",hp:"Hewlett Packard",hpe:"Hewlett Packard Enterprise",dell:"Dell Technologies",gd:"General Dynamics",gdit:"General Dynamics Information Technology",lmco:"Lockheed Martin",ngc:"Northrop Grumman",bah:"Booz Allen Hamilton",saic:"Science Applications International",dod:"Department of Defense",doj:"Department of Justice",dhs:"Department of Homeland Security",hhs:"Health and Human Services",dot:"Department of Transportation",doe:"Department of Energy",doi:"Department of the Interior",dol:"Department of Labor",doc:"Department of Commerce",dos:"Department of State",ed:"Department of Education",hud:"Housing and Urban Development",usda:"Department of Agriculture",va:"Veterans Affairs",army:"Department of the Army",navy:"Department of the Navy",usaf:"Department of the Air Force",ussf:"Space Force",usmc:"Marine Corps",cia:"Central Intelligence Agency",nsa:"National Security Agency",nga:"National Geospatial-Intelligence Agency",nro:"National Reconnaissance Office",dia:"Defense Intelligence Agency",disa:"Defense Information Systems Agency",darpa:"Defense Advanced Research Projects Agency",dcsa:"Defense Counterintelligence and Security Agency",dla:"Defense Logistics Agency",mda:"Missile Defense Agency",socom:"Special Operations Command",cybercom:"Cyber Command",stratcom:"Strategic Command",transcom:"Transportation Command",centcom:"Central Command",eucom:"European Command",indopacom:"Indo-Pacific Command",northcom:"Northern Command",southcom:"Southern Command",africom:"Africa Command",gsa:"General Services Administration",nasa:"National Aeronautics and Space Administration",fbi:"Federal Bureau of Investigation",dea:"Drug Enforcement Administration",atf:"Bureau of Alcohol Tobacco Firearms and Explosives",usps:"Postal Service",irs:"Internal Revenue Service",epa:"Environmental Protection Agency",fda:"Food and Drug Administration",cdc:"Centers for Disease Control and Prevention",nih:"National Institutes of Health",cms:"Centers for Medicare and Medicaid Services",ssa:"Social Security Administration",opm:"Office of Personnel Management",sba:"Small Business Administration",fema:"Federal Emergency Management Agency",tsa:"Transportation Security Administration",cbp:"Customs and Border Protection",ice:"Immigration and Customs Enforcement",uscis:"Citizenship and Immigration Services",usss:"Secret Service",cisa:"Cybersecurity and Infrastructure Security Agency",faa:"Federal Aviation Administration",fhwa:"Federal Highway Administration",fra:"Federal Railroad Administration",fta:"Federal Transit Administration",noaa:"National Oceanic and Atmospheric Administration",nist:"National Institute of Standards and Technology",census:"Census Bureau",ita:"International Trade Administration",blm:"Bureau of Land Management",nps:"National Park Service",usfs:"Forest Service",fws:"Fish and Wildlife Service",usgs:"Geological Survey",bia:"Bureau of Indian Affairs",boem:"Bureau of Ocean Energy Management",bor:"Bureau of Reclamation",ferc:"Federal Energy Regulatory Commission",nnsa:"National Nuclear Security Administration",sec:"Securities and Exchange Commission",ftc:"Federal Trade Commission",fcc:"Federal Communications Commission",nlrb:"National Labor Relations Board",eeoc:"Equal Employment Opportunity Commission",gao:"Government Accountability Office",omb:"Office of Management and Budget",cbo:"Congressional Budget Office",nara:"National Archives and Records Administration",pbgc:"Pension Benefit Guaranty Corporation",usaid:"Agency for International Development",amtrak:"Amtrak",fdic:"Federal Deposit Insurance Corporation",ncua:"National Credit Union Administration",cfpb:"Consumer Financial Protection Bureau",exim:"Export-Import Bank"},normalizeQuery(e){const t=e.toLowerCase().trim();return this.queryAliases[t]||e},missionGapRisk(e){const t=new Date(e["End Date"]),n=Math.ceil((t-new Date)/864e5),a=parseFloat(e["Award Amount"])||0,s=(e.Description||"").toLowerCase(),r=(e["PSC Description"]||"").toLowerCase(),i=(e["NAICS Description"]||"").toLowerCase(),o=(e["PSC Code"]||"").toUpperCase(),l=`${s} ${r} ${i}`,c=["operations","o&m","maintenance","sustainment","help desk","service desk","support services","managed services","hosting","cloud","network","cyber","security","monitoring","soc","continuity","backup","dr","patch","infrastructure","enterprise","mission","critical","24/7","production"].filter((e=>l.includes(e))),d=c.length>=2,p=["D","R","J"].includes(o.slice(0,1));return n<=180&&(d||p)&&a>=25e4?{level:"high",daysUntil:n,reasons:c.slice(0,4)}:n<=365&&(d||p)&&a>=1e5?{level:"medium",daysUntil:n,reasons:c.slice(0,3)}:{level:"low",daysUntil:n,reasons:c.slice(0,2)}},parseSearchTerms(e){const t=/^[A-Z]\d{1,3}$|^\d{1,2}[A-Z]\d{0,2}$/i,n=/^\d{6}$/,a=e.split(",").map((e=>e.trim())).filter((e=>e.length>0));return{pscCodes:a.filter((e=>t.test(e))).map((e=>e.toUpperCase())),naicsCodes:a.filter((e=>n.test(e))),keywordTerms:a.filter((e=>!t.test(e)&&!n.test(e))),allTerms:a}},buildFilters(e,t){const{pscCodes:n,naicsCodes:a,keywordTerms:s}=this.parseSearchTerms(e),r={time_period:t,award_type_codes:["A","B","C","D"]};return n.length>0&&(r.psc_codes=n),a.length>0&&(r.naics_codes=a),s.length>0&&(r.keywords=s),r.psc_codes||r.naics_codes||r.keywords||(r.keywords=[e]),r}},ModalUtils={activeModal:null,previousFocus:null,open(e){const t=document.getElementById(e);if(!t)return;this.previousFocus=document.activeElement,document.body.style.overflow="hidden",t.classList.add("active"),this.activeModal=t;const n=t.querySelector("button, input, select, textarea");n&&setTimeout((()=>n.focus()),50),this._boundKeydown=this.handleKeydown.bind(this),this._boundBackdrop=this.handleBackdropClick.bind(this),document.addEventListener("keydown",this._boundKeydown),t.addEventListener("click",this._boundBackdrop)},close(){if(!this.activeModal)return;const e=this.activeModal;e.classList.remove("active"),document.body.style.overflow="",this.previousFocus&&this.previousFocus.focus&&this.previousFocus.focus(),document.removeEventListener("keydown",this._boundKeydown),e.removeEventListener("click",this._boundBackdrop),this.activeModal=null},handleKeydown(e){if("Escape"!==e.key){if("Tab"===e.key&&this.activeModal){const t=this.activeModal.querySelectorAll('button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])');if(0===t.length)return;const n=t[0],a=t[t.length-1];e.shiftKey&&document.activeElement===n?(e.preventDefault(),a.focus()):e.shiftKey||document.activeElement!==a||(e.preventDefault(),n.focus())}}else this.close()},handleBackdropClick(e){e.target===this.activeModal&&this.close()}},Autocomplete={activeInput:null,dropdown:null,debounceTimer:null,selectedIndex:-1,results:{agencies:[],recipients:[]},init(e){const t=document.getElementById(e);if(!t)return;if(!t.parentElement.classList.contains("autocomplete-wrapper")){const e=document.createElement("div");e.className="autocomplete-wrapper",t.parentNode.insertBefore(e,t),e.appendChild(t)}const n=document.createElement("div");n.className="autocomplete-dropdown",n.id=`${e}-dropdown`,t.parentElement.appendChild(n),t.addEventListener("input",(t=>this.handleInput(t,e))),t.addEventListener("keydown",(t=>this.handleKeydown(t,e))),t.addEventListener("focus",(t=>this.handleFocus(t,e))),t.addEventListener("blur",(()=>setTimeout((()=>this.hide(e)),200)))},handleInput(e,t){const n=e.target.value.trim();clearTimeout(this.debounceTimer),n.length<2?this.hide(t):this.debounceTimer=setTimeout((()=>this.search(n,t)),250)},handleFocus(e,t){e.target.value.trim().length>=2&&this.hasResults()&&this.show(t)},handleKeydown(e,t){const n=document.getElementById(`${t}-dropdown`);if(!n||!n.classList.contains("active"))return void("ArrowDown"===e.key&&e.target.value.length>=2&&this.search(e.target.value.trim(),t));const a=n.querySelectorAll(".autocomplete-item");"ArrowDown"===e.key?(e.preventDefault(),this.selectedIndex=Math.min(this.selectedIndex+1,a.length-1),this.updateSelection(a)):"ArrowUp"===e.key?(e.preventDefault(),this.selectedIndex=Math.max(this.selectedIndex-1,0),this.updateSelection(a)):"Enter"===e.key&&this.selectedIndex>=0?(e.preventDefault(),a[this.selectedIndex]?.click()):"Escape"===e.key&&this.hide(t)},updateSelection(e){e.forEach(((e,t)=>{e.classList.toggle("selected",t===this.selectedIndex)})),e[this.selectedIndex]?.scrollIntoView({block:"nearest"})},async search(e,t){try{const[n,a]=await Promise.all([API.autocompleteAgency(e),API.autocompleteRecipient(e)]);this.results={agencies:n,recipients:a},this.selectedIndex=-1,this.render(t)}catch(e){console.error("Autocomplete error:",e)}},hasResults(){return this.results.agencies.length>0||this.results.recipients.length>0},render(e){const t=document.getElementById(`${e}-dropdown`);if(!t)return;const{agencies:n,recipients:a}=this.results;if(!this.hasResults())return t.innerHTML='<div class="autocomplete-empty">No matches found</div>',void this.show(e);let s="";n.length>0&&(s+=`<div class="autocomplete-section">\n        <div class="autocomplete-section-label mono muted upper"><i class="fas fa-landmark"></i> Agencies</div>\n        ${n.slice(0,5).map((e=>`\n          <div class="autocomplete-item" data-type="agency" data-value="${this.escapeHtml(e.subtier_agency?.name||e.toptier_agency?.name||"")}">\n            <i class="fas fa-building muted"></i>\n            <div class="autocomplete-item-text">\n              <div class="autocomplete-item-main truncate">${this.escapeHtml(e.subtier_agency?.name||e.toptier_agency?.name||"Unknown")}</div>\n              ${e.toptier_agency?.name&&e.subtier_agency?.name?`<div class="autocomplete-item-sub muted">${this.escapeHtml(e.toptier_agency.name)}</div>`:""}\n            </div>\n          </div>\n        `)).join("")}\n      </div>`),a.length>0&&(s+=`<div class="autocomplete-section">\n        <div class="autocomplete-section-label mono muted upper"><i class="fas fa-briefcase"></i> Vendors & Keywords</div>\n        ${a.slice(0,5).map((e=>`\n          <div class="autocomplete-item" data-type="recipient" data-value="${this.escapeHtml(e.recipient_name||"")}">\n            <i class="fas fa-briefcase muted"></i>\n            <div class="autocomplete-item-text">\n              <div class="autocomplete-item-main truncate">${this.escapeHtml(e.recipient_name||"Unknown")}</div>\n              ${e.uei?`<div class="autocomplete-item-sub muted">UEI: ${e.uei}</div>`:""}\n            </div>\n          </div>\n        `)).join("")}\n      </div>`),t.innerHTML=s,t.querySelectorAll(".autocomplete-item").forEach((t=>{t.addEventListener("click",(()=>{const n=document.getElementById(e);n&&(n.value=t.dataset.value,n.focus()),this.hide(e)}))})),this.show(e)},show(e){const t=document.getElementById(`${e}-dropdown`);t&&t.classList.add("active")},hide(e){const t=document.getElementById(`${e}-dropdown`);t&&t.classList.remove("active"),this.selectedIndex=-1},escapeHtml:e=>e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"):""},API={baseUrl:"https://api.usaspending.gov/api/v2",async searchAwards(e){const t=new Date,n=new Date;n.setFullYear(t.getFullYear()-1);const a={start_date:Utils.formatDateISO(n),end_date:Utils.formatDateISO(t)},{allTerms:s}=Utils.parseSearchTerms(e),r=/^[A-Z]\d{1,3}$|^\d{1,2}[A-Z]\d{0,2}$/i,i=/^\d{6}$/,o=s.map((e=>{const t={time_period:[a],award_type_codes:["A","B","C","D"]};return r.test(e)?t.psc_codes=[e.toUpperCase()]:i.test(e)?t.naics_codes=[e]:t.keywords=[e],fetch(`${this.baseUrl}/search/spending_by_award/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filters:t,fields:["Award ID","Recipient Name","Awarding Agency","Awarding Sub Agency","Award Amount","Description","generated_internal_id","Start Date","End Date","NAICS Code","NAICS Description","PSC Code","PSC Description"],limit:100,sort:"Award Amount",order:"desc"})}).then((e=>e.json()))})),l=await Promise.all(o);let c=[];l.forEach((e=>{e.results&&(c=c.concat(e.results))}));const d=new Map;return c.forEach((e=>{d.has(e["Award ID"])||d.set(e["Award ID"],e)})),Array.from(d.values()).sort(((e,t)=>t["Award Amount"]-e["Award Amount"]))},async getSpendingOverTime(e,t=4){const n=Utils.getCurrentFY(),a=[];for(let e=n-t;e<=n;e++)a.push({start_date:e-1+"-10-01",end_date:`${e}-09-30`});const s=this._buildFilters(e,a),r=await fetch(`${this.baseUrl}/search/spending_over_time/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({group:"quarter",filters:s})});return(await r.json()).results||[]},async getAgencyData(e,t=3){const n=Utils.getCurrentFY(),a=[{start_date:n-t-1+"-10-01",end_date:`${n}-09-30`}],s=this._buildFilters(e,a),r=await fetch(`${this.baseUrl}/search/spending_by_category/awarding_agency`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({category:"awarding_agency",filters:s,limit:100})});return(await r.json()).results||[]},async getAwardsForForecast(e){const t=new Date,n=new Date;n.setFullYear(t.getFullYear()-1);const a={start_date:Utils.formatDateISO(n),end_date:Utils.formatDateISO(t)},s=this._buildFilters(e,[a]),r=await fetch(`${this.baseUrl}/search/spending_by_award/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filters:s,fields:["Award ID","Recipient Name","Description","Start Date","End Date","Award Amount","Potential Total Value of Award","Awarding Agency","Awarding Sub Agency","generated_internal_id","NAICS Code","NAICS Description","PSC Code","PSC Description"],limit:100,sort:"Award Amount",order:"desc"})});return(await r.json()).results||[]},_buildFilters:(e,t)=>Utils.buildFilters(e,t),async autocompleteAgency(e){if(!e||e.length<2)return[];const t=await fetch(`${this.baseUrl}/autocomplete/awarding_agency/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({search_text:e,limit:8})});return(await t.json()).results||[]},async fetchOfficesForSubAgency(e){try{const t=await fetch(`${this.baseUrl}/autocomplete/awarding_agency_office/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({search_text:e,limit:50})}),n=await t.json(),a=[];return n.results&&n.results.forEach((t=>{t.subtier_agency&&t.subtier_agency.name===e&&t.subtier_agency.offices&&t.subtier_agency.offices.forEach((e=>{a.push({code:e.code,name:e.name})})),t.toptier_agency&&t.toptier_agency.offices&&t.toptier_agency.offices.forEach((e=>{a.push({code:e.code,name:e.name})})),t.office&&a.push({code:t.office.code,name:t.office.name})})),a}catch(e){return console.error("Error fetching offices:",e),[]}},async autocompleteRecipient(e){if(!e||e.length<2)return[];const t=await fetch(`${this.baseUrl}/autocomplete/recipient/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({search_text:e,limit:8})});return(await t.json()).results||[]},async getSpendingByGeography(e,t="state"){const n=Utils.getCurrentFY(),a=[{start_date:n-1+"-10-01",end_date:`${n}-09-30`}],s=Utils.buildFilters(e,a),r=await fetch(`${this.baseUrl}/search/spending_by_geography/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({scope:"place_of_performance",geo_layer:t,filters:s})});return(await r.json()).results||[]},async getSubawards(e){const t=new Date,n=new Date;n.setFullYear(t.getFullYear()-1);const a={time_period:[{start_date:Utils.formatDateISO(n),end_date:Utils.formatDateISO(t)}],award_type_codes:["A","B","C","D"]},s=/^[A-Z]\d{1,3}$|^\d{1,2}[A-Z]\d{0,2}$/i,r=/^\d{6}$/,i=e.split(",").map((e=>e.trim())).filter((e=>e.length>0)),o=i.filter((e=>s.test(e))).map((e=>e.toUpperCase())),l=i.filter((e=>r.test(e))),c=i.filter((e=>!s.test(e)&&!r.test(e)));o.length>0&&(a.psc_codes=o),l.length>0&&(a.naics_codes=l),c.length>0&&(a.keywords=c),a.psc_codes||a.naics_codes||a.keywords||(a.keywords=[e]);const d=await fetch(`${this.baseUrl}/search/spending_by_award/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subawards:!0,filters:a,fields:["Sub-Award ID","Sub-Awardee Name","Sub-Award Amount","Prime Award ID","Prime Recipient Name","Sub-Award Date","Awarding Agency","Awarding Sub Agency","prime_award_generated_internal_id"],limit:100,sort:"Sub-Award Amount",order:"desc"})});return(await d.json()).results||[]}},GeoMap={async loadAndRender(e,t){const n=document.getElementById(e);if(n){n.innerHTML='\n      <div class="geo-map-header">\n        <div class="geo-map-title"><i class="fas fa-map-marker-alt"></i> Performance Location</div>\n        <div class="geo-map-total">Loading...</div>\n      </div>\n      <div class="geo-states-grid">\n        <div style="grid-column: 1/-1; text-align:center; padding:2rem; color:var(--text-muted);">\n          <i class="fas fa-spinner fa-spin"></i> Loading geography data...\n        </div>\n      </div>\n    ';try{const e=await API.getSpendingByGeography(t,"state");this.render(n,e)}catch(e){n.innerHTML='\n        <div class="geo-map-header">\n          <div class="geo-map-title"><i class="fas fa-map-marker-alt"></i> Performance Location</div>\n        </div>\n        <div style="text-align:center; padding:1rem; color:var(--text-muted); font-size:0.85rem;">\n          Unable to load geography data\n        </div>\n      '}}},render(e,t){if(!t||0===t.length)return void(e.innerHTML='\n        <div class="geo-map-header">\n          <div class="geo-map-title"><i class="fas fa-map-marker-alt"></i> Performance Location</div>\n        </div>\n        <div style="text-align:center; padding:1rem; color:var(--text-muted); font-size:0.85rem;">\n          No geographic data available\n        </div>\n      ');const n=t.filter((e=>e.aggregated_amount>0)).sort(((e,t)=>t.aggregated_amount-e.aggregated_amount)),a=n.reduce(((e,t)=>e+t.aggregated_amount),0),s=(n[0],n.slice(0,20).map((e=>{const t=e.shape_code||e.display_name;return`\n        <div class="geo-state-item">\n          <span class="geo-state-name truncate">${US_STATES[t]||e.display_name||t}</span>\n          <span class="geo-state-amount mono accent">${Utils.money(e.aggregated_amount)}</span>\n        </div>\n      `})).join(""));e.innerHTML=`\n      <div class="geo-map-header">\n        <div class="geo-map-title mono text-sm muted upper"><i class="fas fa-map-marker-alt"></i> Top Performance Locations</div>\n        <div class="geo-map-total mono accent">${Utils.money(a)} across ${n.length} states</div>\n      </div>\n      <div class="geo-states-grid">${s}</div>\n    `}},ForecastEngine={analyze(e,t,n){const a=this.organizeByQuarter(e),s=this.filterOutliers(a),r=this.detectRecompetes(t),i=this.analyzeMarketConcentration(n),o=this.calculateVolatilityMetrics(s);return{recompetes:r,marketStatus:i.level,hhi:i.hhi,byFY:a.byFY,volatility:o}},organizeByQuarter(e){const t={byFY:{},byQuarter:{},totalByFY:{},allAmounts:[]};return e.forEach((e=>{const n=parseInt(e.time_period?.quarter),a=parseInt(e.time_period?.fiscal_year),s=e.aggregated_amount||0;n&&a&&(t.byFY[a]||(t.byFY[a]={1:0,2:0,3:0,4:0}),t.byFY[a][n]=s,t.byQuarter[n]||(t.byQuarter[n]=[]),t.byQuarter[n].push({fy:a,amt:s}),t.totalByFY[a]=(t.totalByFY[a]||0)+s,t.allAmounts.push({fy:a,q:n,amt:s}))})),t},filterOutliers(e){const t={byFY:{},byQuarter:{},totalByFY:{},allAmounts:[]};Object.keys(e.byFY).forEach((e=>t.byFY[e]={}));for(let n=1;n<=4;n++){const a=e.byQuarter[n]||[],s=a.map((e=>e.amt));if(s.length<3){a.forEach((e=>{t.byQuarter[n]=t.byQuarter[n]||[],t.byQuarter[n].push(e),t.byFY[e.fy][n]=e.amt,t.totalByFY[e.fy]=(t.totalByFY[e.fy]||0)+e.amt}));continue}const r=s.reduce(((e,t)=>e+t),0)/s.length,i=s.reduce(((e,t)=>e+Math.pow(t-r,2)),0)/s.length,o=Math.sqrt(i),l=r+2*o;a.forEach((e=>{e.amt<=l&&(t.byQuarter[n]=t.byQuarter[n]||[],t.byQuarter[n].push(e),t.byFY[e.fy][n]=e.amt,t.totalByFY[e.fy]=(t.totalByFY[e.fy]||0)+e.amt)}))}return t},calculateVolatilityMetrics(e){const t=Utils.getCurrentFY(),n=Object.keys(e.totalByFY).map(Number).filter((e=>e<t)).sort();if(n.length<2)return{stdDev:0,coeffVar:0,score:.5};const a=n.map((t=>e.totalByFY[t])),s=a.reduce(((e,t)=>e+t),0)/a.length,r=a.reduce(((e,t)=>e+Math.pow(t-s,2)),0)/(a.length-1),i=Math.sqrt(r),o=s>0?i/s:0;return{stdDev:i,coeffVar:o,score:Math.min(2.5*o,1)}},analyzeMarketConcentration(e){const t=e.reduce(((e,t)=>e+t.amount),0);let n=0,a=0;if(t>0){e.forEach((e=>{const a=e.amount/t*100;n+=a*a}));a=[...e].sort(((e,t)=>t.amount-e.amount)).slice(0,4).reduce(((e,n)=>e+n.amount/t*100),0)}let s="Competitive",r="Low";return n>2500?(s="Concentrated",r="High"):n>1500&&(s="Moderate",r="Medium"),{hhi:Math.round(n),level:s,cr4:Math.round(a),buyerPower:r,agencyCount:e.length}},detectRecompetes(e){const t=new Date,n=new Date;return n.setFullYear(t.getFullYear()+2),e.filter((e=>{const a=new Date(e["End Date"]);return a>t&&a<n&&e["Award Amount"]>5e4})).sort(((e,t)=>new Date(e["End Date"])-new Date(t["End Date"]))).slice(0,15)}},KnownVendors={vars:new Set(["CARAHSOFT TECHNOLOGY CORP","CARAHSOFT TECHNOLOGY CORPORATION","CDW GOVERNMENT LLC","CDW-G","SHI INTERNATIONAL CORP","SHI GOVERNMENT SOLUTIONS","INSIGHT PUBLIC SECTOR INC","INSIGHT DIRECT USA INC","GOVPLACE, LLC","GOVPLACE LLC","IMMIX GROUP INC","IMMIXGROUP INC","DLT SOLUTIONS LLC","DLT SOLUTIONS","THUNDERCAT TECHNOLOGY, LLC","THUNDERCAT TECHNOLOGY LLC","WORLD WIDE TECHNOLOGY LLC","WWT GOVERNMENT SERVICES","PRESIDIO NETWORKED SOLUTIONS","PRESIDIO GOVERNMENT SOLUTIONS","CONNECTION","PC CONNECTION","PCMG INC","EN POINTE TECHNOLOGIES","STERLING COMPUTERS CORPORATION","STERLING COMPUTERS","MERLIN INTERNATIONAL","RED RIVER TECHNOLOGY","MYTHICS INC","MYTHICS LLC","FOUR POINTS TECHNOLOGY","FOUR POINTS TECHNOLOGY LLC","SILOTECH GROUP INC","DECISIVE COMMUNICATIONS INC","FCN INC","FCN, INC.","SOFTCHOICE CORPORATION","SOFTCHOICE","TRACE3","OPTIV SECURITY INC","OPTIV SECURITY","FEDSTORE CORPORATION","FEDSTORE","GOVSMART INC","GOVSMART, INC.","NEW TECH SOLUTIONS","NEW TECH SOLUTIONS, INC.","PANAMERICA COMPUTERS","PANAMERICA COMPUTERS, INC.","SOFTWARE INFORMATION RESOURCE CORP","ACCESSAGILITY LLC","BLUE TECH INC","BLUE TECH INC.","DH TECHNOLOGIES","DH TECHNOLOGIES, INC.","IT1 SOURCE LLC","ENTERPRISE TECHNOLOGY SOLUTIONS","ENTERPRISE TECHNOLOGY SOLUTIONS, INC.","DISTRIBUTED TECHNOLOGY GROUP LLC","ARCHITECHTURE SOLUTIONS LLC","ADVANCED COMPUTER CONCEPTS","ADVANCED COMPUTER CONCEPTS, INC.","4 STAR TECHNOLOGIES","4 STAR TECHNOLOGIES, INC.","THREE WIRE SYSTEMS","THREE WIRE SYSTEMS, LLC","C & C INTERNATIONAL COMPUTERS"]),primes:new Set(["BOOZ ALLEN HAMILTON","BOOZ ALLEN HAMILTON INC","GENERAL DYNAMICS INFORMATION TECHNOLOGY","GENERAL DYNAMICS IT","GDIT","LEIDOS INC","LEIDOS HOLDINGS","LEIDOS","SAIC","SCIENCE APPLICATIONS INTERNATIONAL","NORTHROP GRUMMAN","RAYTHEON","LOCKHEED MARTIN","LOCKHEED MARTIN CORPORATION","BAE SYSTEMS","L3HARRIS TECHNOLOGIES","CACI INTERNATIONAL","CACI INC","MANTECH INTERNATIONAL","MANTECH","PERATON INC","PERATON","ACCENTURE FEDERAL SERVICES","ACCENTURE","DELOITTE CONSULTING","DELOITTE","IBM CORPORATION","IBM","KPMG","CGI FEDERAL","CGI TECHNOLOGIES","MAXIMUS INC","MAXIMUS FEDERAL","ICF INTERNATIONAL","ICF INC","SERCO INC","SERCO","PAE INCORPORATED","AMENTUM","JACOBS TECHNOLOGY","KBR INC"]),classify(e){const t=e.toUpperCase().trim();if(this.vars.has(t))return"var";if(this.primes.has(t))return"prime";for(const e of this.vars)if(t.includes(e)||e.includes(t))return"var";for(const e of this.primes)if(t.includes(e)||e.includes(t))return"prime";const n=[/\b(TECHNOLOGY|TECHNOLOGIES)\s*(CORP|LLC|INC)/i,/\b(COMPUTERS?|COMPUTING)\s*(CORP|LLC|INC)/i,/\bSOLUTIONS?\s*(CORP|LLC|INC)/i,/\bGOV(PLACE|SMART|STORE)/i,/\bFEDERAL\s*(SOLUTIONS|TECHNOLOGY)/i];for(const e of n)if(e.test(t))return"likely_var";return"unknown"}},JobLinks={knownBrands:["KBR","SAIC","CACI","LEIDOS","SERCO","AECOM","JACOBS","PARSONS","MAXIMUS","ICF","CGI","IBM","DELL","HP","CISCO","ORACLE","GOOGLE","AMAZON WEB","MICROSOFT","ACCENTURE FEDERAL","DELOITTE","KPMG","PWC","EY","PERATON","AMENTUM","MANTECH","BAE SYSTEMS","RAYTHEON","BOEING","AIRBUS","HONEYWELL","HARRIS","TEXTRON","VERIZON","ATT","AT&T","SPRINT","PALANTIR","ANDURIL","CROWDSTRIKE","SPLUNK","VMWARE","SALESFORCE","SERVICENOW","SNOWFLAKE","DATABRICKS","ELASTIC","GITLAB","ATLASSIAN"],brandAliases:{"BOOZ ALLEN":"BAH","GENERAL DYNAMICS":"GDIT","NORTHROP GRUMMAN":"NGC","LOCKHEED MARTIN":"LMCO",L3HARRIS:"L3 HARRIS","L3 HARRIS":"L3HARRIS","WORLD WIDE TECHNOLOGY":"WWT","RED HAT":"REDHAT","PALO ALTO":"PANW"},cleanVendorName(e){let t=e.replace(/,?\s*(LLC|INC|CORP|CORPORATION|INCORPORATED|L\.L\.C\.|L\.P\.|LP|LTD|LIMITED|CO\.)\.?\s*$/gi,"").replace(/\s+/g," ").trim();const n=t.toUpperCase();for(const e of this.knownBrands)if(n===e||n.startsWith(e+" "))return e;for(const[e,t]of Object.entries(this.brandAliases))if(n.startsWith(e))return e;return t},getLinkedInUrl(e){const t=this.cleanVendorName(e);return`https://www.linkedin.com/jobs/search/?keywords=${encodeURIComponent(t)}&f_C=`},getLinkedInPeopleUrl(e,t=""){const n=this.cleanVendorName(e);return`https://www.linkedin.com/search/results/people/?keywords=${encodeURIComponent(t?`"${n}" ${t}`:n)}&origin=GLOBAL_SEARCH_HEADER`},getLinkedInNewsUrl(e){const t="string"==typeof e?this.cleanVendorName(e):e;return`https://www.linkedin.com/search/results/content/?keywords=${encodeURIComponent(t)}`}},SkillsExtractor={patterns:{Cloud:/\b(cloud|aws|amazon web services|azure|gcp|google cloud|fedramp|iaas|paas|saas)\b/i,Cybersecurity:/\b(cyber|security|soc|siem|zero trust|endpoint|threat|vulnerability|pentest|fisma|rmf)\b/i,"AI/ML":/\b(artificial intelligence|machine learning|ai\/ml|nlp|natural language|computer vision|deep learning|neural)\b/i,DevOps:/\b(devops|devsecops|ci\/cd|jenkins|kubernetes|k8s|docker|container|ansible|terraform)\b/i,"Data Analytics":/\b(data engineer|analytics|business intelligence|tableau|power bi|visualization|big data|etl|data lake)\b/i,"Software Dev":/\b(software develop|full stack|frontend|backend|java|python|javascript|\.net|agile|scrum)\b/i,"IT Support":/\b(help desk|service desk|it support|technical support|tier [123]|desktop|end user)\b/i,Network:/\b(network engineer|cisco|routing|switching|firewall|vpn|wan|lan|sd-wan)\b/i,"Project Mgmt":/\b(project manag|program manag|pmp|scrum master|agile coach)\b/i,"Systems Admin":/\b(system admin|sysadmin|windows server|linux|vmware|active directory)\b/i},extract(e){const t={},n={};return e.forEach((e=>{const a=`${e.Description||""} ${e["PSC Description"]||""} ${e["NAICS Description"]||""}`;for(const[s,r]of Object.entries(this.patterns))r.test(a)&&(t[s]=(t[s]||0)+1,n[s]||(n[s]=e.Description?.substring(0,100)||""))})),Object.entries(t).map((([t,a])=>({skill:t,count:a,percentage:Math.round(a/e.length*100),example:n[t]}))).sort(((e,t)=>t.count-e.count)).slice(0,6)}},SalesPlanManager={channels:new Set,currentVendors:[],detectedIntent:null,init(){try{const e=localStorage.getItem("govhoo_channels");e&&(this.channels=new Set(JSON.parse(e)))}catch(e){console.warn("localStorage unavailable, using session-only storage")}},isChannel(e){return this.channels.has(e)},detectIntent(e){const t=App.currentQuery||"",n={};let a=0;e.forEach((e=>{const t=e["Recipient Name"]||"Unknown",s=parseFloat(e["Award Amount"])||0;n[t]=(n[t]||0)+s,a+=s}));const s=Object.entries(n).map((([e,t])=>({name:e,spend:t,share:t/a}))).sort(((e,t)=>t.spend-e.spend));let r=0,i=0;s.forEach((e=>{this.isChannel(e.name)&&(r+=e.spend,i++)}));const o=a>0?r/a:0;if(o>.7&&i>=3)return{type:"product_oem",icon:"fa-box",title:"PRODUCT / OEM CHANNEL",description:`${(100*o).toFixed(1)}% of revenue flows through ${i} channel partners`,focusAreas:["Channel performance & rankings","Partner enablement priorities","Recompete defense by partner","Agency coverage gaps"],suggestedGoal:"Partnership"};const l=s[0];if(l&&t.toLowerCase().includes(l.name.toLowerCase().split(" ")[0]))return{type:"own_company",icon:"fa-building",title:"YOUR COMPANY ANALYSIS",description:`Analyzing your market position: ${Utils.money(l.spend)} (${(100*l.share).toFixed(1)}% share)`,focusAreas:["Defend existing contracts","Identify growth opportunities","Competitive threats to your position","Recompete calendar & defense"],suggestedGoal:"Retention"};return["department","agency","administration","commission","bureau"].some((e=>t.toLowerCase().includes(e)))?{type:"agency",icon:"fa-landmark",title:"AGENCY PENETRATION",description:"Analyzing how to enter or expand within this customer",focusAreas:["Agency mission & budget priorities","Current vendor landscape","Entry points & opportunities","Key contracting vehicles"],suggestedGoal:"Growth"}:{type:"market_keyword",icon:"fa-chart-line",title:"MARKET ANALYSIS",description:`Analyzing the "${t}" market landscape`,focusAreas:["Market size & growth trends","Competitive landscape","Top agencies & opportunities","Entry strategy recommendations"],suggestedGoal:"Growth"}},open(){const e=App.forecastData.awards||App.searchData.raw||[];if(!e.length)return void alert("No award data loaded. Please run a search or forecast first.");this.detectedIntent=this.detectIntent(e);const t={};e.forEach((e=>{const n=e["Awarding Agency"];n&&(t[n]=(t[n]||0)+1)}));const n=Object.entries(t).sort(((e,t)=>t[1]-e[1])).map((([e,t])=>`<option value="${e}">${e} (${t} awards)</option>`)).join("");document.getElementById("spSpecificAgencies").innerHTML=n,document.getElementById("spScope").value="all",document.getElementById("spFocus").value=this.detectedIntent.suggestedGoal,this.prepareVendorList(e),this.renderIntentBanner(),this.updateStatus(e.length,"Entire Market"),this.renderSmartVendorList(),ModalUtils.open("salesPlanModal")},close(){ModalUtils.close();const e=document.getElementById("copySuccessModal");e&&e.classList.remove("active")},renderIntentBanner(){const e=document.getElementById("spIntentBanner");if(!e||!this.detectedIntent)return;const t=this.detectedIntent;e.innerHTML=`\n      <div class="intent-banner-content">\n        <div class="intent-banner-icon"><i class="fas ${t.icon}"></i></div>\n        <div class="intent-banner-text">\n          <div class="intent-banner-title">${t.title}</div>\n          <div class="intent-banner-desc">${t.description}</div>\n          <div class="intent-banner-focus">\n            ${t.focusAreas.map((e=>`<span class="focus-tag">${e}</span>`)).join("")}\n          </div>\n        </div>\n      </div>\n    `,e.style.display="block"},getFilteredData(){const e=document.getElementById("spScope").value,t=document.getElementById("spFocus").value,n=App.forecastData.awards||App.searchData.raw||[];let a=[],s="Entire Market";if("all"===e?a=n:"defense"===e?(a=n.filter((e=>/defense|army|navy|air force|marine|space force/i.test(e["Awarding Agency"]))),s="Defense Sector"):"civilian"===e?(a=n.filter((e=>!/defense|army|navy|air force|marine|space force/i.test(e["Awarding Agency"]))),s="Federal Civilian Sector"):(a=n.filter((t=>t["Awarding Agency"]===e)),s=e),0===a.length)throw new Error("No awards found for the selected scope.");return{filteredAwards:a,scopeName:s,focus:t}},generate(){App.showLoader("GENERATING PLAN...","Filtering data & packaging prompt..."),setTimeout((()=>{try{const{filteredAwards:e,scopeName:t,focus:n}=this.getFilteredData(),a=App.forecastData&&App.forecastData.analysis?App.forecastData.analysis:null,s=PromptPackageGenerator.buildPackage(e,a,{scope:t,focus:n});PromptPackageGenerator.downloadPackage(s),this.close()}catch(e){console.error(e),alert(e.message||"Error generating plan")}finally{App.hideLoader()}}),500)},async copyPrompt(){const e=document.getElementById("btnCopyPrompt");if(!e)return;const t=e.innerHTML;e.innerHTML='<i class="fas fa-spinner fa-spin"></i> Generating...',e.style.opacity="0.7",e.style.pointerEvents="none";try{const{filteredAwards:n,scopeName:a,focus:s}=this.getFilteredData(),r=App.forecastData&&App.forecastData.analysis?App.forecastData.analysis:null,i=PromptPackageGenerator.buildPackage(n,r,{scope:a,focus:s});await navigator.clipboard.writeText(i),this.showCopySuccessModal(i.length),e.innerHTML=t,e.style.opacity="1",e.style.pointerEvents="auto"}catch(n){console.error(n),alert(n.message||"Error copying prompt"),e.innerHTML=t,e.style.opacity="1",e.style.pointerEvents="auto"}},showCopySuccessModal(e){let t=document.getElementById("copySuccessModal");t||(t=document.createElement("div"),t.id="copySuccessModal",t.className="channel-marking-modal",document.body.appendChild(t));const n=Math.round(e/4);t.innerHTML=`\n      <div class="channel-modal-content" style="max-width: 420px; height: auto;">\n        <div class="channel-modal-header" style="border-bottom-color: var(--accent);">\n          <div class="channel-modal-title" style="color: var(--accent);">\n            <i class="fas fa-check-circle"></i> Copied to Clipboard\n          </div>\n          <button class="channel-modal-close" onclick="SalesPlanManager.closeSuccessModal()">\n            <i class="fas fa-times"></i>\n          </button>\n        </div>\n        \n        <div class="channel-modal-body" style="padding: 1.5rem;">\n          <div style="margin-bottom: 1.25rem;">\n            <div style="font-size: 0.95rem; color: #fff; font-weight: 500; margin-bottom: 0.25rem;">Your prompt is ready</div>\n            <div style="font-size: 0.8rem; color: var(--text-muted);">\n              ${e.toLocaleString()} chars · ~${n.toLocaleString()} tokens\n            </div>\n          </div>\n          \n          <div style="font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.5rem;">\n            Open in\n          </div>\n          <div style="display: flex; flex-direction: column; gap: 0.5rem; margin-bottom: 1.25rem;">\n            <a href="https://claude.ai/new" target="_blank" rel="noopener" class="ai-link-btn claude">\n              Claude\n            </a>\n            <a href="https://chat.openai.com" target="_blank" rel="noopener" class="ai-link-btn chatgpt">\n              ChatGPT\n            </a>\n            <a href="https://gemini.google.com" target="_blank" rel="noopener" class="ai-link-btn gemini">\n              Gemini\n            </a>\n          </div>\n          <div style="font-size: 0.75rem; color: var(--text-muted); line-height: 1.5;">\n            Paste with <kbd>Ctrl+V</kbd> (or <kbd>⌘V</kbd>) to generate your sales plan.\n          </div>\n        </div>\n        \n        <div class="channel-modal-footer" style="justify-content: flex-end;">\n          <button class="modal-btn modal-btn-cancel" onclick="SalesPlanManager.closeSuccessModal()">\n            Done\n          </button>\n        </div>\n      </div>\n    `,ModalUtils.open("copySuccessModal")},closeSuccessModal(){ModalUtils.close(),document.getElementById("salesPlanModal").classList.remove("active"),document.body.style.overflow=""},prepareVendorList(e){const t={};let n=0;e.forEach((e=>{const a=e["Recipient Name"]||"Unknown",s=parseFloat(e["Award Amount"])||0;t[a]=(t[a]||0)+s,n+=s})),this.currentVendors=Object.entries(t).map((([t,a])=>({vendor:t,spend:a,marketShare:n>0?(a/n*100).toFixed(2):"0.00",contractCount:e.filter((e=>e["Recipient Name"]===t)).length,classification:KnownVendors.classify(t)}))).sort(((e,t)=>t.spend-e.spend)).slice(0,30)},updateStatus(e,t){const n=document.getElementById("spDataStatus");if(!n)return;const a=this.currentVendors.filter((e=>this.isChannel(e.vendor))).length,s=this.currentVendors.length;n.innerHTML=`\n      <span style="color:var(--success);"><i class="fas fa-check-circle"></i></span>\n      Ready · ${e} awards · ${a}/${s} channels\n    `},toggleChannel(e){this.channels.has(e)?this.channels.delete(e):this.channels.add(e),this.save(),this.updateStatus(App.forecastData.awards?.length||App.searchData.raw?.length||0,"all"===document.getElementById("spScope")?.value?"Entire Market":document.getElementById("spScope")?.value)},toggleAll(){this.currentVendors.every((e=>this.isChannel(e.vendor)))?this.currentVendors.forEach((e=>this.channels.delete(e.vendor))):this.currentVendors.forEach((e=>this.channels.add(e.vendor))),this.save(),this.renderSmartVendorList(),this.updateStatus(App.forecastData.awards?.length||App.searchData.raw?.length||0,"all"===document.getElementById("spScope")?.value?"Entire Market":document.getElementById("spScope")?.value)},acceptSuggested(){this.currentVendors.forEach((e=>{"var"!==e.classification&&"likely_var"!==e.classification||this.channels.add(e.vendor)})),this.save(),this.renderSmartVendorList(),this.updateStatus(App.forecastData.awards?.length||App.searchData.raw?.length||0,"all"===document.getElementById("spScope")?.value?"Entire Market":document.getElementById("spScope")?.value)},save(){try{localStorage.setItem("govhoo_channels",JSON.stringify([...this.channels]))}catch(e){}},renderSmartVendorList(){const e=document.getElementById("spVendorList"),t=document.getElementById("spBulkActionContainer");if(!e||!t)return;const n=this.currentVendors.filter((e=>("var"===e.classification||"likely_var"===e.classification)&&!this.isChannel(e.vendor))),a=this.currentVendors.filter((e=>"prime"===e.classification)),s=this.currentVendors.filter((e=>"unknown"===e.classification&&!this.isChannel(e.vendor))),r=this.currentVendors.filter((e=>this.isChannel(e.vendor))),i=this.currentVendors.length>0&&this.currentVendors.every((e=>this.isChannel(e.vendor)));if(t.innerHTML=`\n      <div style="display: flex; gap: 0.5rem;">\n        ${n.length>0?`\n          <button onclick="SalesPlanManager.acceptSuggested()" style="background: rgba(76, 175, 80, 0.1); border: 1px solid var(--success); color: var(--success); padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 0.7rem; font-family: 'JetBrains Mono'; display: flex; align-items: center; gap: 6px;">\n            <i class="fas fa-magic"></i> ACCEPT SUGGESTIONS (${n.length})\n          </button>\n        `:""}\n        <button onclick="SalesPlanManager.toggleAll()" style="background: transparent; border: 1px solid var(--border); color: var(--accent); padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 0.7rem; font-family: 'JetBrains Mono'; display: flex; align-items: center; gap: 6px;">\n          <i class="far ${i?"fa-square":"fa-check-square"}"></i> ${i?"UNMARK ALL":"MARK ALL"}\n        </button>\n      </div>\n    `,0===this.currentVendors.length)return void(e.innerHTML='<div style="text-align:center; padding:1rem; color:#666;">No vendors found in this scope.</div>');let o="";r.length>0&&(o+=this.renderVendorSection("✅ MARKED AS CHANNELS","These vendors are already marked as your channel partners",r,"success")),n.length>0&&(o+=this.renderVendorSection("🎯 SUGGESTED CHANNELS","We detected these as likely resellers/VARs based on known patterns",n,"accent")),s.length>0&&(o+=this.renderVendorSection("❓ NEEDS REVIEW","We couldn't automatically classify these vendors",s,"muted")),a.length>0&&(o+=this.renderVendorSection("🏢 LIKELY PRIMES/SIs","These appear to be system integrators or large primes",a,"muted")),e.innerHTML=o},renderVendorSection(e,t,n,a){const s={success:"var(--success)",accent:"var(--accent)",muted:"#666"}[a]||"#666";return`\n      <div style="margin-bottom: 1.5rem;">\n        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">\n          <span style="font-size: 0.8rem; font-weight: 700; color: ${s}; text-transform: uppercase; letter-spacing: 0.5px;">\n            ${e}\n          </span>\n          <span style="font-size: 0.7rem; color: #666;">(${n.length})</span>\n        </div>\n        <div style="font-size: 0.75rem; color: #888; margin-bottom: 0.75rem;">${t}</div>\n        <div style="border: 1px solid var(--border); border-radius: 6px; overflow: hidden; border-left: 3px solid ${s};">\n          ${n.map((e=>this.renderVendorRow(e))).join("")}\n        </div>\n      </div>\n    `},renderVendorRow(e){const t=this.isChannel(e.vendor);return`\n      <div class="vendor-list-item" style="border-bottom: 1px solid var(--border); padding: 0.6rem 0.75rem;">\n        <div class="vendor-info" style="flex: 1;">\n          <div class="vendor-name" style="font-size: 0.85rem; font-weight: 600; color: #fff;">${e.vendor}</div>\n          <div class="vendor-stats" style="font-size: 0.7rem; color: #888;">\n            ${e.contractCount} contracts • ${Utils.money(e.spend)} • ${e.marketShare}% share\n          </div>\n        </div>\n        <div class="vendor-toggle" style="display: flex; align-items: center; gap: 0.5rem;">\n          <div class="toggle-switch ${t?"active":""}" onclick="SalesPlanManager.toggleItem('${e.vendor.replace(/'/g,"\\'")}', this)">\n            <div class="toggle-slider"></div>\n          </div>\n          <div class="toggle-label" style="font-size: 0.7rem; width: 70px; color: ${t?"var(--success)":"#888"};">\n            ${t?"Channel":"Competitor"}\n          </div>\n        </div>\n      </div>\n    `},toggleItem(e,t){this.toggleChannel(e),this.renderSmartVendorList()}},App={mode:"search",currentQuery:"",searchData:{raw:[],active:[],filter:null,loaded:!1},forecastData:{spending:null,agencies:null,awards:null,analysis:null,loaded:!1},drillState:{level:0,path:[],currentAgency:null,currentSubAgency:null},subawardDrillState:{level:0,filter:null,filterType:null},activeFeedSource:"prime",onlyHighMissionGap:!1,init(){let e;SalesPlanManager.init(),Autocomplete.init("mainSearchInput"),Autocomplete.init("miniSearch"),this.setupEventDelegation(),document.getElementById("mainSearchInput").addEventListener("keypress",(e=>{"Enter"===e.key&&App.runSearch()})),document.getElementById("miniSearch").addEventListener("keypress",(e=>{"Enter"===e.key&&(document.getElementById("mainSearchInput").value=e.target.value,"forecast"===App.mode?App.runForecast(e.target.value):App.runSearch(e.target.value))})),document.getElementById("mainSearchInput").addEventListener("focus",(function(){this.select()})),document.getElementById("miniSearch").addEventListener("focus",(function(){this.select()})),function(e,t){const n=document.getElementById(e),a=document.querySelector("."+t);if(!n||!a)return;const s=n.closest(".autocomplete-wrapper");s&&a.parentNode!==s&&s.appendChild(a);const r=()=>a.classList.toggle("visible",n.value.length>0);n.addEventListener("input",r),n.addEventListener("change",r),r()}("mainSearchInput","input-clear"),window.addEventListener("resize",(()=>{clearTimeout(e),e=setTimeout((()=>{"search"===App.mode&&App.searchData?.active?.length>0&&App.renderSankey();const e=document.getElementById("subawardWrapper");App.forecastData?.subawards&&e&&"none"!==e.style.display&&App.renderSubawardSankey(App.forecastData.subawards)}),250)})),LibLoader.preloadWhenIdle();const t=new URLSearchParams(window.location.search),n=t.get("q"),a=t.get("mode");n&&(document.getElementById("mainSearchInput").value=n,"forecast"===a?App.runForecast(n):App.runSearch(n))},setupEventDelegation(){document.addEventListener("click",(e=>{const t=e.target.closest("[data-action]");if(!t)return;const n=t.dataset.action,a={search:()=>this.runSearch(),forecast:()=>this.runForecast(),showHero:()=>this.showHero(),toggleMode:()=>this.setMode("search"===this.mode?"forecast":"search"),setModeSearch:()=>this.setMode("search"),setModeForecast:()=>this.setMode("forecast"),resetDrill:()=>this.resetDrill(),clearFilter:()=>this.resetDrill(),shareLink:()=>this.shareLink(t),exportCSV:()=>this.exportCSV(t),openSalesPlan:()=>SalesPlanManager.open(),closeSalesPlan:()=>SalesPlanManager.close(),copyPrompt:()=>SalesPlanManager.copyPrompt(),generateDownload:()=>SalesPlanManager.generate(),closeSuccessModal:()=>SalesPlanManager.closeSuccessModal(),resetSubawardDrill:()=>this.resetSubawardDrill(),toggleChannel:()=>{const e=t.dataset.vendor;e&&SalesPlanManager.toggleChannel(e)},openPipelineBuilder:()=>PipelineBuilder.open(),closePipelineBuilder:()=>PipelineBuilder.close(),generatePipeline:()=>PipelineBuilder.generate(),downloadPipelineCSV:()=>PipelineBuilder.downloadCSV(),openConvoStarters:()=>ConvoStarters.open("prime"),openSubConvoStarters:()=>ConvoStarters.open("sub"),closeConvoStarters:()=>ConvoStarters.close(),copyAllConvo:()=>ConvoStarters.copyAll(),downloadConvoPDF:()=>ConvoStarters.downloadForPhone()};a[n]&&(e.preventDefault(),a[n]())}))},showHero(){document.getElementById("appView").style.display="none";const e=document.getElementById("heroView");e.style.display="flex",e.classList.remove("hidden"),setTimeout((()=>e.classList.remove("slide-up")),10)},setMode(e){App.mode=e,document.getElementById("modeSearchBtn").classList.toggle("active","search"===e),document.getElementById("modeForecastBtn").classList.toggle("active","forecast"===e),document.getElementById("searchModeView").classList.toggle("active","search"===e),document.getElementById("forecastModeView").classList.toggle("active","forecast"===e),App.currentQuery&&("search"!==e||App.searchData.loaded?"forecast"!==e||App.forecastData.loaded||App.runForecast(App.currentQuery):App.runSearch(App.currentQuery))},toggleMode(){App.setMode("search"===App.mode?"forecast":"search")},async runSearch(e){let t=e||document.getElementById("mainSearchInput").value;if(t){t=Utils.normalizeQuery(t),document.getElementById("mainSearchInput").value=t,t!==App.currentQuery&&(App.searchData={raw:[],active:[],filter:null,loaded:!1},App.forecastData={loaded:!1},App.searchGeoData=null,App.resetDrill(),App.subawardDrillState={level:0,filter:null,filterType:null}),App.currentQuery=t,App.mode="search",App.showLoader("RETRIEVING DATA...","Searching USASpending API");try{await LibLoader.loadD3(),App.searchData.raw=await API.searchAwards(t),App.searchData.active=App.searchData.raw,App.searchData.loaded=!0,App.transitionToApp(),App.setMode("search"),App.updateSearchDashboard(),this.loadSubcontractingData(t),this.loadGeoDataForSearch(t),requestAnimationFrame((()=>App.renderSankey()))}catch(e){console.error(e),alert("Error retrieving data.")}finally{App.hideLoader()}}},async loadGeoDataForSearch(e){try{const t=await API.getSpendingByGeography(e,"state");App.searchGeoData=t,App.renderSearchLocations()}catch(e){console.warn("Could not load geo data:",e)}},updateSearchDashboard(){const e=App.searchData.active;document.getElementById("stat-vol").innerText=Utils.money(e.reduce(((e,t)=>e+(t["Award Amount"]||0)),0)),document.getElementById("stat-count").innerText=e.length,document.getElementById("stat-vendors").innerText=new Set(e.map((e=>e["Recipient Name"]))).size,document.getElementById("stat-agencies").innerText=new Set(e.map((e=>e["Awarding Agency"]))).size,App.renderFeed(),App.updateDrillUI(),App.renderSearchTopWinners(e),App.renderSearchTopBuyers(e),App.renderSearchSkills(e),App.renderSearchLocations();const t=document.getElementById("convoStartersBtn");t&&(t.disabled=0===App.searchData.raw.length)},resetDrill(){App.drillState={level:0,path:[],currentAgency:null,currentSubAgency:null},App.searchData.filter=null,App.searchData.active=App.searchData.raw,App.activeFeedSource="prime";const e=document.getElementById("officesPanel");e&&(e.style.display="none"),App.updateSearchDashboard(),App.renderSankey()},updateDrillUI(){const e=document.getElementById("drillBreadcrumb"),t=document.getElementById("drillHint"),n=document.getElementById("drillLevelBadge"),a=document.getElementById("drillLevelText"),s=document.getElementById("officesPanel"),r=document.getElementById("drillControlsBar"),i=document.getElementById("filterBadge");if(0===App.drillState.level)r&&(r.style.display="none"),t.style.display="flex",document.getElementById("subagencyPanel").style.display="none",s&&(s.style.display="none"),i&&(i.style.display="none"),t.innerHTML='<i class="fas fa-mouse-pointer"></i><span>Click an <strong>agency</strong> or <strong>vendor</strong> bar to drill down</span>';else{r&&(r.style.display="block"),e.style.display="flex",n.style.display="inline-flex",i&&App.searchData.filter?(i.style.display="inline-flex",document.getElementById("filterName").innerText=Utils.trunc(App.searchData.filter,20)):i&&(i.style.display="none"),1===App.drillState.level?a.innerText="Agency View":2===App.drillState.level?a.innerText="Sub-Agency View":3===App.drillState.level&&(a.innerText="Vendor Perspective");let o='<div class="breadcrumb-item" data-action="resetDrill"><i class="fas fa-globe breadcrumb-icon"></i><span>All Agencies</span></div>';App.drillState.path.forEach(((e,t)=>{const n=t===App.drillState.path.length-1;o+=`\n        <span class="breadcrumb-separator"><i class="fas fa-chevron-right"></i></span>\n        <div class="breadcrumb-item ${n?"active":""}" onclick="${n?"":`App.drillToLevel(${t+1})`}">\n          <span>${Utils.trunc(e.name,25)}</span>\n        </div>`})),e.innerHTML=o,1===App.drillState.level?(t.innerHTML='<i class="fas fa-layer-group"></i><span>Click a <strong>sub-agency</strong> or <strong>vendor</strong> to refine</span>',App.renderSubAgencyPanel(),s&&(s.style.display="none")):2===App.drillState.level?(document.getElementById("subagencyPanel").style.display="none",s&&(s.style.display="none"),t.innerHTML='<i class="fas fa-check-circle" style="color:var(--success)"></i><span>Viewing <strong>sub-agency</strong> breakdown</span>'):(document.getElementById("subagencyPanel").style.display="none",s&&(s.style.display="none"),t.innerHTML='<i class="fas fa-check-circle" style="color:var(--success)"></i><span>Viewing filtered breakdown</span>')}},renderSubAgencyPanel(){const e=document.getElementById("subagencyList"),t=App.searchData.raw.filter((e=>e["Awarding Agency"]===App.drillState.currentAgency)),n={};t.forEach((e=>{const t=e["Awarding Sub Agency"]||"Unknown";n[t]=n[t]||{amount:0,count:0},n[t].amount+=e["Award Amount"]||0,n[t].count++}));const a=Object.entries(n).map((([e,t])=>({name:e,...t}))).sort(((e,t)=>t.amount-e.amount));document.getElementById("subagencyParentName").innerText=Utils.trunc(App.drillState.currentAgency,40),document.getElementById("subagencyTotalAmount").innerText=Utils.money(a.reduce(((e,t)=>e+t.amount),0)),document.getElementById("subagencyCount").innerText=a.length,e.innerHTML=a.map(((e,t)=>`<div class="subagency-item" onclick="App.drillToSubAgency('${e.name.replace(/'/g,"\\'")}')"><div class="subagency-item-left"><div class="subagency-rank ${t<3?"top-3":""}">${t+1}</div><div class="subagency-info"><div class="subagency-name">${e.name}</div><div class="subagency-contracts">${e.count} contracts</div></div></div><div class="subagency-item-right"><div class="subagency-bar-container"><div class="subagency-bar" style="width:${e.amount/a[0].amount*100}%"></div></div><div class="subagency-amount">${Utils.money(e.amount)}</div><i class="fas fa-chevron-right subagency-drill-icon"></i></div></div>`)).join(""),document.getElementById("subagencyPanel").style.display="block"},drillToAgency(e){App.drillState={level:1,currentAgency:e,currentSubAgency:null,path:[{type:"agency",name:e}]},App.searchData.active=App.searchData.raw.filter((t=>t["Awarding Agency"]===e)),App.searchData.filter=e,App.activeFeedSource="prime",App.updateSearchDashboard(),App.renderSankey()},drillToSubAgency(e){App.drillState.level=2,App.drillState.currentSubAgency=e,App.drillState.path=[{type:"agency",name:App.drillState.currentAgency},{type:"sub",name:e}],App.searchData.active=App.searchData.raw.filter((t=>t["Awarding Agency"]===App.drillState.currentAgency&&t["Awarding Sub Agency"]===e)),App.searchData.filter=e,App.activeFeedSource="prime",App.updateSearchDashboard(),App.renderSankey(),App.loadOfficesForSubAgency(e)},async loadOfficesForSubAgency(e){const t=document.getElementById("officesPanel"),n=document.getElementById("officesList");t.style.display="block",document.getElementById("officesSubAgencyName").innerText=Utils.trunc(e,40),n.innerHTML='<div style="text-align:center; padding:1rem; color:var(--text-muted);"><i class="fas fa-spinner fa-spin"></i> Loading offices...</div>';try{const t=await API.fetchOfficesForSubAgency(e);if(0===t.length)return n.innerHTML='<div style="text-align:center; padding:1rem; color:var(--text-muted);">No contracting offices found for this sub-agency</div>',document.getElementById("officesCount").innerText="0",void(document.getElementById("officesTotalAmount").innerText="$0");const a=[],s=new Set;t.forEach((e=>{s.has(e.code)||(s.add(e.code),a.push(e))})),document.getElementById("officesCount").innerText=a.length,document.getElementById("officesTotalAmount").innerText=Utils.money(App.searchData.active.reduce(((e,t)=>e+(t["Award Amount"]||0)),0)),n.innerHTML=a.slice(0,15).map(((e,t)=>`\n        <div class="subagency-item" style="cursor: default;">\n          <div class="subagency-item-left">\n            <div class="subagency-rank ${t<3?"top-3":""}">${t+1}</div>\n            <div class="subagency-info">\n              <div class="subagency-name">${Autocomplete.escapeHtml(e.name)}</div>\n              <div class="subagency-contracts" style="font-family: 'JetBrains Mono', monospace; font-size: 0.7rem;">${Autocomplete.escapeHtml(e.code||"N/A")}</div>\n            </div>\n          </div>\n          <div class="subagency-item-right">\n            <i class="fas fa-briefcase" style="color: var(--text-muted); opacity: 0.5;"></i>\n          </div>\n        </div>\n      `)).join("")}catch(e){console.error("Error loading offices:",e),n.innerHTML='<div style="text-align:center; padding:1rem; color:var(--text-muted);">Error loading offices</div>'}},drillToLevel(e){App.searchData.active=App.searchData.raw,0===e?App.resetDrill():1===e?App.drillToAgency(App.drillState.path[0].name):2===e&&App.drillToSubAgency(App.drillState.path[1].name)},drillDown(e){const t=App.searchData.raw,n=t.find((t=>t["Awarding Agency"]===e)),a=t.find((t=>t["Awarding Sub Agency"]===e)),s=t.find((t=>t["Recipient Name"]===e));if(App.searchData.active=t,n&&!a)App.drillToAgency(e);else if(a){const t=a["Awarding Agency"];App.drillState.currentAgency=t,App.drillToSubAgency(e)}else s&&(3===App.drillState.level&&App.drillState.path.pop(),App.drillState.level=3,App.drillState.path.push({type:"vendor",name:e}),App.searchData.filter=`Vendor: ${e}`,App.activeFeedSource="prime",App.searchData.active=t.filter((t=>t["Recipient Name"]===e)),App.updateSearchDashboard(),App.renderSankey())},clearFilter(){App.drillState.level>0?App.resetDrill():(App.searchData.filter=null,App.searchData.active=App.searchData.raw,App.activeFeedSource="prime",App.updateSearchDashboard(),App.renderSankey())},renderSankey(){const e=document.getElementById("chartContainer");e.innerHTML="";const t=App.searchData.active;if(!t||0===t.length)return void(e.innerHTML='<div style="text-align:center; padding:4rem; color:#666">No data available for this view.</div>');e.innerHTML='<svg id="sankeySvg"></svg>';const n=0===App.drillState.level,a={};t.forEach((e=>{if(e["Award Amount"]>0){const t=((n?e["Awarding Agency"]:e["Awarding Sub Agency"])||e["Awarding Agency"]||"Unknown Agency")+"|||"+(e["Recipient Name"]||"Unknown Vendor");a[t]=(a[t]||0)+e["Award Amount"]}}));const s=Object.entries(a).sort(((e,t)=>t[1]-e[1])),r=App.drillState.level>0?50:25,i=s.slice(0,r),o=s.slice(r),l=new Set,c=[];if(i.forEach((([e,t])=>{const[n,a]=e.split("|||");l.add(n),l.add(a),c.push({source:n,target:a,value:t})})),o.length>0){const e={};o.forEach((([t,n])=>{const[a]=t.split("|||");l.has(a)&&(e[a]=(e[a]||0)+n)})),Object.entries(e).forEach((([e,t])=>{const n=`Other (${o.length} Vendors)`;l.add(n),c.push({source:e,target:n,value:t})}))}const d=Array.from(l).map((e=>({name:e}))),p=new Map(d.map(((e,t)=>[e.name,t]))),u=c.map((e=>({source:p.get(e.source),target:p.get(e.target),value:e.value}))),m=((e.parentElement?e.parentElement.offsetWidth:e.offsetWidth)||800)-2,g=Math.max(500,28*d.length),h=d3.select("#sankeySvg").attr("width",m).attr("height",g),y=d3.sankey().nodeId((e=>e.index)).nodeWidth(20).nodePadding(20).extent([[1,1],[m-1,g-6]]),{nodes:f,links:v}=y({nodes:d.map((e=>Object.assign({},e))),links:u.map((e=>Object.assign({},e)))}),A=e=>!(!e||e.startsWith("Other")||e.includes("Unknown")||"No Description"===e)&&App.searchData.raw.some((t=>t["Awarding Agency"]===e||t["Awarding Sub Agency"]===e||t["Recipient Name"]===e));h.append("g").selectAll("rect").data(f).join("rect").attr("x",(e=>e.x0)).attr("y",(e=>e.y0)).attr("height",(e=>e.y1-e.y0)).attr("width",(e=>e.x1-e.x0)).attr("fill",(e=>Utils.getColor(e.name))).attr("opacity",.8).attr("stroke","none").style("cursor",(e=>A(e.name)?"pointer":"default")).on("click",((e,t)=>{A(t.name)&&App.drillDown(t.name)})).append("title").text((e=>`${e.name}\n${Utils.money(e.value)}`));const b=h.append("defs");v.forEach(((e,t)=>{const n=b.append("linearGradient").attr("id","g"+t).attr("gradientUnits","userSpaceOnUse").attr("x1",e.source.x1).attr("x2",e.target.x0);n.append("stop").attr("offset","0%").attr("stop-color",Utils.getColor(e.source.name)),n.append("stop").attr("offset","100%").attr("stop-color",Utils.getColor(e.target.name))})),h.append("g").attr("fill","none").selectAll("path").data(v).join("path").attr("d",d3.sankeyLinkHorizontal()).attr("stroke",((e,t)=>"url(#g"+t+")")).attr("stroke-width",(e=>Math.max(1,e.width))).attr("stroke-opacity",.4),h.append("g").selectAll("text").data(f).join("text").attr("x",(e=>e.x0<m/2?e.x1+6:e.x0-6)).attr("y",(e=>(e.y1+e.y0)/2)).attr("dy","0.35em").attr("text-anchor",(e=>e.x0<m/2?"start":"end")).text((e=>Utils.trunc(e.name,40))).style("font-size","11px").style("fill","#fff").style("pointer-events","none")},renderFeed(){const e=document.getElementById("feedGrid");if("sub"===App.activeFeedSource&&App.forecastData.subawards)return void this.renderSubawardFeed(e);const t=App.searchData.active;0!==t.length?e.innerHTML=t.map((e=>{const t=e.generated_internal_id;let n="#";t?n=`https://www.usaspending.gov/award/${t}`:e["Award ID"]&&(n=`https://www.usaspending.gov/search/?hash=&filters=${encodeURIComponent(JSON.stringify({keyword:e["Award ID"]}))}`);let a="";e["NAICS Code"]&&(a+=`<span class="meta-tag naics" title="${Autocomplete.escapeHtml(e["NAICS Description"]||"")}">NAICS: ${Autocomplete.escapeHtml(e["NAICS Code"])}</span>`),e["PSC Code"]&&(a+=`<span class="meta-tag psc" title="${Autocomplete.escapeHtml(e["PSC Description"]||"")}">PSC: ${Autocomplete.escapeHtml(e["PSC Code"])}</span>`);const s=e["Awarding Sub Agency"],r=s&&s!==e["Awarding Agency"]?`${Utils.trunc(e["Awarding Agency"],20)} → ${Utils.trunc(s,20)}`:Utils.trunc(e["Awarding Agency"],35),i=e["Recipient Name"]||"Unknown Vendor",o=Autocomplete.escapeHtml(i),l=Autocomplete.escapeHtml(Utils.trunc(e.Description,100)),c=Autocomplete.escapeHtml(r),d=JobLinks.getLinkedInUrl(i),p=JobLinks.getLinkedInPeopleUrl(i),u=JobLinks.getLinkedInNewsUrl(i);return`<div class="deal-card">\n    <div class="deal-header"><span class="deal-agency">${c}</span><span class="deal-amount">${Utils.money(e["Award Amount"])}</span></div>\n    <div class="deal-desc">${l}</div>\n    <div class="deal-vendor">${o} <a href="${p}" target="_blank" class="job-link" style="margin-left:6px;" title="Find contacts at this company"><i class="fab fa-linkedin"></i> People</a> <a href="${d}" target="_blank" class="job-link" title="Search jobs at this company"><i class="fab fa-linkedin"></i> Jobs</a> <a href="${u}" target="_blank" class="job-link" title="LinkedIn posts about this company"><i class="fas fa-newspaper"></i> News</a></div>\n    ${a?`<div class="deal-meta">${a}</div>`:""}\n    <div class="deal-footer"><span class="deal-date">Start: ${Utils.date(e["Start Date"])}${e["End Date"]?" → "+Utils.date(e["End Date"]):""}</span><a href="${n}" target="_blank" class="action-btn">OPEN AWARD <i class="fas fa-external-link-alt"></i></a></div>\n  </div>`})).join(""):e.innerHTML='<div style="text-align:center; padding:2rem; color:#666">No contracts found.</div>'},renderSubawardFeed(e){let t=App.forecastData.subawards||[];const n=App.subawardDrillState;n.level>0&&n.filter&&("prime"===n.filterType?t=t.filter((e=>(e["Prime Recipient Name"]||"Unknown Prime")===n.filter)):"sub"===n.filterType?t=t.filter((e=>(e["Sub-Awardee Name"]||"Unknown Sub")===n.filter)):"agency"===n.filterType&&(t=t.filter((e=>(e["Awarding Agency"]||e["Awarding Sub Agency"]||"Unknown Agency")===n.filter)))),0!==t.length?(t=[...t].sort(((e,t)=>(parseFloat(t["Sub-Award Amount"])||0)-(parseFloat(e["Sub-Award Amount"])||0))),e.innerHTML=t.slice(0,50).map((e=>{const t=e["Prime Recipient Name"]||"Unknown Prime",n=e["Sub-Awardee Name"]||"Unknown Sub",a=parseFloat(e["Sub-Award Amount"])||0,s=e["Sub-Award Date"],r=e["Awarding Agency"]||e["Awarding Sub Agency"]||"",i=e.prime_award_generated_internal_id||"";let o="";i&&(o=`https://www.usaspending.gov/award/${i}`);const l=Autocomplete.escapeHtml(Utils.trunc(t,25)),c=Autocomplete.escapeHtml(Utils.trunc(n,25)),d=JobLinks.getLinkedInPeopleUrl(t),p=JobLinks.getLinkedInPeopleUrl(n);return`<div class="deal-card" style="border-left-color: #E5C07B;">\n        <div class="deal-header">\n          <span class="deal-agency" style="color: #E5C07B;">SUBCONTRACT</span>\n          <span class="deal-amount">${Utils.money(a)}</span>\n        </div>\n        <div class="deal-desc" style="font-size: 0.8rem;">\n          <strong>${l}</strong> <i class="fas fa-arrow-right" style="margin: 0 6px; opacity: 0.5;"></i> <strong>${c}</strong>\n        </div>\n        <div class="deal-vendor" style="font-size: 0.75rem; color: var(--text-muted);">\n          ${r?`Agency: ${Autocomplete.escapeHtml(Utils.trunc(r,30))}`:""}\n        </div>\n        <div class="deal-footer">\n          <span class="deal-date">${s?Utils.date(s):"Date N/A"}</span>\n          <div style="display: flex; gap: 0.5rem; align-items: center;">\n            <a href="${d}" target="_blank" class="job-link" title="Find contacts at prime"><i class="fab fa-linkedin"></i> Prime</a>\n            <a href="${p}" target="_blank" class="job-link" title="Find contacts at sub"><i class="fab fa-linkedin"></i> Sub</a>\n            ${o?`<a href="${o}" target="_blank" class="action-btn" style="font-size: 0.65rem; padding: 0.25rem 0.5rem;">OPEN AWARD <i class="fas fa-external-link-alt"></i></a>`:""}\n          </div>\n        </div>\n      </div>`})).join("")):e.innerHTML='<div style="text-align:center; padding:2rem; color:#666">No subcontracts found.</div>'},renderSearchTopBuyers(e){const t=document.getElementById("searchTopBuyersBody");if(!t)return;if(!e||0===e.length)return void(t.innerHTML='<div class="muted text-xs" style="text-align:center;">No agency data available</div>');const n={};e.forEach((e=>{const t=e["Awarding Agency"]||"Unknown";n[t]||(n[t]={name:t,spend:0,count:0}),n[t].spend+=parseFloat(e["Award Amount"])||0,n[t].count++}));const a=Object.values(n).sort(((e,t)=>t.spend-e.spend)),s=a.slice(0,5);t.innerHTML=`\n    <div class="compact-winner-list">\n      ${s.map(((e,t)=>{const n=JobLinks.getLinkedInPeopleUrl(e.name),a=`https://www.usajobs.gov/Search/Results?k=${encodeURIComponent(e.name)}`,s=JobLinks.getLinkedInNewsUrl(e.name);return`\n        <div class="compact-winner-item">\n          <div class="compact-winner-rank">${t+1}</div>\n          <div class="compact-winner-info">\n            <div class="compact-winner-name">${Utils.trunc(e.name,28)}</div>\n            <div class="compact-winner-meta">${Utils.money(e.spend)} · ${e.count} awards</div>\n            <div class="job-links" style="margin-top:4px;">\n              <a href="${n}" target="_blank" class="job-link" title="Find contacts at this agency"><i class="fab fa-linkedin"></i> People</a>\n              <a href="${a}" target="_blank" class="job-link" title="Federal jobs at this agency"><i class="fas fa-flag-usa"></i> Jobs</a>\n              <a href="${s}" target="_blank" class="job-link" title="LinkedIn posts about this agency"><i class="fas fa-newspaper"></i> News</a>\n            </div>\n          </div>\n        </div>`})).join("")}\n    </div>\n    ${a.length>5?`<div class="text-xs muted" style="text-align:center; margin-top:0.5rem;">+${a.length-5} more agencies</div>`:""}\n  `},renderSearchTopWinners(e){const t=document.getElementById("searchTopWinnersBody");if(!t)return;if(!e||0===e.length)return void(t.innerHTML='<div class="muted text-xs" style="text-align:center;">No vendor data available</div>');const n={};e.forEach((e=>{const t=e["Recipient Name"]||"Unknown";n[t]||(n[t]={name:t,spend:0,count:0}),n[t].spend+=parseFloat(e["Award Amount"])||0,n[t].count++}));const a=Object.values(n).sort(((e,t)=>t.spend-e.spend)),s=a.slice(0,5);t.innerHTML=`\n    <div class="compact-winner-list">\n      ${s.map(((e,t)=>{const n=JobLinks.getLinkedInUrl(e.name),a=JobLinks.getLinkedInPeopleUrl(e.name),s=JobLinks.getLinkedInNewsUrl(e.name);return`\n        <div class="compact-winner-item">\n          <div class="compact-winner-rank">${t+1}</div>\n          <div class="compact-winner-info">\n            <div class="compact-winner-name">${Utils.trunc(e.name,28)}</div>\n            <div class="compact-winner-meta">${Utils.money(e.spend)} · ${e.count} awards</div>\n            <div class="job-links" style="margin-top:4px;">\n              <a href="${a}" target="_blank" class="job-link" title="Find contacts at this company"><i class="fab fa-linkedin"></i> People</a>\n              <a href="${n}" target="_blank" class="job-link" title="Search jobs on LinkedIn"><i class="fab fa-linkedin"></i> Jobs</a>\n              <a href="${s}" target="_blank" class="job-link" title="LinkedIn posts about this company"><i class="fas fa-newspaper"></i> News</a>\n            </div>\n          </div>\n        </div>`})).join("")}\n    </div>\n    ${a.length>5?`<div class="text-xs muted" style="text-align:center; margin-top:0.5rem;">+${a.length-5} more vendors in results</div>`:""}\n  `},renderSearchTopPrimes(e){const t=document.getElementById("searchTopPrimesBody");if(!t)return;if(!e||0===e.length)return void(t.innerHTML='<div class="muted text-xs" style="text-align:center;">No subcontract data available</div>');let n=e;const a=App.subawardDrillState;a.level>0&&a.filter&&("prime"===a.filterType?n=e.filter((e=>(e["Prime Recipient Name"]||"Unknown Prime")===a.filter)):"sub"===a.filterType?n=e.filter((e=>(e["Sub-Awardee Name"]||"Unknown Sub")===a.filter)):"agency"===a.filterType&&(n=e.filter((e=>(e["Awarding Agency"]||e["Awarding Sub Agency"]||"Unknown Agency")===a.filter))));const s={};n.forEach((e=>{const t=e["Prime Recipient Name"]||"Unknown";s[t]||(s[t]={name:t,spend:0,count:0}),s[t].spend+=parseFloat(e["Sub-Award Amount"])||0,s[t].count++}));const r=Object.values(s).sort(((e,t)=>t.spend-e.spend)),i=r.slice(0,5);t.innerHTML=`\n      <div class="compact-winner-list">\n        ${i.map(((e,t)=>{const n=JobLinks.getLinkedInUrl(e.name),a=JobLinks.getLinkedInPeopleUrl(e.name),s=JobLinks.getLinkedInNewsUrl(e.name);return`\n          <div class="compact-winner-item">\n            <div class="compact-winner-rank">${t+1}</div>\n            <div class="compact-winner-info">\n              <div class="compact-winner-name">${Utils.trunc(e.name,28)}</div>\n              <div class="compact-winner-meta">${Utils.money(e.spend)} · ${e.count} subawards</div>\n              <div class="job-links" style="margin-top:4px;">\n                <a href="${a}" target="_blank" class="job-link" title="Find contacts at this company"><i class="fab fa-linkedin"></i> People</a>\n                <a href="${n}" target="_blank" class="job-link" title="Search jobs on LinkedIn"><i class="fab fa-linkedin"></i> Jobs</a>\n                <a href="${s}" target="_blank" class="job-link" title="LinkedIn posts about this company"><i class="fas fa-newspaper"></i> News</a>\n              </div>\n            </div>\n          </div>`})).join("")}\n      </div>\n      ${r.length>5?`<div class="text-xs muted" style="text-align:center; margin-top:0.5rem;">+${r.length-5} more primes in results</div>`:""}\n    `},renderSearchTopSubs(e){const t=document.getElementById("searchTopSubsBody");if(!t)return;if(!e||0===e.length)return void(t.innerHTML='<div class="muted text-xs" style="text-align:center;">No subcontract data available</div>');let n=e;const a=App.subawardDrillState;a.level>0&&a.filter&&("prime"===a.filterType?n=e.filter((e=>(e["Prime Recipient Name"]||"Unknown Prime")===a.filter)):"sub"===a.filterType?n=e.filter((e=>(e["Sub-Awardee Name"]||"Unknown Sub")===a.filter)):"agency"===a.filterType&&(n=e.filter((e=>(e["Awarding Agency"]||e["Awarding Sub Agency"]||"Unknown Agency")===a.filter))));const s={};n.forEach((e=>{const t=e["Sub-Awardee Name"]||"Unknown";s[t]||(s[t]={name:t,spend:0,count:0}),s[t].spend+=parseFloat(e["Sub-Award Amount"])||0,s[t].count++}));const r=Object.values(s).sort(((e,t)=>t.spend-e.spend)),i=r.slice(0,5);t.innerHTML=`\n      <div class="compact-winner-list">\n        ${i.map(((e,t)=>{const n=JobLinks.getLinkedInUrl(e.name),a=JobLinks.getLinkedInPeopleUrl(e.name),s=JobLinks.getLinkedInNewsUrl(e.name);return`\n          <div class="compact-winner-item">\n            <div class="compact-winner-rank">${t+1}</div>\n            <div class="compact-winner-info">\n              <div class="compact-winner-name">${Utils.trunc(e.name,28)}</div>\n              <div class="compact-winner-meta">${Utils.money(e.spend)} · ${e.count} subawards</div>\n              <div class="job-links" style="margin-top:4px;">\n                <a href="${a}" target="_blank" class="job-link" title="Find contacts at this company"><i class="fab fa-linkedin"></i> People</a>\n                <a href="${n}" target="_blank" class="job-link" title="Search jobs on LinkedIn"><i class="fab fa-linkedin"></i> Jobs</a>\n                <a href="${s}" target="_blank" class="job-link" title="LinkedIn posts about this company"><i class="fas fa-newspaper"></i> News</a>\n              </div>\n            </div>\n          </div>`})).join("")}\n      </div>\n      ${r.length>5?`<div class="text-xs muted" style="text-align:center; margin-top:0.5rem;">+${r.length-5} more subcontractors in results</div>`:""}\n    `},renderSearchSkills(e){const t=document.getElementById("searchSkillsBody");if(!t)return;if(!e||0===e.length)return void(t.innerHTML='<div class="muted text-xs" style="text-align:center;">No skills data available</div>');const n=SkillsExtractor.extract(e);if(0===n.length)return void(t.innerHTML='<div class="muted text-xs" style="text-align:center;">No specific skills detected in award descriptions</div>');const a=n[0]?.percentage||100;t.innerHTML=`\n      ${n.slice(0,5).map((e=>`\n        <div class="skill-bar-container">\n          <div class="skill-bar-label">\n            <span class="skill-bar-name">${e.skill}</span>\n            <span class="skill-bar-pct">${e.percentage}%</span>\n          </div>\n          <div class="skill-bar">\n            <div class="skill-bar-fill" style="width: ${e.percentage/a*100}%"></div>\n          </div>\n        </div>\n      `)).join("")}\n      <div class="text-xs" style="margin-top: 0.75rem; color: var(--text-muted); font-style: italic;">\n        <i class="fas fa-lightbulb" style="color: var(--accent);"></i> \n        These skills appear most in current results\n      </div>\n    `},renderSearchLocations(){const e=document.getElementById("searchLocationsBody");if(!e)return;const t=App.searchGeoData;if(!t||0===t.length)return void(e.innerHTML='<div class="muted text-xs" style="text-align:center;">Loading location data...</div>');const n=t.sort(((e,t)=>t.aggregated_amount-e.aggregated_amount)).slice(0,5),a=t.reduce(((e,t)=>e+t.aggregated_amount),0);e.innerHTML=`\n      <div class="compact-location-list">\n        ${n.map(((e,t)=>{const n=e.state_code||e.shape_code||"XX",s=US_STATES[n]||n,r=a>0?Math.round(e.aggregated_amount/a*100):0;return`\n          <div class="compact-location-item">\n            <div class="compact-location-rank">${t+1}</div>\n            <div class="compact-location-info">\n              <div class="compact-location-name">${s}</div>\n              <div class="compact-location-meta">${Utils.money(e.aggregated_amount)} · ${r}%</div>\n            </div>\n          </div>`})).join("")}\n      </div>\n      ${t.length>5?`<div class="text-xs muted" style="text-align:center; margin-top:0.5rem;">+${t.length-5} more states</div>`:""}\n    `},async runForecast(e){let t=e||document.getElementById("mainSearchInput").value;if(t){if(t=Utils.normalizeQuery(t),document.getElementById("mainSearchInput").value=t,t!==App.currentQuery&&(App.searchData={loaded:!1},App.forecastData={spending:null,agencies:null,awards:null,analysis:null,loaded:!1}),await LibLoader.ensureAll(),"undefined"!=typeof Chart){const e=Chart.getChart("spendingChart");e&&e.destroy()}App.currentQuery=t,App.mode="forecast",App.showLoader("CRUNCHING NUMBERS...","Applying Recency-Weighted Seasonality");try{const[e,n,a]=await Promise.all([API.getSpendingOverTime(t),API.getAgencyData(t),API.getAwardsForForecast(t)]);App.forecastData={spending:e,agencies:n,awards:a,analysis:ForecastEngine.analyze(e,a,n),loaded:!0},App.transitionToApp(),App.setMode("forecast"),App.renderForecastDashboard()}catch(e){console.error(e),App.showToast("Error fetching forecast data.","error")}finally{App.hideLoader()}}},renderForecastDashboard(){const e=App.forecastData.analysis;if(!e||!e.byFY)return void(document.getElementById("projectionSummary").innerHTML='<div style="padding:1rem; color:var(--danger)">Insufficient data for forecast analysis.</div>');const t=App.forecastData.awards||[],n=t.reduce(((e,t)=>e+(parseFloat(t["Potential Total Value of Award"])||parseFloat(t["Award Amount"])||0)),0);if(!e)return;t.reduce(((e,t)=>e+(parseFloat(t["Potential Total Value of Award"])||parseFloat(t["Award Amount"])||0)),0);const a=Utils.getCurrentFY(),s=Utils.getCurrentQuarter(),r=e.byFY||{},i=(Object.keys(r).map(Number).sort(),a-1),o=r[i]?Object.values(r[i]).reduce(((e,t)=>e+t),0):0,l=r[i-1]?Object.values(r[i-1]).reduce(((e,t)=>e+t),0):0;let c=0,d="No prior data";l>0&&o>0&&(c=(o-l)/l*100,d=c>=0?"Obligations growing":"Obligations declining");const p=this.calculateRollingForecast(e.byFY,a,s,c),u=p.reduce(((e,t)=>e+t.projection),0);document.getElementById("stat-total-awards").innerText=Utils.money(n),document.getElementById("stat-total-obligations").innerText=Utils.money(o);const m=document.getElementById("stat-yoy-change"),g=document.getElementById("stat-yoy-direction");l>0&&o>0?(m.innerText=`${c>=0?"+":""}${c.toFixed(0)}%`,m.style.color=c>=0?"var(--success)":"var(--danger)",g.innerText=d,g.style.color=c>=0?"var(--success)":"var(--danger)"):(m.innerText="N/A",m.style.color="var(--text-muted)",g.innerText="Insufficient history",g.className="stat-sub neutral"),document.getElementById("stat-recompetes").innerText=e.recompetes.length,this.renderForecastTable(p,o,c,u,e,t),this.renderTopBuyers(t),this.renderTopWinners(t);const h=document.getElementById("spendingChart").getContext("2d"),y=Object.keys(e.byFY).sort(),f=getComputedStyle(document.documentElement).getPropertyValue("--accent").trim();new Chart(h,{type:"bar",data:{labels:y.map((e=>`FY${String(e).slice(-2)}`)),datasets:[{label:"Q1",data:y.map((t=>e.byFY[t][1]||0)),backgroundColor:f},{label:"Q2",data:y.map((t=>e.byFY[t][2]||0)),backgroundColor:f},{label:"Q3",data:y.map((t=>e.byFY[t][3]||0)),backgroundColor:f},{label:"Q4",data:y.map((t=>e.byFY[t][4]||0)),backgroundColor:f}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{stacked:!1,grid:{display:!1},ticks:{color:"#888"}},y:{stacked:!1,grid:{color:"#333"},ticks:{color:"#888",callback:e=>Utils.money(e)}}},plugins:{legend:{display:!1},tooltip:{callbacks:{label:e=>`${e.dataset.label}: ${Utils.money(e.raw)}`}}}}}),this.renderRecompetes(e.recompetes)},async loadSubcontractingData(e){const t=document.getElementById("subcontractingBody");document.getElementById("subcontractingStats");if(t){t.innerHTML='<div style="text-align:center; padding:2rem; color:var(--text-muted);"><i class="fas fa-spinner fa-spin"></i> Loading subaward flow...</div>';try{const t=await API.getSubawards(e);App.forecastData.subawards=t,this.renderSubawardSankey(t),this.renderSearchTopPrimes(t),this.renderSearchTopSubs(t)}catch(e){console.error(e),t.innerHTML='<div style="text-align:center; padding:1rem; color:var(--text-muted); font-size:0.85rem;">Unable to load subaward data</div>'}}},renderSubawardSankey(e){const t=document.getElementById("subawardWrapper"),n=document.getElementById("subcontractingBody"),a=document.getElementById("subcontractingStats"),s=document.getElementById("subcontractingLegend"),r=document.getElementById("subConvoStartersPanel");if(!t||!n)return;if(s&&(s.style.display="none"),!e||0===e.length)return t.style.display="none",r&&(r.style.display="none"),void(a&&(a.innerHTML=""));t.style.display="block",r&&(r.style.display="flex");let i=e;const o=App.subawardDrillState;o.level>0&&o.filter&&("prime"===o.filterType?i=e.filter((e=>(e["Prime Recipient Name"]||"Unknown Prime")===o.filter)):"sub"===o.filterType?i=e.filter((e=>(e["Sub-Awardee Name"]||"Unknown Sub")===o.filter)):"agency"===o.filterType&&(i=e.filter((e=>(e["Awarding Agency"]||e["Awarding Sub Agency"]||"Unknown Agency")===o.filter))));const l={};let c=0;i.forEach((e=>{const t=e["Awarding Agency"]||e["Awarding Sub Agency"]||"Unknown Agency",n=e["Prime Recipient Name"]||"Unknown Prime",a=e["Sub-Awardee Name"]||"Unknown Sub",s=parseFloat(e["Sub-Award Amount"])||0;if(s>0){const e=`${t}|||${n}`;l[e]=(l[e]||0)+s;const r=`${n}|||${a}`;l[r]=(l[r]||0)+s,c+=s}})),a&&(a.innerHTML=`${Utils.money(c)} subaward flow · ${i.length} records`);const d=Object.entries(l).sort(((e,t)=>t[1]-e[1])).slice(0,40),p=new Set,u=[];if(d.forEach((([e,t])=>{const[n,a]=e.split("|||");p.add(n),p.add(a),u.push({source:n,target:a,value:t})})),0===u.length)return void(t.style.display="none");const m=Array.from(p).map((e=>({name:e}))),g=new Map(m.map(((e,t)=>[e.name,t]))),h=u.map((e=>({source:g.get(e.source),target:g.get(e.target),value:e.value})));let y="";if(o.level>0){const e="prime"===o.filterType?"Prime":"sub"===o.filterType?"Subcontractor":"Agency";y=`\n        <div class="drill-breadcrumb" style="display: flex; margin-bottom: 0.75rem;">\n          <div class="breadcrumb-item" onclick="App.resetSubawardDrill()" style="cursor:pointer;">\n            <i class="fas fa-stream breadcrumb-icon"></i>\n            <span>All Subawards</span>\n          </div>\n          <span class="breadcrumb-separator"><i class="fas fa-chevron-right"></i></span>\n          <div class="breadcrumb-item active">\n            <span>${Utils.trunc(o.filter,30)}</span>\n            <span style="font-size:0.65rem; color:var(--text-muted); margin-left:6px;">(${e})</span>\n          </div>\n        </div>\n      `}n.innerHTML=`\n      ${y}\n      <div id="subawardDrillHint" class="drill-hint" style="margin-bottom: 0.5rem; ${o.level>0?"display:none;":""}">\n        <i class="fas fa-mouse-pointer"></i>\n        <span>Click a <strong>prime</strong> or <strong>subcontractor</strong> bar to drill down</span>\n      </div>\n      <svg id="subawardSankeySvg"></svg>\n    `;const f=n.offsetWidth||800,v=Math.max(350,20*m.length),A=d3.select("#subawardSankeySvg").attr("width",f).attr("height",v),b=d3.sankey().nodeId((e=>e.index)).nodeWidth(20).nodePadding(20).extent([[1,1],[f-1,v-6]]),{nodes:w,links:S}=b({nodes:m.map((e=>Object.assign({},e))),links:h.map((e=>Object.assign({},e)))}),I=new Set(i.map((e=>e["Prime Recipient Name"]||"Unknown Prime"))),C=(new Set(i.map((e=>e["Sub-Awardee Name"]||"Unknown Sub"))),new Set(i.map((e=>e["Awarding Agency"]||e["Awarding Sub Agency"]||"Unknown Agency"))));w.forEach((e=>{C.has(e.name)&&!I.has(e.name)?e.nodeType="agency":I.has(e.name)?e.nodeType="prime":e.nodeType="sub"}));const E=A.append("defs");S.forEach(((e,t)=>{const n=Utils.getColor(e.source.name),a=Utils.getColor(e.target.name),s=E.append("linearGradient").attr("id",`sub-gradient-${t}`).attr("gradientUnits","userSpaceOnUse").attr("x1",e.source.x1).attr("x2",e.target.x0);s.append("stop").attr("offset","0%").attr("stop-color",n),s.append("stop").attr("offset","100%").attr("stop-color",a)})),A.append("g").attr("fill","none").selectAll("path").data(S).join("path").attr("d",d3.sankeyLinkHorizontal()).attr("stroke",((e,t)=>`url(#sub-gradient-${t})`)).attr("stroke-width",(e=>Math.max(1,e.width))).attr("stroke-opacity",.4).on("mouseover",(function(){d3.select(this).attr("stroke-opacity",.8)})).on("mouseout",(function(){d3.select(this).attr("stroke-opacity",.4)})).append("title").text((e=>`${e.source.name} → ${e.target.name}\n${Utils.money(e.value)}`)),A.append("g").selectAll("rect").data(w).join("rect").attr("x",(e=>e.x0)).attr("y",(e=>e.y0)).attr("height",(e=>Math.max(1,e.y1-e.y0))).attr("width",(e=>e.x1-e.x0)).attr("fill",(e=>Utils.getColor(e.name))).attr("opacity",.8).style("cursor","pointer").on("click",(function(e,t){App.drillSubaward(t.name,t.nodeType)})).on("mouseover",(function(){d3.select(this).attr("opacity",1)})).on("mouseout",(function(){d3.select(this).attr("opacity",.8)})).append("title").text((e=>`${e.name}\n${Utils.money(e.value)}\nClick to filter`)),A.append("g").selectAll("text").data(w).join("text").attr("x",(e=>e.x0<f/2?e.x1+6:e.x0-6)).attr("y",(e=>(e.y1+e.y0)/2)).attr("dy","0.35em").attr("text-anchor",(e=>e.x0<f/2?"start":"end")).text((e=>Utils.trunc(e.name,40))).style("font-size","11px").style("fill","#fff").style("pointer-events","none")},drillSubaward(e,t){App.subawardDrillState={level:1,filter:e,filterType:t},App.activeFeedSource="sub",App.forecastData.subawards&&(App.renderSubawardSankey(App.forecastData.subawards),App.renderSearchTopPrimes(App.forecastData.subawards),App.renderSearchTopSubs(App.forecastData.subawards),App.renderFeed())},resetSubawardDrill(){App.subawardDrillState={level:0,filter:null,filterType:null},App.activeFeedSource="sub",App.forecastData.subawards&&(App.renderSubawardSankey(App.forecastData.subawards),App.renderSearchTopPrimes(App.forecastData.subawards),App.renderSearchTopSubs(App.forecastData.subawards),App.renderFeed())},renderTopBuyers(e){const t=document.getElementById("topBuyersBody");if(!t)return;const n={};e.forEach((e=>{const t=e["Awarding Agency"]||"Unknown";n[t]||(n[t]={name:t,spend:0,count:0}),n[t].spend+=parseFloat(e["Award Amount"])||0,n[t].count++}));const a=Object.values(n).sort(((e,t)=>t.spend-e.spend)),s=a.reduce(((e,t)=>e+t.spend),0);if(0===a.length)return void(t.innerHTML='<div style="text-align:center; color:var(--text-muted); padding:1rem;">No agency data available</div>');const r=a.slice(0,8);t.innerHTML=`\n      <div class="buyer-list">\n        ${r.map(((e,t)=>{const n=s>0?e.spend/s*100:0;return`\n          <div class="buyer-item">\n            <div class="buyer-rank mono text-xs bold accent">${t+1}</div>\n            <div class="buyer-info">\n              <div class="buyer-name truncate">${Utils.trunc(e.name,40)}</div>\n              <div class="buyer-stats text-xs muted">${e.count} contracts</div>\n            </div>\n            <div class="buyer-amount">\n              <div class="buyer-spend mono accent">${Utils.money(e.spend)}</div>\n              <div class="buyer-share text-xs muted">${n.toFixed(1)}%</div>\n            </div>\n          </div>`})).join("")}\n      </div>\n      ${a.length>8?`<div style="text-align:center; color:var(--text-muted); font-size:0.75rem; margin-top:0.75rem;">+${a.length-8} more agencies</div>`:""}\n    `},renderTopWinners(e){const t=document.getElementById("topWinnersBody");if(!t)return;const n={};e.forEach((e=>{const t=e["Recipient Name"]||"Unknown";n[t]||(n[t]={name:t,spend:0,count:0,agencies:new Set}),n[t].spend+=parseFloat(e["Award Amount"])||0,n[t].count++,n[t].agencies.add(e["Awarding Agency"]||"Unknown")}));const a=Object.values(n).map((e=>({...e,agencies:e.agencies.size}))).sort(((e,t)=>t.spend-e.spend)),s=a.reduce(((e,t)=>e+t.spend),0);if(0===a.length)return void(t.innerHTML='<div style="text-align:center; color:var(--text-muted); padding:1rem;">No vendor data available</div>');const r=a.slice(0,8);t.innerHTML=`\n      <div class="buyer-list">\n        ${r.map(((e,t)=>{const n=s>0?e.spend/s*100:0;return`\n          <div class="buyer-item">\n            <div class="buyer-rank mono text-xs bold accent">${t+1}</div>\n            <div class="buyer-info">\n              <div class="buyer-name truncate">${Utils.trunc(e.name,35)}</div>\n              <div class="buyer-stats text-xs muted">${e.count} contracts · ${e.agencies} ${1===e.agencies?"agency":"agencies"}</div>\n            </div>\n            <div class="buyer-amount">\n              <div class="buyer-spend mono accent">${Utils.money(e.spend)}</div>\n              <div class="buyer-share text-xs muted">${n.toFixed(1)}%</div>\n            </div>\n          </div>`})).join("")}\n      </div>\n      ${a.length>8?`<div style="text-align:center; color:var(--text-muted); font-size:0.75rem; margin-top:0.75rem;">+${a.length-8} more vendors</div>`:""}\n    `},renderRecompetes(e){const t=document.getElementById("recompetesList");if(!t)return;if(!e||0===e.length)return void(t.innerHTML="");const n=e.map((e=>({...e,risk:Utils.missionGapRisk(e)}))),a=n.reduce(((e,t)=>e+(parseFloat(t["Award Amount"])||0)),0),s=n.filter((e=>"high"===e.risk.level)),r=s.reduce(((e,t)=>e+(parseFloat(t["Award Amount"])||0)),0),i=App.onlyHighMissionGap?n.filter((e=>"high"===e.risk.level)):n;let o=`${Utils.money(a)} in ${e.length} contracts expiring within 24 months`;s.length>0&&(o+=` · <span style="color:var(--danger); font-weight:600;">${s.length} high-risk (${Utils.money(r)})</span>`),t.innerHTML=`\n      <div class="section-header">\n        <div class="section-title-group">\n          <i class="fas fa-clock" style="color:var(--danger)"></i>\n          <span class="section-title">Expiring Contracts</span>\n        </div>\n        <div class="mission-gap-filter">\n          <span class="section-subtitle">${o}</span>\n          ${s.length>0?`\n            <button class="mission-gap-toggle ${App.onlyHighMissionGap?"active":""}" onclick="App.toggleMissionGapFilter()" title="Show only contracts with high mission continuity risk">\n              <i class="fas fa-exclamation-triangle"></i>\n              High Risk Only\n            </button>\n          `:""}\n        </div>\n      </div>\n      \n      ${0===i.length?'\n        <div style="text-align:center; padding:2rem; color:var(--text-muted);">\n          No contracts match the current filter.\n          <a href="#" onclick="App.toggleMissionGapFilter(); return false;" style="color:var(--accent); margin-left:0.5rem;">Show all</a>\n        </div>\n      ':i.map((e=>{if(!e["End Date"])return"";const t=e.generated_internal_id,n=t?`https://www.usaspending.gov/award/${t}`:e["Award ID"]?`https://www.usaspending.gov/search/?hash=&filters=${encodeURIComponent(JSON.stringify({keyword:e["Award ID"]}))}`:null,a=new Date(e["End Date"]),s=a.getMonth(),r=a.getFullYear();let i=1;s>=0&&s<=2?i=2:s>=3&&s<=5?i=3:s>=6&&s<=8&&(i=4);const o=`FY${String(s>=9?r+1:r).slice(-2)} Q${i}`,l=new Date,c=Math.ceil((a-l)/864e5),d=c<180?"urgent":c<365?"soon":"later",p=e.risk,u="high"===p.level?"Mission Gap: High":"medium"===p.level?"Mission Gap: Medium":"Mission Gap: Low",m=e=>Autocomplete.escapeHtml(e);return`\n        <div class="deal-card" style="margin-bottom:1rem; ${"high"===p.level?"border-left: 3px solid var(--danger);":"medium"===p.level?"border-left: 3px solid #FDD835;":""}">\n          <div class="deal-header">\n            <span class="deal-agency">${m(Utils.trunc(e["Awarding Agency"],40))}</span>\n            <span class="deal-amount">${Utils.money(e["Award Amount"])}</span>\n          </div>\n          <div class="deal-desc">${m(Utils.trunc(e.Description,100))}</div>\n          <div class="deal-meta">\n            <span class="meta-tag" style="color:var(--accent); border-color:var(--accent);">${o}</span>\n            <span class="meta-tag mission-gap ${p.level}" title="Flags contracts likely tied to ongoing operational support">${u}</span>\n            ${e["PSC Code"]?`<span class="meta-tag psc" title="${m(e["PSC Description"]||"")}">PSC: ${m(e["PSC Code"])}</span>`:""}\n          </div>\n          \n          ${p.reasons.length>0&&"low"!==p.level?`<div class="mission-gap-signals">Signals: ${m(p.reasons.join(", "))}</div>`:""}\n          \n          <div class="deal-footer">\n            <div>\n              <div style="font-size:0.8rem; color:${"urgent"===d?"var(--danger)":"soon"===d?"#FDD835":"var(--text-muted)"}">\n                Expires: ${Utils.date(e["End Date"])} (${c} days)\n              </div>\n              <div style="font-size:0.75rem; color:#666">Incumbent: ${m(Utils.trunc(e["Recipient Name"],35))}</div>\n            </div>\n            ${n?`<a href="${n}" target="_blank" rel="noopener" class="action-btn">OPEN AWARD <i class="fas fa-external-link-alt"></i></a>`:""}\n          </div>\n        </div>`})).join("")}\n    `},toggleMissionGapFilter(){App.onlyHighMissionGap=!App.onlyHighMissionGap,App.forecastData.analysis&&App.forecastData.analysis.recompetes&&this.renderRecompetes(App.forecastData.analysis.recompetes)},calculateRollingForecast(e,t,n,a){const s=[];let r=t,i=n;for(let n=0;n<4;n++){const n=[];Object.keys(e).map(Number).sort().reverse().forEach((a=>{a<t&&e[a]&&e[a][i]>0&&n.length<3&&n.push({fy:a,amount:e[a][i]})}));let o=0;if(n.length>0){const e=[.5,.3,.2];let t=0;n.forEach(((n,a)=>{const s=e[a]||.1;o+=n.amount*s,t+=s})),o/=t}const l=e[t-1]&&e[t-1][i]?e[t-1][i]:0,c=e[t-2]&&e[t-2][i]?e[t-2][i]:0;let d=0;c>0&&l>0?d=(l-c)/c:a&&(d=a/100),d=Math.max(-.5,Math.min(.5,d));const p=1+d;let u=0;l>0?u=l*p:o>0&&(u=o*p),s.push({period:`FY${String(r).slice(-2)} Q${i}`,quarter:i,fiscalYear:r,historicalAvg:o,lastYear:l,priorYear:c,quarterGrowth:100*d,projection:u,dataPoints:n.length}),i++,i>4&&(i=1,r++)}return s},renderForecastTable(e,t,n,a,s,r){const i=document.getElementById("forecastTableBody");if(!i)return;const o=Utils.getCurrentFY(),l=Utils.getCurrentQuarter(),c=s.byFY&&s.byFY[o]?s.byFY[o]:{},d=Object.values(c).reduce(((e,t)=>e+(t||0)),0);let p=0;for(let t=1;t<=4;t++){const n=c[t]||0,a=e.find((e=>e.fiscalYear===o&&e.quarter===t)),s=a?a.projection:0;p+=t<l?n:t===l?Math.max(n,s):s}i.innerHTML=e.map((e=>{const t=e.dataPoints>0,n=e.quarterGrowth||0,a=n>=0?"trend-up":"trend-down",s=n>=0?"▲":"▼",r=c[e.quarter]||0,i=e.fiscalYear===o&&e.quarter<l,d=e.fiscalYear===o&&e.quarter===l;let p="";return p=i?`<span style="color:var(--text-primary); font-weight:700; border-bottom:1px dotted var(--text-muted); cursor:help;" title="Actual Obligation (Final)">${Utils.money(r)}</span>`:d?`<span style="color:var(--accent); font-weight:600;" title="Proj: ${Utils.money(e.projection)} / Actual: ${Utils.money(r)}">${Utils.money(Math.max(r,e.projection))}</span>`:`<span style="color:var(--accent); font-weight:600;">${e.projection>0?Utils.money(e.projection):"-"}</span>`,`\n      <tr>\n        <td>\n          <strong>${e.period}</strong> \n          ${i?'<i class="fas fa-lock" style="font-size:0.6rem; color:var(--text-muted); margin-left:4px;" title="Closed Quarter"></i>':""}\n          ${d?'<i class="fas fa-clock" style="font-size:0.6rem; color:var(--accent); margin-left:4px;" title="Active Quarter"></i>':""}\n        </td>\n        <td style="color:var(--text-muted);">\n          ${t?Utils.money(e.historicalAvg):'<span style="opacity:0.5">No data</span>'}\n        </td>\n        <td style="color:var(--text-muted);">${e.lastYear>0?Utils.money(e.lastYear):"-"}</td>\n        <td style="white-space: nowrap;">\n          <div style="display: inline-flex; align-items: center; gap: 0.5rem;">\n            ${p}\n            ${!i&&e.lastYear>0?`<span class="trend-pill ${a}" style="font-size:0.65rem;">${s} ${Math.abs(n).toFixed(0)}%</span>`:""}\n          </div>\n        </td>\n      </tr>\n    `})).join("");const u=document.getElementById("projectionSummary");if(u&&p>0){const n=t>0?(p-t)/t*100:0,a=n>=0?"var(--success)":"var(--danger)",i=`FY${String(o).slice(-2)}`,l=p>0?d/p*100:0,c=Math.max(0,p-d),m=r&&r[0]&&r[0]["Awarding Agency"]?r[0]["Awarding Agency"]:"the primary agency";let g="";g=s.hhi>2500?"teaming with established primes to bypass high barriers to entry.":s.hhi>1500?"a targeted account-entry strategy focusing on under-served sub-agencies.":`an aggressive displacement strategy targeting the ${m} incumbent base.`;const h=s.recompetes.reduce(((e,t)=>e+(parseFloat(t["Award Amount"])||0)),0),y=e.length>0&&Number(e.reduce(((e,t)=>e+(t.dataPoints||0)),0)/e.length)||0,f=Number(s.volatility?.score)||.5;let v=y/3*70+30*(1-f);v=Math.max(0,Math.min(100,Number(v)||0));let A=v>=75?"HIGH":v>=45?"MEDIUM":"LOW",b=A.toLowerCase();u.innerHTML=`\n      <div class="hero-growth-label">Projected ${i} Forecast</div>\n      <div style="display: flex; align-items: baseline; gap: 1.5rem; flex-wrap: wrap; margin-bottom: 0.5rem;">\n        <div class="hero-growth-value">${Utils.money(p)}</div>\n        <div style="color:${a}; font-size: 1.5rem; font-weight: 700; font-family: 'JetBrains Mono';">\n          ${n>=0?"▲":"▼"} ${Math.abs(n).toFixed(0)}% <span style="font-size:0.8rem; opacity:0.7">YoY Growth</span>\n        </div>\n      </div>\n      \n      <div style="margin-bottom: 1.5rem; font-size: 0.7rem; color: var(--text-muted);">\n        <div style="display:flex; justify-content:space-between; margin-bottom:4px;">\n          <span>Obligations YTD: <strong style="color:var(--text-primary)">${Utils.money(d)}</strong></span>\n          <span>Forecast (To-Go): ${Utils.money(c)}</span>\n        </div>\n        <div style="height:6px; width:100%; background:rgba(255,255,255,0.1); border-radius:3px; overflow:hidden;">\n          <div style="height:100%; width:${l}%; background:var(--text-primary); opacity:0.8;"></div>\n        </div>\n      </div>\n      \n      <div class="strategic-narrative-card">\n        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">\n          <div style="color:var(--accent); font-weight:700; font-size:0.7rem; text-transform:uppercase; letter-spacing:1px;">\n            <i class="fas fa-robot"></i> Data Insights\n          </div>\n          <div style="font-size:0.6rem; color:var(--text-muted); text-transform:uppercase; letter-spacing:1px;">\n            Model Confidence: <span class="analysis-panel-badge ${b}">${A} (${v.toFixed(0)}%)</span>\n          </div>\n        </div>\n\n        <strong>Market Dynamics:</strong> This is a <strong>${s.marketStatus}</strong> market (HHI: ${s.hhi}). \n        With a ${n>=0?"bullish":"softening"} <strong>${n.toFixed(0)}% ${i} growth forecast</strong>, \n        the model recommends ${g}\n        ${s.recompetes.length>5?` High recompete volume (${Utils.money(h)}) in the next 24 months signals a prime capture window.`:""}\n        \n        <div style="margin-top: 15px; padding: 10px; background: rgba(0,0,0,0.2); border: 1px solid var(--border); border-radius: 4px;">\n          <div style="font-size: 0.6rem; color: var(--accent); text-transform: uppercase; margin-bottom: 5px; font-weight: 700;">Confidence Logic</div>\n          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.65rem; color: var(--text-muted);">\n            <div>\n              <strong>Density:</strong> ${y.toFixed(1)}/3.0 Years \n              <div style="height:3px; width:100%; background:#333; margin-top:3px;">\n                <div style="height:100%; width:${y/3*100}%; background:var(--accent);"></div>\n              </div>\n            </div>\n            <div>\n              <strong>Stability:</strong> ${(100-100*f).toFixed(0)}% Stable\n              <div style="height:3px; width:100%; background:#333; margin-top:3px;">\n                <div style="height:100%; width:${100*(1-f)}%; background:var(--accent);"></div>\n              </div>\n            </div>\n          </div>\n          <div style="font-size: 0.6rem; margin-top: 8px; font-style: italic; opacity: 0.8;">\n            Note: High volatility or <1 year of data reduces projection reliability.\n          </div>\n        </div>\n      </div>\n      \n      <div class="disclaimer-text" style="margin-top: 1.5rem; padding: 1rem; border-top: 1px solid var(--border); font-size: 0.7rem; color: var(--text-muted); line-height: 1.5;">\n  \n  <strong style="color: var(--accent); text-transform: uppercase; letter-spacing: 0.5px; display: block; margin-bottom: 0.5rem;">\n    <i class="fas fa-info-circle"></i> Notes\n  </strong>\n\n  <ul style="padding-left: 1rem; margin-bottom: 1rem; list-style-type: disc;">\n    <li style="margin-bottom: 0.25rem;">\n      <strong>Obligations vs. Ceiling:</strong> We track <em>Obligated Funds</em> (cash spent), not Ceiling (potential value). This ensures you chase actual funded opportunities, not empty contract vehicles.\n    </li>\n    <li style="margin-bottom: 0.25rem;">\n      <strong>Seasonality Model:</strong> Our forecasts account for the "Q4 Spending Spree" (July-Sept). If the "To-Go" number looks high, it's because the agency historically dumps budget at year-end.\n    </li>\n    <li style="margin-bottom: 0.25rem;">\n      <strong>Market Lock (HHI):</strong> We calculate incumbency strength. <span style="color:#ddd;">Low scores (&lt;1,500)</span> mean the door is open; <span style="color:#ddd;">High scores (&gt;2,500)</span> mean you should look to partner.\n    </li>\n    <li style="margin-bottom: 0.25rem;">\n      <strong>Reporting Lag:</strong> Defense agencies (DoD) often delay reporting by 90 days for security. Recent awards may not appear immediately.\n    </li>\n  </ul>\n\n  <div style="font-style: italic; opacity: 0.8; border-top: 1px dashed var(--border); padding-top: 0.5rem;">\n    <strong>Disclaimer:</strong> Govhoo is a free intelligence tool built to help you plan. Projections are estimates based solely on USASpending.gov data. Always verify specific opportunities on SAM.gov.\n  </div>\n\n</div>\n    `}else u&&(u.innerHTML="")},exportCSV(e){const t="search"===App.mode?App.searchData.active:App.forecastData.awards||[];if(!t.length){if(e){const t=e.innerHTML;e.style.color="var(--danger)",e.style.borderColor="var(--danger)",e.innerHTML='<i class="fas fa-times"></i>',setTimeout((()=>{e.style.color="",e.style.borderColor="",e.innerHTML=t}),2e3)}return}const n=t.map((e=>{let t="N/A";if(e["Start Date"]){const n=new Date(e["Start Date"]),a=n.getMonth(),s=n.getFullYear();let r;r=a>=9?1:a<=2?2:a<=5?3:4,t=`FY${String(a>=9?s+1:s).slice(-2)} Q${r}`}const n=e.generated_internal_id;let a="";return n?a=`https://www.usaspending.gov/award/${n}`:e["Award ID"]&&(a=`https://www.usaspending.gov/search/?hash=&filters=${encodeURIComponent(JSON.stringify({keyword:e["Award ID"]}))}`),[`"${t}"`,`"${(e["Recipient Name"]||"").replace(/"/g,'""')}"`,`"${(e["Awarding Agency"]||"").replace(/"/g,'""')}"`,`"${(e["Awarding Sub Agency"]||"").replace(/"/g,'""')}"`,e["Award Amount"]||0,`"${(e.Description||"").replace(/"/g,'""')}"`,e["Start Date"]||"",e["End Date"]||"",e["Award ID"]||"",a]})),a=[["Fiscal Period","Recipient","Agency","Sub-Agency","Amount","Description","Start Date","End Date","Award ID","Award Link"].join(","),...n.map((e=>e.join(",")))].join("\n"),s=new Blob([a],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(s),i=document.createElement("a");if(i.setAttribute("href",r),i.setAttribute("download",`govhoo_${App.mode}_${App.currentQuery}.csv`),document.body.appendChild(i),i.click(),document.body.removeChild(i),e){const t=e.innerHTML;e.style.color="var(--success)",e.style.borderColor="var(--success)",e.innerHTML='<i class="fas fa-check"></i>',setTimeout((()=>{e.style.color="",e.style.borderColor="",e.innerHTML=t}),2e3)}},showLoader(e,t){document.getElementById("loaderText").innerText=e,document.getElementById("loaderSubtext").innerText=t||"",document.getElementById("loader").style.display="flex"},hideLoader(){document.getElementById("loader").style.display="none"},transitionToApp(){const e=document.getElementById("heroView");e.classList.add("slide-up"),document.getElementById("appView").style.display="block",document.getElementById("miniSearch").value=App.currentQuery,document.getElementById("dashboardContainer").classList.add("active");const t=document.getElementById("dashboardContainer");if(!t.querySelector(".hero-footer")){const n=e.querySelector(".hero-footer");if(n){const e=n.cloneNode(!0);e.removeAttribute("id"),t.appendChild(e)}}setTimeout((()=>{e.style.display="none",e.classList.add("hidden")}),500)},shareLink(e){const t=new URL(window.location);t.searchParams.set("q",App.currentQuery),t.searchParams.set("mode",App.mode),navigator.clipboard.writeText(t.toString()).then((()=>{if(e){const t=e.innerHTML;e.style.color="var(--success)",e.style.borderColor="var(--success)",e.innerHTML='<i class="fas fa-check"></i>',setTimeout((()=>{e.style.color="",e.style.borderColor="",e.innerHTML=t}),2e3)}}))}},PromptPackageGenerator={calculateMetrics(e,t){const n=e.reduce(((e,t)=>e+(parseFloat(t["Award Amount"])||0)),0),a=e.length,s=a>0?n/a:0,r=e.map((e=>parseFloat(e["Award Amount"])||0)).filter((e=>e>0)).sort(((e,t)=>e-t));let i=0;if(r.length>0){const e=Math.floor(r.length/2);i=r.length%2!=0?r[e]:(r[e-1]+r[e])/2}const o=r.filter((e=>e>=1e6)).length,l=r.filter((e=>e>=1e5&&e<1e6)).length,c=r.filter((e=>e<1e5)).length,d=new Date,p=e.filter((e=>{const t=(new Date(e["End Date"])-d)/2592e6;return t>0&&t<=18}));return{totalValue:n,contractCount:a,avgDealSize:s,medianDealSize:i,largeDeals:o,midDeals:l,smallDeals:c,expiringValue:p.reduce(((e,t)=>e+(parseFloat(t["Award Amount"])||0)),0),expiringCount:p.length}},buildVendorIntel(e){const t={},n=new Date;e.forEach((e=>{const a=e["Recipient Name"]||"Unknown";t[a]||(t[a]={spend:0,count:0,agencies:new Set,contracts:[],expiring:0});const s=parseFloat(e["Award Amount"])||0;t[a].spend+=s,t[a].count++,t[a].agencies.add(e["Awarding Agency"]),t[a].contracts.push(e);const r=(new Date(e["End Date"])-n)/2592e6;r>0&&r<=18&&(t[a].expiring+=s)}));const a=Object.values(t).reduce(((e,t)=>e+t.spend),0);return Object.entries(t).map((([e,t])=>({name:e,spend:t.spend,share:a>0?t.spend/a*100:0,contracts:t.count,agencies:t.agencies.size,expiring:t.expiring,avgDeal:t.count>0?t.spend/t.count:0,isChannel:SalesPlanManager.isChannel(e)}))).sort(((e,t)=>t.spend-e.spend))},buildAgencyIntel(e){const t={};e.forEach((e=>{const n=e["Awarding Agency"]||"Unknown",a=e["Awarding Sub Agency"]||"Unknown";t[n]||(t[n]={spend:0,count:0,subs:{},vendors:{}});const s=parseFloat(e["Award Amount"])||0;t[n].spend+=s,t[n].count++,t[n].subs[a]||(t[n].subs[a]=0),t[n].subs[a]+=s;const r=e["Recipient Name"]||"Unknown";t[n].vendors[r]||(t[n].vendors[r]=0),t[n].vendors[r]+=s}));const n=Object.values(t).reduce(((e,t)=>e+t.spend),0);return Object.entries(t).map((([e,t])=>{const a=Object.entries(t.vendors).sort(((e,t)=>t[1]-e[1])).slice(0,3).map((([e,t])=>({name:e,spend:t}))),s=Object.entries(t.subs).sort(((e,t)=>t[1]-e[1])).slice(0,3).map((([e,t])=>({name:e,spend:t})));return{name:e,spend:t.spend,share:n>0?t.spend/n*100:0,contracts:t.count,topVendors:a,topSubs:s,incumbent:a[0]?.name||"Unknown"}})).sort(((e,t)=>t.spend-e.spend))},generatePrompt(e,t){const n=e=>Utils.money(e),a=e=>e&&!isNaN(e)?e.toFixed(1)+"%":"0.0%",s=e.query.toUpperCase(),r=`FY${String(Utils.getCurrentFY()).slice(-2)}`,i=Utils.getCurrentFY(),o=e.vendors.filter((e=>!e.isChannel)),l=e.vendors.filter((e=>e.isChannel)),c=e.agencies.slice(0,6),d=e.metrics,p=(e.analysis,d.expiringValue);return`\n<SYSTEM_INSTRUCTIONS_INTERNAL>\n- ROLE: Senior Federal Sales Director at a Tier-1 CSP/Defense Prime.\n- DATA INTEGRITY: Use ONLY the provided data below. \n- CLOSED UNIVERSE: Do not hallucinate outside companies, placeholder vendors, or market stats.\n- START RESPONSE IMMEDIATELY with the # Title. Do not include meta-commentary.\n</SYSTEM_INSTRUCTIONS_INTERNAL>\n\n# Federal Go-To-Market Plan: ${s}\n\n**Scope**: Fiscal Year ${i} (${r}). Target agencies include ${c.map((e=>e.name)).join(", ")}.\n\n---\n\n## EXECUTIVE SUMMARY\nOne high-density paragraph stating the ${r} target revenue range (calculated as a percentage of the total ${n(p)} recompete signal), primary competitive risk, and agency focus.\n\n## MARKET DYNAMICS & FRICTION\nFour sentences explaining how revenue is won in the ${s} market and the specific role of incumbency.\n\n## COMPETITIVE LANDSCAPE (NON-CHANNEL VENDORS)\nOutput the following table for these identified competitors ONLY. \n${0===o.length?"> No non-channel competitors identified in dataset.":`\n| Vendor | Spend | Share | Contracts | Agencies | Recompete Exposure |\n|---|---:|---:|---:|---:|---:|\n${o.slice(0,6).map((e=>`| ${e.name} | ${n(e.spend)} | ${a(e.share)} | ${e.contracts} | ${e.agencies} | ${n(e.expiring)} |`)).join("\n")}`}\n\n* Identify specific vulnerabilities for the top 3 incumbents above (e.g., single-agency concentration or high recompete volume).\n* Identify which incumbents act as "gatekeepers" to key programs.\n\n## CHANNEL PARTNER LANDSCAPE (IDENTIFIED PARTNERS)\nOutput the following table for these identified friendly channel partners ONLY. \n${0===l.length?"> (No channel partners marked. Identify resellers in the Sales Plan modal to populate this section.)":`\n| Partner Vendor | Partner Spend | Share | Contracts | Agencies | Current Exposure |\n|---|---:|---:|---:|---:|---:|\n${l.slice(0,6).map((e=>`| ${e.name} | ${n(e.spend)} | ${a(e.share)} | ${e.contracts} | ${e.agencies} | ${n(e.expiring)} |`)).join("\n")}`}\n\n* Detail where these specific partners provide "speed to contract" via established vehicles.\n\n## PARTNER-TO-INCUMBENT ATTACK MAP\nIdentify the most logical path to displace incumbents using identified partners.\n\n| Target Incumbent | Vulnerability | Recommended Partner Path | Strategic Rationale |\n|---|---|---|---|\n${o.slice(0,3).map(((e,t)=>{const a=l.length>0?l[t%l.length].name:"DIRECT-LED";return`| ${e.name} | ${n(e.expiring)} Recompete | ${a} | Target displacement via ${a}'s agency footprint |`})).join("\n")}\n\n## ACCOUNT PRIORITIZATION\n| Account / Component | Priority | Decision |\n|---|---|---|\n${c.map((e=>`| ${e.name} - ${e.topSubs[0]?.name||"Primary Component"} | TBD | TBD |`)).join("\n")}\n\n## STRATEGIC DECISIONS (PRIMARY ACCOUNTS ONLY)\nFocus on target outcome, deal shape, and specific partner access path.\n\n## PIPELINE AND TARGETS\nRevenue range and required deal count logic based on the ${n(d.medianDealSize)} median deal size.\n\n## GO-TO-MARKET MOTION\nState clearly if execution is Partner-Led (using partners identified above) or Direct-Led.\n\n## RESOURCE PLAN\nList requirements for Sponsorship, Sales, Technical coverage, and Legal.\n\n## RISKS AND MITIGATION\nMarkdown table covering lock, dependency, vehicles, and timing.\n\n## NEXT 30 DAYS: EXECUTION SPRINT\nMarkdown table with verifiable milestones and a Kill/No-Go decision point.\n\n## APPENDIX: EXECUTION PRECONDITIONS\nSuccinctly state required leadership support and the alternative if withheld.`},buildPackage(e,t,n={}){const a=this.calculateMetrics(e,t),s=this.buildVendorIntel(e),r=this.buildAgencyIntel(e);return this.generatePrompt({query:App.currentQuery,metrics:a,vendors:s,agencies:r,analysis:t},n)},downloadPackage(e){const t=new Blob([e],{type:"text/plain;charset=utf-8"}),n=document.createElement("a");n.href=URL.createObjectURL(t);const a=Utils.getCurrentFY();n.download=`Territory_Plan_FY${a}_${App.currentQuery.replace(/\s+/g,"_")}.txt`,document.body.appendChild(n),n.click(),document.body.removeChild(n)}},PipelineBuilder={generatedPipeline:[],historicalData:null,init(){const e=document.getElementById("pipelineTargetFY");if(e){const t=Utils.getCurrentFY();e.innerHTML=`\n        <option value="${t}">FY${t} (Current)</option>\n        <option value="${t+1}" selected>FY${t+1} (Next)</option>\n      `}},open(){const e=document.getElementById("pipelineBuilderModal");e&&(this.init(),this.populateAgencyDropdown(),e.classList.add("active"),document.body.style.overflow="hidden",document.getElementById("pipelineResultsArea").style.display="none",document.getElementById("pipelineLoading").style.display="none",document.getElementById("btnDownloadPipeline").disabled=!0,document.getElementById("pipelineDataStatus").textContent="Configure options and click Generate to build your pipeline.")},close(){const e=document.getElementById("pipelineBuilderModal");e&&(e.classList.remove("active"),document.body.style.overflow="")},populateAgencyDropdown(){const e=document.getElementById("pipelineFocusAgency");if(!e)return;const t=App.forecastData.awards||App.searchData.raw||[],n=[...new Set(t.map((e=>e["Awarding Agency"])).filter(Boolean))].sort();e.innerHTML='<option value="">All Agencies in Results</option>'+n.map((e=>`<option value="${e}">${Utils.trunc(e,50)}</option>`)).join("")},async generate(){const e=parseInt(document.getElementById("pipelineTargetFY").value),t=parseInt(document.getElementById("pipelineHistoryYears").value),n=parseFloat(document.getElementById("pipelineProbMultiplier").value),a=parseFloat(document.getElementById("pipelineMinDeal").value),s=document.getElementById("pipelineFocusAgency").value;document.getElementById("pipelineLoading").style.display="flex",document.getElementById("pipelineResultsArea").style.display="none",document.getElementById("pipelineDataStatus").textContent="Fetching historical spending data...";try{const r=await this.fetchHistoricalData(t);if(!r||0===r.length)throw new Error("No historical data found for this search.");this.historicalData=r,document.getElementById("pipelineDataStatus").textContent="Analyzing spending patterns...";const i=this.buildPipelineFromHistory(r,{targetFY:e,historyYears:t,probMultiplier:n,minDeal:a,focusAgency:s});this.generatedPipeline=i,this.renderResults(i,e),document.getElementById("pipelineLoading").style.display="none",document.getElementById("pipelineResultsArea").style.display="block",document.getElementById("btnDownloadPipeline").disabled=0===i.length,document.getElementById("pipelineDataStatus").textContent=`Generated ${i.length} opportunities totaling ${Utils.money(i.reduce(((e,t)=>e+t.Amount),0))}`}catch(e){console.error("Pipeline generation error:",e),document.getElementById("pipelineLoading").style.display="none",document.getElementById("pipelineDataStatus").textContent=`Error: ${e.message}`}},async fetchHistoricalData(e){const t=App.currentQuery;if(!t)throw new Error("No search query found. Please run a search first.");const n=Utils.getCurrentFY(),a=[];for(let s=0;s<e;s++){const e=n-s,r=e-1+"-10-01",i=`${e}-09-30`,o=Utils.buildFilters(t,[{start_date:r,end_date:i}]);try{const t=await fetch(`${API.baseUrl}/search/spending_by_award/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filters:o,fields:["Award ID","Recipient Name","Description","Start Date","End Date","Award Amount","Awarding Agency","Awarding Sub Agency","NAICS Code","NAICS Description","PSC Code","PSC Description","generated_internal_id"],limit:100,sort:"Award Amount",order:"desc"})}),n=await t.json();n.results&&n.results.length>0&&(n.results.forEach((t=>{t._fiscalYear=e,t._quarter=this.getQuarterFromDate(t["Start Date"])})),a.push(...n.results))}catch(t){console.warn(`Failed to fetch FY${e} data:`,t)}}return a},getQuarterFromDate(e){if(!e)return 1;const t=new Date(e).getMonth();return t>=9?1:t<=2?2:t<=5?3:4},getFYQuarterDates:(e,t)=>({1:{start:e-1+"-10-01",end:e-1+"-12-31"},2:{start:`${e}-01-01`,end:`${e}-03-31`},3:{start:`${e}-04-01`,end:`${e}-06-30`},4:{start:`${e}-07-01`,end:`${e}-09-30`}}[t]),buildPipelineFromHistory(e,t){const{targetFY:n,historyYears:a,probMultiplier:s,minDeal:r,focusAgency:i}=t,o=[];let l=e;i&&(l=e.filter((e=>e["Awarding Agency"]===i))),r>0&&(l=l.filter((e=>(e["Award Amount"]||0)>=r)));const c={};l.forEach((e=>{const t=e["Awarding Agency"]||"Unknown",n=e["Awarding Sub Agency"]||"",a=e._quarter||1,s=e["NAICS Code"]||"",r=e["PSC Code"]||"",i=`${t}|Q${a}|${s||r}`;c[i]||(c[i]={agency:t,subAgency:n,quarter:a,naicsCode:s,pscCode:r,naicsDesc:e["NAICS Description"]||"",pscDesc:e["PSC Description"]||"",historicalAmounts:[],historicalYears:[],descriptions:[],vendors:[]}),c[i].historicalAmounts.push(e["Award Amount"]||0),c[i].historicalYears.push(e._fiscalYear),e.Description&&c[i].descriptions.push(e.Description),e["Recipient Name"]&&c[i].vendors.push(e["Recipient Name"])}));return Object.values(c).forEach((e=>{if(e.historicalAmounts.length<1)return;const t=e.historicalAmounts.reduce(((e,t)=>e+t),0)/e.historicalAmounts.length,i=t*s;if(i<r)return;const l=[...new Set(e.historicalYears)],c=l.length/a,d=Math.min(100*c,100),p=this.getFYQuarterDates(n,e.quarter),u={};e.descriptions.forEach((e=>{const t=e.substring(0,100);u[t]=(u[t]||0)+1}));const m=Object.entries(u).sort(((e,t)=>t[1]-e[1]))[0],g={};e.vendors.forEach((e=>{g[e]=(g[e]||0)+1}));const h=Object.entries(g).sort(((e,t)=>t[1]-e[1]))[0],y=Utils.getCurrentQuarter(),f=Utils.getCurrentFY();let v="Prospecting";n===f?(e.quarter<=y||e.quarter===y+1)&&(v="Qualification"):n===f+1&&1===e.quarter&&(v="Qualification"),o.push({OpportunityName:`${e.agency.split(" ").slice(0,3).join(" ")} - ${e.pscDesc||e.naicsDesc||App.currentQuery} - FY${n}Q${e.quarter}`,AccountName:e.agency,Amount:Math.round(i),CloseDate:p.end,StageName:v,Probability:Math.round(d*s),Type:"New Business",LeadSource:"USAspending Historical Analysis",Description:m?m[0]:`Projected opportunity based on ${l.length} year(s) of historical spending in Q${e.quarter}`,NextStep:"Prospecting"===v?"Research incumbent and identify stakeholders":"Qualify opportunity and engage customer",FiscalYear:`FY${n}`,FiscalQuarter:`Q${e.quarter}`,SubAgency:e.subAgency,NAICSCode:e.naicsCode,NAICSDescription:e.naicsDesc,PSCCode:e.pscCode,PSCDescription:e.pscDesc,Incumbent:h?h[0]:"",HistoricalAverage:Math.round(t),HistoricalYearsObserved:l.join(", "),RecurrenceRate:`${Math.round(100*c)}%`,DataSource:"USAspending.gov",GeneratedDate:(new Date).toISOString().split("T")[0],SearchKeyword:App.currentQuery})})),o.sort(((e,t)=>{const n=new Date(e.CloseDate)-new Date(t.CloseDate);return 0!==n?n:t.Amount-e.Amount})),o},renderResults(e,t){const n=e.reduce(((e,t)=>e+t.Amount),0),a=e.length>0?n/e.length:0,s={Q1:0,Q2:0,Q3:0,Q4:0};e.forEach((e=>{const t=e.FiscalQuarter;void 0!==s[t]&&s[t]++}));const r=Object.entries(s).sort(((e,t)=>t[1]-e[1]))[0];document.getElementById("pipelineStatsGrid").innerHTML=`\n      <div class="pipeline-stat">\n        <div class="pipeline-stat-label">Total Pipeline Value</div>\n        <div class="pipeline-stat-value">${Utils.money(n)}</div>\n        <div class="pipeline-stat-sub">FY${t} Projected</div>\n      </div>\n      <div class="pipeline-stat">\n        <div class="pipeline-stat-label">Opportunities</div>\n        <div class="pipeline-stat-value">${e.length}</div>\n        <div class="pipeline-stat-sub">Based on History</div>\n      </div>\n      <div class="pipeline-stat">\n        <div class="pipeline-stat-label">Average Deal</div>\n        <div class="pipeline-stat-value">${Utils.money(a)}</div>\n        <div class="pipeline-stat-sub">Projected Size</div>\n      </div>\n      <div class="pipeline-stat">\n        <div class="pipeline-stat-label">Peak Quarter</div>\n        <div class="pipeline-stat-value">${r?r[0]:"-"}</div>\n        <div class="pipeline-stat-sub">${r?r[1]+" opportunities":""}</div>\n      </div>\n    `,document.getElementById("pipelineResultCount").textContent=`${e.length} opportunities generated`,0!==e.length?document.getElementById("pipelineTableContainer").innerHTML=`\n      <table class="pipeline-table">\n        <thead>\n          <tr>\n            <th>Opportunity Name</th>\n            <th>Account</th>\n            <th>Amount</th>\n            <th>Close Date</th>\n            <th>Quarter</th>\n            <th>Stage</th>\n            <th>Prob</th>\n            <th>Incumbent</th>\n          </tr>\n        </thead>\n        <tbody>\n          ${e.map((e=>`\n            <tr>\n              <td title="${e.OpportunityName}">${Utils.trunc(e.OpportunityName,45)}</td>\n              <td class="agency" title="${e.AccountName}">${Utils.trunc(e.AccountName,30)}</td>\n              <td class="amount">${Utils.money(e.Amount)}</td>\n              <td class="date">${e.CloseDate}</td>\n              <td><span class="pipeline-quarter-badge">${e.FiscalQuarter}</span></td>\n              <td><span class="stage ${e.StageName.toLowerCase()}">${e.StageName}</span></td>\n              <td>${e.Probability}%</td>\n              <td title="${e.Incumbent}">${Utils.trunc(e.Incumbent||"-",20)}</td>\n            </tr>\n          `)).join("")}\n        </tbody>\n      </table>\n    `:document.getElementById("pipelineTableContainer").innerHTML='\n        <div style="text-align:center; padding:2rem; color:var(--text-muted);">\n          <i class="fas fa-search" style="font-size:2rem; margin-bottom:1rem; opacity:0.5;"></i>\n          <p>No opportunities generated. Try adjusting the minimum deal size or historical years.</p>\n        </div>\n      '},downloadCSV(){if(0===this.generatedPipeline.length)return void alert("No pipeline data to download. Please generate a pipeline first.");const e=this.generatedPipeline.map((e=>[e.OpportunityName,e.AccountName,e.Amount,e.CloseDate,e.StageName,e.Probability,e.Type,e.LeadSource,e.Description,e.NextStep,e.FiscalYear,e.FiscalQuarter,e.SubAgency,e.NAICSCode,e.NAICSDescription,e.PSCCode,e.PSCDescription,e.Incumbent,e.HistoricalAverage,e.HistoricalYearsObserved,e.RecurrenceRate,e.DataSource,e.GeneratedDate,e.SearchKeyword])),t=e=>{if(null==e)return"";const t=String(e);return t.includes(",")||t.includes('"')||t.includes("\n")?`"${t.replace(/"/g,'""')}"`:t},n=[["Opportunity Name","Account Name","Amount","Close Date","Stage","Probability (%)","Type","Lead Source","Description","Next Step","Fiscal Year","Fiscal Quarter","Sub-Agency","NAICS Code","NAICS Description","PSC Code","PSC Description","Incumbent","Historical Average","Historical Years Observed","Recurrence Rate","Data Source","Generated Date","Search Keyword"].map(t).join(","),...e.map((e=>e.map(t).join(",")))].join("\n"),a=new Blob([n],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a");s.href=URL.createObjectURL(a);const r=document.getElementById("pipelineTargetFY").value;s.download=`Pipeline_FY${r}_${App.currentQuery.replace(/[^a-zA-Z0-9]/g,"_")}_${(new Date).toISOString().split("T")[0]}.csv`,document.body.appendChild(s),s.click(),document.body.removeChild(s),document.getElementById("pipelineDataStatus").textContent="CSV downloaded successfully! Ready for Salesforce import."}},ConvoStarters={currentFocus:"agencies",currentMode:"prime",generatedStarters:[],open(e="prime"){const t=document.getElementById("convoStartersModal");if(!t)return;if(this.currentMode=e,"sub"===e){if(0===(App.forecastData.subawards||[]).length)return void alert("No subcontract data available. Please run a search first.")}else{if(0===(App.searchData.active||[]).length)return void alert("Please run a search first to generate conversation starters.")}t.classList.add("active"),document.body.style.overflow="hidden";const n=t.querySelector(".channel-modal-title");n&&(n.innerHTML="sub"===e?'<i class="fas fa-handshake" style="color: #E5C07B;"></i> TEAMING CONVERSATION STARTERS':'<i class="fas fa-comments" style="color: #8DA0CB;"></i> CONVERSATION STARTERS');const a=t.querySelector(".convo-focus-toggle");a&&("sub"===e?(a.innerHTML='\n          <button class="convo-focus-btn active" data-convo-focus="primes" onclick="ConvoStarters.setFocus(\'primes\')" style="border-color: #E5C07B;">\n            <i class="fas fa-building"></i> Primes\n          </button>\n          <button class="convo-focus-btn" data-convo-focus="subs" onclick="ConvoStarters.setFocus(\'subs\')" style="border-color: #E5C07B;">\n            <i class="fas fa-user-friends"></i> Subs\n          </button>\n          <button class="convo-focus-btn" data-convo-focus="both" onclick="ConvoStarters.setFocus(\'both\')" style="border-color: #E5C07B;">\n            <i class="fas fa-users"></i> Both\n          </button>\n        ',this.setFocus("primes")):(a.innerHTML='\n          <button class="convo-focus-btn active" data-convo-focus="agencies" onclick="ConvoStarters.setFocus(\'agencies\')">\n            <i class="fas fa-landmark"></i> Agencies\n          </button>\n          <button class="convo-focus-btn" data-convo-focus="vendors" onclick="ConvoStarters.setFocus(\'vendors\')">\n            <i class="fas fa-building"></i> Vendors\n          </button>\n          <button class="convo-focus-btn" data-convo-focus="both" onclick="ConvoStarters.setFocus(\'both\')">\n            <i class="fas fa-users"></i> Both\n          </button>\n        ',this.setFocus("agencies"))),this.updateContext()},updateContext(){const e=document.getElementById("convoDataStatus");if("sub"===this.currentMode){let t=App.forecastData.subawards||[];const n=App.subawardDrillState||{};n.level>0&&n.filter&&("prime"===n.filterType?t=t.filter((e=>(e["Prime Recipient Name"]||"Unknown Prime")===n.filter)):"sub"===n.filterType&&(t=t.filter((e=>(e["Sub-Awardee Name"]||"Unknown Sub")===n.filter))));let a=[];n.level>0&&n.filter&&a.push(`Filtered to: ${n.filter}`),App.currentQuery&&a.push(`Search: "${App.currentQuery}"`),e&&(a.length>0?e.innerHTML=`Based on <span id="convoAwardCount">${t.length}</span> subcontracts. ${a.join(" · ")}`:e.innerHTML=`Based on <span id="convoAwardCount">${t.length}</span> subcontracts from your search.`)}else{const t=App.searchData.active||[],n=App.drillState||{},a=App.searchData.filter;let s=[];if(n.path&&n.path.length>0){const e=n.path.map((e=>"object"==typeof e?e.name:e)).filter(Boolean);e.length>0&&s.push(`Filtered to: ${e.join(" → ")}`)}else a&&s.push(`Filtered to: ${a}`);App.currentQuery&&s.push(`Search: "${App.currentQuery}"`),e&&(s.length>0?e.innerHTML=`Based on <span id="convoAwardCount">${t.length}</span> awards. ${s.join(" · ")}`:e.innerHTML=`Based on <span id="convoAwardCount">${t.length}</span> awards from your search.`)}},close(){const e=document.getElementById("convoStartersModal");e&&(e.classList.remove("active"),document.body.style.overflow="")},setFocus(e){this.currentFocus=e,document.querySelectorAll(".convo-focus-btn").forEach((t=>{t.classList.toggle("active",t.dataset.convoFocus===e)})),this.generate()},generate(){const e=[],t=App.currentQuery||"this market";if("sub"===this.currentMode){let n=App.forecastData.subawards||[];if(0===n.length)return;const a=App.subawardDrillState||{};a.level>0&&a.filter&&("prime"===a.filterType?n=n.filter((e=>(e["Prime Recipient Name"]||"Unknown Prime")===a.filter)):"sub"===a.filterType&&(n=n.filter((e=>(e["Sub-Awardee Name"]||"Unknown Sub")===a.filter))));const s={prime:"prime"===a.filterType?a.filter:null,sub:"sub"===a.filterType?a.filter:null},r=this.analyzePrimes(n),i=this.analyzeSubs(n);"primes"!==this.currentFocus&&"both"!==this.currentFocus||e.push(...this.generatePrimeStarters(r,i,t,s)),"subs"!==this.currentFocus&&"both"!==this.currentFocus||e.push(...this.generateSubStarters(i,r,t,s))}else{const n=App.searchData.active||[];if(0===n.length)return;const a=App.drillState||{},s=a.path&&a.path.length>0?a.path[a.path.length-1]:null,r={agency:a.currentAgency||null,subAgency:a.currentSubAgency||null,vendor:3===a.level&&s?"object"==typeof s?s.name:s:null,level:a.level||0},i=this.analyzeAgencies(n),o=this.analyzeVendors(n),l=this.findRecompetes(n);"agencies"!==this.currentFocus&&"both"!==this.currentFocus||e.push(...this.generateAgencyStarters(i,o,l,t,r)),"vendors"!==this.currentFocus&&"both"!==this.currentFocus||e.push(...this.generateVendorStarters(o,i,t,r))}this.generatedStarters=e,this.render(e)},analyzePrimes(e){const t={};return e.forEach((e=>{const n=e["Prime Recipient Name"]||"Unknown Prime",a=e["Sub-Awardee Name"]||"Unknown Sub",s=parseFloat(e["Sub-Award Amount"])||0,r=e["Awarding Agency"]||e["Awarding Sub Agency"]||"";t[n]||(t[n]={name:n,totalSubbed:0,subCount:0,subs:{},agencies:{}}),t[n].totalSubbed+=s,t[n].subCount++,t[n].subs[a]=(t[n].subs[a]||0)+s,r&&(t[n].agencies[r]=(t[n].agencies[r]||0)+s)})),Object.values(t).map((e=>{const t=Object.entries(e.subs).sort(((e,t)=>t[1]-e[1]));e.topSub=t[0]?{name:t[0][0],amount:t[0][1]}:null,e.subVendorCount=t.length;const n=Object.entries(e.agencies).sort(((e,t)=>t[1]-e[1]));return e.topAgency=n[0]?{name:n[0][0],amount:n[0][1]}:null,e})).sort(((e,t)=>t.totalSubbed-e.totalSubbed))},analyzeSubs(e){const t={};return e.forEach((e=>{const n=e["Prime Recipient Name"]||"Unknown Prime",a=e["Sub-Awardee Name"]||"Unknown Sub",s=parseFloat(e["Sub-Award Amount"])||0,r=e["Awarding Agency"]||e["Awarding Sub Agency"]||"";t[a]||(t[a]={name:a,totalReceived:0,awardCount:0,primes:{},agencies:{}}),t[a].totalReceived+=s,t[a].awardCount++,t[a].primes[n]=(t[a].primes[n]||0)+s,r&&(t[a].agencies[r]=(t[a].agencies[r]||0)+s)})),Object.values(t).map((e=>{const t=Object.entries(e.primes).sort(((e,t)=>t[1]-e[1]));return e.topPrime=t[0]?{name:t[0][0],amount:t[0][1]}:null,e.primeCount=t.length,e})).sort(((e,t)=>t.totalReceived-e.totalReceived))},generatePrimeStarters(e,t,n,a={}){const s=[],r=e.slice(0,5),i=[(e,t)=>`I noticed ${e} subs out a lot of ${t} work. Is that by design, or do you just have more opportunities than bandwidth?`,(e,t)=>`How does ${e} usually find teaming partners for ${t} work—do you use capability briefs, or is it mostly through relationships?`,(e,t)=>`I'm a small shop with ${t} expertise. What would make someone like me actually useful to ${e} on a proposal?`,(e,t)=>`${e} works with ${t} different subs—that's impressive. How do you manage that many teaming relationships?`,(e,t)=>`Is ${e} actively looking to expand your ${t} bench, or are you pretty locked in with your current teammates?`],o=[(e,t)=>`I see you work a lot with ${t}. How'd that teaming relationship get started?`,(e,t)=>`${t} seems to be your go-to sub. What makes that partnership work so well?`,(e,t)=>`What's the best way to get on ${e}'s radar for future ${t} opportunities?`,e=>`Does ${e} prefer working with the same subs repeatedly, or do you mix it up based on the opportunity?`,(e,t)=>`I heard ${e} has some ${t} bids coming up. Are you already teamed, or still building your roster?`];return r.forEach(((e,t)=>{const r=e.name.split(" ").slice(0,2).join(" "),l=i[t%i.length];if((t<3||e.subVendorCount>2)&&s.push({type:"prime",target:e.name,icon:"fa-handshake",text:l(r,n,e.subVendorCount)}),e.topSub&&e.topSub.name!==a.sub){const a=e.topSub.name.split(" ").slice(0,2).join(" "),i=o[t%o.length];s.push({type:"prime",target:e.name,icon:"fa-user-friends",text:i(r,a,n)})}e.totalSubbed>1e6&&s.push({type:"prime",target:e.name,icon:"fa-chart-bar",text:`${r} subs out about ${Utils.money(e.totalSubbed)} in ${n} work. Is that a growing part of your business, or pretty stable?`})})),s.push({type:"prime",target:"General",icon:"fa-coffee",text:`I'm looking for primes who need ${n} support. Any advice on how to approach these conversations without sounding desperate?`}),s.push({type:"prime",target:"General",icon:"fa-lightbulb",text:"What makes a capability brief actually get read? I've sent a bunch out but never hear back."}),s},generateSubStarters(e,t,n,a={}){const s=[],r=e.slice(0,5),i=[(e,t)=>`I see you do a lot of ${n} work for ${t}. How'd you get on their team?`,(e,t)=>`You're teaming with ${t} different primes—do you have a favorite, or is it all the same?`,(e,t)=>`Are you looking to expand your prime relationships for ${t} work, or are you pretty maxed out?`,(e,t)=>`Is ${t} good to work with as a prime? I'm thinking about approaching them.`,(e,t)=>`What's your sweet spot in ${t}? I'm trying to figure out where there might be teaming synergies.`],o=[(e,t)=>`We might be going after similar ${t} work. Any interest in teaming instead of competing?`,e=>`I've seen ${e} on a few proposal teams. Do you mostly sub, or do you prime stuff too?`,(e,t)=>`How's the ${t} market treating you? Feels like there's more competition than ever.`,e=>"Do you prefer being a sub or going after prime contracts directly? I'm still figuring out my strategy."];return r.forEach(((e,t)=>{const r=e.name.split(" ").slice(0,2).join(" ");if(e.topPrime&&e.topPrime.name!==a.prime){const a=e.topPrime.name.split(" ").slice(0,2).join(" "),o=i[t%i.length];s.push({type:"sub",target:e.name,icon:"fa-link",text:o(r,a,e.primeCount,n)})}e.primeCount>1&&s.push({type:"sub",target:e.name,icon:"fa-network-wired",text:`${r} teams with ${e.primeCount} different primes. How do you balance those relationships without stepping on toes?`});const l=o[t%o.length];s.push({type:"sub",target:e.name,icon:"fa-users",text:l(r,n)})})),s.push({type:"sub",target:"General",icon:"fa-question-circle",text:"How do you find out about teaming opportunities before the RFP drops? I feel like I'm always late to the party."}),s.push({type:"sub",target:"General",icon:"fa-handshake",text:`Anyone here looking for ${n} teammates? I've got capacity and I'm tired of chasing primes who ghost me.`}),s},analyzeAgencies(e){const t={},n=App.drillState||{},a=n.level>=2&&n.currentSubAgency;return e.forEach((e=>{const n=a?e["Awarding Sub Agency"]||e["Awarding Agency"]||"Unknown":e["Awarding Agency"]||"Unknown",s=e["Awarding Sub Agency"]||"",r=parseFloat(e["Award Amount"])||0,i=e["Recipient Name"]||"",o=e.Description||"",l=e["PSC Description"]||"",c=e["End Date"];if(t[n]||(t[n]={name:n,totalSpend:0,count:0,vendors:{},subAgencies:{},descriptions:[],pscDescs:[],expiringSoon:[]}),t[n].totalSpend+=r,t[n].count++,t[n].vendors[i]=(t[n].vendors[i]||0)+r,s&&(t[n].subAgencies[s]=(t[n].subAgencies[s]||0)+r),o&&t[n].descriptions.push(o),l&&!t[n].pscDescs.includes(l)&&t[n].pscDescs.push(l),c){const e=new Date(c),a=(e-new Date)/2592e6;a>0&&a<18&&r>5e4&&t[n].expiringSoon.push({vendor:i,amount:r,endDate:e,desc:o})}})),Object.values(t).map((e=>{const t=Object.entries(e.vendors).sort(((e,t)=>t[1]-e[1]));return e.topVendor=t[0]?{name:t[0][0],spend:t[0][1]}:null,e.vendorCount=t.length,e})).sort(((e,t)=>t.totalSpend-e.totalSpend))},analyzeVendors(e){const t={},n=App.drillState||{},a=n.level>=2&&n.currentSubAgency;return e.forEach((e=>{const n=e["Recipient Name"]||"Unknown",s=a?e["Awarding Sub Agency"]||e["Awarding Agency"]||"":e["Awarding Agency"]||"",r=parseFloat(e["Award Amount"])||0,i=e.Description||"";t[n]||(t[n]={name:n,totalSpend:0,count:0,agencies:{},descriptions:[]}),t[n].totalSpend+=r,t[n].count++,s&&(t[n].agencies[s]=(t[n].agencies[s]||0)+r),i&&t[n].descriptions.push(i)})),Object.values(t).map((e=>{const t=Object.entries(e.agencies).sort(((e,t)=>t[1]-e[1]));return e.topAgency=t[0]?{name:t[0][0],spend:t[0][1]}:null,e.agencyCount=t.length,e})).sort(((e,t)=>t.totalSpend-e.totalSpend))},findRecompetes(e){const t=new Date,n=new Date;return n.setMonth(t.getMonth()+18),e.filter((e=>{const a=new Date(e["End Date"]);return a>t&&a<n&&(parseFloat(e["Award Amount"])||0)>1e5})).sort(((e,t)=>new Date(e["End Date"])-new Date(t["End Date"]))).slice(0,10)},generateAgencyStarters(e,t,n,a,s={}){const r=[],i=e.slice(0,5),o=e.reduce(((e,t)=>e+t.totalSpend),0),l=["I've been trying to learn more about","I'm curious about","I was reading up on","Someone mentioned that","I've heard that"];if(s.vendor){const e=s.vendor,t=e.split(" ").slice(0,2).join(" ");i.forEach((n=>{const s=n.name.replace("Department of ","").replace("Department of the ","");(n.vendors[e]||0)>0&&r.push({type:"agency",target:n.name,icon:"fa-coffee",text:`How's the ${a} world treating ${s} these days? I know ${t} has been pretty active there.`})}))}if(i.forEach(((e,t)=>{const n=(e.totalSpend/o*100).toFixed(0),i=e.name.replace("Department of ","").replace("Department of the ",""),c=l[t%l.length];if(e.pscDescs.length>0){const t=e.pscDescs[0].toLowerCase();r.push({type:"agency",target:e.name,icon:"fa-comments",text:`${c} ${i}'s ${t} initiatives. What's been the most interesting project you've seen come through lately?`})}if(e.topVendor&&e.topVendor.spend>1e6&&e.topVendor.name!==s.vendor){const t=e.topVendor.name.split(" ").slice(0,2).join(" ");r.push({type:"agency",target:e.name,icon:"fa-user-friends",text:`Do you ever work with the ${t} folks? I've seen them around ${i} a lot—curious what that world is like from the inside.`})}e.expiringSoon.slice(0,1).length>0&&r.push({type:"agency",target:e.name,icon:"fa-calendar",text:`Sounds like ${i} has some ${a} work coming up for bid. Is that something people are already talking about, or still too early?`}),n>15&&r.push({type:"agency",target:e.name,icon:"fa-lightbulb",text:`${i} seems to be doing a lot in the ${a} space. What's driving that—new mission requirements, or modernization stuff?`})})),i.length>0){const e=i[0].name.replace("Department of ","").replace("Department of the ","");r.push({type:"agency",target:"General",icon:"fa-question-circle",text:`I'm still learning the ${a} landscape. Any advice on how smaller companies can actually get in front of ${e}?`}),r.push({type:"agency",target:"General",icon:"fa-users",text:"Is this your first time at this conference, or are you a regular? I'm trying to figure out which sessions are actually worth attending."})}return r},generateVendorStarters(e,t,n,a={}){const s=[],r=e.slice(0,5),i=[(e,t,n)=>`How's the ${t} account treating ${e} these days? Seems like a busy shop.`,(e,t,n)=>`${e} and ${t}—that's a solid pairing. How'd you all originally get your foot in the door there?`,(e,t,n)=>`I've heard ${t} can be tough to work with. Has that been your experience at ${e}, or is it overblown?`,(e,t,n)=>`What's ${t} like as a customer? I'm trying to figure out if they're worth pursuing for ${n} work.`,(e,t,n)=>`Is ${t} one of those "good revenue, painful delivery" accounts, or do they actually make it easy to do good work?`];if(a.agency||a.subAgency){const e=a.subAgency||a.agency,t=e.replace("Department of ","").replace("Department of the ","");r.forEach(((a,r)=>{const o=a.name.split(" ").slice(0,2).join(" ");if((a.agencies[e]||0)>0){const e=i[r%i.length];s.push({type:"vendor",target:a.name,icon:"fa-building",text:e(o,t,n)})}}))}return r.forEach(((e,t)=>{const r=e.name.split(" ").slice(0,2).join(" ");if(e.agencyCount>1&&!a.agency){const a=e.topAgency?.name?.replace("Department of ","").replace("Department of the ","")||"different agencies";0===t?s.push({type:"vendor",target:e.name,icon:"fa-map",text:`${r} seems to be the big dog in ${n} right now. Is ${a} where most of that work is, or is it spread out?`}):1===t?s.push({type:"vendor",target:e.name,icon:"fa-compass",text:`How does ${r} decide which agencies to go after? Is it opportunistic, or do you have a real strategy around ${n}?`}):s.push({type:"vendor",target:e.name,icon:"fa-map",text:`You all work across ${e.agencyCount} agencies—that's impressive. How do you keep up with that many different customers?`})}if(e.totalSpend>5e6&&(0===t?s.push({type:"vendor",target:e.name,icon:"fa-handshake",text:`For a company like ${r}, do small businesses ever actually add value as subs, or is it mostly a compliance thing?`}):t<3?s.push({type:"vendor",target:e.name,icon:"fa-graduation-cap",text:`I'm trying to break into ${n}. What would make someone like me actually useful to ${r} on a proposal?`}):s.push({type:"vendor",target:e.name,icon:"fa-door-open",text:`What's the best way to get on ${r}'s radar for teaming? Cold emails, conferences like this, or something else?`})),e.topAgency&&e.topAgency.name!==a.agency){const a=e.topAgency.name.replace("Department of ","").replace("Department of the ","");t%3==0?s.push({type:"vendor",target:e.name,icon:"fa-coffee",text:`${a} seems to love you guys. What's the secret—great past performance, or do you just know the right people?`}):t%3==1?s.push({type:"vendor",target:e.name,icon:"fa-lightbulb",text:`How'd ${r} originally land the ${a} work? Was it a big competitive win, or did it grow from something smaller?`}):s.push({type:"vendor",target:e.name,icon:"fa-star",text:`Is ${a} a good customer to have? I'm trying to figure out where to focus my energy in the ${n} space.`})}e.count>=3&&(t%2==0?s.push({type:"vendor",target:e.name,icon:"fa-chart-line",text:`${r} has been winning a lot lately. Is it the same BD team, or did you guys hire some secret weapon?`}):s.push({type:"vendor",target:e.name,icon:"fa-trophy",text:`What's driving the ${n} wins for ${r}? Better pricing, better tech, or just better relationships?`}))})),s.push({type:"vendor",target:"General",icon:"fa-beer",text:"Long day on the floor? I'm about ready for whatever's open. Know if there's a good happy hour spot nearby?"}),s.push({type:"vendor",target:"General",icon:"fa-route",text:"Been to any good sessions? I feel like I've just been wandering the expo hall all day."}),s.push({type:"vendor",target:"General",icon:"fa-id-badge",text:"First time here—any tips? Like which booths have the best swag, or which panels are actually worth sitting through?"}),s},render(e){const t=document.getElementById("convoResultsArea");t&&(0!==e.length?t.innerHTML=e.map(((e,t)=>`\n      <div class="convo-card" data-index="${t}">\n        <div class="convo-card-label">\n          <i class="fas ${e.icon}"></i>\n          <span>${"agency"===e.type?"Agency":"Vendor"}: ${Utils.trunc(e.target,35)}</span>\n        </div>\n        <div class="convo-card-text">${e.text}</div>\n        <button class="convo-card-copy" onclick="ConvoStarters.copyOne(${t})" title="Copy this talking point">\n          <i class="fas fa-copy"></i>\n        </button>\n      </div>\n    `)).join(""):t.innerHTML='\n        <div class="convo-empty">\n          <i class="fas fa-comments"></i>\n          <p>No conversation starters could be generated. Try a different search or focus.</p>\n        </div>\n      ')},copyOne(e){const t=this.generatedStarters[e];t&&navigator.clipboard.writeText(t.text).then((()=>{const t=document.querySelector(`.convo-card[data-index="${e}"] .convo-card-copy`);t&&(t.classList.add("copied"),t.innerHTML='<i class="fas fa-check"></i>',setTimeout((()=>{t.classList.remove("copied"),t.innerHTML='<i class="fas fa-copy"></i>'}),1500))}))},copyAll(){if(0===this.generatedStarters.length)return;const e=this.generatedStarters.map(((e,t)=>`[${e.type.toUpperCase()}: ${e.target}]\n${e.text}`)).join("\n\n---\n\n"),t=`CONVERSATION STARTERS: ${App.currentQuery.toUpperCase()}\nGenerated ${(new Date).toLocaleDateString()} via Govhoo.com\n${"=".repeat(50)}\n\n`;navigator.clipboard.writeText(t+e).then((()=>{const e=document.getElementById("convoDataStatus");e&&(e.textContent="All talking points copied to clipboard!",setTimeout((()=>this.updateContext()),2e3))}))},downloadForPhone(){if(0===this.generatedStarters.length)return;const e=this.generatedStarters.map(((e,t)=>`[${e.type.toUpperCase()}: ${e.target}]\n${e.text}`)).join("\n\n---\n\n"),t=`CONVERSATION STARTERS\n${App.currentQuery.toUpperCase()}\n${(new Date).toLocaleDateString()}\nvia Govhoo.com\n${"=".repeat(30)}\n\n`,n=new Blob([t+e],{type:"text/plain;charset=utf-8;"}),a=document.createElement("a");a.href=URL.createObjectURL(n),a.download=`TalkingPoints_${App.currentQuery.replace(/[^a-zA-Z0-9]/g,"_")}_${(new Date).toISOString().split("T")[0]}.txt`,document.body.appendChild(a),a.click(),document.body.removeChild(a);const s=document.getElementById("convoDataStatus");s&&(s.textContent="Downloaded! Send to your phone or print for the event.")}};App.init(),Autocomplete.init("mainSearchInput"),Autocomplete.init("miniSearch");
</script>
</body>
</html>