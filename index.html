<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#000000">
  <meta name="color-scheme" content="dark">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 rx=%2220%22 fill=%22%23000000%22/><text y=%2250%%22 x=%2250%%22 font-size=%2265%22 font-family=%22'JetBrains Mono', monospace%22 font-weight=%22700%22 fill=%22%23426a5a%22 text-anchor=%22middle%22 dominant-baseline=%22central%22>>_</text></svg>">
  <title>Govhoo - Federal Awards Visualization</title>
  <meta name="title" content="Govhoo - Federal Awards Visualization">
  <meta name="description" content="Free Federal Sales Intelligence Strategic Planning. Follow the money with live USASpending data analysis.">
  <meta name="keywords" content="federal sales, usaspending search, government contracts, defense contracts, federal jobs, expiring contracts, federal territory planning, incumbent search">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://govhoo.com/">
  <meta property="og:title" content="Govhoo | Follow the Money">
  <meta property="og:description" content="Federal contract intelligence with live USASpending data.">
  <meta property="og:image" content="https://govhoo.com/social.png">
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:title" content="Govhoo | Federal Awards Visualization">
  <meta property="twitter:description" content="Federal contract intelligence with live USASpending data.">
  <link rel="canonical" href="https://govhoo.com/">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://kit.fontawesome.com/8ef6ca8a5d.js" crossorigin="anonymous" defer></script>
  <link rel="preconnect" href="https://api.usaspending.gov">
  <link rel="dns-prefetch" href="https://api.usaspending.gov">
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js" as="script">
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/d3-sankey/0.12.3/d3-sankey.min.js" as="script">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js" defer></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-T343V4RFHV"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-T343V4RFHV');
  </script>
<style>
:root{--bg-app:#0e1111;--bg-card:#1c2320;--bg-input:#1e2724;--bg-elevated:#232d29;--text-primary:#e8e6e1;--text-muted:#a3b2ac;--text-subtle:#5a6660;--link:#7daf9c;--accent:#4a7a67;--accent-dark:#365c4c;--accent-light:#7daf9c;--accent-dim:rgba(74,122,103,0.15);--success:#78a890;--warning:#d1bfa7;--danger:#b87e7e;--info:#7e9cb8;--border:rgba(143,158,152,0.22);--border-hover:rgba(143,158,152,0.35);--safe-top:env(safe-area-inset-top,20px);--safe-bottom:env(safe-area-inset-bottom,20px)}*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}body{margin:0;padding:0;font-family:JetBrains Mono,monospace;background:var(--bg-app);color:var(--text-primary);min-height:100vh;overflow-x:hidden;width:100%}::-webkit-scrollbar{width:8px;height:8px}::-webkit-scrollbar-track{background:var(--bg-app)}::-webkit-scrollbar-thumb{background:var(--bg-elevated);border:1px solid var(--border);border-radius:4px}::-webkit-scrollbar-thumb:hover{background:var(--accent-dim)}.view-section{display:none}.view-section.active{display:block;animation:fadeIn .5s ease}.loader{position:fixed;inset:0;z-index:300;background:rgba(14,18,17,.95);display:none;flex-direction:column;align-items:center;justify-content:center}.spinner{width:40px;height:40px;border:2px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .8s linear infinite}@keyframes spin{to{transform:rotate(1turn)}}@keyframes fadeIn{0%{opacity:0;transform:translateY(5px)}to{opacity:1;transform:translateY(0)}}@keyframes subtlePulse{0%,to{box-shadow:0 0 0 0 rgba(66,106,90,0)}50%{box-shadow:0 0 0 4px rgba(66,106,90,.08)}}.main-input,.mini-search,select,textarea{width:100%;background:var(--bg-input)!important;border:1px solid var(--border)!important;color:#f1eee9!important;padding:1.25rem 1rem;font-size:1.1rem;border-radius:8px;font-family:JetBrains Mono,monospace;transition:border-color .2s;-webkit-appearance:none;box-shadow:0 4px 12px rgba(0,0,0,.2)}.main-input:focus,.mini-search:focus{outline:none;border-color:var(--accent)!important;background:#222}.btn-row{display:flex;gap:.75rem;margin-top:1rem}#searchBtn,.btn-primary{flex:1;padding:1rem;font-weight:700;border:1px solid var(--accent)!important;background:var(--accent)!important;color:#f1eee9!important;border-radius:4px;font-size:.9rem;cursor:pointer;text-transform:uppercase;letter-spacing:1px;display:flex;align-items:center;justify-content:center;gap:.5rem;box-shadow:0 2px 4px rgba(0,0,0,.2)!important;transition:all .2s ease;font-family:JetBrains Mono,monospace}#searchBtn:hover,.btn-primary:hover{background:var(--accent-dark)!important;border-color:var(--accent-dark)!important;transform:translateY(-1px);opacity:1}.action-btn{background:var(--bg-input);color:var(--accent);text-decoration:none;padding:.5rem 1rem;border-radius:4px;font-size:.8rem;font-weight:600;border:1px solid var(--border);display:flex;align-items:center;gap:6px}.action-btn:hover{border-color:var(--accent);background:var(--accent-dim)}.input-clear{position:absolute;right:12px;top:50%;transform:translateY(-50%);background:none;border:none;color:var(--text-muted);font-size:1.25rem;cursor:pointer;display:none;padding:4px 8px;z-index:215;line-height:1;align-items:center;justify-content:center}.input-clear:hover{color:var(--accent)!important;opacity:1;transform:translateY(-50%) scale(1.1);transition:all .15s ease}.hero-view,.input-clear.visible{display:flex}.hero-view{position:fixed;inset:0;z-index:200;flex-direction:column;align-items:center;justify-content:flex-start;padding:2rem;padding-top:max(8vh,var(--safe-top));transition:transform .5s cubic-bezier(.16,1,.3,1);overflow-y:auto}.hero-view.slide-up{transform:translateY(-100%)}.hero-view.hidden{display:none}.terminal-logo{font-family:JetBrains Mono,monospace;font-size:2.5rem;font-weight:700;margin-bottom:.5rem;color:#f1eee9;letter-spacing:-1px;text-align:center}.terminal-logo span{color:var(--accent-light)}.hero-subtitle{margin-bottom:2rem;text-align:center;font-family:JetBrains Mono,monospace;font-size:.85rem;color:var(--text-muted)}.search-box-container{position:relative;z-index:210;width:100%;max-width:500px;margin-top:1.5rem}#heroView .search-box-container{display:flex;flex-direction:column;gap:12px}#heroView .main-input,#searchBtn{height:56px;border-radius:6px!important}#searchBtn{font-weight:800!important;letter-spacing:2px}#heroView a[href^="?q="]{background:hsla(0,0%,100%,.03)!important;border:1px solid var(--border)!important;color:var(--text-muted)!important;border-radius:20px!important;padding:6px 16px!important;font-size:.75rem;letter-spacing:.5px}#heroView a[href^="?q="]:hover{background:var(--accent-dim)!important;color:var(--accent-light)!important;border-color:var(--accent)!important;transform:translateY(-1px)}.autocomplete-wrapper{position:relative}.autocomplete-dropdown{position:absolute;top:100%;left:0;right:0;z-index:220;background:var(--bg-card);border:1px solid var(--border);border-top:none;border-radius:0 0 4px 4px;max-height:320px;overflow-y:auto;display:none}.autocomplete-dropdown.active{display:block}.autocomplete-section{padding:.5rem 0;border-bottom:1px solid var(--border)}.autocomplete-section:last-child{border-bottom:none}.autocomplete-section-label{padding:.25rem 1rem;font-size:.65rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:1px;font-family:JetBrains Mono,monospace}.autocomplete-item{padding:.6rem 1rem;cursor:pointer;display:flex;align-items:center;gap:.75rem;font-size:.9rem;color:var(--text-primary);transition:background .1s}.autocomplete-item.selected,.autocomplete-item:hover{background:hsla(0,0%,100%,.05)}.autocomplete-item i{color:var(--text-muted);width:16px;text-align:center;font-size:.8rem}.autocomplete-item-text{flex:1;min-width:0}.autocomplete-item-main{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.autocomplete-item-sub{font-size:.7rem;color:var(--text-muted);margin-top:2px}.autocomplete-empty{padding:1rem;text-align:center;color:var(--text-muted);font-size:.85rem}.app-header{position:sticky;top:0;z-index:100;background:rgba(14,18,17,.95);backdrop-filter:blur(10px);padding:.6rem 1rem;padding-top:max(.6rem,var(--safe-top));border-bottom:1px solid var(--border);justify-content:space-between;overflow:hidden}.app-header,.header-left{display:flex;align-items:center;gap:.75rem}.header-left{flex:1;min-width:0}.logo-btn{font-family:JetBrains Mono;font-weight:700;font-size:1.1rem;color:#f1eee9;cursor:pointer;flex-shrink:0;padding:.25rem}.logo-btn:hover,.logo-btn span{color:var(--accent)}.mini-search{background:var(--bg-input);border:1px solid var(--border);color:#f1eee9;padding:.5rem 1rem;border-radius:4px;font-size:.9rem;flex:1;min-width:0;width:100%}.mini-search-wrapper{flex:1;min-width:0;overflow:hidden}.header-actions{gap:.4rem;flex-shrink:0}.header-actions,.icon-btn{display:flex;align-items:center}.icon-btn{background:var(--accent);border:none;color:#f1eee9;width:34px;height:34px;border-radius:50%;justify-content:center;cursor:pointer;font-size:14px;font-family:JetBrains Mono,monospace;transition:opacity .15s ease,transform .15s ease}.icon-btn:hover{opacity:.82;transform:scale(1.08);color:#f1eee9}.icon-btn.active{background:var(--accent-light);color:#f1eee9}.icon-btn-slack{background:#5b7c99!important}.icon-btn-slack:hover{background:#6c8daa!important;transform:translateY(-1px)}.icon-btn-csv{background:#466d5c!important}.icon-btn-csv:hover{background:#577e6d!important;transform:translateY(-1px)}.icon-btn-pres{background:#e07a5f!important;color:#f1eee9!important}.icon-btn-pres:hover{background:#f18b70!important;transform:translateY(-1px)}.icon-btn-pres.active{background:#f18b70!important;color:#f1eee9!important}.dashboard-container{padding:1rem;padding-bottom:calc(2rem + var(--safe-bottom));max-width:1400px;margin:0 auto;display:none;width:100%}.dashboard-container.active{display:block;animation:fadeIn .8s forwards}.section-header{justify-content:space-between;margin:2rem 0 1rem;border-bottom:1px solid var(--border);padding-bottom:.5rem;flex-wrap:wrap}.section-header,.section-title-group{display:flex;align-items:center;gap:.5rem}.section-title{font-family:JetBrains Mono,monospace;font-size:.9rem;font-weight:700!important;color:#f1eee9!important;text-transform:uppercase;letter-spacing:2px}.section-subtitle{font-size:.75rem;color:var(--text-primary);opacity:.65;font-style:italic}.chart-wrapper{background:transparent!important;border:none!important;border-radius:4px;padding:1rem;width:100%;overflow-x:auto;overflow-y:visible;box-shadow:none!important}.chart-container{width:100%;min-height:500px;height:auto;display:block}svg{border:none!important;outline:none!important}.feed-grid{display:flex;flex-direction:column;gap:1rem}.explainer-highlight{background:#466d5c;padding:1px 3px;border-radius:2px;font-style:normal;color:var(--text-primary)}.deal-card{border-radius:4px;transition:transform .1s}.deal-card:active{transform:scale(.99)}#feedGrid .deal-card:nth-child(n+4){opacity:.7}#feedGrid .deal-card:nth-child(n+4):hover{opacity:1}.deal-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:.75rem}.deal-agency{font-size:.75rem;color:var(--text-muted);font-weight:600;text-transform:uppercase;background:hsla(0,0%,100%,.05);padding:2px 6px;border-radius:4px}.deal-amount{font-family:JetBrains Mono,monospace!important;color:#f1eee9!important;font-weight:700;font-size:1rem;letter-spacing:-.5px}.deal-desc{font-size:1rem;font-weight:600;margin-bottom:.5rem;line-height:1.4;color:#fff}.deal-vendor{font-size:.85rem;color:var(--info);margin-bottom:.75rem;font-family:JetBrains Mono,monospace}.deal-meta{display:flex;flex-wrap:wrap;gap:.5rem;margin-bottom:1rem}.deal-footer{display:flex;justify-content:space-between;align-items:center;padding-top:1rem;border-top:1px solid #222}.deal-date,.mission-gap-signals{letter-spacing:1px;opacity:.5}.deal-date,.deal-footer .action-btn,.mission-gap-signals{font-family:JetBrains Mono,monospace;font-size:.65rem!important;text-transform:uppercase;color:var(--text-primary)!important}.deal-footer .action-btn{background:transparent!important;border:1px solid rgba(251,247,245,.3)!important;font-weight:700;letter-spacing:.5px;padding:.5rem .75rem;transition:all .2s ease}.deal-footer .action-btn:hover{background:rgba(251,247,245,.08)!important;border-color:var(--text-primary)!important;color:#f1eee9!important}.meta-tag{font-size:.65rem;font-family:JetBrains Mono,monospace;padding:3px 8px;border-radius:4px;background:rgba(251,247,245,.05)!important;color:var(--text-muted)!important;border:1px solid transparent!important;font-weight:600}.meta-tag.psc{background:rgba(126,156,184,.15)!important;color:var(--info)!important}.meta-tag.naics{background:rgba(155,142,169,.15)!important;color:#9b8ea9!important}.meta-tag.mission-gap{font-weight:600}.meta-tag.mission-gap.high{background:rgba(251,128,114,.15)!important;border-color:var(--danger)!important;color:var(--danger)!important}.meta-tag.mission-gap.medium{background:rgba(253,216,53,.15)!important;border-color:var(--warning)!important;color:var(--warning)!important}.meta-tag.mission-gap.low{background:hsla(0,0%,100%,.05)!important;border-color:var(--border)!important;color:var(--text-muted)!important}.mission-gap-filter{display:flex;align-items:center;gap:.5rem}.mission-gap-toggle{display:inline-flex;align-items:center;justify-content:center;gap:.4rem;padding:0 12px;height:34px;min-width:34px;background:#e07a5f!important;border:none!important;border-radius:34px;font-size:.7rem;font-family:JetBrains Mono,monospace;color:#f1eee9!important;font-weight:700;cursor:pointer;transition:opacity .15s,transform .15s;white-space:nowrap}.mission-gap-toggle:hover{opacity:.82;transform:scale(1.04);color:#f1eee9!important}.mission-gap-toggle.active{background:#a7a9ac!important;color:#f1eee9!important;opacity:1}.mission-gap-toggle i{font-size:.65rem;color:#f1eee9!important}#searchJobPanel{overflow:hidden;max-width:100%;box-sizing:border-box}.job-intel-panel{background:var(--bg-card);border:1px solid var(--border)!important;border-radius:6px;padding:1rem;overflow:hidden}.job-link{font-size:.65rem;color:#5b7c99;text-decoration:none;display:inline-flex;align-items:center;gap:3px;padding:2px 6px;border-radius:3px;background:rgba(91,124,153,.1);border:1px solid rgba(91,124,153,.2);transition:all .15s}.job-link:hover{background:rgba(91,124,153,.2);border-color:rgba(91,124,153,.4);color:#f2e8cf}.job-link i{font-size:.6rem}.reach-row{display:flex;align-items:flex-start;justify-content:space-between;padding:.55rem .35rem;gap:.5rem;cursor:pointer;border-bottom:1px solid hsla(0,0%,100%,.07);border-radius:4px;transition:background .15s}.reach-row:hover{background:hsla(0,0%,100%,.06)}.reach-row:last-child{border-bottom:none}.reach-name{font-size:.8rem;font-weight:600;color:var(--text-primary);text-decoration:underline;text-decoration-color:hsla(0,0%,100%,.15);text-underline-offset:2px}.reach-row:hover .reach-name{text-decoration-color:var(--accent);color:var(--accent)}.reach-badge{font-family:JetBrains Mono,monospace;font-size:.55rem;padding:.1rem .35rem;background:rgba(119,141,169,.12);color:#778da9;border-radius:3px;white-space:nowrap}.reach-badge.accent{background:rgba(74,122,103,.15);color:var(--accent-light)}.reach-meta{font-size:.6rem;color:var(--text-muted);margin-top:.15rem;line-height:1.4}.reach-amount{font-size:.8rem;font-weight:600;color:#f2e8cf}.reach-amount,.reach-count{font-family:JetBrains Mono,monospace}.reach-count{font-size:.55rem;color:#778da9}.reach-overflow{font-size:.55rem;color:var(--text-muted);text-align:center;margin-top:.35rem}.data-panel{background:var(--bg-card);border:1px solid var(--border);border-radius:10px;margin-bottom:.75rem;overflow:hidden}.data-panel-header{display:flex;align-items:baseline;justify-content:space-between;padding:.65rem 1rem .35rem;border-bottom:1px solid hsla(0,0%,100%,.08)}.data-panel-title{font-family:JetBrains Mono,monospace;font-size:.6rem;color:var(--accent-light);text-transform:uppercase;letter-spacing:1.5px;font-weight:600}.data-panel-subtitle{font-family:JetBrains Mono,monospace;font-size:.45rem;color:var(--text-muted)}.data-panel-body{padding:.35rem 1rem .75rem}.drill-controls-bar{padding:.5rem .75rem;border-radius:8px;background:hsla(0,0%,100%,.02);border:1px solid var(--border)}.drill-breadcrumb{display:flex;gap:.35rem!important;padding:.75rem 1rem;background:var(--accent-dim);border:1px solid var(--border);border-radius:4px;margin-bottom:1rem;font-size:.8rem;overflow-x:auto;white-space:nowrap}.breadcrumb-item,.drill-breadcrumb{align-items:center;font-family:JetBrains Mono,monospace}.breadcrumb-item{padding:.25rem .5rem;border-radius:6px;border:1px solid var(--border);background:transparent;color:var(--text-muted);font-size:.72rem;line-height:1.1;display:inline-flex;gap:.35rem;cursor:pointer;transition:opacity .15s ease,transform .15s ease}.breadcrumb-item:hover{opacity:.92;transform:scale(1.02);color:var(--text-primary)}.breadcrumb-item.active{background:var(--accent-dim);color:var(--accent);border:1px solid var(--accent);cursor:default}.breadcrumb-icon{font-size:.72rem;opacity:.75}.breadcrumb-separator{color:var(--text-subtle);font-size:.8rem;font-weight:700}.drill-hint{display:flex;align-items:center;justify-content:center;gap:.5rem;padding:.5rem;background:rgba(212,196,168,.05);border:1px dashed var(--border);border-radius:4px;margin-top:.5rem;font-size:.75rem;color:var(--text-muted)}.drill-hint i{color:var(--accent)}#drillControlsBar>div{gap:.5rem!important}#bubbleChartPanel{background:var(--bg-card);border:1px solid var(--border);border-radius:8px;padding:.75rem;margin-bottom:1.5rem;overflow:hidden}#bubbleChartPanel .bubble-header{font-family:JetBrains Mono,monospace;font-size:.6rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:.5rem}#bubbleChartContainer,#subBubbleContainer{width:100%;position:relative}#bubbleChartContainer{min-height:420px}#bubbleChartContainer svg,#subBubbleContainer svg{width:100%;height:100%;display:block}.bubble-node{cursor:pointer;transition:opacity .15s ease}.bubble-node:hover{opacity:.85!important}.bubble-label{fill:#f1eee9;dominant-baseline:central}.bubble-amount-label,.bubble-label{font-family:JetBrains Mono,monospace;pointer-events:none;text-anchor:middle}.bubble-amount-label{fill:rgba(241,238,233,.7)}.bubble-tooltip{position:absolute;background:rgba(22,27,24,.95);border:1px solid var(--border);border-radius:6px;padding:.75rem 1rem;font-family:JetBrains Mono,monospace;font-size:.75rem;color:var(--text-primary);pointer-events:none;z-index:50;white-space:nowrap;backdrop-filter:blur(8px);box-shadow:0 4px 12px rgba(0,0,0,.4);opacity:0;transition:opacity .15s ease}.bubble-tooltip.visible{opacity:1}.bubble-tooltip-name{font-weight:700;color:#f1eee9;margin-bottom:4px}.bubble-tooltip-amount{color:var(--accent-light);font-size:.85rem;font-weight:700}.bubble-tooltip-meta{color:var(--text-muted);font-size:.65rem;margin-top:4px}.bubble-toggle-row{display:flex;gap:.5rem;margin-bottom:1rem}.bubble-toggle-btn{padding:.35rem .75rem;font-family:JetBrains Mono,monospace;font-size:.65rem;font-weight:700;text-transform:uppercase;letter-spacing:.5px;border:1px solid var(--border);border-radius:4px;background:transparent;color:var(--text-muted);cursor:pointer;transition:all .15s ease}.bubble-toggle-btn.active{background:var(--accent);border-color:var(--accent);color:#f1eee9}.bubble-toggle-btn:hover:not(.active){border-color:var(--accent);color:var(--accent-light)}.bubble-bc-item{display:inline-flex;align-items:center;gap:4px;padding:.2rem .5rem;border-radius:4px;color:var(--text-muted);font-family:JetBrains Mono,monospace;font-size:.7rem;cursor:pointer;transition:all .15s ease;white-space:nowrap}.bubble-bc-item:hover{color:var(--accent-light);background:hsla(0,0%,100%,.05)}.bubble-bc-item.active{color:#f1eee9;font-weight:700;cursor:default}.bubble-bc-item.active:hover{background:transparent}.bubble-bc-sep{color:var(--text-subtle);font-size:.55rem}.hero-footer{width:100%;max-width:1200px;margin:3rem auto 0;padding-top:2rem}.dashboard-container .hero-footer{margin:4rem auto 0;padding-bottom:2rem;animation:fadeIn 1s forwards}.dashboard-container .hero-footer .footer-grid{gap:2rem}.footer-grid{display:grid;grid-template-columns:1fr;gap:2rem}@media (min-width:768px){.footer-grid{grid-template-columns:1fr 1fr 1fr;gap:2rem}.footer-section{border-bottom:none;padding-bottom:0}}.footer-section{padding-bottom:1.5rem;border-bottom:1px solid hsla(0,0%,100%,.1)}.footer-section:last-child{border-bottom:none;padding-bottom:0}.footer-label{font-family:JetBrains Mono,monospace;font-size:.65rem;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--accent);margin-bottom:.75rem}.footer-text{overflow:hidden;font-size:.8rem;line-height:1.6;color:var(--text-primary);opacity:.65;margin-bottom:.75rem}.footer-text:last-child{margin-bottom:0}.footer-link{font-family:JetBrains Mono,monospace;font-size:.7rem;color:var(--link);text-decoration:none;text-transform:uppercase;letter-spacing:.5px;font-weight:700;padding-bottom:2px;border-bottom:1px solid var(--accent);transition:opacity .2s ease}.footer-link:hover{opacity:.7}.use-cases{display:flex;flex-direction:column;gap:1rem}.use-case{padding:.875rem;background:hsla(0,0%,100%,.02);border-left:2px solid var(--accent)}.use-case-title{font-family:JetBrains Mono,monospace;font-size:.7rem;font-weight:700;color:var(--text-primary);margin-bottom:.375rem;text-transform:uppercase;letter-spacing:.5px}.use-case-desc{font-size:.75rem;color:var(--text-muted);line-height:1.5}.tip-bio-img{width:48px;height:48px;border-radius:50%;filter:grayscale(1) contrast(1.1);flex-shrink:0;float:left;margin-right:12px;margin-bottom:4px}.sankey-loaded{animation:subtlePulse 2s ease-in-out 1}.footer-copyright{font-family:JetBrains Mono,monospace;font-size:.65rem;color:var(--text);letter-spacing:.5px;margin-top:1rem;text-align:center}.steps-list li{position:relative;padding-left:3rem;margin-bottom:1.25rem;font-size:.85rem;color:var(--text-primary);line-height:1.5}.steps-list li:before{content:counter(step-counter);counter-increment:step-counter;position:absolute;left:0;top:0;width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;font-family:JetBrains Mono,monospace}.steps-list li strong{color:var(--accent-light)}.steps-list{counter-reset:step-counter}.steps-list li:first-child:before{background-color:#5b7c99!important;color:#f1eee9!important;box-shadow:0 0 0 2px #0e1111}.steps-list li:nth-child(2):before{background-color:#7b6d8d!important;color:#f1eee9!important;box-shadow:0 0 0 2px #0e1111}.steps-list li:nth-child(3):before{background-color:#e07a5f!important;color:#f1eee9!important;box-shadow:0 0 0 2px #0e1111}.presentation-mode #bubbleChartPanel,.presentation-mode #sankeyPanel,.presentation-mode #subBubblePanel,.presentation-mode #subcontractingPanel{background:#fff!important;border-color:#e0e0e0!important}.presentation-mode #bubbleChartPanel *,.presentation-mode #sankeyPanel *,.presentation-mode #subBubblePanel *,.presentation-mode #subcontractingPanel *{--text-primary:#1a1a1a;--text-muted:#666;--text-subtle:#999;--border:rgba(0,0,0,0.12)}.presentation-mode #bubble-stat-agencies,.presentation-mode #bubble-stat-count,.presentation-mode #bubble-stat-entities,.presentation-mode #bubble-stat-vendors,.presentation-mode #bubble-stat-vol,.presentation-mode #stat-agencies,.presentation-mode #stat-count,.presentation-mode #stat-vendors,.presentation-mode #stat-vol,.presentation-mode #sub-bubble-stat-primes,.presentation-mode #sub-bubble-stat-records,.presentation-mode #sub-bubble-stat-shown,.presentation-mode #sub-bubble-stat-subs,.presentation-mode #sub-bubble-stat-vol,.presentation-mode #sub-stat-count,.presentation-mode #sub-stat-primes,.presentation-mode #sub-stat-subs,.presentation-mode #sub-stat-vol{color:#1a1a1a!important}.presentation-mode #bubbleChartSubtitle,.presentation-mode #sankeySubtitle,.presentation-mode #subBubbleSubtitle,.presentation-mode .bubble-header{color:#666!important}.presentation-mode #bubbleChartPanel span[style*="text-transform: uppercase"],.presentation-mode #sankeyPanel span[style*="text-transform: uppercase"],.presentation-mode #subBubblePanel span[style*="text-transform: uppercase"],.presentation-mode #subcontractingPanel span[style*="text-transform: uppercase"]{color:#888!important}.presentation-mode #bubbleChartPanel div[style*=border-left],.presentation-mode #bubbleChartPanel div[style*=border-top],.presentation-mode #sankeyPanel div[style*=border-left],.presentation-mode #sankeyPanel div[style*=border-top],.presentation-mode #subBubblePanel div[style*=border-left],.presentation-mode #subBubblePanel div[style*=border-top],.presentation-mode #subcontractingPanel div[style*=border-left],.presentation-mode #subcontractingPanel div[style*=border-top]{border-color:#e0e0e0!important}.presentation-mode #bubbleChartPanel>div:last-child,.presentation-mode #sankeyPanel>div:last-child,.presentation-mode #subBubblePanel>div:last-child{color:#999!important}.presentation-mode .bubble-label{fill:#1a1a1a!important}.presentation-mode .bubble-amount-label{fill:rgba(26,26,26,.65)!important}.presentation-mode .bubble-bc-item{color:#666}.presentation-mode .bubble-bc-item:hover{color:var(--accent);background:rgba(0,0,0,.05)}.presentation-mode .bubble-bc-item.active{color:#1a1a1a}.presentation-mode .bubble-bc-sep{color:#ccc}.presentation-mode #bubbleBreadcrumb,.presentation-mode #subBubbleBreadcrumb{background:rgba(0,0,0,.03)!important;border-color:#e0e0e0!important}.presentation-mode .bubble-tooltip{background:hsla(0,0%,100%,.96)!important;border-color:#ddd!important;color:#1a1a1a!important;box-shadow:0 4px 16px rgba(0,0,0,.12)}.presentation-mode .bubble-tooltip-name{color:#1a1a1a!important}.presentation-mode .bubble-tooltip-amount{color:var(--accent)!important}.presentation-mode .bubble-tooltip-meta{color:#666!important}.presentation-mode .bubble-toggle-btn{border-color:#ddd!important;color:#888!important}.presentation-mode .bubble-toggle-btn.active{background:var(--accent)!important;border-color:var(--accent)!important;color:#fff!important}.presentation-mode .bubble-toggle-btn:hover:not(.active){border-color:var(--accent)!important;color:var(--accent)!important}.ai-banner{background:var(--accent);border:1px solid var(--accent-dark);border-radius:8px;padding:1rem 1.25rem;margin-bottom:1.5rem;display:flex;justify-content:space-between;align-items:center;gap:1rem;box-shadow:0 6px 16px rgba(0,0,0,.25)}.ai-banner-wrapper{flex:1;min-width:0;display:flow-root}.ai-avatar-float{float:left;width:60px;height:60px;object-fit:contain;margin-right:14px;margin-bottom:4px}.ai-banner-title{margin:0 0 4px;color:#f1eee9;font-size:.95rem;text-transform:uppercase;letter-spacing:1px;font-weight:800;line-height:1.2;padding-top:4px}.ai-banner-desc{margin:0;color:#f1eee9;font-size:.85rem;line-height:1.4;opacity:.9}.btn-ai{background:#f1eee9!important;color:var(--accent)!important;border:none!important;border-radius:6px;cursor:pointer;font-family:JetBrains Mono,monospace;font-weight:800;padding:.6rem 1.2rem;transition:all .15s ease;box-shadow:0 4px 12px rgba(0,0,0,.15)!important;flex-shrink:0;white-space:nowrap}.btn-ai:hover{background:#fff!important;transform:translateY(-1px);box-shadow:0 6px 16px rgba(0,0,0,.25)!important}.ai-action-panel{background:var(--bg-card);border:1px solid var(--border);border-radius:8px;padding:1.5rem;margin-bottom:1.5rem;display:none;box-shadow:0 8px 24px rgba(0,0,0,.3);position:relative;scroll-margin-top:90px}.ai-header{display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--border);padding-bottom:1rem;margin-bottom:1.25rem}.ai-header h3{margin:0;color:#f1eee9;font-size:.95rem;text-transform:uppercase;letter-spacing:1px;font-weight:800}.ai-result-content{font-size:.85rem;color:var(--text-primary);line-height:1.6}.strategic-read h1,.strategic-read h2,.strategic-read h3{color:var(--accent-light);margin-top:1.5rem;margin-bottom:.75rem;font-size:.9rem;text-transform:uppercase;letter-spacing:1px;border-bottom:1px solid hsla(0,0%,100%,.05);padding-bottom:.25rem}.strategic-read h1:first-child,.strategic-read h2:first-child{margin-top:0}.strategic-read ul{padding-left:1.25rem;margin-bottom:1.25rem}.strategic-read li{margin-bottom:.5rem;color:var(--text-muted)}.strategic-read strong{color:#f1eee9;font-weight:700}.ai-avatar{width:72px;height:72px;object-fit:contain;flex-shrink:0}.ai-avatar.small{width:42px;height:42px}.ai-header-title{display:flex;align-items:center;gap:1rem}.btn-ai-outline{background:transparent;border:1px solid rgba(74,122,103,.4);color:var(--accent-light);border-radius:4px;padding:.4rem .75rem;font-size:.7rem;font-weight:700;font-family:JetBrains Mono,monospace;cursor:pointer;transition:all .2s ease;letter-spacing:1px}.btn-ai-outline:hover{background:rgba(74,122,103,.15);border-color:var(--accent);color:#f1eee9}.ai-chat-history{margin-top:1.5rem;border-top:1px dashed rgba(74,122,103,.4);padding-top:1.5rem;display:flex;flex-direction:column;gap:1.5rem}.ai-msg-user{align-self:flex-end;background:var(--bg-input);border:1px solid var(--border);padding:.75rem 1rem;border-radius:6px 6px 0 6px;color:var(--text-primary);max-width:85%;font-size:.85rem;line-height:1.5;font-family:JetBrains Mono,monospace}.ai-msg-arti{align-self:flex-start;display:flex;gap:1rem;max-width:95%}.ai-msg-arti .strategic-read{margin-top:-1.25rem;flex:1;min-width:0}.ai-msg-arti .strategic-read h1,.ai-msg-arti .strategic-read h2,.ai-msg-arti .strategic-read h3{margin-top:.75rem;font-size:.8rem;padding-bottom:.15rem}.ai-msg-arti .strategic-read p:first-child{margin-top:0}.ai-msg-arti .strategic-read p:last-child{margin-bottom:0}.ai-msg-arti .strategic-read ul{margin-bottom:.5rem}.ai-chat-input-wrapper{display:flex;gap:.5rem;margin-top:1.5rem}#aiChatInput{flex:1;min-width:0}@keyframes artiPulse{0%{opacity:.4;transform:scale(.95)}50%{opacity:1;transform:scale(1.05)}to{opacity:.4;transform:scale(.95)}}.arti-thinking .ai-avatar{animation:artiPulse 1.5s ease-in-out infinite}.ai-chat-input-wrapper button:disabled,.ai-chat-input-wrapper input:disabled{opacity:.5;cursor:not-allowed}.ai-chat-counter{font-size:.8rem;text-align:right;margin-top:.5rem;opacity:.9;transition:color .3s ease}.ai-chat-counter,.ai-disclaimer{color:#f1eee9;font-family:JetBrains Mono,monospace}.ai-disclaimer{font-size:.7rem;opacity:.85;text-align:left;margin-top:.9rem;line-height:1.4}#aiChatSendBtn{cursor:pointer;touch-action:manipulation;-webkit-tap-highlight-color:transparent}.ai-msg-arti,.ai-msg-user{scroll-margin-top:100px}.arti-fab{position:fixed;bottom:max(24px,env(safe-area-inset-bottom,24px));right:20px;z-index:9999;width:64px;height:64px;border-radius:50%;background:var(--accent);border:2px solid var(--accent-light);box-shadow:0 6px 16px rgba(0,0,0,.4);cursor:pointer;display:none;align-items:center;justify-content:center;padding:0;transition:transform .2s ease,box-shadow .2s ease;-webkit-tap-highlight-color:transparent}.arti-fab:active{transform:scale(.95)}.arti-fab img{width:44px;height:44px;object-fit:contain}@keyframes fabPopIn{0%{opacity:0;transform:scale(.5) translateY(20px)}to{opacity:1;transform:scale(1) translateY(0)}}@keyframes govhooScan{0%{transform:translateX(-100%)}to{transform:translateX(300%)}}.govhoo-progress-bar{width:100%;height:6px;background:hsla(0,0%,100%,.05);border-radius:4px;overflow:hidden;position:relative;border:1px solid var(--border);margin-top:1.25rem}.govhoo-progress-fill{position:absolute;top:0;left:0;height:100%;width:0;background:var(--accent);border-radius:4px;transition:width .2s ease-out}.govhoo-progress-glow{position:absolute;top:0;left:0;width:50%;height:100%;background:linear-gradient(90deg,transparent,hsla(0,0%,100%,.4),transparent);animation:govhooScan 1.5s linear infinite}@media (max-width:900px){.chart-wrapper{overflow-x:scroll!important;-webkit-overflow-scrolling:touch}}@media (max-width:768px){.dashboard-container{width:100%!important;max-width:100%!important;padding-left:1rem!important;padding-right:1rem!important;overflow-x:hidden!important}.job-intel-panel>div{grid-template-columns:1fr!important}.btn-row{flex-direction:column}.chart-container{min-width:auto;width:100%}.sankey-panel{padding:.5rem!important}.reach-row{padding:.7rem .5rem;min-height:60px}.reach-amount,.reach-name{font-size:.75rem}.data-panel{border-radius:8px;margin-bottom:.6rem}.data-panel-header{padding:.55rem .75rem .3rem}.data-panel-title{font-size:.55rem}.data-panel-body{padding:.25rem .75rem .6rem}.job-link{min-height:44px;min-width:44px;display:inline-flex;align-items:center;justify-content:center;padding:8px 12px;font-size:.7rem}.meta-tag{min-height:36px;padding:6px 10px;font-size:.65rem}.breadcrumb-item{min-height:44px;padding:8px 12px;display:inline-flex;align-items:center}.icon-btn{width:44px;height:44px;font-size:16px}.action-btn{min-height:44px;padding:8px 12px}.bubble-bc-item{min-height:40px;padding:8px 10px}.bubble-toggle-btn{min-height:40px;padding:8px 12px}.deal-footer .action-btn{min-height:44px}.main-input,.mini-search,input,select,textarea{font-size:16px!important}.arti-fab.visible{display:flex;animation:fabPopIn .4s cubic-bezier(.175,.885,.32,1.275) forwards}}@media (max-width:600px){.app-header{gap:.5rem;padding:.5rem .75rem}.header-left{gap:.5rem}.mini-search{max-width:none;padding:.5rem .6rem;font-size:16px}.logo-btn{font-size:.9rem}.header-actions{gap:.35rem}.job-links{gap:6px}#bubbleChartContainer{min-height:320px}.ai-banner{flex-direction:column;align-items:stretch;padding:.85rem;gap:0}.ai-avatar-float{width:50px;height:50px;margin-right:12px;margin-bottom:2px}.ai-banner-title{font-size:.85rem;padding-top:2px;margin-bottom:2px}.ai-banner-desc{font-size:.75rem;display:block!important}.ai-banner .btn-ai{width:100%;padding:.6rem;font-size:.75rem;margin-top:.75rem;justify-content:center}.ai-avatar{width:48px;height:48px}.ai-msg-arti{flex-direction:column;align-items:flex-start;gap:.75rem;max-width:100%}.ai-msg-arti .strategic-read{margin-top:0;width:100%}.ai-chat-history .ai-avatar.small{width:48px;height:48px}.ai-msg-user{max-width:95%;padding:.6rem .85rem}.ai-chat-input-wrapper{gap:.4rem}#aiChatSendBtn{padding:0 .8rem;font-size:.8rem}}@media (max-width:520px){.drill-controls-bar{padding:.5rem .6rem}.breadcrumb-item{font-size:.7rem;padding:.22rem .45rem}}.bubble-toggle-row,.chart-wrapper,.drill-breadcrumb{scrollbar-width:none;-ms-overflow-style:none}.bubble-toggle-row::-webkit-scrollbar,.chart-wrapper::-webkit-scrollbar,.drill-breadcrumb::-webkit-scrollbar{display:none}.bubble-tooltip{background:rgba(22,27,24,.85)!important;backdrop-filter:blur(12px) saturate(180%);-webkit-backdrop-filter:blur(12px) saturate(180%);border:1px solid hsla(0,0%,100%,.1)!important}.arti-fab{background:rgba(74,122,103,.9);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px)}.deal-card{background:var(--bg-card);border:1px solid var(--border)!important;border-radius:6px;padding:1.25rem;transition:all .2s cubic-bezier(.16,1,.3,1);box-shadow:0 2px 8px rgba(0,0,0,.15);cursor:pointer}.deal-card:hover{transform:translateY(-3px);border-color:var(--accent)!important;box-shadow:0 8px 24px rgba(0,0,0,.4),0 0 0 1px rgba(74,122,103,.2);background:#1f2724}.deal-card:active{transform:translateY(0) scale(.99)}body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif}.breadcrumb-item,.deal-agency,.deal-amount,.deal-date,.deal-vendor,.footer-link,.meta-tag,.reach-amount,.reach-badge,.section-title,.terminal-logo,button,h1,h2,h3,h4,h5,h6,input,select,textarea{font-family:JetBrains Mono,monospace!important}.ai-result-content,.deal-desc,.hero-subtitle,.strategic-read p{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,sans-serif;letter-spacing:.2px}.hero-suggestions{margin-top:1.25rem;font-size:.8rem;color:var(--text-subtle);display:flex;align-items:center;justify-content:center;gap:.6rem;flex-wrap:wrap;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,sans-serif}.hero-suggestion-chip{color:var(--text-muted);background:hsla(0,0%,100%,.03);padding:4px 10px;border-radius:20px;text-decoration:none;font-family:JetBrains Mono,monospace;font-size:.7rem;border:1px solid var(--border);transition:all .2s ease}.hero-suggestion-chip:hover{background:var(--accent-dim);border-color:var(--accent);color:var(--accent-light);transform:translateY(-1px)}.syntax-tooltip-wrapper{position:relative;display:inline-flex;align-items:center;margin-left:.25rem;cursor:help}.syntax-icon{font-size:.8rem;color:var(--text-subtle);transition:color .2s}.syntax-tooltip-wrapper:hover .syntax-icon{color:var(--accent-light)}.syntax-tooltip{position:absolute;bottom:150%;left:50%;transform:translateX(-50%) translateY(5px);background:var(--bg-elevated);border:1px solid var(--border);padding:.75rem 1rem;border-radius:6px;color:var(--text-primary);font-size:.75rem;font-family:JetBrains Mono,monospace;white-space:nowrap;opacity:0;visibility:hidden;transition:all .2s ease;box-shadow:0 4px 12px rgba(0,0,0,.3);z-index:100}.syntax-tooltip-wrapper:hover .syntax-tooltip{opacity:1;visibility:visible;transform:translateX(-50%) translateY(0)}
</style>
</head>
<body>

<div id="heroView" class="hero-view">
  <div class="terminal-logo"><span style="color: var(--accent);">>_</span>Govhoo</div>
  <p class="hero-subtitle" style="padding-left: 1.25em;">Follow the Money. For Free.</p>
  
  <div class="search-box-container">
  <input type="text" id="mainSearchInput" class="main-input" placeholder="Try: CLOUD, 541512 AND AIR FORCE, or DA10 AND AIR FORCE" autocomplete="off" style="text-transform: uppercase;">
  <button class="input-clear" onclick="document.getElementById('mainSearchInput').value=''; document.getElementById('mainSearchInput').focus();" aria-label="Clear search">×</button>
    <div class="btn-row">
      <button id="searchBtn" class="btn-primary" data-action="search" style="flex: none; width: 100%; background-color: var(--accent); color: #F1EEE9;">
        SEARCH
      </button>
    </div>
  </div>
 <div class="hero-suggestions">
    <a href="?q=Cloud,+Cyber" class="hero-suggestion-chip">Cloud, Cyber</a>
    <a href="?q=R499+AND+AIR+FORCE" class="hero-suggestion-chip">R499 AND Air Force</a>
    <a href="?q=NVIDIA" class="hero-suggestion-chip">NVIDIA</a>
    
    <div class="syntax-tooltip-wrapper">
      <i class="fas fa-info-circle syntax-icon"></i>
      <div class="syntax-tooltip">
        Use <strong>AND</strong> to narrow (e.g., <em>DA10 AND Navy</em>)<br>
        Use <strong>,</strong> to combine (e.g., <em>Cloud, Cyber</em>)
      </div>
    </div>
</div>
<footer class="hero-footer">
  <div class="footer-grid">

    <!-- GETTING STARTED -->
    <div class="footer-section">
      <div class="footer-label mono text-xs accent upper">Getting Started</div>

      <div style="margin-bottom: 1rem;">
        <ol class="steps-list" style="list-style: none; padding-left: 0;">

          <li style="margin-bottom: 1rem;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
              <strong style="color: var(--text-primary);">Search Anything</strong>
            </div>
            <div style="font-size: 0.75rem; color: var(--text-primary); opacity: 0.7; line-height: 1.5;">
              Type a keyword, company, NAICS code, or agency. Use <strong style="color: var(--accent-light);">AND</strong> to narrow — <em>541512 AND Air Force</em>. Use a <strong style="color: var(--accent-light);">,</strong> to broaden — <em>Cloud, Cyber</em>. Shorthand like <em>DHS</em>, <em>VA</em>, <em>DISA</em> works everywhere. Click <strong>Ask Arti</strong> after any search to get an instant take on the data in your search and ask follow-up questions.
            </div>
          </li>

          <li style="margin-bottom: 1rem;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
              <strong style="color: var(--text-primary);">Follow the Money</strong>
            </div>
            <div style="font-size: 0.75rem; color: var(--text-primary); opacity: 0.7; line-height: 1.5;">
              The Sankey shows how dollars flow from agencies to primes. Click any bar to drill in. Below it, the NAICS breakdown shows which codes dominate — click one to narrow your search. Use vehicle pills to filter by contract vehicle.
            </div>
          </li>

          <li style="margin-bottom: 0;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
              <strong style="color: var(--text-primary);">Find Partners & Competitors</strong>
            </div>
            <div style="font-size: 0.75rem; color: var(--text-primary); opacity: 0.7; line-height: 1.5;">
              Switch to the Sub view to see prime→sub relationships. The Prime Reach panel shows which primes have the broadest agency coverage. Click any vendor's <em>Footprint</em> link to see their entire federal portfolio.
            </div>
          </li>
		  
        </ol>
      </div>
    </div>

    <!-- WHY GOVHOO -->
    <div class="footer-section">
      <div class="footer-label mono text-xs accent upper">Why Govhoo</div>

      <div class="use-cases">

        <div class="use-case">
          <div class="use-case-title">
            Size a Market in Seconds
          </div>
          <div class="use-case-desc">
            See total spend, top agencies, dominant vendors, and which NAICS codes carry the most investment — instantly.
          </div>
        </div>

        <div class="use-case">
          <div class="use-case-title">
            Find the Right Primes
          </div>
          <div class="use-case-desc">
            See which primes are active across multiple agencies in your market. One partner, broader reach.
          </div>
        </div>

        <div class="use-case">
          <div class="use-case-title">
            Scout the Competition
          </div>
          <div class="use-case-desc">
            Click any vendor's Footprint to see their entire federal portfolio across every agency and market.
          </div>
        </div>

      </div>
    </div>

<!-- BUILT BY -->
<div class="footer-section">
  <div class="footer-label mono text-xs accent upper">Built by a Sales Guy</div>

  <p class="footer-text">
  <img src="https://govhoo.com/images/oldmark.jpg" alt="Mark Flournoy" class="tip-bio-img">
  Hi, I’m Mark, a retired federal sales guy, former COTR, and Marine. At AWS, F5, and Red Hat, I spent hours every month digging through USASpending data, SAM.gov listings, and industry days just to understand where the government was actually investing and who really controlled the workshare.
  <br><br>
  I built Govhoo to make that part simple. Govhoo isn’t trying to replace GovWin or BGOV. It’s a directional tool. It shows sustained government investment so teams can align efforts and resources and move forward with confidence. And it’s free to use.
  <br><br>
  If you want help applying this to your territory planning, or a resourcing discussion with leadership, I’m happy to talk it through. You can also find me on
  <a href="https://www.linkedin.com/in/markflournoy/" target="_blank" class="footer-link">
    LinkedIn
  </a>.
</p>

  <div style="padding: 1rem; margin-top: 1.2rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px;">
    <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; font-weight: 700; color: #F1EEE9; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 0.5rem;">
      Need a Second Set of Eyes?
    </div>
    <div style="font-size: 0.7rem; color: var(--text-primary); opacity: 0.7; line-height: 1.4; margin-bottom: 1rem;">
      If you’re deciding where to focus next or need to sanity-check a market, let’s spend 30 minutes walking through the data together.
    </div>
    <a href="https://calendly.com/markflournoy/govhoo" target="_blank" style="text-decoration:none;">
      <button class="btn-primary" style="width: 100%; padding: 0.6rem; font-size: 0.75rem; justify-content: center;">
         Book a working session
      </button>
    </a>
  </div>
</div>
  </div>
  <div class="footer-bottom">
    <div class="footer-copyright">© 2026 <span style="color: #5f8055;">>_</span>GOVHOO.COM — DATA VIA USASPENDING.GOV</div>
  </div>
</footer>
</div>

<div id="appView" style="display:none;">
  <header class="app-header">
    <div class="header-left">
      <span class="logo-btn" data-action="showHero" title="Back to home"><span style="color: var(--accent);">>_</span>Govhoo</span>
      <div class="mini-search-wrapper">
        <input type="text" id="miniSearch" class="mini-search" placeholder="Search keywords, companies, NAICS, agencies..." style="text-transform: uppercase;">
      </div>
    </div>
    <div class="header-actions">
      <button class="icon-btn icon-btn-slack" data-action="shareBrief" title="Share Link">
        <i class="fa-regular fa-paper-plane"></i>
      </button>
      <button class="icon-btn icon-btn-csv" title="Download CSV" data-action="exportCSV">
        <i class="fas fa-arrow-down"></i>
      </button>
      <button class="icon-btn icon-btn-pres" id="presToggleBtn" onclick="App.togglePresentationMode()" title="Light Mode">
        <i class="fas fa-rainbow"></i>
      </button>
    </div>
  </header>

  <div id="dashboardContainer" class="dashboard-container">
    
    <div id="searchModeView" class="view-section active">
      
      <!-- Drill Navigation Controls -->
      <div id="drillControlsBar" class="drill-controls-bar" style="display: none; margin-bottom: 1rem; padding: 0.75rem 1rem; background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 6px; overflow: hidden;">
        <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 0.5rem;">
          <div id="drillBreadcrumb" class="drill-breadcrumb" style="display: flex; margin: 0; flex-wrap: wrap; min-width: 0;">
            <div class="breadcrumb-item" data-action="resetDrill">
              
              <span>All Agencies</span>
            </div>
          </div>
        </div>
      </div>
<div id="aiIntelligenceBanner" class="ai-banner">
    <div class="ai-banner-wrapper">
        <img src="images/arti.png" alt="Arti" class="ai-avatar-float">
        <h4 class="ai-banner-title">ASK ARTI</h4>
        <p class="ai-banner-desc">Want a quick analysis of all this data? Just ask Arti, your friendly AI sales guy.</p>
    </div>
    <button id="triggerAiPlanBtn" class="btn-ai" onclick="App.runAiActionPlan()">
        ASK ARTI
    </button>
</div>

<div id="aiActionPanel" class="ai-action-panel">
    <div class="ai-header">
        <div class="ai-header-title">
            <img src="images/arti.png" alt="Arti" class="ai-avatar">
            <h3>ARTI'S TAKE</h3>
        </div>
        <button id="copyAiBtn" class="btn-ai-outline" onclick="App.copyAiPlan()" style="display: none;">COPY</button>
    </div>
    
    <div id="aiContentContainer" class="ai-result-content"></div>
    
    <div id="aiChatHistory" class="ai-chat-history" style="display: none;"></div>
    
    <div id="aiChatInputWrapper" class="ai-chat-input-wrapper" style="display: none;">
        <input type="text" id="aiChatInput" class="main-input" placeholder="Ask follow-up questions..." autocomplete="off" style="font-size: 0.85rem; padding: 0.75rem 1rem; height: auto;">
        <button id="aiChatSendBtn" class="btn-ai" onclick="App.sendAiChatMessage()" style="padding: 0 1.25rem; font-weight: 700; letter-spacing: 1px;">SEND</button>
    </div>
    <div id="aiChatCounter" class="ai-chat-counter" style="display: none;">5 questions remaining</div>
	<div id="aiDisclaimer" class="ai-disclaimer" style="display: none;">
        Arti is an AI. Always verify USASpending data and use your own judgment before making strategic decisions.
    </div>
</div>
      <!-- Agency Award Flow Sankey -->
      <div id="sankeyPanel" class="sankey-panel" style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; padding: 1.25rem; margin-bottom: 1rem; overflow: hidden;">
        
        <div style="margin-bottom: 1rem;">
          <div id="sankeySubtitle" style="font-family: 'JetBrains Mono', monospace; font-size: 0.6rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 0.5rem;">Top 100 Active Contracts · Obligated Value</div>
          <div style="display: flex; align-items: baseline; gap: 1.5rem; flex-wrap: wrap;">
            <div id="stat-vol" style="font-family: 'JetBrains Mono', monospace; font-size: clamp(1.75rem, 5vw, 2.5rem); font-weight: 800; color: var(--text-primary); line-height: 1;">-</div>
            <div id="searchStatsCompact" style="display: flex; gap: 1.25rem; align-items: baseline; flex-wrap: wrap; margin-left: 0.5rem; padding-left: 1.5rem; border-left: 1px solid var(--border);">
              <div style="display: flex; align-items: baseline; gap: 0.35rem;">
                <span id="stat-agencies" style="font-family: 'JetBrains Mono', monospace; font-size: 1rem; font-weight: 700; color: var(--text-primary);">-</span>
                <span style="font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase;">Agencies</span>
              </div>
              <div style="display: flex; align-items: baseline; gap: 0.35rem;">
                <span id="stat-count" style="font-family: 'JetBrains Mono', monospace; font-size: 1rem; font-weight: 700; color: var(--text-primary);">-</span>
                <span style="font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase;">Contracts</span>
              </div>
              <div style="display: flex; align-items: baseline; gap: 0.35rem;">
                <span id="stat-vendors" style="font-family: 'JetBrains Mono', monospace; font-size: 1rem; font-weight: 700; color: var(--text-primary);">-</span>
                <span style="font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase;">Vendors</span>
              </div>
            </div>
          </div>
        </div>

        <div class="chart-wrapper" style="border: none; padding: 0; background: transparent; overflow-x: auto; overflow-y: visible;">
          <div id="chartContainer" class="chart-container"></div>
        </div>
        <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 1rem; padding-top: 0.75rem; border-top: 1px solid var(--border); font-size: 0.65rem; color: var(--text-muted);">
          <span id="marketHealth" style="font-family: 'JetBrains Mono', monospace;"></span>
          <span style="font-family: 'JetBrains Mono', monospace;"><span style="color: var(--accent);">>_</span>Govhoo.com</span>
        </div>
      </div>

      <!-- 1. Bubble Chart — visual market sizing, mobile-readable -->
      <div id="bubbleChartPanel" style="display: none;">
        
        <div style="margin-bottom: 1rem;">
          <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 0.5rem;">
            <div id="bubbleChartSubtitle" style="font-family: 'JetBrains Mono', monospace; font-size: 0.6rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1.5px;">Top Active Vendors & Agencies · Lifetime Funded Value</div>
            <div class="bubble-toggle-row" style="margin-bottom: 0;" id="bubbleToggleRow">
              <button class="bubble-toggle-btn active" onclick="App.setBubbleMode('vendors')" id="bubbleToggleVendors">Vendors</button>
              <button class="bubble-toggle-btn" onclick="App.setBubbleMode('agencies')" id="bubbleToggleAgencies">Agencies</button>
              <button class="bubble-toggle-btn" onclick="App.setBubbleMode('subagencies')" id="bubbleToggleSubAgencies" style="display:none;">Sub-Agencies</button>
              <span style="border-left: 1px solid var(--border); height: 1.2rem; margin: 0 0.25rem;"></span>
              <button class="bubble-toggle-btn active" onclick="App.setBubbleChartType('bubbles')" id="chartTypeBubbles">Bubbles</button>
              <button class="bubble-toggle-btn" onclick="App.setBubbleChartType('treemap')" id="chartTypeTreemap">Treemap</button>
            </div>
          </div>
          <div style="display: flex; align-items: baseline; gap: 1.5rem; flex-wrap: wrap;">
            <div id="bubble-stat-vol" style="font-family: 'JetBrains Mono', monospace; font-size: clamp(1.75rem, 5vw, 2.5rem); font-weight: 800; color: var(--text-primary); line-height: 1;">-</div>
            <div style="display: flex; gap: 1.25rem; align-items: baseline; flex-wrap: wrap; margin-left: 0.5rem; padding-left: 1.5rem; border-left: 1px solid var(--border);">
              <div style="display: flex; align-items: baseline; gap: 0.35rem;">
                <span id="bubble-stat-agencies" style="font-family: 'JetBrains Mono', monospace; font-size: 1rem; font-weight: 700; color: var(--text-primary);">-</span>
                <span style="font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase;">Agencies</span>
              </div>
              <div style="display: flex; align-items: baseline; gap: 0.35rem;">
                <span id="bubble-stat-count" style="font-family: 'JetBrains Mono', monospace; font-size: 1rem; font-weight: 700; color: var(--text-primary);">-</span>
                <span style="font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase;">Contracts</span>
              </div>
              <div style="display: flex; align-items: baseline; gap: 0.35rem;">
                <span id="bubble-stat-vendors" style="font-family: 'JetBrains Mono', monospace; font-size: 1rem; font-weight: 700; color: var(--text-primary);">-</span>
                <span style="font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase;">Vendors</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Bubble breadcrumb (mirrors and syncs with the Sankey breadcrumb) -->
        <div id="bubbleBreadcrumb" style="display:none; margin-bottom: 0.75rem; padding: 0.5rem 0.75rem; background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 6px; font-size: 0.7rem; overflow-x: auto;">
          <div id="bubbleBreadcrumbInner" style="display: flex; align-items: center; gap: 0.35rem; flex-wrap: wrap;"></div>
        </div>
        <div id="bubbleChartContainer">
          <div class="bubble-tooltip" id="bubbleTooltip"></div>
        </div>
        <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid var(--border); font-size: 0.6rem; color: var(--text-muted);">
          <span> Size = total award value · Click to drill down · Toggle Treemap for market share view</span>
          <span style="font-family: 'JetBrains Mono', monospace;"><span style="color: var(--accent);">>_</span>Govhoo.com</span>
        </div>
      </div>
      
      <div id="drillHint" class="drill-hint" style="display:none;">
        
        <span>Click an <strong>agency bar</strong> to drill into sub-agencies</span>
      </div>

      <!-- 2. NAICS Breakdown — click any row to narrow search -->
      <div id="naicsPanel" class="data-panel" style="display: none;">
        <div class="data-panel-header">
          <span class="data-panel-title">NAICS Breakdown</span>
          <span class="data-panel-subtitle">click any row to search</span>
        </div>
        <div class="data-panel-body" id="naicsMixBody"></div>
      </div>

      <!-- 3. Prime Reach — who to partner with, ranked by agency diversity -->
      <div id="teamingPanel" class="data-panel" style="display: none;">
        <div class="data-panel-header">
          <span class="data-panel-title">Prime Reach</span>
          <span class="data-panel-subtitle">ranked by agency diversity</span>
        </div>
        <div class="data-panel-body" id="teamingList"></div>
      </div>

      <!-- 4. Vehicle Filter Pills — only shows if vehicles exist -->
      <div id="vehicleFilterBar" style="display: none; margin-bottom: 0.75rem; padding: 0.5rem 0.75rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px;">
        <div style="display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap;">
          <span style="font-family: 'JetBrains Mono', monospace; font-size: 0.5rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1.5px; flex-shrink: 0;">Vehicles</span>
          <div id="vehiclePills" style="display: flex; gap: 0.35rem; flex-wrap: wrap;"></div>
        </div>
      </div>

      <!-- 5. Sidebar grid: Agencies, Locations, Key Terms -->
      <!-- 5. Top Agencies — who's buying, with drill and LinkedIn links -->
      <div id="searchJobPanel" style="margin: 0 0 0.75rem 0; padding: 0; position: relative;">
        <div id="agencyReachPanel" class="data-panel" style="display: none;">
          <div class="data-panel-header">
            <span class="data-panel-title">Top Agencies</span>
            <span class="data-panel-subtitle">click to drill · ranked by spend</span>
          </div>
          <div class="data-panel-body" id="searchTopBuyersBody"></div>
        </div>
      </div>

<!-- 6. Explainer — context for those who want it -->
<div id="primeExplainerBox" style="background: linear-gradient(135deg, rgba(99,102,241,0.08), rgba(99,102,241,0.03)); border: 1px solid rgba(99,102,241,0.2); border-radius: 8px; padding: 1rem 1.25rem; margin-bottom: 1rem; display: none;">
  <div style="display: flex; align-items: flex-start; gap: 0.75rem;">
    <div style="flex: 1; font-size: 0.75rem; color: var(--text-muted); line-height: 1.6;">
      <strong style="color: var(--text-primary); font-size: 0.8rem;">What you're looking at</strong><br>
      Live federal award data from USASpending.gov. Every contract shown had funding activity in the past 12 months. Dollar values are <strong style="color: var(--text-primary);">Total Obligations to Date</strong> — the government's cumulative commitment over the life of the contract.<br><br>
      <strong style="color: var(--text-primary);">The panels</strong><br>
      <strong style="color: var(--accent);">Sankey</strong> — how dollars flow from agencies to primes. Click any bar to drill in.
      <strong style="color: var(--accent);">Bubble Chart</strong> — visual market sizing. Toggle between vendors and agencies.
      <strong style="color: var(--accent);">NAICS</strong> — top codes by value with lead vendor and buying agency. Click any row to narrow your search.
      <strong style="color: var(--accent);">Prime Reach</strong> — top primes ranked by agency diversity. Click any name to search their full portfolio.
      <strong style="color: var(--accent);">Top Agencies</strong> — who's buying, with top vendor at each. Click to drill into sub-agencies.
      <strong style="color: var(--accent);">Vehicles</strong> — filter the entire view to a single contract vehicle.<br><br>
      <strong style="color: var(--text-primary);">Search tips</strong><br>
      <em class="explainer-highlight">Use AND with codes: <strong>541512 AND Air Force</strong>. Commas broaden: <strong>Cloud, Cyber</strong>. Switch to Sub view to see prime→sub flow.</em>
    </div>
  </div>
</div>

      <!-- 7. Expiring Contracts -->
      <div id="recompetesList" style="margin-bottom: 1.5rem;"></div>

      <div class="section-header">
        <div class="section-title-group">
          <span class="section-title">Recent Awards</span>
        </div>
      </div>
      <div id="feedGrid" class="feed-grid"></div>

      <div id="subawardWrapper" style="display: none;">      
        <div style="margin-top: 1.5rem;">
          <div id="subcontractingPanel" style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; padding: 0.75rem; overflow: hidden;">
            <div id="subcontractingStats" style="margin-bottom: 1rem;">
  <div id="subSankeySubtitle" style="font-family: 'JetBrains Mono', monospace; font-size: 0.6rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 0.5rem;">Top 100 Subcontracts · Individual Transaction Value</div>
  <div style="display: flex; align-items: baseline; gap: 1.5rem; flex-wrap: wrap;">
    <div id="sub-stat-vol" style="font-family: 'JetBrains Mono', monospace; font-size: clamp(1.75rem, 5vw, 2.5rem); font-weight: 800; color: var(--text-primary); line-height: 1;">-</div>
    
    <div style="display: flex; gap: 1.25rem; align-items: baseline; flex-wrap: wrap; margin-left: 0.5rem; padding-left: 1.5rem; border-left: 1px solid var(--border);">
      <div style="display: flex; align-items: baseline; gap: 0.35rem;">
        <span id="sub-stat-primes" style="font-family: 'JetBrains Mono', monospace; font-size: 1rem; font-weight: 700; color: var(--text-primary);">-</span>
        <span style="font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase;">Primes</span>
      </div>
      <div style="display: flex; align-items: baseline; gap: 0.35rem;">
        <span id="sub-stat-subs" style="font-family: 'JetBrains Mono', monospace; font-size: 1rem; font-weight: 700; color: var(--text-primary);">-</span>
        <span style="font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase;">Subs</span>
      </div>
      <div style="display: flex; align-items: baseline; gap: 0.35rem;">
        <span id="sub-stat-count" style="font-family: 'JetBrains Mono', monospace; font-size: 1rem; font-weight: 700; color: var(--text-primary);">-</span>
        <span style="font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase;">Contracts</span>
      </div>
    </div>
  </div>
</div>
            <div class="chart-wrapper" style="border: none; padding: 0; background: transparent; overflow-x: auto; overflow-y: visible;">
              <div id="subcontractingBody" style="min-height: 350px;"></div>
            </div>
          </div>
        </div>

        <!-- 1. Sub Bubble Chart -->
        <div id="subBubblePanel" style="display: none; margin-top: 1rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; padding: 1.25rem; overflow: hidden;">
          <div style="margin-bottom: 1rem;">
            <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 0.5rem;">
              <div id="subBubbleSubtitle" style="font-family: 'JetBrains Mono', monospace; font-size: 0.6rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1.5px;">Top Primes & Subcontractors · Individual Transaction Value</div>
              <div class="bubble-toggle-row" style="margin-bottom: 0;">
                <button class="bubble-toggle-btn active" onclick="App.setSubBubbleMode('primes')" id="subBubbleTogglePrimes">Primes</button>
                <button class="bubble-toggle-btn" onclick="App.setSubBubbleMode('subs')" id="subBubbleToggleSubs">Subs</button>
                <span style="border-left: 1px solid var(--border); height: 1.2rem; margin: 0 0.25rem;"></span>
                <button class="bubble-toggle-btn active" onclick="App.setSubBubbleChartType('bubbles')" id="subChartTypeBubbles">Bubbles</button>
                <button class="bubble-toggle-btn" onclick="App.setSubBubbleChartType('treemap')" id="subChartTypeTreemap">Treemap</button>
              </div>
            </div>
            <div style="display: flex; align-items: baseline; gap: 1.5rem; flex-wrap: wrap;">
              <div id="sub-bubble-stat-vol" style="font-family: 'JetBrains Mono', monospace; font-size: clamp(1.75rem, 5vw, 2.5rem); font-weight: 800; color: var(--text-primary); line-height: 1;">-</div>
              <div style="display: flex; gap: 1.25rem; align-items: baseline; flex-wrap: wrap; margin-left: 0.5rem; padding-left: 1.5rem; border-left: 1px solid var(--border);">
                <div style="display: flex; align-items: baseline; gap: 0.35rem;">
                  <span id="sub-bubble-stat-primes" style="font-family: 'JetBrains Mono', monospace; font-size: 1rem; font-weight: 700; color: var(--text-primary);">-</span>
                  <span style="font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase;">Primes</span>
                </div>
                <div style="display: flex; align-items: baseline; gap: 0.35rem;">
                  <span id="sub-bubble-stat-subs" style="font-family: 'JetBrains Mono', monospace; font-size: 1rem; font-weight: 700; color: var(--text-primary);">-</span>
                  <span style="font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase;">Subs</span>
                </div>
                <div style="display: flex; align-items: baseline; gap: 0.35rem;">
                  <span id="sub-bubble-stat-records" style="font-family: 'JetBrains Mono', monospace; font-size: 1rem; font-weight: 700; color: var(--text-primary);">-</span>
                  <span style="font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase;">Contracts</span>
                </div>
              </div>
            </div>
          </div>
          <div id="subBubbleBreadcrumb" style="display:none; margin-bottom: 0.75rem; padding: 0.5rem 0.75rem; background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 6px; font-size: 0.7rem; overflow-x: auto;">
            <div id="subBubbleBreadcrumbInner" style="display: flex; align-items: center; gap: 0.35rem; flex-wrap: wrap;"></div>
          </div>
          <div id="subBubbleContainer" style="width: 100%; min-height: 380px; position: relative;">
            <div class="bubble-tooltip" id="subBubbleTooltip"></div>
          </div>
          <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid var(--border); font-size: 0.6rem; color: var(--text-muted);">
            <span> Bubble size = subaward value · Click to drill</span>
            <span style="font-family: 'JetBrains Mono', monospace;"><span style="color: var(--accent);">>_</span>Govhoo.com</span>
          </div>
        </div>

        <!-- 2. Top Primes (in sub view) — reach-style panel -->
        <div id="subPrimesPanel" class="data-panel" style="display: none; margin-top: 0.75rem;">
          <div class="data-panel-header">
            <span class="data-panel-title">Top Primes</span>
            <span class="data-panel-subtitle">by sub value awarded</span>
          </div>
          <div class="data-panel-body" id="searchTopPrimesBody"></div>
        </div>

        <!-- 3. Top Subs — reach-style panel -->
        <div id="subSubsPanel" class="data-panel" style="display: none; margin-top: 0.75rem;">
          <div class="data-panel-header">
            <span class="data-panel-title">Top Subs</span>
            <span class="data-panel-subtitle">by sub value received</span>
          </div>
          <div class="data-panel-body" id="searchTopSubsBody"></div>
        </div>

        <!-- 4. Sub Explainer -->
        <div id="subExplainerBox" style="background: linear-gradient(135deg, rgba(99,102,241,0.08), rgba(99,102,241,0.03)); border: 1px solid rgba(99,102,241,0.2); border-radius: 8px; padding: 1rem 1.25rem; margin-top: 0.75rem; display: none;">
          <div style="display: flex; align-items: flex-start; gap: 0.75rem;">
            <div style="flex: 1; font-size: 0.75rem; color: var(--text-muted); line-height: 1.6;">
              <strong style="color: var(--text-primary); font-size: 0.8rem;">What you're looking at</strong><br>
              Subcontracting activity from the past 12 months. Dollar amounts are <strong style="color: var(--text-primary);">individual transaction values</strong>, not cumulative obligations.<br><br>
              <strong style="color: var(--text-primary);">The panels</strong><br>
              <strong style="color: var(--accent);">Sankey</strong> — how sub dollars flow from agencies through primes to subs. Click any bar to filter.
              <strong style="color: var(--accent);">Bubble Chart</strong> — visual market sizing. Toggle between primes and subs.
              <strong style="color: var(--accent);">Top Primes</strong> — who's awarding the most sub work, with their top subs. Click any name to search their portfolio.
              <strong style="color: var(--accent);">Top Subs</strong> — who's receiving sub work, with the primes they work under.<br><br>
              <strong style="color: var(--text-primary);">Search tips</strong><br>
              <em class="explainer-highlight">Click any vendor name to search their full federal footprint. Use the People/Jobs/News links to find contacts and openings.</em>
              <span id="subAndNote" style="display:none;"><br><br>
              <em class="explainer-highlight"><strong style="color: var(--text-primary);">AND searches:</strong> Subcontract data shows the broader market. The USASpending subaward API does not support AND filtering. Use the Prime view for precise AND-filtered totals.</em>
              </span>
            </div>
          </div>
        </div>

        <!-- 5. Sub Cards -->
        <div id="subFeedWrapper" style="display: none; margin-top: 1rem;">
          <div class="section-header">
            <div class="section-title-group">
              <span class="section-title">Recent Subcontracts</span>
            </div>
          </div>
          <div id="subFeedGrid" class="feed-grid"></div>
        </div>

      </div>

    </div> </div>
</div>
<button id="artiFab" class="arti-fab" onclick="App.runAiActionPlan()" title="Ask Arti">
    <img src="images/arti.png" alt="Arti">
</button>
<div id="loader" class="loader">
  <div class="spinner"></div>
  <p id="loaderText" style="margin-top:1rem; font-family:'JetBrains Mono'; color:var(--accent);">RETRIEVING DATA...</p>
  <p id="loaderSubtext" style="color:var(--text-subtle); font-size:0.8rem; margin-top:0.5rem;"></p>
</div>
<script>
const LibLoader={d3Loaded:!1,loading:{d3:null},async loadD3(){return this.d3Loaded&&window.d3&&window.d3.sankey?Promise.resolve():(this.loading.d3||(this.loading.d3=new Promise(((e,t)=>{const n=document.createElement("script");n.src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js",n.onload=()=>{const n=document.createElement("script");n.src="https://cdnjs.cloudflare.com/ajax/libs/d3-sankey/0.12.3/d3-sankey.min.js",n.onload=()=>{this.d3Loaded=!0,e()},n.onerror=t,document.head.appendChild(n)},n.onerror=t,document.head.appendChild(n)}))),this.loading.d3)},async ensureAll(){await this.loadD3()},preloadWhenIdle(){"requestIdleCallback"in window?requestIdleCallback((()=>this.ensureAll()),{timeout:2e3}):setTimeout((()=>this.ensureAll()),100)}},Utils={copyDealToClipboard(e,t){const n=App.searchData.active[e];if(!n)return;const a=n.generated_internal_id;let r="";a&&(r=`https://www.usaspending.gov/award/${a}`);const s=VehicleDetector.detect(n["Award ID"]),i=VehicleDetector.getSetAsideLabel(n["Type of Set Aside"]),o=Utils.getContractTypeTag(n["Contract Award Type"]),l=[`Agency: ${n["Awarding Agency"]||"N/A"}`,n["Awarding Sub Agency"]&&n["Awarding Sub Agency"]!==n["Awarding Agency"]?`Sub-Agency: ${n["Awarding Sub Agency"]}`:null,`Vendor: ${n["Recipient Name"]||"N/A"}`,`Obligated: ${Utils.money(n["Award Amount"])}`,`Description: ${(n.Description||"N/A").substring(0,200)}`,`Start: ${n["Start Date"]||"N/A"}`,`End: ${n["End Date"]||"N/A"}`,n["Award ID"]?`Award ID: ${n["Award ID"]}`:null,n["Last Modified Date"]?`Last Modified: ${n["Last Modified Date"]}`:null,o?`Type: ${o.full}`:null,s?`Vehicle: ${s.vehicle}`:null,i?`Set-Aside: ${i}`:null,n["NAICS Code"]?`NAICS: ${n["NAICS Code"]} - ${n["NAICS Description"]||""}`:null,n["PSC Code"]?`PSC: ${n["PSC Code"]} - ${n["PSC Description"]||""}`:null,r?`Link: ${r}`:null].filter(Boolean).join("\n");navigator.clipboard.writeText(l).then((()=>{t&&(t.innerHTML="",t.style.color="var(--accent)",setTimeout((()=>{t.innerHTML="",t.style.color=""}),1500))}))},copySubDealToClipboard(e,t){try{const n=JSON.parse(decodeURIComponent(e)),a=n.prime_award_generated_internal_id?`https://www.usaspending.gov/award/${n.prime_award_generated_internal_id}`:"",r=["Type: Subcontract",`Agency: ${n["Awarding Agency"]||"N/A"}`,`Prime: ${n["Prime Recipient Name"]||"N/A"}`,`Subcontractor: ${n["Sub-Awardee Name"]||"N/A"}`,`Amount: ${Utils.money(parseFloat(n["Sub-Award Amount"])||0)}`,`Date: ${n["Sub-Award Date"]||"N/A"}`,a?`Prime Award: ${a}`:null].filter(Boolean).join("\n");navigator.clipboard.writeText(r).then((()=>{t&&(t.innerHTML="",t.style.color="var(--accent)",setTimeout((()=>{t.innerHTML="",t.style.color=""}),1500))}))}catch(e){console.error("Copy failed",e)}},copyRecompeteToClipboard(e,t,n,a,r,s,i,o,l,c,d,p,u,m,g){const h=VehicleDetector.detect(l),y=VehicleDetector.getSetAsideLabel(m),b=["EXPIRING CONTRACT",`Agency: ${t||"N/A"}`,n&&n!==t?`Sub-Agency: ${n}`:null,`Incumbent: ${a||"N/A"}`,`Amount: ${r}`,`Description: ${s||"N/A"}`,`Start: ${i||"N/A"}`,`Expires: ${o||"N/A"}`,l?`Award ID: ${l}`:null,h?`Vehicle: ${h.vehicle}`:null,y?`Set-Aside: ${y}`:null,p?`NAICS: ${p} - ${u||""}`:null,c?`PSC: ${c} - ${d||""}`:null,g?`Link: ${g}`:null].filter(Boolean).join("\n");navigator.clipboard.writeText(b).then((()=>{e&&(e.innerHTML="",e.style.color="var(--accent)",setTimeout((()=>{e.innerHTML="",e.style.color=""}),1500))}))},money:e=>e||0===e?e>=1e9?"$"+(e/1e9).toFixed(1)+"B":e>=1e6?"$"+(e/1e6).toFixed(1)+"M":e>=1e3?"$"+(e/1e3).toFixed(0)+"K":"$"+Math.round(e).toLocaleString():"-",trunc:(e,t)=>e&&e.length>t?e.substring(0,t)+"...":e||"No Description",date:e=>e?new Date(e).toLocaleDateString():"—",formatDateISO:e=>e.toISOString().split("T")[0],getCurrentFY:()=>{const e=new Date;return e.getMonth()>=9?e.getFullYear()+1:e.getFullYear()},getColor:(()=>{const e=["#466D5C","#7B6D8D","#5B7C99","#E07A5F","#D98895","#3D405B","#F2E8CF","#81B29A","#778DA9","#606C38"],t=new Map;let n=0;const a=a=>a?a.includes("Other")||a.includes("Unknown")?"#353A40":(t.has(a)||t.set(a,n++),e[t.get(a)%e.length]):"#4A4A4A";return a.reset=()=>{t.clear(),n=0},a})(),queryAliases:{aws:"Amazon",gcp:"Google Cloud",msft:"Microsoft",ibm:"International Business Machines",hp:"Hewlett Packard",hpe:"Hewlett Packard Enterprise",dell:"Dell Technologies",gd:"General Dynamics",gdit:"General Dynamics Information Technology",lmco:"Lockheed Martin",ngc:"Northrop Grumman",bah:"Booz Allen Hamilton",saic:"Science Applications International",dod:"Department of Defense",doj:"Department of Justice",dhs:"Department of Homeland Security",hhs:"Health and Human Services",dot:"Department of Transportation",doe:"Department of Energy",doi:"Department of the Interior",dol:"Department of Labor",doc:"Department of Commerce",dos:"Department of State",ed:"Department of Education",hud:"Housing and Urban Development",usda:"Department of Agriculture",va:"Veterans Affairs",army:"Department of the Army",navy:"Department of the Navy",usaf:"Department of the Air Force",ussf:"Space Force",usmc:"Marine Corps",cia:"Central Intelligence Agency",nsa:"National Security Agency",nga:"National Geospatial-Intelligence Agency",nro:"National Reconnaissance Office",dia:"Defense Intelligence Agency",disa:"Defense Information Systems Agency",darpa:"Defense Advanced Research Projects Agency",dcsa:"Defense Counterintelligence and Security Agency",dla:"Defense Logistics Agency",mda:"Missile Defense Agency",socom:"Special Operations Command",cybercom:"Cyber Command",stratcom:"Strategic Command",transcom:"Transportation Command",centcom:"Central Command",eucom:"European Command",indopacom:"Indo-Pacific Command",northcom:"Northern Command",southcom:"Southern Command",africom:"Africa Command",gsa:"General Services Administration",nasa:"National Aeronautics and Space Administration",fbi:"Federal Bureau of Investigation",dea:"Drug Enforcement Administration",atf:"Bureau of Alcohol Tobacco Firearms and Explosives",usps:"Postal Service",irs:"Internal Revenue Service",epa:"Environmental Protection Agency",fda:"Food and Drug Administration",cdc:"Centers for Disease Control and Prevention",nih:"National Institutes of Health",cms:"Centers for Medicare and Medicaid Services",ssa:"Social Security Administration",opm:"Office of Personnel Management",sba:"Small Business Administration",fema:"Federal Emergency Management Agency",tsa:"Transportation Security Administration",cbp:"Customs and Border Protection",ice:"Immigration and Customs Enforcement",uscis:"Citizenship and Immigration Services",usss:"Secret Service",cisa:"Cybersecurity and Infrastructure Security Agency",faa:"Federal Aviation Administration",fhwa:"Federal Highway Administration",fra:"Federal Railroad Administration",fta:"Federal Transit Administration",noaa:"National Oceanic and Atmospheric Administration",nist:"National Institute of Standards and Technology",census:"Census Bureau",ita:"International Trade Administration",blm:"Bureau of Land Management",nps:"National Park Service",usfs:"Forest Service",fws:"Fish and Wildlife Service",usgs:"Geological Survey",bia:"Bureau of Indian Affairs",boem:"Bureau of Ocean Energy Management",bor:"Bureau of Reclamation",ferc:"Federal Energy Regulatory Commission",nnsa:"National Nuclear Security Administration",sec:"Securities and Exchange Commission",ftc:"Federal Trade Commission",fcc:"Federal Communications Commission",nlrb:"National Labor Relations Board",eeoc:"Equal Employment Opportunity Commission",gao:"Government Accountability Office",omb:"Office of Management and Budget",cbo:"Congressional Budget Office",nara:"National Archives and Records Administration",pbgc:"Pension Benefit Guaranty Corporation",usaid:"Agency for International Development",amtrak:"Amtrak",fdic:"Federal Deposit Insurance Corporation",ncua:"National Credit Union Administration",cfpb:"Consumer Financial Protection Bureau",exim:"Export-Import Bank"},normalizeQuery(e){const t=e.toLowerCase().trim();return this.queryAliases[t]||e},missionGapRisk(e){const t=new Date(e["End Date"]),n=Math.ceil((t-new Date)/864e5),a=parseFloat(e["Award Amount"])||0,r=(e.Description||"").toLowerCase(),s=(e["PSC Description"]||"").toLowerCase(),i=(e["NAICS Description"]||"").toLowerCase(),o=(e["PSC Code"]||"").toUpperCase(),l=`${r} ${s} ${i}`,c=["operations","o&m","maintenance","sustainment","help desk","service desk","support services","managed services","hosting","cloud","network","cyber","security","monitoring","soc","continuity","backup","dr","patch","infrastructure","enterprise","mission","critical","24/7","production"].filter((e=>l.includes(e))),d=c.length>=2,p=["D","R","J"].includes(o.slice(0,1));return n<=180&&(d||p)&&a>=25e4?{level:"high",daysUntil:n,reasons:c.slice(0,4)}:n<=365&&(d||p)&&a>=1e5?{level:"medium",daysUntil:n,reasons:c.slice(0,3)}:{level:"low",daysUntil:n,reasons:c.slice(0,2)}},normalizeAwardFields(e){const t={naics_code:"NAICS Code",naics_description:"NAICS Description",psc_code:"PSC Code",psc_description:"PSC Description"};return e.map((e=>{const n={...e};for(const[a,r]of Object.entries(t))a in e&&(n[r]=e[a]);return n}))},filterActiveContracts(e){const t=new Date,n=new Date;n.setDate(n.getDate()-90);const a=new Date;return a.setDate(a.getDate()-30),e.filter((e=>{const r=e["End Date"];if(!r)return!0;const s=new Date(r);if(isNaN(s.getTime()))return!0;if(s>t)return!0;if(s>n){if((parseFloat(e["Award Amount"])||0)>1e4)return!0;const t=e["Last Modified Date"];if(t){const e=new Date(t);if(!isNaN(e.getTime())&&e>a)return!0}return!1}return!1}))},getContractTypeTag(e){if(!e)return null;const t=e.toLowerCase();return t.includes("definitive")?{short:"DEF",full:"Definitive Contract"}:t.includes("delivery")?{short:"DO",full:"Delivery Order"}:t.includes("purchase")?{short:"PO",full:"Purchase Order"}:t.includes("bpa call")?{short:"BPA",full:"BPA Call"}:t.includes("blanket")?{short:"BPA",full:"Blanket Purchase Agreement"}:t.includes("indefinite")?{short:"IDC",full:e}:t.includes("gwac")?{short:"GWAC",full:e}:{short:e.substring(0,4).toUpperCase(),full:e}},parseSearchTerms(e){const t=/^[A-Z]{1,2}\d{1,3}$|^\d{1,2}[A-Z]\d{0,2}$/i,n=/^\d{6}$/,a=e.includes("+")||/\bAND\b/.test(e),r=e.replace(/,?\s*(L\.?L\.?C\.?|INC\.?|CORP\.?|CORPORATION|INCORPORATED|COMPANY|CO\.?|LTD\.?|L\.?P\.?|P\.?C\.?|P\.?L\.?L\.?C\.?)\.?(?=\s*,|\s*$|\s+AND\b|\s*\+)/gi,"").replace(/,\s*$/,"").trim().split(",").map((e=>e.trim())).filter((e=>e.length>0)),s=r.filter((e=>t.test(e))).map((e=>e.toUpperCase())),i=r.filter((e=>n.test(e))),o=r.filter((e=>!t.test(e)&&!n.test(e)));let l=[];return a&&o.forEach((e=>{const t=e.split(/\+|\bAND\b/).map((e=>e.trim())).filter((e=>e.length>0));if(t.length>1){const e=t.map((e=>Utils.normalizeQuery(e)));l.push(e)}})),{pscCodes:s,naicsCodes:i,keywordTerms:o,allTerms:r,andGroups:l}},buildFilters(e,t){const{pscCodes:n,naicsCodes:a,keywordTerms:r,andGroups:s}=this.parseSearchTerms(e),i={time_period:t,award_type_codes:API.CONTRACT_TYPES};if(s.length>0){const e=s[0],t=/^[A-Z]{1,2}\d{1,3}$|^\d{1,2}[A-Z]\d{0,2}$/i,n=/^\d{6}$/,a=[];return e.forEach((e=>{n.test(e)?(i.naics_codes=i.naics_codes||[],i.naics_codes.push(e)):t.test(e)?(i.psc_codes=i.psc_codes||[],i.psc_codes.push(e.toUpperCase())):a.push(e)})),a.length>0&&(i.keywords=a),i}return n.length>0&&(i.psc_codes=n),a.length>0&&(i.naics_codes=a),r.length>0&&(i.keywords=r),i.psc_codes||i.naics_codes||i.keywords||(i.keywords=[e]),i}},VehicleDetector={patterns:[{prefix:/^GS-35F/i,vehicle:"GSA Schedule",short:"GSA"},{prefix:/^GS-00F/i,vehicle:"GSA Schedule",short:"GSA"},{prefix:/^GS-07F/i,vehicle:"GSA Schedule",short:"GSA"},{prefix:/^GS-\d{2}F/i,vehicle:"GSA Schedule",short:"GSA"},{prefix:/^47Q[A-Z]{2}A/i,vehicle:"OASIS+",short:"OASIS+"},{prefix:/^47QTCA/i,vehicle:"OASIS",short:"OASIS"},{prefix:/^47QTCK/i,vehicle:"OASIS SB",short:"OASIS SB"},{prefix:/^GS-06F/i,vehicle:"ALLIANT 2",short:"ALLIANT"},{prefix:/^HC102[89]/i,vehicle:"CIO-SP3",short:"CIO-SP3"},{prefix:/^HC1013/i,vehicle:"CIO-SP4",short:"CIO-SP4"},{prefix:/^W15QKN/i,vehicle:"Army ITES",short:"ITES"},{prefix:/^W52P1J/i,vehicle:"Army CHESS",short:"CHESS"},{prefix:/^FA870[12]/i,vehicle:"NETCENTS",short:"NETCENTS"},{prefix:/^N0017[89]/i,vehicle:"SeaPort",short:"SEAPORT"},{prefix:/^N00189/i,vehicle:"SeaPort-NxG",short:"SEAPORT"},{prefix:/^47QFCA/i,vehicle:"8(a) STARS III",short:"STARS III"},{prefix:/^47QFSA/i,vehicle:"8(a) STARS III",short:"STARS III"},{prefix:/^HHSN/i,vehicle:"NIH CIO-SP",short:"NIH"},{prefix:/^75N98/i,vehicle:"NIH NITAAC",short:"NITAAC"},{prefix:/^VA118/i,vehicle:"VA T4NG",short:"T4NG"},{prefix:/^36C10X/i,vehicle:"VA VETS 2",short:"VETS 2"}],detect(e){if(!e)return null;for(const t of this.patterns)if(t.prefix.test(e))return t;return null},setAsideLabels:{SBA:"8(a)","8A":"8(a)","8AN":"8(a)",HZC:"HUBZone",HZS:"HUBZone",WOSB:"WOSB",EDWOSB:"EDWOSB",SDVOSBC:"SDVOSB",SDVOSBS:"SDVOSB",SBP:"Small Biz",SMP:"Small Biz",VSA:"VOSB",VSB:"VOSB",HS2:"HUBZone SB",HS3:"HUBZone/8(a)",ISBEE:"Econ. Disadv.",IEE:"Econ. Disadv."},getSetAsideLabel(e){return e?this.setAsideLabels[e]||(e.length<=10?e:null):null}},Autocomplete={activeInput:null,dropdown:null,debounceTimer:null,selectedIndex:-1,results:{agencies:[],recipients:[]},init(e){const t=document.getElementById(e);if(!t)return;if(!t.parentElement.classList.contains("autocomplete-wrapper")){const e=document.createElement("div");e.className="autocomplete-wrapper",t.parentNode.insertBefore(e,t),e.appendChild(t)}const n=document.createElement("div");n.className="autocomplete-dropdown",n.id=`${e}-dropdown`,t.parentElement.appendChild(n),t.addEventListener("input",(t=>this.handleInput(t,e))),t.addEventListener("keydown",(t=>this.handleKeydown(t,e))),t.addEventListener("focus",(t=>this.handleFocus(t,e))),t.addEventListener("blur",(()=>setTimeout((()=>this.hide(e)),200)))},handleInput(e,t){const n=e.target.value.trim();clearTimeout(this.debounceTimer),n.length<2?this.hide(t):this.debounceTimer=setTimeout((()=>this.search(n,t)),250)},handleFocus(e,t){e.target.value.trim().length>=2&&this.hasResults()&&this.show(t)},handleKeydown(e,t){const n=document.getElementById(`${t}-dropdown`);if(!n||!n.classList.contains("active"))return void("ArrowDown"===e.key&&e.target.value.length>=2&&this.search(e.target.value.trim(),t));const a=n.querySelectorAll(".autocomplete-item");"ArrowDown"===e.key?(e.preventDefault(),this.selectedIndex=Math.min(this.selectedIndex+1,a.length-1),this.updateSelection(a)):"ArrowUp"===e.key?(e.preventDefault(),this.selectedIndex=Math.max(this.selectedIndex-1,0),this.updateSelection(a)):"Enter"===e.key&&this.selectedIndex>=0?(e.preventDefault(),a[this.selectedIndex]?.click()):"Escape"===e.key&&this.hide(t)},updateSelection(e){e.forEach(((e,t)=>{e.classList.toggle("selected",t===this.selectedIndex)})),e[this.selectedIndex]?.scrollIntoView({block:"nearest"})},async search(e,t){try{const[n,a]=await Promise.all([API.autocompleteAgency(e),API.autocompleteRecipient(e)]);this.results={agencies:n,recipients:a},this.selectedIndex=-1,this.render(t)}catch(e){console.error("Autocomplete error:",e)}},hasResults(){return this.results.agencies.length>0||this.results.recipients.length>0},render(e){const t=document.getElementById(`${e}-dropdown`);if(!t)return;const{agencies:n,recipients:a}=this.results;if(!this.hasResults())return t.innerHTML='<div class="autocomplete-empty">No matches found</div>',void this.show(e);let r="";n.length>0&&(r+=`<div class="autocomplete-section">\n        <div class="autocomplete-section-label mono muted upper"> Agencies</div>\n        ${n.slice(0,5).map((e=>`\n          <div class="autocomplete-item" data-type="agency" data-value="${this.escapeHtml(e.subtier_agency?.name||e.toptier_agency?.name||"")}">\n            \n            <div class="autocomplete-item-text">\n              <div class="autocomplete-item-main truncate">${this.escapeHtml(e.subtier_agency?.name||e.toptier_agency?.name||"Unknown")}</div>\n              ${e.toptier_agency?.name&&e.subtier_agency?.name?`<div class="autocomplete-item-sub muted">${this.escapeHtml(e.toptier_agency.name)}</div>`:""}\n            </div>\n          </div>\n        `)).join("")}\n      </div>`),a.length>0&&(r+=`<div class="autocomplete-section">\n        <div class="autocomplete-section-label mono muted upper"> Vendors & Keywords</div>\n        ${a.slice(0,5).map((e=>`\n          <div class="autocomplete-item" data-type="recipient" data-value="${this.escapeHtml(e.recipient_name||"")}">\n            \n            <div class="autocomplete-item-text">\n              <div class="autocomplete-item-main truncate">${this.escapeHtml(e.recipient_name||"Unknown")}</div>\n              ${e.uei?`<div class="autocomplete-item-sub muted">UEI: ${e.uei}</div>`:""}\n            </div>\n          </div>\n        `)).join("")}\n      </div>`),t.innerHTML=r,t.querySelectorAll(".autocomplete-item").forEach((t=>{t.addEventListener("click",(()=>{const n=document.getElementById(e);n&&(n.value=t.dataset.value,n.focus()),this.hide(e)}))})),this.show(e)},show(e){const t=document.getElementById(`${e}-dropdown`);t&&t.classList.add("active")},hide(e){const t=document.getElementById(`${e}-dropdown`);t&&t.classList.remove("active"),this.selectedIndex=-1},escapeHtml:e=>e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"):""},API={baseUrl:"https://api.usaspending.gov/api/v2",_activeControllers:new Set,async _fetch(e,t={},n=45e3){const a=new AbortController;this._activeControllers.add(a);const r=setTimeout((()=>a.abort()),n);try{const n=await fetch(e,{...t,signal:a.signal});return clearTimeout(r),n}catch(e){if(clearTimeout(r),"AbortError"===e.name){const e=new Error("Request timed out. USASpending.gov may be slow — try narrowing your search.");throw e.isTimeout=!0,e}throw e}finally{this._activeControllers.delete(a)}},cancelAll(){this._activeControllers.forEach((e=>e.abort())),this._activeControllers.clear()},CONTRACT_TYPES:["A","B","C","D"],AWARD_FIELDS:["Award ID","Recipient Name","Recipient UEI","Awarding Agency","Awarding Sub Agency","Funding Agency","Funding Sub Agency","Award Amount","Total Outlays","Description","generated_internal_id","Start Date","End Date","Last Modified Date","Contract Award Type","Type Set Aside","Extent Competed","naics_code","naics_description","psc_code","psc_description","parent_award_id","recipient_parent_name","number_of_offers_received"],async searchAwards(e){const t=new Date,n=new Date;n.setFullYear(t.getFullYear()-1);const a={start_date:Utils.formatDateISO(n),end_date:Utils.formatDateISO(t)},{pscCodes:r,naicsCodes:s,keywordTerms:i,andGroups:o}=Utils.parseSearchTerms(e);if(o.length>0){const e=o[0],t=/^[A-Z]{1,2}\d{1,3}$|^\d{1,2}[A-Z]\d{0,2}$/i,n=/^\d{6}$/,r=[],s=[];if(e.forEach((e=>{n.test(e)?r.push({type:"naics",value:e}):t.test(e)?r.push({type:"psc",value:e.toUpperCase()}):s.push(e)})),r.length>0){const e={time_period:[a],award_type_codes:this.CONTRACT_TYPES};r.forEach((t=>{"naics"===t.type?(e.naics_codes=e.naics_codes||[],e.naics_codes.push(t.value)):(e.psc_codes=e.psc_codes||[],e.psc_codes.push(t.value))})),s.length>0&&(e.keywords=s);const t=await this._fetch(`${this.baseUrl}/search/spending_by_award/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filters:e,fields:this.AWARD_FIELDS,limit:100,sort:"Award Amount",order:"desc"})});return Utils.filterActiveContracts(Utils.normalizeAwardFields((await t.json()).results||[]))}{const e=s.map((e=>{const t={time_period:[a],award_type_codes:this.CONTRACT_TYPES,keywords:[e]};return this._fetch(`${this.baseUrl}/search/spending_by_award/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filters:t,fields:this.AWARD_FIELDS,limit:100,sort:"Award Amount",order:"desc"})}).then((e=>e.json()))})),t=await Promise.all(e),n=new Map;t.forEach((e=>{e.results&&e.results.forEach((e=>{n.has(e["Award ID"])||n.set(e["Award ID"],e)}))}));const r=[];return n.forEach((e=>{const t=[e["Recipient Name"],e["Awarding Agency"],e["Awarding Sub Agency"],e.Description,e["NAICS Description"],e["PSC Description"],e["Award ID"]].filter(Boolean).join(" ").toLowerCase();s.every((e=>t.includes(e.toLowerCase())))&&r.push(e)})),Utils.filterActiveContracts(Utils.normalizeAwardFields(r.sort(((e,t)=>t["Award Amount"]-e["Award Amount"]))))}}const l={};[...r.map((e=>({type:"psc",value:e}))),...s.map((e=>({type:"naics",value:e}))),...i.map((e=>({type:"keyword",value:e})))].forEach((({type:e,value:t})=>{l[e]||(l[e]=[]),l[e].push(t)}));const c=Object.entries(l).map((([e,t])=>{const n={time_period:[a],award_type_codes:this.CONTRACT_TYPES};return"psc"===e?n.psc_codes=t:"naics"===e?n.naics_codes=t:n.keywords=t,this._fetch(`${this.baseUrl}/search/spending_by_award/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filters:n,fields:this.AWARD_FIELDS,limit:100,sort:"Award Amount",order:"desc"})}).then((e=>e.json()))})),d=await Promise.all(c);let p=[];d.forEach((e=>{e.results&&(p=p.concat(e.results))}));const u=new Map;return p.forEach((e=>{u.has(e["Award ID"])||u.set(e["Award ID"],e)})),Utils.filterActiveContracts(Utils.normalizeAwardFields(Array.from(u.values()).sort(((e,t)=>t["Award Amount"]-e["Award Amount"]))))},async getSubAgencyData(e,t){const n=Utils.getCurrentFY(),a=Utils.buildFilters(e,[{start_date:n-1+"-10-01",end_date:`${n}-09-30`}]);t&&(a.agencies=[{type:"awarding",tier:"toptier",name:t}]);const r=await this._fetch(`${this.baseUrl}/search/spending_by_category/awarding_subagency`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({category:"awarding_subagency",filters:a,limit:50})});return(await r.json()).results||[]},async autocompleteAgency(e){if(!e||e.length<2)return[];const t=await this._fetch(`${this.baseUrl}/autocomplete/awarding_agency/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({search_text:e,limit:8})},8e3);return(await t.json()).results||[]},async autocompleteRecipient(e){if(!e||e.length<2)return[];const t=await this._fetch(`${this.baseUrl}/autocomplete/recipient/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({search_text:e,limit:8})},8e3);return(await t.json()).results||[]},async getSubawards(e){const t=new Date,n=new Date;n.setFullYear(t.getFullYear()-1);const a=[{start_date:Utils.formatDateISO(n),end_date:Utils.formatDateISO(t)}],r=Utils.buildFilters(e,a),s=await this._fetch(`${this.baseUrl}/search/spending_by_award/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subawards:!0,filters:r,fields:["Sub-Award ID","Sub-Awardee Name","Sub-Award Amount","Prime Award ID","Prime Recipient Name","Sub-Award Date","Awarding Agency","Awarding Sub Agency","prime_award_generated_internal_id"],limit:100,sort:"Sub-Award Amount",order:"desc"})});return(await s.json()).results||[]}},ForecastEngine={detectRecompetes(e){const t=new Date,n=new Date;return n.setFullYear(t.getFullYear()+2),e.filter((e=>{const a=new Date(e["End Date"]);return a>t&&a<n&&e["Award Amount"]>5e4})).sort(((e,t)=>new Date(e["End Date"])-new Date(t["End Date"]))).slice(0,15)}},JobLinks={knownBrands:["KBR","SAIC","CACI","LEIDOS","SERCO","AECOM","JACOBS","PARSONS","MAXIMUS","ICF","CGI","IBM","DELL","HP","CISCO","ORACLE","GOOGLE","AMAZON WEB","MICROSOFT","ACCENTURE FEDERAL","DELOITTE","KPMG","PWC","EY","PERATON","AMENTUM","MANTECH","BAE SYSTEMS","RAYTHEON","BOEING","AIRBUS","HONEYWELL","HARRIS","TEXTRON","VERIZON","ATT","AT&T","SPRINT","PALANTIR","ANDURIL","CROWDSTRIKE","SPLUNK","VMWARE","SALESFORCE","SERVICENOW","SNOWFLAKE","DATABRICKS","ELASTIC","GITLAB","ATLASSIAN"],brandAliases:{"BOOZ ALLEN":"BAH","GENERAL DYNAMICS":"GDIT","NORTHROP GRUMMAN":"NGC","LOCKHEED MARTIN":"LMCO",L3HARRIS:"L3 HARRIS","L3 HARRIS":"L3HARRIS","WORLD WIDE TECHNOLOGY":"WWT","RED HAT":"REDHAT","PALO ALTO":"PANW"},cleanVendorName(e){let t=e.replace(/,?\s*(LLC|INC|CORP|CORPORATION|INCORPORATED|L\.L\.C\.|L\.P\.|LP|LTD|LIMITED|CO\.)\.?\s*$/gi,"").replace(/\s+/g," ").trim();const n=t.toUpperCase();for(const e of this.knownBrands)if(n===e||n.startsWith(e+" "))return e;for(const[e,t]of Object.entries(this.brandAliases))if(n.startsWith(e))return e;return t},getLinkedInUrl(e){const t=this.cleanVendorName(e);return`https://www.linkedin.com/jobs/search/?keywords=${encodeURIComponent(t)}&f_C=`},getLinkedInPeopleUrl(e,t=""){const n=this.cleanVendorName(e);return`https://www.linkedin.com/search/results/people/?keywords=${encodeURIComponent(t?`"${n}" ${t}`:n)}&origin=GLOBAL_SEARCH_HEADER`},getLinkedInNewsUrl(e){const t="string"==typeof e?this.cleanVendorName(e):e;return`https://www.linkedin.com/search/results/content/?keywords=${encodeURIComponent(t)}`}},App={mode:"search",currentQuery:"",searchData:{raw:[],active:[],filter:null,loaded:!1},forecastData:{analysis:null,subawards:null,loaded:!1},drillState:{level:0,path:[],currentAgency:null,currentSubAgency:null},subawardDrillState:{level:0,path:[],filter:null,filterType:null},activeFeedSource:"prime",onlyHighMissionGap:!1,AI_ENDPOINT:"https://76unm1rlj0.execute-api.us-east-1.amazonaws.com/default/grumpy2",aiState:{history:[],count:0,max:5},async runAiActionPlan(){const e=document.getElementById("aiIntelligenceBanner"),t=document.getElementById("aiActionPanel"),n=document.getElementById("aiContentContainer"),a=document.getElementById("triggerAiPlanBtn"),r=document.getElementById("copyAiBtn");if(!App.searchData||!App.searchData.active||0===App.searchData.active.length)return void alert("Please run a search first to gather account data.");e&&(e.style.display="none"),t.style.display="block",document.getElementById("artiFab")?.classList.remove("visible"),setTimeout((()=>{t.scrollIntoView({behavior:"smooth",block:"start"})}),100),r.style.display="none",a.innerHTML='<i class="fas fa-spinner fa-spin" style="margin-right: 6px;"></i> ASKING ARTI...',a.disabled=!0,n.innerHTML='\n          <div style="padding: 0.5rem 0 1.5rem 0;">\n              <div style="display: flex; align-items: center; gap: 1rem;">\n                  <img src="images/arti.png" class="ai-avatar small" style="animation: artiPulse 1.5s infinite ease-in-out;" alt="Arti">\n                  <div>\n                      <div id="aiLoaderText" style="font-family: \'JetBrains Mono\', monospace; font-size: 0.85rem; color: var(--accent-light); font-weight: 700; text-transform: uppercase; letter-spacing: 1px;">\n                          INITIALIZING...\n                      </div>\n                      <div id="aiLoaderSubtext" style="font-size: 0.7rem; color: var(--text-muted); margin-top: 4px;">\n                          Connecting to Govhoo AI engine\n                      </div>\n                  </div>\n              </div>\n              \n              <div class="govhoo-progress-bar">\n                  <div id="aiProgressFill" class="govhoo-progress-fill"></div>\n                  <div class="govhoo-progress-glow"></div>\n              </div>\n              \n              <div style="display: flex; justify-content: flex-end; margin-top: 0.5rem;">\n                  <span id="aiLoaderTimer" style="font-size: 0.65rem; color: var(--text-muted); font-family: \'JetBrains Mono\', monospace;">0.0s</span>\n              </div>\n          </div>';const s=Date.now(),i=setInterval((()=>{const e=document.getElementById("aiLoaderText"),t=document.getElementById("aiLoaderSubtext"),n=document.getElementById("aiProgressFill"),a=document.getElementById("aiLoaderTimer");if(!e)return void clearInterval(i);const r=(Date.now()-s)/1e3;a.textContent=r.toFixed(1)+"s";const o=Math.min(96,100*(1-Math.exp(-r/4)));n.style.width=`${o}%`,r<2?(e.textContent="SCANNING DATASET",t.textContent=`Processing ${App.searchData.active.length} active contracts`):r<5?(e.textContent="ANALYZING PATTERNS",t.textContent="Identifying agency trends and vendor reach"):r<8?(e.textContent="EVALUATING COMPETITION",t.textContent="Cross-referencing prime and sub relationships"):(e.textContent="COMPOSING BRIEF",t.textContent="Applying federal sales heuristics")}),100),o=App.searchData.active;try{const e=await fetch(App.AI_ENDPOINT,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({request_type:"govhoo_action_plan",market_data:o,objective:"Account Intelligence"})});if(!e.ok)throw new Error(`Gateway Error: ${e.status}`);const t=await e.json();if(t.error)throw new Error(t.error);const a=t.strategic_read;if(!a)throw new Error("Invalid AI response format.");let s;if(clearInterval(i),window.marked&&"function"==typeof window.marked.parse)marked.setOptions({breaks:!0,gfm:!0}),s=marked.parse(a);else{s=`<pre style="white-space: pre-wrap; font-family: 'JetBrains Mono', monospace; font-size: 12px; line-height: 1.5;">${(e=>e.replace(/[&<>"']/g,(e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[e]))))(a)}</pre>`}n.innerHTML=`<div class="ai-result-section strategic-read">${s}</div>`,n.dataset.rawPlan=a,r.style.display="inline-block",document.getElementById("aiChatInputWrapper").style.display="flex",document.getElementById("aiChatCounter").style.display="block",document.getElementById("aiChatCounter").innerText=`${App.aiState.max} questions remaining for this view.`,document.getElementById("aiDisclaimer").style.display="block",document.getElementById("aiChatInput").onkeydown=function(e){"Enter"===e.key&&(e.preventDefault(),App.sendAiChatMessage())},App.aiState.history=[{role:"user",content:`Give me a strategic read on the "${App.currentQuery}" market.`},{role:"model",content:a}]}catch(e){console.error("AI Error:",e),clearInterval(i);const t=(e.message||"Unknown error").replace(/[&<>"']/g,(e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[e])));n.innerHTML=`\n              <div style="color: #ff6b6b; font-size: 13px; padding: 1rem 0;">\n                  Briefing failed: ${t}\n              </div>\n          `}finally{a.innerHTML="ASK ARTI",a.disabled=!1}},async sendAiChatMessage(){if(App.aiState.count>=App.aiState.max)return;const e=document.getElementById("aiChatInput"),t=document.getElementById("aiChatSendBtn"),n=e.value.trim();if(!n)return;const a=document.getElementById("aiChatHistory");a.style.display="flex";const r=n.replace(/[&<>"']/g,(e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[e])));a.insertAdjacentHTML("beforeend",`<div class="ai-msg-user">${r}</div>`),e.value="",e.disabled=!0,t.disabled=!0;const s="arti-load-"+Date.now();a.insertAdjacentHTML("beforeend",`\n          <div class="ai-msg-arti arti-thinking" id="${s}">\n              <img src="images/arti.png" class="ai-avatar small">\n              <div id="${s}-text" style="padding-top: 8px; color: var(--text-muted); font-size: 0.75rem; font-style: italic;">\n                  Reviewing the data\n              </div>\n          </div>\n      `);const i=Date.now(),o=setInterval((()=>{const e=document.getElementById(`${s}-text`);if(!e)return void clearInterval(o);const t=Math.floor((Date.now()-i)/1e3),n=".".repeat(t%3+1),a=["Reviewing the data","Analyzing patterns","Composing response"],r=a[Math.min(Math.floor(t/5),a.length-1)];e.textContent=`${r}${n} (${t}s)`}),500),l=document.getElementById(s);l.scrollIntoView({behavior:"smooth",block:"nearest"}),App.aiState.history.push({role:"user",content:n});try{const n=await fetch(App.AI_ENDPOINT,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({request_type:"govhoo_chat",market_data:App.searchData.active,history:App.aiState.history})});if(!n.ok)throw new Error(`Gateway Error: ${n.status}`);const a=await n.json();if(a.error)throw new Error(a.error);let r;if(window.marked&&"function"==typeof window.marked.parse)r=marked.parse(a.response);else{r=`<pre style="white-space: pre-wrap; font-family: 'JetBrains Mono', monospace; font-size: 12px; line-height: 1.5;">${(e=>e.replace(/[&<>"']/g,(e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[e]))))(a.response)}</pre>`}clearInterval(o),l.classList.remove("arti-thinking"),l.innerHTML=`\n              <img src="images/arti.png" class="ai-avatar small">\n              <div class="strategic-read">${r}</div>\n          `,setTimeout((()=>{l.scrollIntoView({behavior:"smooth",block:"start"})}),100),App.aiState.history.push({role:"model",content:a.response}),App.aiState.count++;const s=App.aiState.max-App.aiState.count,i=document.getElementById("aiChatCounter");s>1?(i.innerText=`${s} questions remaining for this view.`,i.style.color="#E07A5F",e.disabled=!1,t.disabled=!1,window.innerWidth>768&&setTimeout((()=>e.focus()),100)):1===s?(i.innerText="Make it count. I've got time for one more question on this dataset.",i.style.color="#E07A5F",e.disabled=!1,t.disabled=!1,window.innerWidth>768&&setTimeout((()=>e.focus()),100)):(i.innerText="That's all for this dataset. Run a new search or drill into an agency to reset my limits.",i.style.color="#E07A5F",e.placeholder="Limits reached for this view.")}catch(a){console.error("Chat Error:",a),clearInterval(o),l.classList.remove("arti-thinking"),l.innerHTML='<div style="color: #ff6b6b; font-size: 13px; padding-top: 8px;">Error fetching response. Try again.</div>',e.value=n,e.disabled=!1,t.disabled=!1,App.aiState.history.pop()}},copyAiPlan(){const e=document.getElementById("aiContentContainer");if(!e)return;const t=e.dataset.rawPlan;t&&navigator.clipboard.writeText(t).then((()=>{const e=document.getElementById("copyAiBtn"),t=e.innerHTML;e.innerHTML="COPIED",e.style.color="var(--success)",e.style.borderColor="var(--success)",setTimeout((()=>{e.innerHTML=t,e.style.color="",e.style.borderColor=""}),1500)})).catch((e=>{console.error("Clipboard failed:",e),alert("Copy failed.")}))},resetAiPanel(){const e=document.getElementById("aiIntelligenceBanner"),t=document.getElementById("aiActionPanel"),n=document.getElementById("aiContentContainer"),a=document.getElementById("triggerAiPlanBtn"),r=document.getElementById("copyAiBtn");App.aiState={history:[],count:0,max:5};const s=document.getElementById("aiChatHistory");s&&(s.innerHTML="",s.style.display="none");const i=document.getElementById("aiChatInputWrapper");i&&(i.style.display="none");const o=document.getElementById("aiChatCounter");o&&(o.style.display="none");const l=document.getElementById("aiDisclaimer");l&&(l.style.display="none"),document.getElementById("artiFab")?.classList.remove("visible"),e&&(e.style.display="flex"),t&&(t.style.display="none"),r&&(r.style.display="none"),n&&(n.innerHTML="",delete n.dataset.rawPlan),a&&(a.innerHTML="ASK ARTI",a.disabled=!1)},init(){let e;Autocomplete.init("mainSearchInput"),Autocomplete.init("miniSearch"),this.setupEventDelegation(),document.getElementById("mainSearchInput").addEventListener("keypress",(e=>{"Enter"===e.key&&App.runSearch()})),document.getElementById("miniSearch").addEventListener("keypress",(e=>{"Enter"===e.key&&(document.getElementById("mainSearchInput").value=e.target.value,App.runSearch(e.target.value))})),document.getElementById("mainSearchInput").addEventListener("focus",(function(){this.select()})),document.getElementById("miniSearch").addEventListener("focus",(function(){this.select()})),function(e,t){const n=document.getElementById(e),a=document.querySelector("."+t);if(!n||!a)return;const r=n.closest(".autocomplete-wrapper");r&&a.parentNode!==r&&r.appendChild(a);const s=()=>a.classList.toggle("visible",n.value.length>0);n.addEventListener("input",s),n.addEventListener("change",s),s()}("mainSearchInput","input-clear"),window.addEventListener("resize",(()=>{clearTimeout(e),e=setTimeout((()=>{"search"===App.mode&&App.searchData?.active?.length>0&&App.renderSankey();const e=document.getElementById("subawardWrapper");App.forecastData?.subawards&&e&&"none"!==e.style.display&&App.renderSubawardSankey(App.forecastData.subawards)}),250)})),LibLoader.preloadWhenIdle();const t=new URLSearchParams(window.location.search).get("q");t&&(document.getElementById("mainSearchInput").value=t,App.runSearch(t))},setupEventDelegation(){document.addEventListener("click",(e=>{const t=e.target.closest("[data-action]");if(!t)return;const n=t.dataset.action,a={search:()=>this.runSearch(),showHero:()=>this.showHero(),resetDrill:()=>this.resetDrill(),clearFilter:()=>this.resetDrill(),shareLink:()=>this.shareLink(t),shareBrief:()=>this.shareBrief(t),exportCSV:()=>this.exportCSV(t),resetSubawardDrill:()=>this.resetSubawardDrill()};a[n]&&(e.preventDefault(),a[n]())}))},showHero(){document.getElementById("appView").style.display="none";const e=document.getElementById("heroView");e.style.display="flex",e.classList.remove("hidden"),setTimeout((()=>e.classList.remove("slide-up")),10)},setMode(){document.getElementById("searchModeView")?.classList.add("active")},async runSearch(e){let t=e||document.getElementById("mainSearchInput").value;if(t){API.cancelAll(),t=Utils.normalizeQuery(t.toUpperCase()),document.getElementById("mainSearchInput").value=t,document.title=`Govhoo | ${t.toUpperCase()}`,t!==App.currentQuery&&(App.searchData={raw:[],active:[],filter:null,loaded:!1},App.forecastData={loaded:!1},App.resetDrill(),App.subawardDrillState={level:0,path:[],filter:null,filterType:null}),App.currentQuery=t,App.showLoader("SCANNING "+t.toUpperCase(),"Pulling live awards from USASpending.gov");try{await LibLoader.loadD3(),App.searchData.raw=await API.searchAwards(t),App.searchData.active=App.searchData.raw,App.searchData.loaded=!0,App.transitionToApp(),App.setMode("search"),App.updateSearchDashboard(),requestAnimationFrame((()=>{App.renderSankey(),App.renderVehiclePills(),App.renderPrimeReach()})),this.loadBackgroundData(t)}catch(e){console.error(e),App.hideLoader();const t=e.isTimeout?"USASpending.gov is responding slowly. Try again or narrow your search.":e.message||"Error retrieving data. Please try again.";App.transitionToApp(),App.setMode("search");const n=document.getElementById("feedGrid");n&&(n.innerHTML=`<div style="text-align:center;padding:2.5rem 1rem;color:var(--danger);">\n        <i class="fas fa-exclamation-triangle" style="font-size:1.5rem;margin-bottom:0.75rem;display:block;"></i>\n        <div style="font-size:0.85rem;margin-bottom:1rem;">${t}</div>\n        <button onclick="App.runSearch()" class="btn-primary" style="width:auto;padding:0.6rem 1.5rem;font-size:0.8rem;">\n          <i class="fas fa-redo" style="margin-right:6px;"></i>Retry Search\n        </button>\n      </div>`)}finally{App.hideLoader()}}},async loadBackgroundData(e){this.loadForecastInBackground(e);try{await this.loadSubcontractingData(e)}catch(e){console.warn("Background data failure:",e)}},async loadForecastInBackground(e){if(!e)return;const t=App.searchData.raw||[],n=ForecastEngine.detectRecompetes(t);App.forecastData={analysis:{recompetes:n},subawards:App.forecastData?.subawards||null,loaded:!0},App.renderStrategyTools()},renderStrategyTools(){const e=App.forecastData&&App.forecastData.analysis;if(!e)return;const t=e.recompetes||[],n=App.drillState||{};let a=t;n.level>=1&&n.currentAgency&&(a=t.filter((e=>e["Awarding Agency"]===n.currentAgency)),n.level>=2&&n.currentSubAgency&&(a=a.filter((e=>e["Awarding Sub Agency"]===n.currentSubAgency)))),this.renderRecompetes(a)},updateSearchDashboard(){App.resetAiPanel();const e=App.searchData.active,t=e.reduce(((e,t)=>e+(t["Award Amount"]||0)),0);document.getElementById("stat-vol").innerText=Utils.money(t),document.getElementById("stat-count").innerText=e.length,document.getElementById("stat-vendors").innerText=new Set(e.map((e=>e["Recipient Name"]))).size,document.getElementById("stat-agencies").innerText=new Set(e.map((e=>e["Awarding Agency"]))).size,document.getElementById("artiFab")?.classList.add("visible");const n=document.getElementById("marketHealth");if(n){new Date;const t=new Date;t.setDate(t.getDate()-90);let a=0;if(e.forEach((e=>{const n=e["Last Modified Date"]?new Date(e["Last Modified Date"]):null;n&&!isNaN(n.getTime())&&n>t&&a++})),a>0){const t=Math.round(a/e.length*100),r=t>70?"Active — programs are funded and moving":t>40?"Moderate — some programs active, some dormant":"Low activity — most contracts idle";n.innerHTML=`<strong style="color:${t>70?"var(--accent)":t>40?"var(--warning, #FDD835)":"var(--text-muted)"};">${t}%</strong> of contracts modified in last 90 days · ${r}`}else n.innerHTML=""}App.renderFeed(),App.updateDrillUI(),App.renderSearchTopBuyers(e),App.renderNaicsMix(e),App.renderBubbleChart(),App.renderStrategyTools();const a=document.getElementById("sankeySubtitle");a&&App.currentQuery&&(a.textContent='"'+App.currentQuery.toUpperCase()+'" · TOP 100 ACTIVE CONTRACTS · LIFETIME FUNDED VALUE');const r=document.getElementById("primeExplainerBox");r&&(r.style.display="block");const s=document.getElementById("subExplainerBox");s&&(s.style.display="block");const i=document.getElementById("subAndNote");if(i){const{andGroups:e}=Utils.parseSearchTerms(App.currentQuery||"");i.style.display=e.length>0?"inline":"none"}const o=document.getElementById("sankeyPanel");o&&o.classList.add("sankey-loaded")},resetDrill(){App.drillState={level:0,path:[],currentAgency:null,currentSubAgency:null},App.searchData.filter=null,App.searchData.active=App.searchData.raw,App.nativeSubAgencyData=null,App.activeFeedSource="prime",App.activeVehicleFilter=null,App.bubbleMode="auto",App.updateSearchDashboard(),App.renderSankey()},viewFootprint(e){const t=JobLinks.cleanVendorName(e);!t||t.length<2||(document.getElementById("mainSearchInput").value=t,document.getElementById("miniSearch").value=t,App.runSearch(t))},activeVehicleFilter:null,filterByVehicle(e,t){App.activeVehicleFilter!==e?(App.activeVehicleFilter=e,App.searchData.active=App.searchData.raw.filter((t=>t.parent_award_id===e)),App.searchData.filter=t,App.activeFeedSource="prime",App.updateSearchDashboard(),App.renderSankey(),App.renderVehiclePills()):this.clearVehicleFilter()},clearVehicleFilter(){App.activeVehicleFilter=null,App.searchData.filter=null,App.searchData.active=App.searchData.raw,App.activeFeedSource="prime",App.updateSearchDashboard(),App.renderSankey(),App.renderVehiclePills()},renderVehiclePills(){const e=document.getElementById("vehicleFilterBar"),t=document.getElementById("vehiclePills");if(!e||!t)return;const n=App.searchData.raw||[],a={};n.forEach((e=>{const t=e.parent_award_id;if(!t||"NONE"===t)return;const n=VehicleDetector.detect(t)?.short||t;a[t]||(a[t]={pid:t,label:n,count:0,amount:0}),a[t].count++,a[t].amount+=parseFloat(e["Award Amount"])||0}));const r=Object.values(a).sort(((e,t)=>t.amount-e.amount)).filter((e=>e.count>=2));if(0===r.length)return void(e.style.display="none");e.style.display="block";const s=r.slice(0,8),i=App.activeVehicleFilter;t.innerHTML=s.map((e=>{const t=i===e.pid;return`<button onclick="App.filterByVehicle('${e.pid.replace(/'/g,"\\'")}', '${e.label.replace(/'/g,"\\'")}')"\n        style="padding: 0.2rem 0.5rem; font-family: 'JetBrains Mono', monospace; font-size: 0.6rem;\n        background: ${t?"var(--accent)":"rgba(255,255,255,0.07)"}; \n        color: ${t?"#000":"var(--text-muted)"};\n        border: 1px solid ${t?"var(--accent)":"var(--border)"}; border-radius: 4px; \n        cursor: pointer; transition: all 0.15s; white-space: nowrap;"\n        title="${e.pid} · ${e.count} orders · ${Utils.money(e.amount)}">${e.label} <span style="opacity:0.6">${e.count}</span></button>`})).join("")+(i?'<button onclick="App.clearVehicleFilter()" \n      style="padding: 0.2rem 0.5rem; font-family: \'JetBrains Mono\', monospace; font-size: 0.6rem;\n      background: rgba(239,83,80,0.15); color: var(--danger); border: 1px solid rgba(239,83,80,0.3); \n      border-radius: 4px; cursor: pointer;">Clear</button>':"")},renderPrimeReach(){const e=document.getElementById("teamingPanel"),t=document.getElementById("teamingList");if(!e||!t)return;const n=App.searchData.raw||[];if(0===n.length)return void(e.style.display="none");const a={};n.forEach((e=>{const t=e["Recipient Name"]||"Unknown",n=e["Awarding Agency"]||"",r=e["Awarding Sub Agency"]||"",s=parseFloat(e["Award Amount"])||0;a[t]||(a[t]={name:t,agencies:{},subAgencies:new Set,totalAmt:0,count:0}),a[t].totalAmt+=s,a[t].count++,n&&(a[t].agencies[n]||(a[t].agencies[n]=0),a[t].agencies[n]+=s),r&&a[t].subAgencies.add(r)}));const r=Object.values(a).sort(((e,t)=>Object.keys(t.agencies).length-Object.keys(e.agencies).length||t.totalAmt-e.totalAmt)).slice(0,5);if(0===r.length)return void(e.style.display="none");e.style.display="block";t.innerHTML=r.map((e=>{const t=Object.keys(e.agencies).length,n=e.subAgencies.size,a=Object.entries(e.agencies).sort(((e,t)=>t[1]-e[1])).map((([e])=>e.replace(/^Department of (the )?/i,"").replace(/^Office of (the )?/i,"")));return`<div class="reach-row" onclick="App.viewFootprint('${r=e.name,r.replace(/'/g,"\\'").replace(/"/g,"&quot;")}')" title="Search ${e.name}'s full federal portfolio">\n        <div style="min-width: 0; flex: 1;">\n          <div style="display: flex; align-items: center; gap: 0.4rem; flex-wrap: wrap;">\n            <span class="reach-name">${Utils.trunc(e.name,28)}</span>\n            <span class="reach-badge accent">${t} ${1===t?"agency":"agencies"}</span>\n            ${n>t?`<span class="reach-badge">${n} offices</span>`:""}\n          </div>\n          <div class="reach-meta">\n            ${a.slice(0,3).map((e=>Utils.trunc(e,20))).join(" · ")}${a.length>3?" +"+(a.length-3):""}\n          </div>\n          <div class="job-links" style="margin-top: 0.25rem;" onclick="event.stopPropagation();">\n            <a href="${JobLinks.getLinkedInPeopleUrl(e.name)}" target="_blank" class="job-link"> People</a>\n            <a href="${JobLinks.getLinkedInUrl(e.name)}" target="_blank" class="job-link"> Jobs</a>\n            <a href="${JobLinks.getLinkedInNewsUrl(e.name)}" target="_blank" class="job-link"> News</a>\n          </div>\n        </div>\n        <div style="text-align: right; flex-shrink: 0;">\n          <div class="reach-amount">${Utils.money(e.totalAmt)}</div>\n          <div class="reach-count">${e.count} awards</div>\n        </div>\n      </div>`;var r})).join("")},updateDrillUI(){const e=document.getElementById("drillBreadcrumb"),t=document.getElementById("drillHint"),n=document.getElementById("drillControlsBar");if(0===App.drillState.level)n&&(n.style.display="none"),t.style.display="none";else{n&&(n.style.display="block"),e.style.display="flex";let a='<div class="breadcrumb-item" data-action="resetDrill"><span>All Agencies</span></div>';App.drillState.path.forEach(((e,t)=>{const n=t===App.drillState.path.length-1;a+=`\n        <span class="breadcrumb-separator"></span>\n        <div class="breadcrumb-item ${n?"active":""}" onclick="${n?"":`App.drillToLevel(${t+1})`}">\n          <span>${Utils.trunc(e.name,25)}</span>\n        </div>`})),e.innerHTML=a,1===App.drillState.level?t.innerHTML="<span>Click a <strong>sub-agency</strong> or <strong>vendor</strong> to refine</span>":2===App.drillState.level?t.innerHTML="<span>Viewing <strong>sub-agency</strong> breakdown</span>":t.innerHTML="<span>Viewing filtered breakdown</span>"}},drillToAgency(e){App.drillState={level:1,currentAgency:e,currentSubAgency:null,path:[{type:"agency",name:e}]},App.searchData.active=App.searchData.raw.filter((t=>t["Awarding Agency"]===e)),App.searchData.filter=e,App.activeFeedSource="prime","vendors"!==App.bubbleMode&&"agencies"!==App.bubbleMode&&(App.bubbleMode="auto"),App.updateSearchDashboard(),App.renderSankey(),App.currentQuery&&API.getSubAgencyData(App.currentQuery,e).then((t=>{t&&t.length>0&&App.drillState.currentAgency===e&&(App.nativeSubAgencyData=t,App.renderSearchTopBuyers(App.searchData.active))})).catch((e=>console.warn("Native sub-agency fetch failed:",e)))},drillToSubAgency(e){App.drillState.level=2,App.drillState.currentSubAgency=e,App.drillState.path=[{type:"agency",name:App.drillState.currentAgency},{type:"sub",name:e}],App.searchData.active=App.searchData.raw.filter((t=>t["Awarding Agency"]===App.drillState.currentAgency&&t["Awarding Sub Agency"]===e)),App.searchData.filter=e,App.activeFeedSource="prime","vendors"!==App.bubbleMode&&"agencies"!==App.bubbleMode&&(App.bubbleMode="auto"),App.updateSearchDashboard(),App.renderSankey()},drillToLevel(e){App.searchData.active=App.searchData.raw,0===e?App.resetDrill():1===e?App.drillToAgency(App.drillState.path[0].name):2===e&&App.drillToSubAgency(App.drillState.path[1].name)},drillDown(e){const t=App.searchData.raw,n=t.find((t=>t["Awarding Agency"]===e)),a=t.find((t=>t["Awarding Sub Agency"]===e)),r=t.find((t=>t["Recipient Name"]===e));if(App.searchData.active=t,n&&!a)App.drillToAgency(e);else if(a){const t=a["Awarding Agency"];App.drillState.currentAgency=t,App.drillToSubAgency(e)}else r&&(3===App.drillState.level&&App.drillState.path.pop(),App.drillState.level=3,App.drillState.path.push({type:"vendor",name:e}),App.searchData.filter=`Vendor: ${e}`,App.activeFeedSource="prime",App.searchData.active=t.filter((t=>t["Recipient Name"]===e)),App.updateSearchDashboard(),App.renderSankey())},clearFilter(){App.drillState.level>0?App.resetDrill():(App.searchData.filter=null,App.searchData.active=App.searchData.raw,App.activeFeedSource="prime",App.updateSearchDashboard(),App.renderSankey())},renderSankey(){const e=document.getElementById("chartContainer");e.innerHTML="";const t=App.searchData.active;if(!t||0===t.length)return void(e.innerHTML='<div style="text-align:center; padding:4rem; color:var(--text-subtle)">No data available for this view.</div>');const n=0===App.drillState.level,a={};t.forEach((e=>{if(e["Award Amount"]>0){const t=((n?e["Awarding Agency"]:e["Awarding Sub Agency"])||e["Awarding Agency"]||"Unknown Agency")+"|||"+(e["Recipient Name"]||"Unknown Vendor");a[t]=(a[t]||0)+e["Award Amount"]}}));const r=Object.entries(a).sort(((e,t)=>t[1]-e[1])),s=App.drillState.level>0?50:25,i=r.slice(0,s),o=r.slice(s),l=new Set,c=[];if(i.forEach((([e,t])=>{const[n,a]=e.split("|||");l.add(n),l.add(a),c.push({source:n,target:a,value:t})})),o.length>0){const e={};o.forEach((([t,n])=>{const[a]=t.split("|||");l.has(a)&&(e[a]=(e[a]||0)+n)})),Object.entries(e).forEach((([e,t])=>{const n=`Other (${o.length} Vendors)`;l.add(n),c.push({source:e,target:n,value:t})}))}const d=Array.from(l).map((e=>({name:e}))),p=new Map(d.map(((e,t)=>[e.name,t]))),u=c.map((e=>({source:p.get(e.source),target:p.get(e.target),value:e.value}))),m=((e.parentElement?e.parentElement.offsetWidth:e.offsetWidth)||800)-2,g=Math.max(500,28*d.length),h=d3.select(e).append("svg").attr("id","sankeySvg").attr("viewBox",`0 0 ${m} ${g}`).attr("preserveAspectRatio","xMidYMid meet").style("width","100%").style("height","auto").style("display","block"),y=d3.sankey().nodeId((e=>e.index)).nodeWidth(20).nodePadding(20).extent([[1,1],[m-1,g-6]]),{nodes:b,links:A}=y({nodes:d.map((e=>Object.assign({},e))),links:u.map((e=>Object.assign({},e)))});Utils.getColor.reset();const f=h.append("defs");A.forEach(((e,t)=>{const n="prime-grad-"+t,a=f.append("linearGradient").attr("id",n).attr("gradientUnits","userSpaceOnUse").attr("x1",e.source.x1).attr("x2",e.target.x0);a.append("stop").attr("offset","0%").attr("stop-color",Utils.getColor(e.source.name)),a.append("stop").attr("offset","100%").attr("stop-color",Utils.getColor(e.target.name))}));h.append("g").attr("fill","none").selectAll("path").data(A).join("path").attr("d",d3.sankeyLinkHorizontal()).attr("stroke",((e,t)=>"url(#prime-grad-"+t+")")).attr("stroke-width",(e=>Math.max(1,e.width))).attr("stroke-opacity",.4).attr("stroke-linecap","butt").attr("fill","none").style("transition","stroke-opacity 0.2s").on("mouseover",(function(){d3.select(this).attr("stroke-opacity",.8)})).on("mouseout",(function(){d3.select(this).attr("stroke-opacity",.4)})).append("title").text((e=>`${e.source.name} → ${e.target.name}\n${Utils.money(e.value)}`));const v=e=>!(!e||e.startsWith("Other")||e.includes("Unknown")||"No Description"===e)&&App.searchData.raw.some((t=>t["Awarding Agency"]===e||t["Awarding Sub Agency"]===e||t["Recipient Name"]===e)),w=e=>{if(0===App.drillState.level)return!1;const t=App.drillState.path[App.drillState.path.length-1];return t&&t.name===e},S="ontouchstart"in window||navigator.maxTouchPoints>0;h.append("g").selectAll("rect").data(b).join("rect").attr("x",(e=>e.x0)).attr("y",(e=>e.y0)).attr("height",(e=>Math.max(1,e.y1-e.y0))).attr("width",(e=>e.x1-e.x0)).attr("fill",(e=>Utils.getColor(e.name))).attr("opacity",(e=>w(e.name)?1:.8)).attr("stroke",(e=>w(e.name)?"#F1EEE9":"transparent")).attr("stroke-width",(e=>w(e.name)?0:S?24:0)).style("cursor",(e=>v(e.name)?"pointer":"default")).on("click",((e,t)=>{v(t.name)&&(w(t.name)?App.drillState.level<=1?App.resetDrill():App.drillToLevel(App.drillState.level-1):App.drillDown(t.name))})).on("mouseover",(function(e,t){v(t.name)&&d3.select(this).attr("opacity",1)})).on("mouseout",(function(e,t){d3.select(this).attr("opacity",w(t.name)?1:.8)})).append("title").text((e=>{if(!v(e.name))return`${e.name}\n${Utils.money(e.value)}`;const t=w(e.name)?"← Click to drill out":"Click to drill down →";return`${e.name}\n${Utils.money(e.value)}\n${t}`}));const I=m<600;h.append("g").selectAll("text").data(b).join("text").attr("x",(e=>e.x0<m/2?e.x1+6:e.x0-6)).attr("y",(e=>(e.y1+e.y0)/2)).attr("dy",(e=>e.y1-e.y0>30?e.x0<m/2?"-0.5em":"1.1em":"0.35em")).attr("text-anchor",(e=>e.x0<m/2?"start":"end")).text((e=>Utils.trunc(e.name,I?25:40))).style("font-size","11px").style("font-weight",(e=>e.y1-e.y0>30?"700":"400")).style("fill",App.presentationMode?"#1A1A1A":"#F1EEE9").style("pointer-events","none")},renderFeed(e){const t=document.getElementById("feedGrid"),n=App.searchData.active;if(0===n.length)return void(t.innerHTML='<div style="text-align:center; padding:2rem; color:var(--text-subtle)">No contracts found.</div>');const a=e?n:n.slice(0,3),r=!e&&n.length>3,s=a.map(((e,t)=>{const n=e.generated_internal_id;let a="#";n?a=`https://www.usaspending.gov/award/${n}`:e["Award ID"]&&(a=`https://www.usaspending.gov/search/?hash=&filters=${encodeURIComponent(JSON.stringify({keyword:e["Award ID"]}))}`);let r="";const s=Utils.getContractTypeTag(e["Contract Award Type"]);s&&(r+=`<span class="meta-tag" style="background:rgba(141,160,203,0.15);border-color:rgba(141,160,203,0.3);color:var(--info);" title="${s.full}">${s.short}</span>`),e["NAICS Code"]&&(r+=`<span class="meta-tag naics" title="${Autocomplete.escapeHtml(e["NAICS Description"]||"")}">NAICS: ${Autocomplete.escapeHtml(e["NAICS Code"])}</span>`),e["PSC Code"]&&(r+=`<span class="meta-tag psc" title="${Autocomplete.escapeHtml(e["PSC Description"]||"")}">PSC: ${Autocomplete.escapeHtml(e["PSC Code"])}</span>`);const i=VehicleDetector.detect(e["Award ID"]);i&&(r+=`<span class="meta-tag" style="background:rgba(95,128,85,0.15);border-color:rgba(95,128,85,0.3);color:var(--accent);" title="${i.vehicle}">${i.short}</span>`);const o=e["Type Set Aside"],l=VehicleDetector.getSetAsideLabel(o);l&&(r+=`<span class="meta-tag" style="background:rgba(229,192,123,0.15);border-color:rgba(229,192,123,0.3);color:var(--accent);" title="Set-Aside: ${l}">${l}</span>`);const c=parseInt(e.number_of_offers_received);c&&c>0&&(r+=`<span class="meta-tag" style="background:rgba(255,255,255,0.05);border-color:var(--border);color:var(--text-muted);" title="Number of offers received">${c} offer${c>1?"s":""}</span>`);const d=e["Awarding Sub Agency"],p=d&&d!==e["Awarding Agency"]?`${Utils.trunc(e["Awarding Agency"],20)} → ${Utils.trunc(d,20)}`:Utils.trunc(e["Awarding Agency"],35),u=e["Recipient Name"]||"Unknown Vendor",m=Autocomplete.escapeHtml(u),g=Autocomplete.escapeHtml(Utils.trunc(e.Description,100)),h=Autocomplete.escapeHtml(p),y=JobLinks.getLinkedInUrl(u),b=JobLinks.getLinkedInPeopleUrl(u),A=JobLinks.getLinkedInNewsUrl(u);return`<div class="deal-card">\n    <div class="deal-header"><span class="deal-agency">${h}</span><span class="deal-amount">${Utils.money(e["Award Amount"])}<span style="font-size:0.55rem;opacity:0.5;margin-left:0.25rem;">obligated</span></span></div>\n    <div class="deal-desc">${g}</div>\n    <div class="deal-vendor">${m} <a href="${b}" target="_blank" class="job-link" style="margin-left:6px;" title="Find contacts at this company"> People</a> <a href="${y}" target="_blank" class="job-link" title="Search jobs at this company"> Jobs</a> <a href="${A}" target="_blank" class="job-link" title="LinkedIn posts about this company"> News</a></div>\n    ${r?`<div class="deal-meta">${r}</div>`:""}\n    <div class="deal-footer"><span class="deal-date">Start: ${Utils.date(e["Start Date"])}${e["End Date"]?" → "+Utils.date(e["End Date"]):""}${e["Last Modified Date"]?` <span style="opacity:0.5;font-size:0.6rem;" title="Last government action on this contract">· mod ${Utils.date(e["Last Modified Date"])}</span>`:""}</span><div style="display:flex;gap:0.5rem;align-items:center;"><button onclick="Utils.copyDealToClipboard(${t}, this)" class="action-btn" style="font-size:0.7rem; padding:0.35rem 0.6rem; cursor:pointer; background:transparent;" title="Copy for CRM"></button><a href="${a}" target="_blank" class="action-btn">VIEW </a></div></div>\n  </div>`})).join(""),i=r?`<button onclick="App.renderFeed(true)" style="width: 100%; padding: 0.875rem; background: var(--bg-card); border: 1px dashed var(--border); border-radius: 4px; color: var(--accent); font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; cursor: pointer; transition: all 0.2s; text-transform: uppercase; letter-spacing: 1px;" onmouseover="this.style.borderColor='var(--accent)';this.style.background='var(--accent-dim)'" onmouseout="this.style.borderColor='var(--border)';this.style.background='var(--bg-card)'">Show All ${n.length} Contracts</button>`:"";t.innerHTML=s+i},renderSubawardFeed(e,t){const n=e||document.getElementById("subFeedGrid"),a=document.getElementById("subFeedWrapper");if(!n)return;let r=App.forecastData.subawards||[];const s=App.subawardDrillState;if(s.level>0&&s.path&&s.path.length>0&&s.path.forEach((e=>{"agency"===e.type?r=r.filter((t=>(t["Awarding Agency"]||"Unknown Agency")===e.name)):"subagency"===e.type?r=r.filter((t=>(t["Awarding Sub Agency"]||"Unknown Sub Agency")===e.name)):"prime"===e.type?r=r.filter((t=>(t["Prime Recipient Name"]||"Unknown Prime")===e.name)):"sub"===e.type&&(r=r.filter((t=>(t["Sub-Awardee Name"]||"Unknown Sub")===e.name)))})),0===r.length)return n.innerHTML='<div style="text-align:center; padding:2rem; color:var(--text-subtle)">No subcontracts found.</div>',void(a&&(a.style.display="none"));a&&(a.style.display="block"),r=[...r].sort(((e,t)=>(parseFloat(t["Sub-Award Amount"])||0)-(parseFloat(e["Sub-Award Amount"])||0)));const i=t?r.slice(0,50):r.slice(0,3),o=!t&&r.length>3,l=i.map((e=>{const t=e["Prime Recipient Name"]||"Unknown Prime",n=e["Sub-Awardee Name"]||"Unknown Sub",a=parseFloat(e["Sub-Award Amount"])||0,r=e["Sub-Award Date"],s=e["Awarding Agency"]||e["Awarding Sub Agency"]||"",i=e.prime_award_generated_internal_id||"";let o="";i&&(o=`https://www.usaspending.gov/award/${i}`);const l=Autocomplete.escapeHtml(Utils.trunc(t,25)),c=Autocomplete.escapeHtml(Utils.trunc(n,25)),d=JobLinks.getLinkedInPeopleUrl(t),p=JobLinks.getLinkedInPeopleUrl(n),u=encodeURIComponent(JSON.stringify({"Awarding Agency":s,"Prime Recipient Name":t,"Sub-Awardee Name":n,"Sub-Award Amount":e["Sub-Award Amount"],"Sub-Award Date":r,prime_award_generated_internal_id:i}));return`<div class="deal-card" style="border-left-color: var(--accent);">\n        <div class="deal-header">\n          <span class="deal-agency" style="color: var(--accent);">SUBCONTRACT</span>\n          <span class="deal-amount">${Utils.money(a)}</span>\n        </div>\n        <div class="deal-desc" style="font-size: 0.8rem;">\n          <strong>${l}</strong>  <strong>${c}</strong>\n        </div>\n        <div class="deal-vendor" style="font-size: 0.75rem; color: var(--text-muted);">\n          ${s?`Agency: ${Autocomplete.escapeHtml(Utils.trunc(s,30))}`:""}\n        </div>\n        <div class="deal-footer">\n          <span class="deal-date">${r?Utils.date(r):"Date N/A"}</span>\n          <div style="display: flex; gap: 0.5rem; align-items: center;">\n            <button onclick="Utils.copySubDealToClipboard('${u}', this)" class="action-btn" style="font-size:0.65rem; padding:0.25rem 0.5rem; cursor:pointer; background:transparent;" title="Copy for CRM"></button>\n            <a href="${d}" target="_blank" class="job-link" title="Find contacts at prime"> Prime</a>\n            <a href="${p}" target="_blank" class="job-link" title="Find contacts at sub"> Sub</a>\n            ${o?`<a href="${o}" target="_blank" class="action-btn" style="font-size: 0.65rem; padding: 0.25rem 0.5rem;">VIEW </a>`:""}\n          </div>\n        </div>\n      </div>`})).join(""),c=o?`<button onclick="App.renderSubawardFeed(null, true)" style="width: 100%; padding: 0.875rem; background: var(--bg-card); border: 1px dashed var(--border); border-radius: 4px; color: var(--accent); font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; cursor: pointer; transition: all 0.2s; text-transform: uppercase; letter-spacing: 1px;" onmouseover="this.style.borderColor='var(--accent)';this.style.background='rgba(229,192,123,0.08)'" onmouseout="this.style.borderColor='var(--border)';this.style.background='var(--bg-card)'">Show All ${Math.min(r.length,50)} Subcontracts</button>`:"";n.innerHTML=l+c},renderSearchTopBuyers(e){const t=document.getElementById("searchTopBuyersBody"),n=document.getElementById("agencyReachPanel");if(!t)return;if(!e||0===e.length)return void(n&&(n.style.display="none"));n&&(n.style.display="block");const a=App.drillState||{},r=a.level>=1&&a.currentAgency,s=e=>e.replace(/'/g,"\\'").replace(/"/g,"&quot;");if(r){const n=App.nativeSubAgencyData;let a;if(n&&n.length>0)a=n.map((e=>({name:e.name||"Unknown",spend:e.amount||0,count:e.count||0}))).sort(((e,t)=>t.spend-e.spend));else{const t={};e.forEach((e=>{const n=e["Awarding Sub Agency"]||e["Awarding Agency"]||"Unknown";t[n]||(t[n]={name:n,spend:0,count:0}),t[n].spend+=parseFloat(e["Award Amount"])||0,t[n].count++})),a=Object.values(t).sort(((e,t)=>t.spend-e.spend))}const r=a.slice(0,5);t.innerHTML=r.map((e=>`<div class="reach-row" onclick="App.drillToSubAgency('${s(e.name)}')">\n        <div style="min-width: 0; flex: 1;">\n          <div style="display: flex; align-items: center; gap: 0.4rem; flex-wrap: wrap;">\n            <span class="reach-name">${Utils.trunc(e.name,28)}</span>\n            <span class="reach-badge">${e.count} awards</span>\n          </div>\n          <div class="job-links" style="margin-top: 0.25rem;" onclick="event.stopPropagation();">\n            <a href="${JobLinks.getLinkedInPeopleUrl(e.name)}" target="_blank" class="job-link"> People</a>\n            <a href="${JobLinks.getLinkedInUrl(e.name)}" target="_blank" class="job-link"> Jobs</a>\n            <a href="${JobLinks.getLinkedInNewsUrl(e.name)}" target="_blank" class="job-link"> News</a>\n          </div>\n        </div>\n        <div style="text-align: right; flex-shrink: 0;">\n          <div class="reach-amount">${Utils.money(e.spend)}</div>\n          <div class="reach-count">${e.count} awards</div>\n        </div>\n      </div>`)).join("")+(a.length>5?`<div class="reach-overflow">+${a.length-5} more offices</div>`:"")}else{const n={};e.forEach((e=>{const t=e["Awarding Agency"]||"Unknown",a=e["Awarding Sub Agency"]||"",r=e["Recipient Name"]||"",s=parseFloat(e["Award Amount"])||0;n[t]||(n[t]={name:t,spend:0,count:0,subs:new Set,vendors:{}}),n[t].spend+=s,n[t].count++,a&&n[t].subs.add(a),r&&(n[t].vendors[r]||(n[t].vendors[r]=0),n[t].vendors[r]+=s)}));const a=Object.values(n).sort(((e,t)=>t.spend-e.spend)),r=a.slice(0,5),i=e=>e.replace(/^Department of (the )?/i,"").replace(/^Office of (the )?/i,"");t.innerHTML=r.map((e=>{const t=e.subs.size,n=Object.entries(e.vendors).sort(((e,t)=>t[1]-e[1]))[0];return`<div class="reach-row" onclick="App.drillToAgency('${s(e.name)}')">\n        <div style="min-width: 0; flex: 1;">\n          <div style="display: flex; align-items: center; gap: 0.4rem; flex-wrap: wrap;">\n            <span class="reach-name">${Utils.trunc(i(e.name),28)}</span>\n            ${t>1?`<span class="reach-badge accent">${t} offices</span>`:""}\n            <span class="reach-badge">${e.count} awards</span>\n          </div>\n          <div class="reach-meta">\n            ${n?`${Utils.trunc(n[0],22)} leads`:""}\n          </div>\n          <div class="job-links" style="margin-top: 0.25rem;" onclick="event.stopPropagation();">\n            <a href="${JobLinks.getLinkedInPeopleUrl(e.name)}" target="_blank" class="job-link"> People</a>\n            <a href="${JobLinks.getLinkedInUrl(e.name)}" target="_blank" class="job-link"> Jobs</a>\n            <a href="${JobLinks.getLinkedInNewsUrl(e.name)}" target="_blank" class="job-link"> News</a>\n          </div>\n        </div>\n        <div style="text-align: right; flex-shrink: 0;">\n          <div class="reach-amount">${Utils.money(e.spend)}</div>\n          <div class="reach-count">${e.count} awards</div>\n        </div>\n      </div>`})).join("")+(a.length>5?`<div class="reach-overflow">+${a.length-5} more agencies</div>`:"")}},renderSearchTopPrimes(e){const t=document.getElementById("searchTopPrimesBody"),n=document.getElementById("subPrimesPanel");if(!t)return;if(!e||0===e.length)return void(n&&(n.style.display="none"));let a=e;const r=App.subawardDrillState;r.level>0&&r.path&&r.path.length>0&&r.path.forEach((e=>{"agency"===e.type?a=a.filter((t=>(t["Awarding Agency"]||"Unknown Agency")===e.name)):"subagency"===e.type?a=a.filter((t=>(t["Awarding Sub Agency"]||"Unknown Sub Agency")===e.name)):"prime"===e.type?a=a.filter((t=>(t["Prime Recipient Name"]||"Unknown Prime")===e.name)):"sub"===e.type&&(a=a.filter((t=>(t["Sub-Awardee Name"]||"Unknown Sub")===e.name)))}));const s={};a.forEach((e=>{const t=e["Prime Recipient Name"]||"Unknown",n=e["Sub-Awardee Name"]||"",a=parseFloat(e["Sub-Award Amount"])||0;s[t]||(s[t]={name:t,spend:0,count:0,subs:{}}),s[t].spend+=a,s[t].count++,n&&(s[t].subs[n]||(s[t].subs[n]=0),s[t].subs[n]+=a)}));const i=Object.values(s).sort(((e,t)=>t.spend-e.spend)),o=i.slice(0,5);if(0===o.length)return void(n&&(n.style.display="none"));n&&(n.style.display="block");t.innerHTML=o.map((e=>{const t=Object.keys(e.subs).length,n=Object.entries(e.subs).sort(((e,t)=>t[1]-e[1])).map((([e])=>Utils.trunc(e,20)));return`<div class="reach-row" onclick="App.viewFootprint('${a=e.name,a.replace(/'/g,"\\'").replace(/"/g,"&quot;")}')" title="Search ${e.name} portfolio">\n        <div style="min-width: 0; flex: 1;">\n          <div style="display: flex; align-items: center; gap: 0.4rem; flex-wrap: wrap;">\n            <span class="reach-name">${Utils.trunc(e.name,28)}</span>\n            <span class="reach-badge accent">${t} subs</span>\n            <span class="reach-badge">${e.count} awards</span>\n          </div>\n          <div class="reach-meta">\n            ${n.slice(0,3).join(" · ")}${n.length>3?" +"+(n.length-3):""}\n          </div>\n          <div class="job-links" style="margin-top: 0.25rem;" onclick="event.stopPropagation();">\n            <a href="${JobLinks.getLinkedInPeopleUrl(e.name)}" target="_blank" class="job-link"> People</a>\n            <a href="${JobLinks.getLinkedInUrl(e.name)}" target="_blank" class="job-link"> Jobs</a>\n            <a href="${JobLinks.getLinkedInNewsUrl(e.name)}" target="_blank" class="job-link"> News</a>\n          </div>\n        </div>\n        <div style="text-align: right; flex-shrink: 0;">\n          <div class="reach-amount">${Utils.money(e.spend)}</div>\n          <div class="reach-count">${e.count} subs</div>\n        </div>\n      </div>`;var a})).join("")+(i.length>5?`<div class="reach-overflow">+${i.length-5} more primes</div>`:"")},renderSearchTopSubs(e){const t=document.getElementById("searchTopSubsBody"),n=document.getElementById("subSubsPanel");if(!t)return;if(!e||0===e.length)return void(n&&(n.style.display="none"));let a=e;const r=App.subawardDrillState;r.level>0&&r.path&&r.path.length>0&&r.path.forEach((e=>{"agency"===e.type?a=a.filter((t=>(t["Awarding Agency"]||"Unknown Agency")===e.name)):"subagency"===e.type?a=a.filter((t=>(t["Awarding Sub Agency"]||"Unknown Sub Agency")===e.name)):"prime"===e.type?a=a.filter((t=>(t["Prime Recipient Name"]||"Unknown Prime")===e.name)):"sub"===e.type&&(a=a.filter((t=>(t["Sub-Awardee Name"]||"Unknown Sub")===e.name)))}));const s={};a.forEach((e=>{const t=e["Sub-Awardee Name"]||"Unknown",n=e["Prime Recipient Name"]||"",a=parseFloat(e["Sub-Award Amount"])||0;s[t]||(s[t]={name:t,spend:0,count:0,primes:{}}),s[t].spend+=a,s[t].count++,n&&(s[t].primes[n]||(s[t].primes[n]=0),s[t].primes[n]+=a)}));const i=Object.values(s).sort(((e,t)=>t.spend-e.spend)),o=i.slice(0,5);if(0===o.length)return void(n&&(n.style.display="none"));n&&(n.style.display="block");t.innerHTML=o.map((e=>{const t=Object.keys(e.primes).length,n=Object.entries(e.primes).sort(((e,t)=>t[1]-e[1])).map((([e])=>Utils.trunc(e,20)));return`<div class="reach-row" onclick="App.viewFootprint('${(e=>e.replace(/'/g,"\\'").replace(/"/g,"&quot;"))(e.name)}')" title="Search ${e.name} portfolio">\n        <div style="min-width: 0; flex: 1;">\n          <div style="display: flex; align-items: center; gap: 0.4rem; flex-wrap: wrap;">\n            <span class="reach-name">${Utils.trunc(e.name,28)}</span>\n            <span class="reach-badge accent">${t} ${1===t?"prime":"primes"}</span>\n            <span class="reach-badge">${e.count} awards</span>\n          </div>\n          <div class="reach-meta">\n            ${n.slice(0,3).join(" · ")}${n.length>3?" +"+(n.length-3):""}\n          </div>\n          <div class="job-links" style="margin-top: 0.25rem;" onclick="event.stopPropagation();">\n            <a href="${JobLinks.getLinkedInPeopleUrl(e.name)}" target="_blank" class="job-link"> People</a>\n            <a href="${JobLinks.getLinkedInUrl(e.name)}" target="_blank" class="job-link"> Jobs</a>\n            <a href="${JobLinks.getLinkedInNewsUrl(e.name)}" target="_blank" class="job-link"> News</a>\n          </div>\n        </div>\n        <div style="text-align: right; flex-shrink: 0;">\n          <div class="reach-amount">${Utils.money(e.spend)}</div>\n          <div class="reach-count">${e.count} subs</div>\n        </div>\n      </div>`})).join("")+(i.length>5?`<div class="reach-overflow">+${i.length-5} more subs</div>`:"")},renderNaicsMix(e){const t=document.getElementById("naicsPanel"),n=document.getElementById("naicsMixBody");if(!n||!t)return;if(!e||0===e.length)return void(t.style.display="none");const a={};let r=0;e.forEach((e=>{const t=e["NAICS Code"]||e.naics_code;if(!t)return;const n=e["NAICS Description"]||e.naics_description||"",s=parseFloat(e["Award Amount"])||0,i=e["Recipient Name"]||"",o=e["Awarding Agency"]||"",l=parseInt(e.number_of_offers_received)||0;a[t]||(a[t]={code:t,desc:n,count:0,amount:0,vendors:{},agencies:{},offersTotal:0,offersCount:0}),a[t].count++,a[t].amount+=s,r+=s,i&&(a[t].vendors[i]||(a[t].vendors[i]=0),a[t].vendors[i]+=s),o&&(a[t].agencies[o]||(a[t].agencies[o]=0),a[t].agencies[o]+=s),l>0&&(a[t].offersTotal+=l,a[t].offersCount++)}));const s=Object.values(a).sort(((e,t)=>t.amount-e.amount)).slice(0,5);if(0===s.length)return void(t.style.display="none");t.style.display="block";const i=s[0].amount,o=App.currentQuery||"";n.innerHTML=`<div style="display: flex; flex-direction: column; gap: 0.15rem;">\n      ${s.map((e=>{const t=r>0?(e.amount/r*100).toFixed(0):0,n=Object.entries(e.vendors).sort(((e,t)=>t[1]-e[1]))[0],a=Object.entries(e.agencies).sort(((e,t)=>t[1]-e[1]))[0],s=e.offersCount>0?(e.offersTotal/e.offersCount).toFixed(1):null,l=a?a[0].replace(/^Department of (the )?/i,"").replace(/^Office of (the )?/i,""):"",c=o&&!/^\d{6}$/.test(o.trim())?`App.runSearch('${(e=>e.replace(/'/g,"\\'"))(o)} AND ${e.code}')`:`App.runSearch('${e.code}')`;return`<div class="reach-row" onclick="${c}">\n          <div style="min-width: 0; flex: 1;">\n            <div style="display: flex; align-items: center; gap: 0.5rem;">\n              <span style="font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; font-weight: 700; color: #F2E8CF; flex-shrink: 0; min-width: 52px;">${e.code}</span>\n              <div style="flex: 1; min-width: 0;">\n                <div style="height: 6px; background: rgba(255,255,255,0.07); border-radius: 3px; overflow: hidden;">\n                  <div style="height: 100%; width: ${e.amount/i*100}%; background: var(--accent); border-radius: 3px; opacity: 0.85;"></div>\n                </div>\n              </div>\n              <span class="reach-badge accent">${e.count} contracts</span>\n            </div>\n            <div class="reach-meta" style="padding-left: 0;">\n              ${Utils.trunc(e.desc,35)}${n?` · ${Utils.trunc(n[0],18)} leads`:""}${a?` · ${Utils.trunc(l,18)} buys`:""}${s?` · ${s} avg offers`:""}\n            </div>\n          </div>\n          <div style="text-align: right; flex-shrink: 0;">\n            <div class="reach-amount">${Utils.money(e.amount)}</div>\n            <div class="reach-count">${t}%</div>\n          </div>\n        </div>`})).join("")}\n    </div>`},async loadSubcontractingData(e){const t=document.getElementById("subcontractingBody");document.getElementById("subcontractingStats");if(!t)return;t.innerHTML='<div style="text-align:center; padding:2rem; color:var(--text-muted);"> Loading subaward flow...</div>';const n=setTimeout((()=>{t.querySelector(".fa-spinner")&&(t.innerHTML=`<div style="text-align:center; padding:1rem; color:var(--text-muted); font-size:0.85rem;">\n           Subaward data is taking too long to load.\n          <br><a href="#" onclick="App.loadSubcontractingData('${e.replace(/'/g,"\\'")}'); return false;" style="color:var(--accent); text-decoration:underline; font-size:0.8rem;">Retry</a>\n        </div>`)}),15e3);try{const t=await API.getSubawards(e);clearTimeout(n),App.forecastData.subawards=t,this.renderSubawardSankey(t),this.renderSearchTopPrimes(t),this.renderSearchTopSubs(t),this.renderSubawardFeed(),App.renderSubBubbleChart()}catch(a){clearTimeout(n),console.error(a),t.innerHTML=`<div style="text-align:center; padding:1rem; color:var(--text-muted); font-size:0.85rem;">\n         Unable to load subaward data.\n        <br><a href="#" onclick="App.loadSubcontractingData('${e.replace(/'/g,"\\'")}'); return false;" style="color:var(--accent); text-decoration:underline; font-size:0.8rem;">Retry</a>\n      </div>`}},renderSubawardSankey(e){const t=document.getElementById("subawardWrapper"),n=document.getElementById("subcontractingBody"),a=document.getElementById("subcontractingStats");if(!t||!n)return;if(!e||0===e.length){if(t.style.display="none",a){const e=document.getElementById("sub-stat-vol");e&&(e.innerText="-")}return}t.style.display="block";const r=document.getElementById("subSankeySubtitle");r&&App.currentQuery&&(r.textContent='"'+App.currentQuery.toUpperCase()+'" · TOP 100 SUBCONTRACTS · INDIVIDUAL TRANSACTION VALUE');let s=e;const i=App.subawardDrillState;i.level>0&&i.path.length>0&&(i.path.forEach((e=>{"agency"===e.type?s=s.filter((t=>(t["Awarding Agency"]||"Unknown Agency")===e.name)):"subagency"===e.type?s=s.filter((t=>(t["Awarding Sub Agency"]||"Unknown Sub Agency")===e.name)):"prime"===e.type?s=s.filter((t=>(t["Prime Recipient Name"]||"Unknown Prime")===e.name)):"sub"===e.type&&(s=s.filter((t=>(t["Sub-Awardee Name"]||"Unknown Sub")===e.name)))})),i.filter=i.path[i.path.length-1].name,i.filterType=i.path[i.path.length-1].type);const o={};let l=0;const c=i.path.some((e=>"agency"===e.type)),d=i.path.some((e=>"subagency"===e.type));if(s.forEach((e=>{const t=e["Awarding Agency"]||"Unknown Agency",n=e["Awarding Sub Agency"]||t,a=e["Prime Recipient Name"]||"Unknown Prime",r=e["Sub-Awardee Name"]||"Unknown Sub",s=parseFloat(e["Sub-Award Amount"])||0;if(s>0){let e;if(e=c?d?a:n:t,c&&!d){const t=`${e}|||${a}`;o[t]=(o[t]||0)+s;const n=`${a}|||${r}`;o[n]=(o[n]||0)+s}else if(d){const e=`${a}|||${r}`;o[e]=(o[e]||0)+s}else{const e=`${t}|||${a}`;o[e]=(o[e]||0)+s;const n=`${a}|||${r}`;o[n]=(o[n]||0)+s}l+=s}})),a){const e=document.getElementById("sub-stat-vol"),t=document.getElementById("sub-stat-primes"),n=document.getElementById("sub-stat-subs"),a=document.getElementById("sub-stat-count"),r=new Set(s.map((e=>e["Prime Recipient Name"]||"Unknown"))).size,i=new Set(s.map((e=>e["Sub-Awardee Name"]||"Unknown"))).size;e&&(e.innerText=Utils.money(l)),t&&(t.innerText=r),n&&(n.innerText=i),a&&(a.innerText=s.length)}const p=Object.entries(o).sort(((e,t)=>t[1]-e[1])).slice(0,40),u=new Set,m=[];if(p.forEach((([e,t])=>{const[n,a]=e.split("|||");u.add(n),u.add(a),m.push({source:n,target:a,value:t})})),0===m.length)return void(t.style.display="none");const g=Array.from(u).map((e=>({name:e}))),h=new Map(g.map(((e,t)=>[e.name,t]))),y=m.map((e=>({source:h.get(e.source),target:h.get(e.target),value:e.value})));let b="";if(i.level>0&&i.path.length>0){const e={agency:"fa-landmark",subagency:"fa-sitemap",prime:"fa-building",sub:"fa-handshake"},t={agency:"Agency",subagency:"Sub-Agency",prime:"Prime",sub:"Sub"};let n='<div class="breadcrumb-item" onclick="App.resetSubawardDrill()" style="cursor:pointer;">\n        \n        <span>All Subawards</span>\n      </div>';i.path.forEach(((a,r)=>{const s=r===i.path.length-1;e[a.type];n+='<span class="breadcrumb-separator"></span>',n+=s?`<div class="breadcrumb-item active">\n            \n            <span>${Utils.trunc(a.name,30)}</span>\n            <span style="font-size:0.65rem; color:var(--text-muted); margin-left:6px;">(${t[a.type]||a.type})</span>\n          </div>`:`<div class="breadcrumb-item" onclick="App.drillSubawardToLevel(${r})" style="cursor:pointer;">\n            \n            <span>${Utils.trunc(a.name,25)}</span>\n          </div>`})),b=`<div class="drill-breadcrumb" style="display: flex; margin-bottom: 0.75rem;">${n}</div>`}n.innerHTML=`\n      ${b}\n      <div id="subawardDrillHint" class="drill-hint" style="margin-bottom: 0.5rem; ${i.level>0?"display:none;":""}">\n        \n        <span>Click any bar to drill down · click the active bar to drill back up</span>\n      </div>\n      <svg id="subawardSankeySvg"></svg>\n    `;const A=((n.parentElement?n.parentElement.offsetWidth:n.offsetWidth)||800)-2,f=Math.max(350,20*g.length),v=d3.select("#subawardSankeySvg").attr("viewBox",`0 0 ${A} ${f}`).attr("preserveAspectRatio","xMidYMid meet").style("width","100%").style("height","auto").style("display","block"),w=d3.sankey().nodeId((e=>e.index)).nodeWidth(20).nodePadding(20).extent([[1,1],[A-1,f-6]]),{nodes:S,links:I}=w({nodes:g.map((e=>Object.assign({},e))),links:y.map((e=>Object.assign({},e)))}),k=new Set(s.map((e=>e["Prime Recipient Name"]||"Unknown Prime"))),C=new Set(s.map((e=>e["Sub-Awardee Name"]||"Unknown Sub"))),E=new Set(s.map((e=>e["Awarding Agency"]||"Unknown Agency"))),T=new Set(s.map((e=>e["Awarding Sub Agency"]||e["Awarding Agency"]||"Unknown Agency")));S.forEach((e=>{c&&!d&&T.has(e.name)&&!k.has(e.name)?e.nodeType="subagency":c||!E.has(e.name)||k.has(e.name)?k.has(e.name)&&!C.has(e.name)?e.nodeType="prime":C.has(e.name)?e.nodeType="sub":k.has(e.name)?e.nodeType="prime":e.nodeType="sub":e.nodeType="agency"})),Utils.getColor.reset();const D=v.append("defs");I.forEach(((e,t)=>{const n=Utils.getColor(e.source.name),a=Utils.getColor(e.target.name),r=D.append("linearGradient").attr("id",`sub-gradient-${t}`).attr("gradientUnits","userSpaceOnUse").attr("x1",e.source.x1).attr("x2",e.target.x0);r.append("stop").attr("offset","0%").attr("stop-color",n),r.append("stop").attr("offset","100%").attr("stop-color",a)})),v.append("g").attr("fill","none").selectAll("path").data(I).join("path").attr("d",d3.sankeyLinkHorizontal()).attr("stroke",((e,t)=>`url(#sub-gradient-${t})`)).attr("stroke-width",(e=>Math.max(1,e.width))).attr("stroke-opacity",.4).on("mouseover",(function(){d3.select(this).attr("stroke-opacity",.8)})).on("mouseout",(function(){d3.select(this).attr("stroke-opacity",.4)})).append("title").text((e=>`${e.source.name} → ${e.target.name}\n${Utils.money(e.value)}`));const $=e=>i.path.length>0&&i.path[i.path.length-1].name===e,x="ontouchstart"in window||navigator.maxTouchPoints>0;v.append("g").selectAll("rect").data(S).join("rect").attr("x",(e=>e.x0)).attr("y",(e=>e.y0)).attr("height",(e=>Math.max(1,e.y1-e.y0))).attr("width",(e=>e.x1-e.x0)).attr("fill",(e=>Utils.getColor(e.name))).attr("opacity",(e=>$(e.name)?1:.8)).attr("stroke",(e=>$(e.name)?"#F1EEE9":"transparent")).attr("stroke-width",(e=>$(e.name)?0:x?24:0)).style("cursor",(e=>e.name.startsWith("Other")?"default":"pointer")).on("click",(function(e,t){t.name.startsWith("Other")||t.name.includes("Unknown")||($(t.name)?i.path.length<=1?App.resetSubawardDrill():App.drillSubawardToLevel(i.path.length-2):App.drillSubaward(t.name,t.nodeType))})).on("mouseover",(function(e,t){d3.select(this).attr("opacity",1),$(t.name)&&d3.select(this).attr("stroke","var(--danger)").attr("stroke-width",0)})).on("mouseout",(function(e,t){d3.select(this).attr("opacity",$(t.name)?1:.8),d3.select(this).attr("stroke",$(t.name)?"#F1EEE9":"none").attr("stroke-width",($(t.name),0))})).append("title").text((e=>{const t=$(e.name)?"← Click to drill out":"Click to drill down →";return`${e.name}\n${Utils.money(e.value)}\n${e.name.startsWith("Other")?"":t}`}));const B=A<600;v.append("g").selectAll("text").data(S).join("text").attr("x",(e=>e.x0<A/2?e.x1+6:e.x0-6)).attr("y",(e=>(e.y1+e.y0)/2)).attr("dy",(e=>e.y1-e.y0>30?e.x0<A/2?"-0.5em":"1.1em":"0.35em")).attr("text-anchor",(e=>e.x0<A/2?"start":"end")).text((e=>Utils.trunc(e.name,B?25:40))).style("font-size","11px").style("font-weight",(e=>e.y1-e.y0>30?"700":"400")).style("fill",App.presentationMode?"#1A1A1A":"#F1EEE9").style("pointer-events","none")},drillSubaward(e,t){const n=App.subawardDrillState;if(n.path.push({type:t,name:e}),n.level=n.path.length,n.filter=e,n.filterType=t,App.activeFeedSource="sub",App.forecastData.subawards){const e=window.scrollY;App.renderSubawardSankey(App.forecastData.subawards),App.renderSearchTopPrimes(App.forecastData.subawards),App.renderSearchTopSubs(App.forecastData.subawards),App.renderSubawardFeed(),App.renderSubBubbleChart(),requestAnimationFrame((()=>window.scrollTo(0,e)))}},drillSubawardToLevel(e){const t=App.subawardDrillState;if(e<0)App.resetSubawardDrill();else if(t.path=t.path.slice(0,e+1),t.level=t.path.length,t.path.length>0?(t.filter=t.path[t.path.length-1].name,t.filterType=t.path[t.path.length-1].type):(t.filter=null,t.filterType=null),App.activeFeedSource="sub",App.forecastData.subawards){const e=window.scrollY;App.renderSubawardSankey(App.forecastData.subawards),App.renderSearchTopPrimes(App.forecastData.subawards),App.renderSearchTopSubs(App.forecastData.subawards),App.renderSubawardFeed(),App.renderSubBubbleChart(),requestAnimationFrame((()=>window.scrollTo(0,e)))}},resetSubawardDrill(){if(App.subawardDrillState={level:0,path:[],filter:null,filterType:null},App.activeFeedSource="sub",App.forecastData.subawards){const e=window.scrollY;App.renderSubawardSankey(App.forecastData.subawards),App.renderSearchTopPrimes(App.forecastData.subawards),App.renderSearchTopSubs(App.forecastData.subawards),App.renderSubawardFeed(),App.renderSubBubbleChart(),requestAnimationFrame((()=>window.scrollTo(0,e)))}},renderRecompetes(e,t=!1){const n=document.getElementById("recompetesList");if(!n)return;if(!e||0===e.length)return void(n.innerHTML="");const a=e.map((e=>({...e,risk:Utils.missionGapRisk(e)}))),r=a.reduce(((e,t)=>e+(parseFloat(t["Award Amount"])||0)),0),s=a.filter((e=>"high"===e.risk.level)),i=s.reduce(((e,t)=>e+(parseFloat(t["Award Amount"])||0)),0),o=App.onlyHighMissionGap?a.filter((e=>"high"===e.risk.level)):a,l=t?o:o.slice(0,3),c=!t&&o.length>3;let d=`${Utils.money(r)} in ${e.length} contracts expiring within 24 months`;s.length>0&&(d+=` · <span style="color:var(--danger); font-weight:600;">${s.length} high-risk (${Utils.money(i)})</span>`);let p=`\n    <div class="section-header">\n      <div class="section-title-group">\n        <span class="section-title">Expiring Contracts</span>\n      </div>\n      <div class="mission-gap-filter">\n        <span class="section-subtitle">${d}</span>\n        ${s.length>0?`\n          <button class="mission-gap-toggle ${App.onlyHighMissionGap?"active":""}"\n        onclick="App.toggleMissionGapFilter()"\n        title="Show only contracts with high mission continuity risk">\n  \n</button>\n        `:""}\n      </div>\n    </div>`;0===o.length?p+='<div style="text-align:center; padding:2rem; color:var(--text-muted);">No contracts match the current filter. <a href="#" onclick="App.toggleMissionGapFilter(); return false;" style="color:var(--accent); margin-left:0.5rem;">Show all</a></div>':(p+=l.map((e=>{if(!e["End Date"])return"";const t=e.generated_internal_id,n=t?`https://www.usaspending.gov/award/${t}`:e["Award ID"]?`https://www.usaspending.gov/search/?hash=&filters=${encodeURIComponent(JSON.stringify({keyword:e["Award ID"]}))}`:null,a=new Date(e["End Date"]),r=a.getMonth(),s=a.getFullYear();let i=1;r>=0&&r<=2?i=2:r>=3&&r<=5?i=3:r>=6&&r<=8&&(i=4);const o=`FY${String(r>=9?s+1:s).slice(-2)} Q${i}`,l=new Date,c=Math.ceil((a-l)/864e5),d=c<180?"urgent":c<365?"soon":"later",p=e.risk,u="high"===p.level?"Mission Gap: High":"medium"===p.level?"Mission Gap: Medium":"Mission Gap: Low",m=e=>Autocomplete.escapeHtml(e);return`\n      <div class="deal-card" style="margin-bottom:1rem; ${"high"===p.level?"border-left: 3px solid var(--danger);":"medium"===p.level?"border-left: 3px solid #FDD835;":""}">\n        <div class="deal-header">\n          <span class="deal-agency">${m(Utils.trunc(e["Awarding Agency"],40))}</span>\n          <span class="deal-amount">${Utils.money(e["Award Amount"])}</span>\n        </div>\n        <div class="deal-desc">${m(Utils.trunc(e.Description,100))}</div>\n        <div class="deal-meta">\n          <span class="meta-tag" style="color:var(--accent); border-color:var(--accent);">${o}</span>\n          <span class="meta-tag mission-gap ${p.level}">${u}</span>\n          ${e["PSC Code"]?`<span class="meta-tag psc">PSC: ${m(e["PSC Code"])}</span>`:""}\n        </div>\n        ${p.reasons.length>0&&"low"!==p.level?`<div class="mission-gap-signals">Signals: ${m(p.reasons.join(", "))}</div>`:""}\n        <div class="deal-footer">\n          <div>\n            <div style="font-size:0.8rem; color:${"urgent"===d?"var(--danger)":"soon"===d?"#FDD835":"var(--text-muted)"}">\n              Expires: ${Utils.date(e["End Date"])} (${c} days)\n            </div>\n            <div style="font-size:0.75rem; color:var(--text-subtle)">Incumbent: ${m(Utils.trunc(e["Recipient Name"],35))}</div>\n          </div>\n          <div style="display:flex;gap:0.5rem;align-items:center;">\n            <button onclick="Utils.copyRecompeteToClipboard(this, '${m(e["Awarding Agency"]||"")}', '${m(e["Awarding Sub Agency"]||"")}', '${m(e["Recipient Name"]||"")}', '${Utils.money(e["Award Amount"])}', '${m(Utils.trunc(e.Description||"",200))}', '${e["Start Date"]||""}', '${e["End Date"]||""}', '${m(e["Award ID"]||"")}', '${m(e["PSC Code"]||"")}', '${m(e["PSC Description"]||"")}', '${m(e["NAICS Code"]||"")}', '${m(e["NAICS Description"]||"")}', '${e["Type of Set Aside"]||""}', '${n||""}')" class="action-btn"></button>\n            ${n?`<a href="${n}" target="_blank" class="action-btn">VIEW</a>`:""}\n          </div>\n        </div>\n      </div>`})).join(""),c&&(p+=`\n        <button onclick="App.renderRecompetes(App.forecastData.analysis.recompetes, true)" style="width: 100%; padding: 0.875rem; background: var(--bg-card); border: 1px dashed var(--border); border-radius: 4px; color: var(--accent); font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; cursor: pointer; transition: all 0.2s; text-transform: uppercase; letter-spacing: 1px;" onmouseover="this.style.borderColor='var(--accent)';this.style.background='var(--accent-dim)'" onmouseout="this.style.borderColor='var(--border)';this.style.background='var(--bg-card)'">\n          Show All ${o.length} Expiring Contracts\n        </button>`)),n.innerHTML=p},toggleMissionGapFilter(){App.onlyHighMissionGap=!App.onlyHighMissionGap,App.forecastData.analysis&&App.forecastData.analysis.recompetes&&this.renderRecompetes(App.forecastData.analysis.recompetes)},exportCSV(e){const t=App.searchData.active;if(!t.length){if(e){const t=e.innerHTML;e.style.color="var(--danger)",e.style.borderColor="var(--danger)",e.innerHTML="",setTimeout((()=>{e.style.color="",e.style.borderColor="",e.innerHTML=t}),2e3)}return}const n=t.map((e=>{let t="N/A";if(e["Start Date"]){const n=new Date(e["Start Date"]),a=n.getMonth(),r=n.getFullYear();let s;s=a>=9?1:a<=2?2:a<=5?3:4,t=`FY${String(a>=9?r+1:r).slice(-2)} Q${s}`}const n=e.generated_internal_id;let a="";return n?a=`https://www.usaspending.gov/award/${n}`:e["Award ID"]&&(a=`https://www.usaspending.gov/search/?hash=&filters=${encodeURIComponent(JSON.stringify({keyword:e["Award ID"]}))}`),[`"${t}"`,`"${(e["Recipient Name"]||"").replace(/"/g,'""')}"`,`"${(e["Awarding Agency"]||"").replace(/"/g,'""')}"`,`"${(e["Awarding Sub Agency"]||"").replace(/"/g,'""')}"`,e["Award Amount"]||0,`"${(e.Description||"").replace(/"/g,'""')}"`,e["Start Date"]||"",e["End Date"]||"",e["Award ID"]||"",a]})),a=[["Fiscal Period","Recipient","Agency","Sub-Agency","Total Obligations","Description","Start Date","End Date","Award ID","Award Link"].join(","),...n.map((e=>e.join(",")))].join("\n"),r=new Blob([a],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(r),i=document.createElement("a");if(i.setAttribute("href",s),i.setAttribute("download",`govhoo_${App.mode}_${App.currentQuery}.csv`),document.body.appendChild(i),i.click(),document.body.removeChild(i),e){const t=e.innerHTML;e.style.color="var(--success)",e.style.borderColor="var(--success)",e.innerHTML="",setTimeout((()=>{e.style.color="",e.style.borderColor="",e.innerHTML=t}),2e3)}},showLoader(e,t){document.getElementById("loaderText").innerText=e,document.getElementById("loaderSubtext").innerText=t||"",document.getElementById("loader").style.display="flex"},hideLoader(){document.getElementById("loader").style.display="none"},transitionToApp(){const e=document.getElementById("heroView");e.classList.add("slide-up"),document.getElementById("appView").style.display="block",document.getElementById("miniSearch").value=App.currentQuery,document.getElementById("dashboardContainer").classList.add("active");const t=document.getElementById("dashboardContainer");if(!t.querySelector(".hero-footer")){const n=e.querySelector(".hero-footer");if(n){const e=n.cloneNode(!0);e.removeAttribute("id"),t.appendChild(e)}}setTimeout((()=>{e.style.display="none",e.classList.add("hidden")}),500)},shareLink(e){const t=new URL(window.location);t.searchParams.set("q",App.currentQuery),navigator.clipboard.writeText(t.toString()).then((()=>{if(e){const t=e.innerHTML;e.style.color="var(--success)",e.style.borderColor="var(--success)",e.innerHTML="",setTimeout((()=>{e.style.color="",e.style.borderColor="",e.innerHTML=t}),2e3)}}))},shareBrief(e){const t=App.searchData.active,n=App.currentQuery||"Unknown",a=t.reduce(((e,t)=>e+(parseFloat(t["Award Amount"])||0)),0),r=new Set(t.map((e=>e["Awarding Agency"])).filter(Boolean)),s=new Set(t.map((e=>e["Recipient Name"])).filter(Boolean)),i=new Date,o=new Date(i.getTime()+7776e6);let l=0,c=0;t.forEach((e=>{if(e["End Date"]){const t=new Date(e["End Date"]);t>=i&&t<=o&&(l++,c+=parseFloat(e["Award Amount"])||0)}}));const d=new URL(window.location);d.searchParams.set("q",n);let p=`Govhoo Search for ${n}\n`;if(p+=`Top 100 Contracts Value:  ${Utils.money(a)} // ${r.size} Agencies // ${s.size} Primes\n`,l>0&&(p+=`${l} Contracts Expiring in <90 Days (${Utils.money(c)})\n`),App.forecastData?.subawards?.length){const e=App.forecastData.subawards.reduce(((e,t)=>e+(parseFloat(t["Sub-Award Amount"])||0)),0);p+=`${App.forecastData.subawards.length} Subcontracts Tracked (${Utils.money(e)})\n`}p+=`👉 ${d.toString()}`,navigator.clipboard.writeText(p).then((()=>{if(e){const t=e.innerHTML;e.style.color="#78A890",e.style.borderColor="#78A890",e.innerHTML='<i class="fas fa-check"></i> COPIED',setTimeout((()=>{e.style.color="",e.style.borderColor="",e.innerHTML=t}),2e3)}}))},bubbleMode:"auto",bubbleChartType:"bubbles",setBubbleChartType:function(e){App.bubbleChartType=e,document.getElementById("chartTypeBubbles").classList.toggle("active","bubbles"===e),document.getElementById("chartTypeTreemap").classList.toggle("active","treemap"===e),App.renderBubbleChart()},setBubbleMode:function(e){App.bubbleMode=e,document.getElementById("bubbleToggleVendors").classList.toggle("active","vendors"===e),document.getElementById("bubbleToggleAgencies").classList.toggle("active","agencies"===e),document.getElementById("bubbleToggleSubAgencies").classList.toggle("active","subagencies"===e),App.renderBubbleChart()},getEffectiveBubbleMode:function(){if("auto"!==App.bubbleMode)return App.bubbleMode;const e=App.drillState||{};return 0===e.level?"vendors":1===e.level?"subagencies":"vendors"},updateBubbleToggles:function(){const e=App.drillState||{},t=document.getElementById("bubbleToggleVendors"),n=document.getElementById("bubbleToggleAgencies"),a=document.getElementById("bubbleToggleSubAgencies");a&&(a.style.display=e.level>=1?"inline-block":"none");const r=App.getEffectiveBubbleMode();t.classList.toggle("active","vendors"===r),n.classList.toggle("active","agencies"===r),a&&a.classList.toggle("active","subagencies"===r);const s=document.getElementById("bubbleChartSubtitle");if(s){const e={agencies:"Top Active Agencies · Lifetime Funded Value",subagencies:"Top Active Sub-Agencies · Lifetime Funded Value",vendors:"Top Active Vendors · Lifetime Funded Value"};s.textContent=e[r]||"Top Active Vendors & Agencies · Lifetime Funded Value"}},renderBubbleBreadcrumb:function(){const e=document.getElementById("bubbleBreadcrumb"),t=document.getElementById("bubbleBreadcrumbInner");if(!e||!t)return;const n=App.drillState||{};if(0===n.level)return void(e.style.display="none");e.style.display="block";let a='<div class="bubble-bc-item" onclick="App.resetDrill()"> All</div>';n.path&&n.path.length>0&&n.path.forEach(((e,t)=>{const r=t===n.path.length-1,s=("agency"===e.type||e.type,r?"":`onclick="App.drillToLevel(${t+1})"`);a+='<span class="bubble-bc-sep"></span>',a+=`<div class="bubble-bc-item ${r?"active":""}" ${s}> ${Utils.trunc(e.name,30)}</div>`})),t.innerHTML=a}};App.renderBubbleChart=function(){const e=document.getElementById("bubbleChartContainer"),t=document.getElementById("bubbleChartPanel");if(!e||!t)return;const n=App.searchData.active;if(!n||0===n.length)return void(t.style.display="none");t.style.display="block",App.updateBubbleToggles(),App.renderBubbleBreadcrumb();const a=App.drillState||{},r=App.getEffectiveBubbleMode(),s={};let i=0;n.forEach((e=>{let t;t="agencies"===r?e["Awarding Agency"]||"Unknown":"subagencies"===r?e["Awarding Sub Agency"]||e["Awarding Agency"]||"Unknown":e["Recipient Name"]||"Unknown";const n=parseFloat(e["Award Amount"])||0;s[t]||(s[t]={name:t,spend:0,count:0,agencies:new Set,subAgencies:new Set,vendors:new Set,parentAgency:null}),s[t].spend+=n,s[t].count++,s[t].agencies.add(e["Awarding Agency"]||"Unknown"),s[t].subAgencies.add(e["Awarding Sub Agency"]||""),s[t].vendors.add(e["Recipient Name"]||"Unknown"),"subagencies"===r&&(s[t].parentAgency=e["Awarding Agency"]||"Unknown"),i+=n}));let o=Object.values(s).filter((e=>e.spend>0)).sort(((e,t)=>t.spend-e.spend)).slice(0,50);if(0===o.length)return void(t.style.display="none");o.forEach((e=>{e.agencyCount=e.agencies?e.agencies.size:0,e.subAgencyCount=e.subAgencies?e.subAgencies.size:0,e.vendorCount=e.vendors?e.vendors.size:0,delete e.agencies,delete e.subAgencies,delete e.vendors}));const l=new Set(n.map((e=>e["Awarding Agency"]))).size,c=new Set(n.map((e=>e["Recipient Name"]))).size,d=document.getElementById("bubble-stat-vol"),p=document.getElementById("bubble-stat-agencies"),u=document.getElementById("bubble-stat-count"),m=document.getElementById("bubble-stat-vendors"),g=document.getElementById("bubble-stat-entities"),h=(document.getElementById("bubble-stat-entities-label"),document.getElementById("bubbleChartSubtitle"));if(d&&(d.innerText=Utils.money(i)),p&&(p.innerText=l),u&&(u.innerText=n.length),m&&(m.innerText=c),g&&(g.innerText=o.length),h){const x=App.currentQuery?'"'+App.currentQuery.toUpperCase()+'" · ':"",B={agencies:"Agencies",subagencies:"Sub-Agencies",vendors:"Vendors"};h.textContent=x+"Top Active "+(B[r]||"Vendors")+" · Lifetime Funded Value"}const y=document.getElementById("bubbleTooltip");e.querySelectorAll("svg").forEach((e=>e.remove()));const b=e.getBoundingClientRect(),A=Math.max(b.width||600,300),f=Math.max(420,Math.min(.7*A,600)),v=["#466D5C","#7B6D8D","#5B7C99","#E07A5F","#D98895","#3D405B","#F2E8CF","#81B29A","#778DA9","#606C38"],w="ontouchstart"in window||navigator.maxTouchPoints>0;let S=null;function I(t){function n(e){const t=i>0?(e.spend/i*100).toFixed(1):"0";let n;n="agencies"===r||"subagencies"===r?`${e.count} awards · ${e.vendorCount} vendors · ${t}%`:`${e.count} awards · ${e.agencyCount} agencies · ${t}%`;let s="";return"agencies"===r?s=`<div style="color:var(--accent);font-size:0.65rem;margin-top:4px;">${w?"Tap again":"Click"} to drill into sub-agencies →</div>`:"subagencies"===r?s=`<div style="color:var(--accent);font-size:0.65rem;margin-top:4px;">${w?"Tap again":"Click"} to drill into vendors →</div>`:"vendors"===r&&a.level<3&&(s=`<div style="color:var(--accent);font-size:0.65rem;margin-top:4px;">${w?"Tap again":"Click"} to focus on this vendor →</div>`),`\n        <div class="bubble-tooltip-name">${e.name}</div>\n        <div class="bubble-tooltip-amount">${Utils.money(e.spend)}</div>\n        <div class="bubble-tooltip-meta">${n}</div>\n        ${s}\n      `}function s(e){y.classList.remove("visible"),S=null,"agencies"===r?(App.bubbleMode="auto",App.drillToAgency(e.name)):"subagencies"===r?(App.bubbleMode="auto",App.drillToSubAgency(e.name)):App.drillDown(e.name)}w?(t.on("click",(function(e,t){e.stopPropagation();const a=t.data||t;S===a.name?s(a):(S=a.name,y.innerHTML=n(a),y.style.left="50%",y.style.top="auto",y.style.bottom="8px",y.style.transform="translateX(-50%)",y.style.maxWidth="90%",y.classList.add("visible"))})),k.on("click",(function(){y.classList.remove("visible"),S=null}))):t.on("mouseover",(function(e,t){const a=t.data||t;y.innerHTML=n(a),y.classList.add("visible")})).on("mousemove",(function(t){const n=e.getBoundingClientRect();let a=t.clientX-n.left+15,r=t.clientY-n.top-10;a+260>A&&(a-=280),r+90>f&&(r-=100),y.style.left=a+"px",y.style.top=r+"px",y.style.bottom="auto",y.style.transform="none",y.style.maxWidth=""})).on("mouseout",(function(){y.classList.remove("visible")})).on("click",(function(e,t){s(t.data||t)}))}const k=d3.select(e).append("svg").attr("width",A).attr("height",f).attr("viewBox",`0 0 ${A} ${f}`);if("treemap"===App.bubbleChartType){const L=d3.hierarchy({children:o}).sum((e=>e.spend)).sort(((e,t)=>t.value-e.value));d3.treemap().size([A,f]).paddingInner(2).paddingOuter(3).round(!0)(L);const U=k.selectAll(".treemap-cell").data(L.leaves()).join("g").attr("class","treemap-cell").attr("transform",(e=>`translate(${e.x0},${e.y0})`));U.append("clipPath").attr("id",((e,t)=>`tm-clip-${t}`)).append("rect").attr("width",(e=>Math.max(0,e.x1-e.x0))).attr("height",(e=>Math.max(0,e.y1-e.y0))).attr("rx",3),U.append("rect").attr("width",(e=>Math.max(0,e.x1-e.x0))).attr("height",(e=>Math.max(0,e.y1-e.y0))).attr("fill",((e,t)=>v[t%v.length])).attr("opacity",.85).attr("rx",3).attr("stroke","rgba(241, 238, 233, 0.08)").attr("stroke-width",1);function C(e,t,n){const a=.58*n,r=t-12,s=Math.floor(r/a);if(s<3)return[];const i=e.split(/\s+/),o=[];let l="";return i.forEach((e=>{const t=l?l+" "+e:e;t.length<=s?l=t:(l&&o.push(l),l=e.length>s?e.slice(0,s-1)+"…":e)})),l&&o.push(l),o}return U.append("g").attr("clip-path",((e,t)=>`url(#tm-clip-${t})`)).each((function(e){const t=e.x1-e.x0,n=e.y1-e.y0;if(t<40||n<25)return;const a=d3.select(this),r=function(e){const t=e.x1-e.x0,n=e.y1-e.y0,a=e.data.name;Utils.money(e.data.spend);for(let e=Math.min(t/5,n/3,22);e>=7;e-=.5){const r=C(a,t,e),s=.85*e,i=1.25*e,o=1.3*s,l=r.length*i+o+8;if(l<n-8&&r.length>0&&r.length<=4)return{nameLines:r,fontSize:e,amountFs:s,lineH:i,totalH:l}}const r=Math.floor((t-12)/4.06);return{nameLines:[Utils.trunc(a,Math.max(r,3))],fontSize:7,amountFs:6,lineH:8.75,totalH:25.5}}(e),s=(n-r.totalH)/2+r.fontSize;r.nameLines.forEach(((e,n)=>{a.append("text").attr("class","bubble-label").attr("x",t/2).attr("y",s+n*r.lineH).attr("font-size",r.fontSize+"px").attr("font-weight","700").text(e)})),n>40&&a.append("text").attr("class","bubble-amount-label").attr("x",t/2).attr("y",s+r.nameLines.length*r.lineH+4).attr("font-size",r.amountFs+"px").attr("font-weight","800").attr("fill","rgba(241, 238, 233, 0.9)").text(Utils.money(e.data.spend))})),I(U),U.selectAll("rect").attr("opacity",0).transition().duration(500).delay(((e,t)=>12*t)).ease(d3.easeCubicOut).attr("opacity",.85),void U.selectAll("text").attr("opacity",0).transition().duration(400).delay(((e,t)=>200+12*t)).attr("opacity",1)}const E=d3.hierarchy({children:o}).sum((e=>e.spend)).sort(((e,t)=>t.value-e.value)),T=d3.pack().size([A,f]).padding(1.5)(E),D=k.selectAll(".bubble-node").data(T.leaves()).join("g").attr("class","bubble-node").attr("transform",(e=>`translate(${e.x},${e.y})`));function $(e,t,n){const a=.58*n,r=1.6*t,s=Math.floor(r/a);if(s<3)return[];const i=e.split(/\s+/),o=[];let l="";return i.forEach((e=>{const t=l?l+" "+e:e;t.length<=s?l=t:(l&&o.push(l),l=e.length>s?e.slice(0,s-1)+"…":e)})),l&&o.push(l),o}D.append("circle").attr("r",(e=>e.r)).attr("fill",((e,t)=>v[t%v.length])).attr("opacity",.85).attr("stroke","rgba(241, 238, 233, 0.1)").attr("stroke-width",1),D.each((function(e){if(e.r<25)return;const t=d3.select(this),n=function(e){const t=e.r,n=e.data.name;for(let e=Math.min(t/2.5,20);e>=7;e-=.5){const a=$(n,t,e),r=.85*e,s=1.2*e,i=a.length*s+1.3*r+4;if(i<1.6*t&&a.length>0&&a.length<=3)return{nameLines:a,fontSize:e,amountFs:r,lineH:s,totalH:i}}return null}(e);if(!n)return;const a=-n.totalH/2+.8*n.fontSize;n.nameLines.forEach(((e,r)=>{t.append("text").attr("class","bubble-label").attr("y",a+r*n.lineH).attr("font-size",n.fontSize+"px").attr("font-weight","700").text(e)})),e.r>35&&t.append("text").attr("class","bubble-amount-label").attr("y",a+n.nameLines.length*n.lineH+4).attr("font-size",n.amountFs+"px").attr("font-weight","800").attr("fill","rgba(241, 238, 233, 0.9)").text(Utils.money(e.data.spend))})),I(D),D.selectAll("circle").attr("r",0).transition().duration(600).delay(((e,t)=>15*t)).ease(d3.easeCubicOut).attr("r",(e=>e.r)),D.selectAll("text").attr("opacity",0).transition().duration(400).delay(((e,t)=>300+15*t)).attr("opacity",1)},App.subBubbleMode="primes",App.subBubbleChartType="bubbles",App.setSubBubbleChartType=function(e){App.subBubbleChartType=e,document.getElementById("subChartTypeBubbles").classList.toggle("active","bubbles"===e),document.getElementById("subChartTypeTreemap").classList.toggle("active","treemap"===e),App.renderSubBubbleChart()},App.setSubBubbleMode=function(e){App.subBubbleMode=e,document.getElementById("subBubbleTogglePrimes").classList.toggle("active","primes"===e),document.getElementById("subBubbleToggleSubs").classList.toggle("active","subs"===e),App.renderSubBubbleChart()},App.renderSubBubbleBreadcrumb=function(){const e=document.getElementById("subBubbleBreadcrumb"),t=document.getElementById("subBubbleBreadcrumbInner");if(!e||!t)return;const n=App.subawardDrillState||{};if(!n.level||0===n.level)return void(e.style.display="none");e.style.display="block";let a='<div class="bubble-bc-item" onclick="App.resetSubawardDrill()"> All Subawards</div>';n.path&&n.path.length>0&&n.path.forEach(((e,t)=>{const r=t===n.path.length-1,s=(e.type,r?"":`onclick="App.drillSubawardToLevel(${t})"`);a+='<span class="bubble-bc-sep"></span>',a+=`<div class="bubble-bc-item ${r?"active":""}" ${s}> ${Utils.trunc(e.name,30)}</div>`})),t.innerHTML=a},App.renderSubBubbleChart=function(){const e=document.getElementById("subBubbleContainer"),t=document.getElementById("subBubblePanel");if(!e||!t)return;const n=App.forecastData?.subawards;if(!n||0===n.length)return void(t.style.display="none");let a=n;const r=App.subawardDrillState||{};if(r.level>0&&r.path&&r.path.length>0&&r.path.forEach((e=>{"agency"===e.type?a=a.filter((t=>(t["Awarding Agency"]||"Unknown Agency")===e.name)):"subagency"===e.type?a=a.filter((t=>(t["Awarding Sub Agency"]||"Unknown Sub Agency")===e.name)):"prime"===e.type?a=a.filter((t=>(t["Prime Recipient Name"]||"Unknown Prime")===e.name)):"sub"===e.type&&(a=a.filter((t=>(t["Sub-Awardee Name"]||"Unknown Sub")===e.name)))})),0===a.length)return void(t.style.display="none");t.style.display="block",App.renderSubBubbleBreadcrumb();const s=App.subBubbleMode||"primes",i={};let o=0;const l=new Set,c=new Set;a.forEach((e=>{const t=e["Prime Recipient Name"]||"Unknown Prime",n=e["Sub-Awardee Name"]||"Unknown Sub",a=parseFloat(e["Sub-Award Amount"])||0,r="primes"===s?t:n;l.add(t),c.add(n),i[r]||(i[r]={name:r,spend:0,count:0,partners:new Set}),i[r].spend+=a,i[r].count++,i[r].partners.add("primes"===s?n:t),o+=a}));let d=Object.values(i).filter((e=>e.spend>0)).sort(((e,t)=>t.spend-e.spend)).slice(0,40);if(0===d.length)return void(t.style.display="none");d.forEach((e=>{e.partnerCount=e.partners?e.partners.size:0,delete e.partners}));const p=document.getElementById("subBubbleSubtitle");if(p){const T=App.currentQuery?'"'+App.currentQuery.toUpperCase()+'" · ':"";p.textContent=T+"Top "+("primes"===s?"Primes":"Subcontractors")+" · Individual Transaction Value"}const u={vol:document.getElementById("sub-bubble-stat-vol"),primes:document.getElementById("sub-bubble-stat-primes"),subs:document.getElementById("sub-bubble-stat-subs"),records:document.getElementById("sub-bubble-stat-records")};u.vol&&(u.vol.innerText=Utils.money(o)),u.primes&&(u.primes.innerText=l.size),u.subs&&(u.subs.innerText=c.size),u.records&&(u.records.innerText=a.length);const m=document.getElementById("subBubbleTooltip");e.querySelectorAll("svg").forEach((e=>e.remove()));const g=e.getBoundingClientRect(),h=Math.max(g.width||600,300),y=Math.max(380,Math.min(.65*h,550)),b=["#466D5C","#7B6D8D","#5B7C99","#E07A5F","#D98895","#3D405B","#F2E8CF","#81B29A","#778DA9","#606C38"],A="ontouchstart"in window||navigator.maxTouchPoints>0;let f=null;function v(t){function n(e){const t=o>0?(e.spend/o*100).toFixed(1):"0",n="primes"===s?"subs":"primes";return`\n        <div class="bubble-tooltip-name">${e.name}</div>\n        <div class="bubble-tooltip-amount">${Utils.money(e.spend)}</div>\n        <div class="bubble-tooltip-meta">${e.count} subawards · ${e.partnerCount} ${n} · ${t}%</div>\n        <div style="color:var(--accent);font-size:0.65rem;margin-top:4px;">${A?"Tap again":"Click"} to drill →</div>\n      `}A?(t.on("click",(function(e,t){e.stopPropagation();const a=t.data||t;f===a.name?(m.classList.remove("visible"),f=null,App.drillSubaward(a.name,"primes"===s?"prime":"sub")):(f=a.name,m.innerHTML=n(a),m.style.left="50%",m.style.top="auto",m.style.bottom="8px",m.style.transform="translateX(-50%)",m.style.maxWidth="90%",m.classList.add("visible"))})),w.on("click",(function(){m.classList.remove("visible"),f=null}))):t.on("mouseover",(function(e,t){const a=t.data||t;m.innerHTML=n(a),m.classList.add("visible")})).on("mousemove",(function(t){const n=e.getBoundingClientRect();let a=t.clientX-n.left+15,r=t.clientY-n.top-10;a+260>h&&(a-=280),r+90>y&&(r-=100),m.style.left=a+"px",m.style.top=r+"px",m.style.bottom="auto",m.style.transform="none",m.style.maxWidth=""})).on("mouseout",(function(){m.classList.remove("visible")})).on("click",(function(e,t){m.classList.remove("visible");const n=t.data||t;App.drillSubaward(n.name,"primes"===s?"prime":"sub")}))}const w=d3.select(e).append("svg").attr("width",h).attr("height",y).attr("viewBox",`0 0 ${h} ${y}`);if("treemap"===App.subBubbleChartType){const D=d3.hierarchy({children:d}).sum((e=>e.spend)).sort(((e,t)=>t.value-e.value));d3.treemap().size([h,y]).paddingInner(2).paddingOuter(3).round(!0)(D);const $=w.selectAll(".treemap-cell").data(D.leaves()).join("g").attr("class","treemap-cell").attr("transform",(e=>`translate(${e.x0},${e.y0})`));$.append("clipPath").attr("id",((e,t)=>`stm-clip-${t}`)).append("rect").attr("width",(e=>Math.max(0,e.x1-e.x0))).attr("height",(e=>Math.max(0,e.y1-e.y0))).attr("rx",3),$.append("rect").attr("width",(e=>Math.max(0,e.x1-e.x0))).attr("height",(e=>Math.max(0,e.y1-e.y0))).attr("fill",((e,t)=>b[t%b.length])).attr("opacity",.85).attr("rx",3).attr("stroke","rgba(241, 238, 233, 0.08)").attr("stroke-width",1);function S(e,t,n){const a=.58*n,r=t-12,s=Math.floor(r/a);if(s<3)return[];const i=e.split(/\s+/),o=[];let l="";return i.forEach((e=>{const t=l?l+" "+e:e;t.length<=s?l=t:(l&&o.push(l),l=e.length>s?e.slice(0,s-1)+"…":e)})),l&&o.push(l),o}return $.append("g").attr("clip-path",((e,t)=>`url(#stm-clip-${t})`)).each((function(e){const t=e.x1-e.x0,n=e.y1-e.y0;if(t<40||n<25)return;const a=d3.select(this),r=function(e){const t=e.x1-e.x0,n=e.y1-e.y0,a=e.data.name;for(let e=Math.min(t/5,n/3,22);e>=7;e-=.5){const r=S(a,t,e),s=.85*e,i=1.25*e,o=r.length*i+1.3*s+8;if(o<n-8&&r.length>0&&r.length<=4)return{nameLines:r,fontSize:e,amountFs:s,lineH:i,totalH:o}}const r=Math.floor((t-12)/4.06);return{nameLines:[Utils.trunc(e.data.name,Math.max(r,3))],fontSize:7,amountFs:6,lineH:8.75,totalH:25.5}}(e),s=(n-r.totalH)/2+r.fontSize;r.nameLines.forEach(((e,n)=>{a.append("text").attr("class","bubble-label").attr("x",t/2).attr("y",s+n*r.lineH).attr("font-size",r.fontSize+"px").attr("font-weight","700").text(e)})),n>40&&a.append("text").attr("class","bubble-amount-label").attr("x",t/2).attr("y",s+r.nameLines.length*r.lineH+4).attr("font-size",r.amountFs+"px").attr("font-weight","800").attr("fill","rgba(241, 238, 233, 0.9)").text(Utils.money(e.data.spend))})),v($),$.selectAll("rect").attr("opacity",0).transition().duration(500).delay(((e,t)=>12*t)).ease(d3.easeCubicOut).attr("opacity",.85),void $.selectAll("text").attr("opacity",0).transition().duration(400).delay(((e,t)=>200+12*t)).attr("opacity",1)}const I=d3.hierarchy({children:d}).sum((e=>e.spend)).sort(((e,t)=>t.value-e.value)),k=d3.pack().size([h,y]).padding(1.5)(I),C=w.selectAll(".bubble-node").data(k.leaves()).join("g").attr("class","bubble-node").attr("transform",(e=>`translate(${e.x},${e.y})`));function E(e,t,n){const a=.58*n,r=1.6*t,s=Math.floor(r/a);if(s<3)return[];const i=e.split(/\s+/),o=[];let l="";return i.forEach((e=>{const t=l?l+" "+e:e;t.length<=s?l=t:(l&&o.push(l),l=e.length>s?e.slice(0,s-1)+"…":e)})),l&&o.push(l),o}C.append("circle").attr("r",(e=>e.r)).attr("fill",((e,t)=>b[t%b.length])).attr("opacity",.85).attr("stroke","rgba(241, 238, 233, 0.1)").attr("stroke-width",1),C.each((function(e){if(e.r<25)return;const t=d3.select(this),n=function(e){const t=e.r,n=e.data.name;for(let e=Math.min(t/2.5,20);e>=7;e-=.5){const a=E(n,t,e),r=.85*e,s=1.2*e,i=a.length*s+1.3*r+4;if(i<1.6*t&&a.length>0&&a.length<=3)return{nameLines:a,fontSize:e,amountFs:r,lineH:s,totalH:i}}return null}(e);if(!n)return;const a=-n.totalH/2+.8*n.fontSize;n.nameLines.forEach(((e,r)=>{t.append("text").attr("class","bubble-label").attr("y",a+r*n.lineH).attr("font-size",n.fontSize+"px").attr("font-weight","700").text(e)})),e.r>35&&t.append("text").attr("class","bubble-amount-label").attr("y",a+n.nameLines.length*n.lineH+4).attr("font-size",n.amountFs+"px").attr("font-weight","800").attr("fill","rgba(241, 238, 233, 0.9)").text(Utils.money(e.data.spend))})),v(C),C.selectAll("circle").attr("r",0).transition().duration(600).delay(((e,t)=>15*t)).ease(d3.easeCubicOut).attr("r",(e=>e.r)),C.selectAll("text").attr("opacity",0).transition().duration(400).delay(((e,t)=>300+15*t)).attr("opacity",1)},App.presentationMode=!1,App.togglePresentationMode=function(){App.presentationMode=!App.presentationMode;const e=document.getElementById("searchModeView"),t=document.getElementById("presToggleBtn");App.presentationMode?(e.classList.add("presentation-mode"),t.classList.add("active"),t.innerHTML='<i class="fas fa-moon"></i>'):(e.classList.remove("presentation-mode"),t.classList.remove("active"),t.innerHTML='<i class="fas fa-rainbow"></i>');const n=App.presentationMode?"#1A1A1A":"#F1EEE9";d3.select("#chartContainer").selectAll("text").style("fill",n),d3.select("#subcontractingBody").selectAll("text").style("fill",n),App.renderBubbleChart(),App.forecastData?.subawards&&App.renderSubBubbleChart()},App.init();
</script>
</body>
</html>