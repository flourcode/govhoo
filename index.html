<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#000000">
  <meta name="color-scheme" content="dark">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 rx=%2220%22 fill=%22%23000000%22/><text y=%2250%%22 x=%2250%%22 font-size=%2265%22 font-family=%22'JetBrains Mono', monospace%22 font-weight=%22700%22 fill=%22%23426a5a%22 text-anchor=%22middle%22 dominant-baseline=%22central%22>>_</text></svg>">
  <title>Govhoo - Federal Contract Intelligence & Sales Planning</title>
  <meta name="title" content="Govhoo - Federal Contract Intelligence & Sales Planning">
  <meta name="description" content="Free Federal Sales Intelligence Strategic Planning. Follow the money with live USASpending data analysis.">
  <meta name="keywords" content="federal sales, usaspending search, government contracts, defense contracts, federal jobs, expiring contracts, federal territory planning, incumbent search">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://govhoo.com/">
  <meta property="og:title" content="Govhoo | Follow the Money">
  <meta property="og:description" content="Analyze federal agency award flow and generate AI-ready sales plans.">
  <meta property="og:image" content="https://govhoo.com/social.png">
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:title" content="Govhoo | Federal Contract Intelligence">
  <meta property="twitter:description" content="Build your federal sales plan with live obligation data and trend forecasting.">
  <link rel="canonical" href="https://govhoo.com/">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://kit.fontawesome.com/8ef6ca8a5d.js" crossorigin="anonymous"></script>
  <link rel="preconnect" href="https://api.usaspending.gov">
  <link rel="dns-prefetch" href="https://api.usaspending.gov">
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js" as="script">
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/d3-sankey/0.12.3/d3-sankey.min.js" as="script">
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-T343V4RFHV"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-T343V4RFHV');
  </script>
<style>
:root{--bg-app:#0e1111;--bg-card:#161b18;--bg-input:#1a211e;--bg-elevated:#232d29;--text-primary:#e8e6e1;--text-muted:#8f9e98;--text-subtle:#5a6660;--link:#7daf9c;--accent:#4a7a67;--accent-dark:#365c4c;--accent-light:#7daf9c;--accent-dim:rgba(74,122,103,0.15);--success:#78a890;--warning:#d1bfa7;--danger:#b87e7e;--info:#7e9cb8;--border:rgba(143,158,152,0.15);--border-hover:rgba(143,158,152,0.3);--safe-top:env(safe-area-inset-top,20px);--safe-bottom:env(safe-area-inset-bottom,20px)}*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}body{margin:0;padding:0;font-family:JetBrains Mono,monospace;background:var(--bg-app);color:var(--text-primary);min-height:100vh;overflow-x:hidden;width:100%}::-webkit-scrollbar{width:6px;height:6px}.view-section{display:none}.view-section.active{display:block;animation:fadeIn .5s ease}.loader{position:fixed;inset:0;z-index:300;background:rgba(14,18,17,.95);display:none;flex-direction:column;align-items:center;justify-content:center}.spinner{width:40px;height:40px;border:2px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .8s linear infinite}@keyframes spin{to{transform:rotate(1turn)}}@keyframes fadeIn{0%{opacity:0;transform:translateY(5px)}to{opacity:1;transform:translateY(0)}}@keyframes panelSlideUp{0%{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}@keyframes subtlePulse{0%,to{box-shadow:0 0 0 0 rgba(66,106,90,0)}50%{box-shadow:0 0 0 4px rgba(66,106,90,.08)}}.intel-stagger-1{animation:panelSlideUp .4s ease-out .1s both}.intel-stagger-2{animation:panelSlideUp .4s ease-out .2s both}.intel-stagger-3{animation:panelSlideUp .4s ease-out .3s both}.intel-stagger-4{animation:panelSlideUp .4s ease-out .4s both}.buyer-name,.geo-state-name,.vendor-name{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:180px}.main-input,.mini-search,.modal-select,select,textarea{width:100%;background:var(--bg-input)!important;border:1px solid var(--border)!important;color:#f1eee9!important;padding:1.25rem 1rem;font-size:1.1rem;border-radius:4px;font-family:JetBrains Mono,monospace;transition:border-color .2s;-webkit-appearance:none}.main-input:focus,.mini-search:focus{outline:none;border-color:var(--accent)!important;background:#222}.btn-row{display:flex;gap:.75rem;margin-top:1rem}#searchBtn,.btn-primary,.convo-starters-btn,.modal-btn-primary,.pipeline-builder-btn{flex:1;padding:1rem;font-weight:700;border:1px solid var(--accent)!important;background:var(--accent)!important;color:#f1eee9!important;border-radius:4px;font-size:.9rem;cursor:pointer;text-transform:uppercase;letter-spacing:1px;display:flex;align-items:center;justify-content:center;gap:.5rem;box-shadow:0 2px 4px rgba(0,0,0,.2)!important;transition:all .2s ease;font-family:JetBrains Mono,monospace}#searchBtn:hover,.btn-primary:hover,.convo-starters-btn:hover,.pipeline-builder-btn:hover{background:var(--accent-dark)!important;border-color:var(--accent-dark)!important;transform:translateY(-1px);opacity:1}#convoStartersBtn:hover,#gtmPlanBtn:hover,#pipelineBtn:hover,.btn-secondary,.btn-secondary:hover{background:rgba(251,247,245,.08)!important;border-color:var(--text-primary)!important;color:#f1eee9!important;opacity:1}.modal-btn-cancel,.modal-btn-secondary{flex:1;padding:1rem;font-weight:700;border:1px solid rgba(251,247,245,.3)!important;background:transparent!important;color:var(--text-primary)!important;border-radius:4px;font-size:.9rem;cursor:pointer;text-transform:uppercase;letter-spacing:1px;display:flex;align-items:center;justify-content:center;gap:.5rem;transition:all .2s ease;opacity:.9}.modal-btn-cancel:hover,.modal-btn-secondary:hover{background:rgba(251,247,245,.08)!important;border-color:var(--text-primary)!important;color:#f1eee9!important;opacity:1}.action-btn{background:var(--bg-input);color:var(--accent);text-decoration:none;padding:.5rem 1rem;border-radius:4px;font-size:.8rem;font-weight:600;border:1px solid var(--border);display:flex;align-items:center;gap:6px}.action-btn:hover{border-color:var(--accent);background:var(--accent-dim)}.input-clear{position:absolute;right:12px;top:50%;transform:translateY(-50%);background:none;border:none;color:var(--text-muted);font-size:1.25rem;cursor:pointer;display:none;padding:4px 8px;z-index:215;line-height:1;display:flex;align-items:center;justify-content:center}.input-clear:hover{color:var(--accent)!important;opacity:1;transform:translateY(-50%) scale(1.1);transition:all .15s ease}.hero-view,.input-clear.visible{display:flex}.hero-view{position:fixed;inset:0;z-index:200;flex-direction:column;align-items:center;justify-content:flex-start;padding:2rem;padding-top:max(8vh,var(--safe-top));transition:transform .5s cubic-bezier(.16,1,.3,1);overflow-y:auto}.hero-view.slide-up{transform:translateY(-100%)}.hero-view.hidden{display:none}.terminal-logo{font-family:JetBrains Mono,monospace;font-size:2.5rem;font-weight:700;margin-bottom:.5rem;color:#f1eee9;letter-spacing:-1px;text-align:center}.terminal-logo span{color:var(--accent-light)}.hero-subtitle{margin-bottom:2rem;text-align:center;font-family:JetBrains Mono,monospace;font-size:.85rem;color:var(--text-muted)}.search-box-container{position:relative;z-index:210;width:100%;max-width:500px;margin-top:1.5rem}.autocomplete-wrapper{position:relative}.autocomplete-dropdown{position:absolute;top:100%;left:0;right:0;z-index:220;background:var(--bg-card);border:1px solid var(--border);border-top:none;border-radius:0 0 4px 4px;max-height:320px;overflow-y:auto;display:none}.autocomplete-dropdown.active{display:block}.autocomplete-section{padding:.5rem 0;border-bottom:1px solid var(--border)}.autocomplete-section:last-child{border-bottom:none}.autocomplete-section-label{padding:.25rem 1rem;font-size:.65rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:1px;font-family:JetBrains Mono,monospace}.autocomplete-item{padding:.6rem 1rem;cursor:pointer;display:flex;align-items:center;gap:.75rem;font-size:.9rem;color:var(--text-primary);transition:background .1s}.autocomplete-item.selected,.autocomplete-item:hover{background:hsla(0,0%,100%,.05)}.autocomplete-item i{color:var(--text-muted);width:16px;text-align:center;font-size:.8rem}.autocomplete-item-text{flex:1;min-width:0}.autocomplete-item-main{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.autocomplete-item-sub{font-size:.7rem;color:var(--text-muted);margin-top:2px}.autocomplete-empty{padding:1rem;text-align:center;color:var(--text-muted);font-size:.85rem}.app-header{position:sticky;top:0;z-index:100;background:rgba(14,18,17,.95);backdrop-filter:blur(10px);padding:.75rem 1rem;padding-top:max(.75rem,var(--safe-top));border-bottom:1px solid var(--border);justify-content:space-between;overflow:hidden}.app-header,.header-left{display:flex;align-items:center;gap:1rem}.header-left{flex:1;min-width:0}.logo-btn{font-family:JetBrains Mono;font-weight:700;color:#f1eee9;cursor:pointer;flex-shrink:0}.logo-btn:hover,.logo-btn span{color:var(--accent)}.mini-search{background:var(--bg-input);border:1px solid var(--border);color:#f1eee9;padding:.5rem 1rem;border-radius:4px;font-size:.9rem;flex:1;min-width:0;width:100%}.mini-search-wrapper{flex:1;min-width:0;overflow:hidden}.header-actions{gap:.4rem;flex-shrink:0}.header-actions,.icon-btn{display:flex;align-items:center}.icon-btn{background:var(--accent);border:none;color:#f1eee9;width:34px;height:34px;border-radius:50%;justify-content:center;cursor:pointer;font-size:14px;font-family:JetBrains Mono,monospace;transition:opacity .15s ease,transform .15s ease}.icon-btn:hover{opacity:.82;transform:scale(1.08);color:#f1eee9}.icon-btn.active{background:var(--accent-light);color:#f1eee9}.icon-btn-share{background:#5b7c99!important}.icon-btn-share:hover{background:#6c8daa!important;transform:translateY(-1px)}.icon-btn-slack{background:#5b7c99!important}.icon-btn-slack:hover{background:#6c8daa!important;transform:translateY(-1px)}.icon-btn-csv{background:#4a7a67!important}.icon-btn-csv:hover{background:#5b8b78!important;transform:translateY(-1px)}.dashboard-container{padding:1rem;padding-bottom:calc(2rem + var(--safe-bottom));max-width:1400px;margin:0 auto;display:none;width:100%}.dashboard-container.active{display:block;animation:fadeIn .8s forwards}.mode-toggle{display:flex;gap:.5rem;margin-bottom:1.5rem;background:var(--bg-card);padding:.5rem;border-radius:4px;border:1px solid var(--border)}.mode-btn{flex:1;padding:.75rem;background:transparent;border:none;color:var(--text-muted);font-family:JetBrains Mono;font-size:.85rem;cursor:pointer;border-radius:4px;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:.5rem}.mode-btn.active{background:#839e8e;color:#0a0e0d;font-weight:700}.mode-btn:hover:not(.active){color:var(--text-primary)}.section-header{justify-content:space-between;margin:2rem 0 1rem;border-bottom:1px solid var(--border);padding-bottom:.5rem;flex-wrap:wrap}.section-header,.section-title-group{display:flex;align-items:center;gap:.5rem}.section-title{font-family:JetBrains Mono,monospace;font-size:.9rem;font-weight:700!important;color:#f1eee9!important;text-transform:uppercase;letter-spacing:2px}.section-subtitle{font-size:.75rem;color:var(--text-primary);opacity:.65;font-style:italic}.sub-bullet{display:inline-flex;align-items:center;justify-content:center;border-radius:50%;background:var(--accent);color:#f1eee9;flex-shrink:0;line-height:1}.sub-bullet,.sub-bullet.lg,.sub-bullet.sm,.sub-bullet.xl{width:34px;height:34px;font-size:15px}.sub-bullet i{line-height:1}.stats-row{display:grid;grid-template-columns:repeat(4,1fr);gap:1rem;margin-bottom:1.5rem}.stat-item{background:var(--bg-card);padding:1rem;border-radius:4px;border:1px solid var(--border)!important;text-align:center}.stat-label{font-size:.7rem;color:var(--text-primary);opacity:.65;text-transform:uppercase;margin-bottom:.5rem}#stat-agencies,#stat-count,#stat-vendors,#stat-vol,.stat-val{font-size:1.25rem;font-weight:700!important;font-family:JetBrains Mono;color:#f1eee9!important;text-shadow:0 0 1px rgba(251,247,245,.2)}.stat-sub{font-size:.7rem;color:var(--success);margin-top:4px}.stat-sub.neutral{color:var(--text-primary);opacity:.65}.stat-item-action:hover{background:var(--accent-dim);border-color:var(--accent)!important}.chart-wrapper{background:var(--bg-card);border:1px solid var(--border)!important;border-radius:4px;padding:1rem;width:100%;overflow-x:auto;overflow-y:visible}.chart-container{width:100%;min-height:500px;height:auto;display:block}.feed-grid{display:flex;flex-direction:column;gap:1rem}.deal-card{background:var(--bg-card);border:1px solid var(--border)!important;border-radius:4px;padding:1.25rem;transition:transform .1s}.deal-card:active{transform:scale(.99)}#feedGrid .deal-card:nth-child(n+4){opacity:.7}#feedGrid .deal-card:nth-child(n+4):hover{opacity:1}.deal-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:.75rem}.deal-agency{font-size:.75rem;color:var(--text-muted);font-weight:600;text-transform:uppercase;background:hsla(0,0%,100%,.05);padding:2px 6px;border-radius:4px}.deal-amount{font-family:JetBrains Mono,monospace;color:#f1eee9!important;font-weight:700;font-size:1rem}.deal-desc{font-size:1rem;font-weight:600;margin-bottom:.5rem;line-height:1.4;color:#fff}.deal-vendor{font-size:.85rem;color:var(--info);margin-bottom:.75rem;font-family:JetBrains Mono,monospace}.deal-meta{display:flex;flex-wrap:wrap;gap:.5rem;margin-bottom:1rem}.deal-footer{display:flex;justify-content:space-between;align-items:center;padding-top:1rem;border-top:1px solid #222}.deal-date{font-size:.75rem;color:var(--text-primary);opacity:.65}.meta-tag{font-size:.65rem;font-family:JetBrains Mono,monospace;padding:3px 8px;border-radius:3px;background:rgba(251,247,245,.05)!important;color:var(--text-muted)!important;border:1px solid var(--border)!important}.meta-tag.psc{background:rgba(143,182,208,.15);border-color:rgba(143,182,208,.3);color:#8fb6d0}.meta-tag.naics{background:rgba(180,143,208,.15);border-color:rgba(180,143,208,.3);color:#b48fd0}.meta-tag.mission-gap{font-weight:600}.meta-tag.mission-gap.high{background:rgba(251,128,114,.15);border-color:var(--danger)!important;color:var(--danger)!important}.meta-tag.mission-gap.medium{background:rgba(253,216,53,.15);border-color:var(--warning)!important;color:var(--warning)!important}.meta-tag.mission-gap.low{background:hsla(0,0%,100%,.05);border-color:var(--border);color:var(--text-muted)}.time-badge{font-family:JetBrains Mono,monospace;border:1px solid var(--border);padding:4px 8px;border-radius:4px}.mission-gap-signals,.time-badge{font-size:.7rem;color:var(--text-muted)}.mission-gap-signals{margin-top:6px;font-style:italic}.mission-gap-filter{display:flex;align-items:center;gap:.5rem}.mission-gap-toggle{display:inline-flex;align-items:center;justify-content:center;gap:.4rem;padding:0 12px;height:34px;min-width:34px;background:#e07a5f!important;border:none!important;border-radius:34px;font-size:.7rem;font-family:JetBrains Mono,monospace;color:#f1eee9!important;font-weight:700;cursor:pointer;transition:opacity .15s,transform .15s;white-space:nowrap}.mission-gap-toggle:hover{opacity:.82;transform:scale(1.04);color:#f1eee9!important}.mission-gap-toggle.active{background:#a7a9ac!important;color:#f1eee9!important;opacity:1}.mission-gap-toggle i{font-size:.65rem;color:#f1eee9!important}.buyer-list{display:flex;flex-direction:column;gap:0;width:100%}.buyer-item{display:flex;align-items:center;gap:.85rem;padding:.75rem 0;border-bottom:1px solid hsla(0,0%,100%,.05);width:100%}.buyer-item:last-child{border-bottom:none}.buyer-rank{width:34px;height:34px;background:var(--accent)!important;color:#f1eee9!important;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:JetBrains Mono,monospace;font-size:15px!important;font-weight:700;flex-shrink:0;border:none!important}.buyer-info{flex:1;min-width:0}.buyer-name{font-size:.95rem;color:var(--text-primary);font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.buyer-stats{font-size:.7rem;color:var(--text-muted);margin-top:2px}.buyer-amount{text-align:right;flex-shrink:0}.buyer-spend{font-family:JetBrains Mono,monospace;font-size:1.15rem;color:#f1eee9!important;line-height:1.2}.buyer-spend,.trend-pill{font-weight:700;white-space:nowrap}.trend-pill{padding:2px 6px;border-radius:2px;font-size:.7rem;display:inline-flex;align-items:center;gap:2px}.trend-up{color:var(--success);background:rgba(66,106,90,.1)}.trend-down{color:var(--danger);background:rgba(251,128,114,.1)}.methodology-card{background:var(--bg-card);border:1px solid var(--border)!important;border-radius:4px;padding:1.5rem;display:grid;grid-template-columns:repeat(2,1fr);gap:1.5rem}.method-item{padding-bottom:1rem;border-bottom:1px solid var(--border)}.method-item:nth-last-child(-n+2){border-bottom:none;padding-bottom:0}.method-title{font-family:JetBrains Mono,monospace;font-size:.85rem;font-weight:700;color:var(--accent);margin-bottom:.5rem;display:flex;align-items:center;gap:.5rem}.method-title i{font-size:.75rem;opacity:.7}.method-desc{font-size:.8rem;color:var(--text-muted);line-height:1.5}.method-desc code{background:hsla(0,0%,100%,.1);padding:2px 6px;border-radius:3px;font-family:JetBrains Mono,monospace;font-size:.75rem}.method-desc code,.method-desc strong{color:var(--text-primary)}.geo-states-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:.5rem;max-height:300px;overflow-y:auto;width:100%}.geo-state-item{display:flex;align-items:center;justify-content:space-between;gap:.5rem;padding:.5rem .75rem;background:hsla(0,0%,100%,.02);border-radius:4px;font-size:.8rem}.geo-state-name{color:var(--text-primary);font-weight:600;font-size:.85rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1;min-width:0}.geo-state-amount{color:var(--accent);font-family:JetBrains Mono,monospace;font-size:.85rem;font-weight:700;flex-shrink:0}.analysis-panel{background:var(--bg-card);border:1px solid var(--border)!important;border-radius:4px;overflow:hidden;width:100%}.analysis-panel-badge{font-size:.65rem;padding:2px 8px;border-radius:10px;font-weight:600;font-family:JetBrains Mono,monospace}.analysis-panel-badge.high{background:rgba(66,106,90,.2);color:var(--success)}.analysis-panel-badge.medium{background:rgba(253,216,53,.2);color:#fdd835}.analysis-panel-badge.low{background:rgba(239,83,80,.2);color:var(--danger)}.analysis-panel-body{padding:1rem;width:100%}.drill-breadcrumb{display:flex;align-items:center;gap:.5rem;padding:.75rem 1rem;background:var(--accent-dim);border:1px solid var(--border);border-radius:4px;margin-bottom:1rem;font-family:JetBrains Mono,monospace;font-size:.8rem;overflow-x:auto;white-space:nowrap}.breadcrumb-item.active{background:var(--accent-dim);color:var(--accent);border:1px solid var(--accent);cursor:default}.breadcrumb-separator{color:var(--text-subtle);font-size:.8rem;font-weight:700}.breadcrumb-icon,.drill-hint{font-size:.75rem}.drill-hint{display:flex;align-items:center;justify-content:center;gap:.5rem;padding:.5rem;background:rgba(212,196,168,.05);border:1px dashed var(--border);border-radius:4px;margin-top:.5rem;color:var(--text-muted)}.drill-hint i{color:var(--accent)}.subagency-panel{background:var(--bg-card);border:1px solid var(--border)!important;border-radius:4px;margin-top:1.5rem;overflow:hidden}.subagency-header{display:flex;align-items:center;justify-content:space-between;padding:1rem;background:var(--accent-dim);border-bottom:1px solid var(--border)}.subagency-header-left{display:flex;align-items:center;gap:.75rem}.subagency-header-icon{width:36px;height:36px;display:flex;align-items:center;justify-content:center;background:var(--accent-dim);border:1px solid var(--accent);border-radius:4px;color:var(--accent)}.subagency-header-text h3{margin:0;font-family:JetBrains Mono,monospace;font-size:.9rem;color:var(--text-primary);font-weight:600}.subagency-header-text span{font-size:.75rem;color:var(--text-muted)}.subagency-stats{display:flex;gap:1.5rem;font-family:JetBrains Mono,monospace}.subagency-stat{text-align:right}.subagency-stat-val{font-size:1rem;font-weight:700;color:var(--accent)}.subagency-stat-label{font-size:.65rem;color:var(--text-muted);text-transform:uppercase}.subagency-list{max-height:400px;overflow-y:auto}.subagency-item{display:flex;align-items:center;justify-content:space-between;padding:1rem;border-bottom:1px solid var(--border);cursor:pointer;transition:all .15s}.subagency-item:hover{background:hsla(0,0%,100%,.02)}.subagency-item:last-child{border-bottom:none}.subagency-item-left{display:flex;align-items:center;gap:1rem;flex:1;min-width:0}.subagency-rank{width:34px;height:34px;display:flex;align-items:center;justify-content:center;background:var(--accent)!important;color:#f1eee9!important;border-radius:50%;font-family:JetBrains Mono,monospace;font-size:15px!important;font-weight:700;flex-shrink:0;border:none!important}.subagency-info{flex:1;min-width:0}.subagency-name{font-size:.95rem;color:var(--text-primary);font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.subagency-contracts{font-size:.75rem;color:var(--text-muted);margin-top:2px}.subagency-item-right{display:flex;align-items:center;gap:1rem;flex-shrink:0}.subagency-bar-container{width:120px;height:8px;background:hsla(0,0%,100%,.05);border-radius:4px;overflow:hidden}.subagency-bar{height:100%;background:var(--accent-dim);border-radius:4px;transition:width .3s ease}.subagency-amount{font-family:JetBrains Mono,monospace;font-size:1.1rem;font-weight:700;color:#f1eee9!important;min-width:90px;text-align:right}.subagency-drill-icon{color:var(--text-muted);font-size:.8rem;opacity:0;transition:all .15s}.subagency-item:hover .subagency-drill-icon{opacity:1;color:var(--accent);transform:translateX(2px)}.sales-plan-card{background:var(--accent-dim);border:1px solid var(--accent);border-radius:4px;padding:1rem;cursor:pointer;transition:all .3s ease;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center}.sales-plan-card-icon{font-size:1.5rem;color:var(--accent);margin-bottom:.5rem}.sales-plan-card-title{font-size:.85rem;font-weight:700;color:var(--accent);margin-bottom:.25rem;text-transform:uppercase;letter-spacing:1px}.sales-plan-card-subtitle{font-size:.85rem;color:var(--text-primary);line-height:1.4;margin-bottom:.75rem}.sales-plan-card-action{display:inline-flex;align-items:center;gap:.5rem;font-size:.75rem;color:var(--accent);text-transform:uppercase;letter-spacing:1px;font-weight:600}.hero-growth-label{font-family:JetBrains Mono,monospace;font-size:.7rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:2px;margin-bottom:.5rem}.hero-growth-value{font-size:2.5rem;font-weight:800;font-family:JetBrains Mono,monospace;line-height:1;color:#f1eee9!important}.strategic-narrative-card{background:var(--bg-card);border-left:4px solid var(--accent);padding:1.25rem;margin:1.5rem 0;font-size:.9rem;line-height:1.6}#searchJobPanel,#searchSubcontractPanel{overflow:hidden;max-width:100%;box-sizing:border-box}.intel-grid>div{min-width:0;overflow:hidden}.job-intel-panel{background:var(--bg-card);border:1px solid var(--border)!important;border-radius:6px;padding:1rem;overflow:hidden}.job-link{font-size:.65rem;color:var(--link);text-decoration:none;display:inline-flex;align-items:center;gap:3px;padding:2px 6px;border-radius:3px;background:rgba(141,160,203,.1);border:1px solid rgba(141,160,203,.2);transition:all .15s}.job-link:hover{background:rgba(141,160,203,.2);border-color:rgba(141,160,203,.4);color:#f1eee9}.job-link i{font-size:.6rem}.skills-demand{margin-top:1rem;padding:1rem;background:var(--bg-card);border:1px solid var(--border);border-radius:4px}.skills-header{font-family:JetBrains Mono,monospace;font-size:.7rem;color:var(--accent);text-transform:uppercase;letter-spacing:1px;margin-bottom:.75rem;display:flex;align-items:center;gap:.5rem}.skill-bar-container{margin-bottom:.5rem}.skill-bar-label{display:flex;justify-content:space-between;font-size:.75rem;margin-bottom:4px}.skill-bar-name{color:var(--text-primary);font-weight:600;font-size:.85rem}.skill-bar-pct{color:#f1eee9!important;font-family:JetBrains Mono,monospace;font-size:.85rem;font-weight:700}.skill-bar{height:8px;background:hsla(0,0%,100%,.05)!important;border-radius:4px;overflow:hidden;position:relative}.skill-bar-fill{height:100%;background:var(--accent);border-radius:4px;transition:width .4s ease-out;min-width:2px}.compact-winner-list{display:flex;flex-direction:column;gap:.6rem}.compact-winner-item{display:flex;align-items:flex-start;gap:.6rem;padding:.5rem;border-radius:4px;background:hsla(0,0%,100%,.02)}.compact-winner-item:hover{background:hsla(0,0%,100%,.05)}.compact-winner-rank{width:34px;height:34px;background:var(--accent)!important;color:#f1eee9!important;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:JetBrains Mono,monospace;font-size:15px!important;font-weight:700;flex-shrink:0;margin-top:2px;border:none!important}.compact-winner-info{flex:1;min-width:0}.compact-winner-name{font-size:.9rem;color:var(--text-primary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-weight:600}.compact-location-list{display:flex;flex-direction:column;gap:.5rem}.compact-location-item{display:flex;align-items:center;gap:.6rem;padding:.4rem .5rem;border-radius:4px;background:hsla(0,0%,100%,.02)}.compact-location-item:hover{background:hsla(0,0%,100%,.05)}.compact-location-rank{width:34px;height:34px;background:var(--accent)!important;color:#f1eee9!important;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:JetBrains Mono,monospace;font-size:15px!important;font-weight:700;flex-shrink:0;border:none!important}.compact-location-info{flex:1;min-width:0}.compact-location-name{font-size:.9rem;color:var(--text-primary);font-weight:600}.compact-winner-count{font-size:.75rem;color:var(--text-muted);font-family:JetBrains Mono,monospace;margin-top:2px}.compact-winner-amount{font-family:JetBrains Mono,monospace;font-size:1.05rem;font-weight:700;color:#f1eee9!important;white-space:nowrap;flex-shrink:0;text-align:right;min-width:80px;line-height:1.2}.compact-location-count{font-size:.7rem;color:var(--text-muted);font-family:JetBrains Mono,monospace;margin-top:1px}.compact-location-amount{font-family:JetBrains Mono,monospace;font-size:1rem;font-weight:700;color:#f1eee9!important;white-space:nowrap;flex-shrink:0;text-align:right;min-width:75px}.intelligence-banner{margin:1.5rem 0 .5rem;padding:1rem;background:rgba(214,109,100,.1);border:1px solid rgba(214,109,100,.3);border-left:4px solid #d66d64;border-radius:4px;display:flex;gap:1rem;align-items:flex-start;font-size:.75rem;color:var(--text-muted);line-height:1.5}.intel-icon{color:var(--accent-light)!important;font-size:1.1rem;margin-top:2px;flex-shrink:0}.intel-content strong{color:#f1eee9;font-family:JetBrains Mono,monospace;font-size:.75rem;text-transform:uppercase;letter-spacing:.5px}.intel-tip{margin-top:.5rem;padding-top:.5rem;border-top:1px solid rgba(214,109,100,.2);color:#e0e0e0}#spIntentBanner{display:none;background:hsla(0,0%,100%,.02);border-bottom:1px solid var(--border);padding:1rem 1.5rem}.intent-banner-content{display:flex;align-items:flex-start;gap:.75rem}.intent-banner-icon{font-size:1.25rem;color:var(--accent-light)!important;opacity:.9;width:24px;text-align:center;flex-shrink:0}.intent-banner-text{flex:1}.intent-banner-title{font-family:JetBrains Mono,monospace;font-size:.7rem;font-weight:700;color:var(--text-muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:.25rem}.intent-banner-desc{font-size:.95rem;color:var(--text-primary);margin-bottom:.5rem;font-weight:500}.intent-banner-focus{display:flex;flex-wrap:wrap;align-items:center;gap:.4rem}.focus-tag{font-size:.65rem;background:transparent;border:none;color:var(--text-muted);padding:0}.focus-tag:before{content:"â€¢";margin-right:.35rem;color:var(--accent)}.channel-marking-modal,.convo-modal,.pipeline-modal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(14,18,17,.95)!important;z-index:500;padding:2rem;overflow-y:auto;display:flex;align-items:flex-start;justify-content:center;opacity:0;visibility:hidden;transition:opacity .2s ease,visibility .2s;backdrop-filter:blur(5px)}.channel-marking-modal.active,.convo-modal.active,.pipeline-modal.active{opacity:1;visibility:visible}.channel-modal-content,.convo-modal-content,.pipeline-modal-content{background:var(--bg-card);border:1px solid var(--border);border-top:3px solid var(--accent)!important;border-radius:8px;width:100%;margin:2rem auto;transform:translateY(12px) scale(.99);opacity:0;transition:all .3s cubic-bezier(.16,1,.3,1);display:flex;flex-direction:column;box-shadow:0 24px 60px rgba(0,0,0,.6)}.channel-marking-modal.active .channel-modal-content,.convo-modal.active .convo-modal-content,.pipeline-modal.active .pipeline-modal-content{transform:translateY(0) scale(1);opacity:1}.channel-modal-content{max-width:800px;max-height:85vh}.pipeline-modal-content{max-width:1100px;max-height:90vh}.convo-modal-content{max-width:700px;max-height:90vh}.channel-modal-header{padding:1.25rem 1.5rem;border-bottom:1px solid var(--border);background:hsla(0,0%,100%,.02);display:flex;justify-content:space-between;align-items:center}.channel-modal-title{font-size:1.1rem;font-weight:700;color:#f1eee9!important;font-family:JetBrains Mono,monospace;text-transform:uppercase;letter-spacing:1px;display:flex;align-items:center;gap:.75rem}.channel-modal-title .sub-bullet{background:var(--accent)!important;color:#f1eee9!important;box-shadow:0 0 0 2px var(--bg-card)}.channel-modal-close{background:transparent;border:1px solid transparent;color:var(--text-muted);font-size:1.1rem;cursor:pointer;width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:4px;transition:all .2s ease}.channel-modal-close:hover{background:hsla(0,0%,100%,.05);color:#f1eee9}.channel-modal-body{padding:1.5rem;flex:1;overflow-y:auto;min-height:0}.channel-modal-footer{padding:1rem 1.5rem;border-top:1px solid var(--border);display:flex;gap:1rem;justify-content:space-between;align-items:center;flex-shrink:0;background:var(--bg-elevated)}.modal-footer-buttons{display:flex;gap:.75rem;align-items:center}.modal-footer-secondary{display:flex;gap:.5rem}.modal-status-line{color:var(--text-muted)}.modal-btn,.modal-status-line{font-size:.75rem;font-family:JetBrains Mono,monospace}.modal-btn{padding:.65rem 1.25rem;border-radius:4px;font-weight:600;cursor:pointer;transition:all .2s;text-transform:uppercase;letter-spacing:1px}.modal-btn-primary{background:var(--accent)!important;border:1px solid var(--accent)!important;color:#f1eee9!important;box-shadow:0 2px 5px rgba(0,0,0,.3)}.modal-btn-primary:hover{background:var(--accent-dark)!important;transform:translateY(-1px)}.modal-btn-cancel{background:hsla(0,0%,100%,.03)!important;border:1px solid var(--border)!important;color:var(--text-muted)!important}.vendor-list-item{display:flex;align-items:center;justify-content:space-between;padding:.75rem 1rem;border:1px solid var(--border);border-radius:4px;margin-bottom:.5rem;background:hsla(0,0%,100%,.01);transition:all .2s}.vendor-list-item:hover{background:hsla(0,0%,100%,.03);border-color:var(--accent-light)}.toggle-switch{position:relative;width:44px;height:24px;background:#2a2a2a;border-radius:12px;cursor:pointer;transition:background .3s}.toggle-switch.active{background:var(--accent)!important}.toggle-slider{position:absolute;top:3px;left:3px;width:18px;height:18px;background:#f1eee9;border-radius:50%;transition:transform .3s;box-shadow:0 1px 3px rgba(0,0,0,.3)}.toggle-switch.active .toggle-slider{transform:translateX(20px)}.convo-card{background:var(--bg-card);border:1px solid var(--border)!important;border-left:3px solid var(--accent)!important;border-radius:4px;padding:1.25rem;margin-bottom:.75rem;position:relative;transition:transform .2s ease}.convo-card:hover{border-color:var(--accent-light)!important;transform:translateX(4px)}.convo-card-label{font-family:JetBrains Mono,monospace;font-size:.65rem;color:var(--accent-light)!important;text-transform:uppercase;letter-spacing:1px;margin-bottom:.75rem;display:flex;align-items:center;gap:.5rem;font-weight:700}.convo-card-copy{position:absolute;top:1rem;right:1rem;background:transparent;border:1px solid var(--border);color:var(--text-muted);width:32px;height:32px;border-radius:4px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .15s}.convo-card-copy:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-dim)}.convo-focus-toggle{display:flex;gap:.5rem;margin-bottom:1.25rem}.convo-focus-btn{flex:1;padding:.6rem;background:transparent;border:1px solid var(--border);color:var(--text-muted);border-radius:4px;cursor:pointer;font-family:JetBrains Mono,monospace;font-size:.7rem;text-transform:uppercase;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:6px}.convo-focus-btn:hover{color:var(--text-primary);border-color:var(--text-muted)}.pipeline-config-row{display:grid;grid-template-columns:1fr 1fr 1fr;gap:1rem;margin-bottom:1rem}.pipeline-config-item label{display:block;font-size:.7rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:.5rem;font-weight:600}.pipeline-config-item input,.pipeline-config-item select{width:100%;padding:.7rem;background:var(--bg-input);border:1px solid var(--border);border-radius:4px;color:var(--text-primary);font-size:.85rem;font-family:JetBrains Mono,monospace}.pipeline-config-item select:focus{border-color:var(--accent);outline:none}.pipeline-table th{background:var(--bg-card);color:var(--accent);font-family:JetBrains Mono,monospace;padding:.75rem .5rem;text-align:left;border-bottom:2px solid var(--border);font-size:.7rem;text-transform:uppercase}.pipeline-table .stage{display:inline-block;padding:2px 8px;border-radius:4px;font-size:.65rem;font-weight:600;text-transform:uppercase;letter-spacing:.5px}.pipeline-table .stage.prospecting{background:hsla(0,0%,100%,.05);color:var(--text-muted);border:1px solid var(--border)}.pipeline-table .stage.qualification{background:var(--accent-dim);color:var(--accent-light);border:1px solid var(--accent)}.pipeline-quarter-badge{color:var(--text-primary);background:var(--bg-elevated);border:1px solid var(--border);padding:2px 6px;border-radius:3px;font-size:.65rem}.channel-explanation,.intelligence-banner,.modal-info-box{background:var(--accent-dim)!important;border-left:3px solid var(--accent)!important;padding:1rem;margin-bottom:1.5rem;font-size:.85rem;color:var(--text-primary);line-height:1.6;border-radius:0 4px 4px 0}.intelligence-banner i,.modal-info-box i{color:var(--accent);margin-right:8px}.hero-footer{width:100%;max-width:1200px;margin:3rem auto 0;padding-top:2rem}.dashboard-container .hero-footer{margin:4rem auto 0;padding-bottom:2rem;animation:fadeIn 1s forwards}.dashboard-container .hero-footer .footer-grid{gap:2rem}.footer-grid{display:grid;grid-template-columns:1fr;gap:2rem}@media (min-width:768px){.footer-grid{grid-template-columns:1fr 1fr 1fr;gap:2rem}.footer-section{border-bottom:none;padding-bottom:0}}.footer-section{padding-bottom:1.5rem;border-bottom:1px solid hsla(0,0%,100%,.1)}.footer-section:last-child{border-bottom:none;padding-bottom:0}.footer-label{font-family:JetBrains Mono,monospace;font-size:.65rem;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--accent);margin-bottom:.75rem}.footer-text{overflow:hidden;font-size:.8rem;line-height:1.6;color:var(--text-primary);opacity:.65;margin-bottom:.75rem}.footer-text:last-child{margin-bottom:0}.footer-link{font-family:JetBrains Mono,monospace;font-size:.7rem;color:var(--link);text-decoration:none;text-transform:uppercase;letter-spacing:.5px;font-weight:700;padding-bottom:2px;border-bottom:1px solid var(--accent);transition:opacity .2s ease}.footer-link:hover{opacity:.7}.use-cases{display:flex;flex-direction:column;gap:1rem}.use-case{padding:.875rem;background:hsla(0,0%,100%,.02);border-left:2px solid var(--accent)}.use-case-title{font-family:JetBrains Mono,monospace;font-size:.7rem;font-weight:700;color:var(--text-primary);margin-bottom:.375rem;text-transform:uppercase;letter-spacing:.5px}.use-case-desc{font-size:.75rem;color:var(--text-muted);line-height:1.5}.pro-tip-box{font-family:JetBrains Mono,monospace;background:rgba(212,196,168,.08);border:1px solid var(--accent);border-radius:4px;padding:.75rem;margin-top:1rem}.pro-tip-label{font-size:.6rem;font-weight:700;color:var(--accent);text-transform:uppercase;letter-spacing:1px;margin-bottom:.5rem}.pro-tip-code{font-size:.75rem;color:var(--text-primary);background:rgba(0,0,0,.3);padding:.375rem .5rem;border-radius:2px;display:inline-block;margin-top:.25rem}.tip-bio-img{width:48px;height:48px;border-radius:50%;filter:grayscale(1) contrast(1.1);flex-shrink:0;float:left;margin-right:12px;margin-bottom:4px}.disclaimer-text{margin-top:1.5rem;padding:1rem;font-size:.7rem;color:var(--text-muted);border-top:1px solid var(--border);line-height:1.4;font-style:italic}.steps-list{counter-reset:step;list-style:none;padding:0;margin:0}.steps-list li{position:relative;padding-left:2.75rem!important;margin-bottom:1rem!important;color:#ccc!important;font-size:.75rem;line-height:1.5}.steps-list li:before{counter-increment:step;content:counter(step);position:absolute;left:0;top:-4px;background-color:var(--accent)!important;color:#f1eee9!important;border-radius:50%!important;width:34px!important;height:34px!important;font-size:15px!important;display:flex;align-items:center;justify-content:center;border:none!important}.steps-list li strong{color:#f1eee9!important;font-weight:700!important}.sankey-loaded{animation:subtlePulse 2s ease-in-out 1}.modal-step-label{font-size:.85rem;color:var(--accent);font-weight:700;margin-bottom:1rem;text-transform:uppercase;letter-spacing:1px;display:flex;align-items:center;gap:.5rem}.modal-step-section{padding:1.5rem;border-bottom:1px solid var(--border);background:hsla(0,0%,100%,.02)}.modal-step-section:last-child{border-bottom:none}.modal-info-box{background:rgba(66,106,90,.06);border-left:2px solid var(--accent);padding:.75rem 1rem;border-radius:0 4px 4px 0;margin-bottom:1.5rem;font-size:.8rem;color:var(--text-muted);line-height:1.6}.modal-info-box strong{color:var(--text-primary)}.modal-info-box i{color:var(--accent)}.modal-info-box.success{background:rgba(66,106,90,.08);border-color:var(--success)}.modal-info-box.success i{color:var(--success)}.modal-form-label{display:block;font-size:.75rem;color:var(--text-muted);margin-bottom:.5rem;font-weight:600}.modal-step-grid{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem}.modal-body-section{padding:1.5rem}.modal-select{padding:.6rem;font-size:.9rem;background:var(--bg-app)}@keyframes modalSlideIn{0%{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.modal-animate-in{animation:modalSlideIn .3s ease-out forwards}.action-bar-label{font-family:JetBrains Mono,monospace;font-size:.6rem;font-weight:700;text-transform:uppercase;letter-spacing:2px;color:var(--accent-light)!important;opacity:.6;margin-bottom:.75rem;width:100%;display:flex;align-items:center;gap:.5rem}.action-bar-label:after{content:"";flex:1;height:1px;background:var(--border)}@media (max-width:900px){.chart-wrapper{overflow-x:scroll!important;-webkit-overflow-scrolling:touch}.pipeline-results-grid,.stats-row{grid-template-columns:1fr 1fr}}@media (max-width:768px){.pipeline-results-grid{grid-template-columns:repeat(2,1fr)}.methodology-card,.pipeline-config-row{grid-template-columns:1fr}.subagency-bar-container{display:none}.subagency-stats{flex-direction:column;gap:.5rem}.subagency-stat{text-align:left}.stats-row{grid-template-columns:1fr!important;gap:.75rem!important}.stat-item{display:flex!important;justify-content:space-between!important;align-items:center!important;padding:1rem!important;text-align:left!important}.stat-label{margin-bottom:0!important}.stat-item-action{grid-column:span 1!important}#forecastModeView div[style*="display: grid"]{grid-template-columns:1fr!important;gap:1rem!important;width:100%!important;overflow:hidden!important}.dashboard-container{padding-left:1rem!important;padding-right:1rem!important;overflow-x:hidden!important}.analysis-panel,.analysis-panel-body,.buyer-list,.dashboard-container{width:100%!important;max-width:100%!important}.job-intel-panel>div{grid-template-columns:1fr!important}.forecast-table td:last-child,.forecast-table th{padding-right:0!important}.geo-states-grid{grid-template-columns:1fr!important}.btn-row{flex-direction:column}.chart-container{min-width:auto;width:100%}.chart-wrapper{padding:0!important;border:none!important}.sankey-panel{padding:.5rem!important}}@media (max-width:600px){.mode-toggle{flex-direction:column}.app-header{gap:.5rem;padding:.5rem .75rem}.header-left{gap:.5rem}.mini-search{max-width:none;padding:.5rem .6rem;font-size:.8rem}.logo-btn{font-size:.9rem}.header-actions{gap:.35rem}.channel-marking-modal{padding:0}.channel-modal-content{margin:0;border-radius:0;border-top:2px solid var(--accent);height:100%;max-height:100%;max-width:100%;display:flex;flex-direction:column;transform:translateY(16px);opacity:0}.channel-modal-header{flex-shrink:0;padding:1rem}.channel-modal-title{font-size:1.1rem}.channel-modal-body{flex:1;overflow-y:auto;min-height:0}.channel-modal-footer{flex-direction:column;gap:.75rem;padding:1rem 1rem max(1rem,env(safe-area-inset-bottom))}.modal-footer-buttons{flex-direction:column;width:100%;gap:.5rem}.modal-footer-buttons .modal-btn-primary{width:100%;padding:.875rem}.modal-footer-secondary{width:100%;gap:.5rem}.modal-footer-secondary .modal-btn{flex:1;padding:.75rem}.modal-status-line{text-align:center;font-size:.7rem;opacity:.7;padding-top:.5rem;border-top:1px solid var(--border)}.step-grid{grid-template-columns:1fr!important}.hero-growth-value{font-size:2rem}.intel-grid{grid-template-columns:1fr!important}.intel-grid>div{min-width:0;overflow:hidden}.modal-step-grid{grid-template-columns:1fr!important}.channel-modal-close{width:44px;height:44px;font-size:1.25rem;margin:-.25rem -.25rem -.25rem 0}.buyer-spend{font-size:1rem}.buyer-amount{min-width:75px}.compact-winner-amount{font-size:.9rem;min-width:65px}.compact-location-amount{font-size:.85rem;min-width:60px}.subagency-amount{font-size:.95rem;min-width:70px}.buyer-name,.compact-winner-name,.subagency-name{font-size:.85rem}.job-links{gap:4px}.job-link{font-size:.6rem;padding:2px 4px}.buyer-rank,.compact-location-rank,.compact-winner-rank,.subagency-rank{width:34px;height:34px;font-size:15px!important}.sub-bullet,.sub-bullet.lg,.sub-bullet.sm,.sub-bullet.xl{width:34px;height:34px;font-size:15px}.steps-list li:before{width:34px!important;height:34px!important;font-size:15px!important}.steps-list li{padding-left:2.75rem!important}.icon-btn{width:34px;height:34px;font-size:15px}}.steps-list li{letter-spacing:.5px}.steps-list li,.steps-list li:before{font-family:JetBrains Mono,monospace!important}.steps-list li:before{font-weight:700!important}.steps-list li strong{font-family:JetBrains Mono,monospace!important}.compact-location-amount,.compact-winner-amount,.deal-amount{font-family:JetBrains Mono,monospace!important;color:#f1eee9!important;letter-spacing:-.5px}.deal-date,.mission-gap-signals,.vendor-stats{letter-spacing:1px;opacity:.5}.deal-date,.deal-footer .action-btn,.mission-gap-signals,.vendor-stats{font-family:JetBrains Mono,monospace;font-size:.65rem!important;text-transform:uppercase;color:var(--text-primary)!important}.deal-footer .action-btn{background:transparent!important;border:1px solid rgba(251,247,245,.3)!important;font-weight:700;letter-spacing:.5px;padding:.5rem .75rem;transition:all .2s ease}.deal-footer .action-btn:hover{background:rgba(251,247,245,.08)!important;border-color:var(--text-primary)!important;color:#f1eee9!important}#heroView .search-box-container{display:flex;flex-direction:column;gap:12px}#heroView .main-input,#searchBtn{height:56px;border-radius:6px!important}#searchBtn{font-weight:800!important;letter-spacing:2px}.prime-sankey-header,.sankey-header,.subcontract-sankey-header{background:var(--bg-card);color:var(--text-primary);border-bottom:1px solid var(--border);padding:.75rem 1rem;font-weight:600;letter-spacing:.2px}.drill-controls-bar{padding:.5rem .75rem;border-radius:8px;background:hsla(0,0%,100%,.02);border:1px solid var(--border)}.drill-breadcrumb{gap:.35rem!important}.breadcrumb-item{padding:.25rem .5rem;border-radius:6px;border:1px solid var(--border);background:transparent;color:var(--text-muted);font-family:JetBrains Mono,monospace;font-size:.72rem;line-height:1.1;display:inline-flex;align-items:center;gap:.35rem;cursor:pointer;transition:opacity .15s ease,transform .15s ease}.breadcrumb-icon{font-size:.72rem;opacity:.75}.breadcrumb-item:hover{opacity:.92;transform:scale(1.02);color:var(--text-primary)}.drill-level-indicator{padding:.2rem .5rem;border-radius:999px;border:1px solid var(--border);background:hsla(0,0%,100%,.015);color:var(--text-muted)}.drill-level-indicator,.filter-badge{font-family:JetBrains Mono,monospace;font-size:.7rem;line-height:1.1;display:inline-flex;align-items:center;gap:.35rem}.filter-badge{padding:.2rem .55rem;border-radius:999px;border:1px solid rgba(66,106,90,.45);background:rgba(66,106,90,.1);color:var(--text-primary);cursor:pointer;transition:opacity .15s ease,transform .15s ease}.filter-badge:hover{opacity:.92;transform:scale(1.02)}#drillControlsBar>div{gap:.5rem!important}@media (max-width:520px){.drill-controls-bar{padding:.5rem .6rem}.breadcrumb-item{font-size:.7rem;padding:.22rem .45rem}}#drillLevelBadge,#filterBadge{display:none!important}.main-input,.mini-search{border-radius:8px;background:var(--bg-input)!important;border:1px solid var(--border)!important;box-shadow:0 4px 12px rgba(0,0,0,.2)}#heroView a[href^="?q="]{background:hsla(0,0%,100%,.03)!important;border:1px solid var(--border)!important;color:var(--text-muted)!important;border-radius:20px!important;padding:6px 16px!important;font-size:.75rem;letter-spacing:.5px}#heroView a[href^="?q="]:hover{background:var(--accent-dim)!important;color:var(--accent-light)!important;border-color:var(--accent)!important;transform:translateY(-1px)}.sub-bullet.blue{background:var(--info)}.sub-bullet.orange{background:var(--warning);color:var(--bg-app)}.sub-bullet.red{background:var(--danger)}.sub-bullet.purple{background:#9b8ea9}.analysis-panel,.deal-card,.stat-item{background:var(--bg-card);border:1px solid var(--border)!important;box-shadow:0 2px 8px rgba(0,0,0,.15)}#stat-vol,.deal-amount,.hero-growth-value{color:var(--text-primary)!important;text-shadow:none;letter-spacing:-1px}.meta-tag{border-radius:4px;font-weight:600;border:1px solid transparent}.meta-tag.psc{background:rgba(126,156,184,.15);color:var(--info)}.meta-tag.naics{background:rgba(155,142,169,.15);color:#9b8ea9}@media (max-width:768px){.channel-marking-modal,.convo-modal,.pipeline-modal{padding:.75rem!important;align-items:center!important}.channel-modal-content,.convo-modal-content,.pipeline-modal-content{margin:0!important;width:100%!important;max-height:95vh!important;border-radius:8px!important;display:flex;flex-direction:column}#copySuccessModal .channel-modal-content{height:auto!important;min-height:auto!important;max-height:auto!important;flex:0 0 auto!important;margin:auto!important;transform:none!important}.channel-modal-body,.channel-modal-footer,.channel-modal-header{padding:1rem!important}.channel-modal-title{font-size:.95rem!important}}@media (max-width:768px){input,select,textarea{font-size:16px!important}}::-webkit-scrollbar{width:8px;height:8px}::-webkit-scrollbar-track{background:var(--bg-app)}::-webkit-scrollbar-thumb{background:var(--bg-elevated);border:1px solid var(--border);border-radius:4px}::-webkit-scrollbar-thumb:hover{background:var(--accent-dim)}.pipeline-modal-body{overflow-x:auto;-webkit-overflow-scrolling:touch}#sankey,#sankey-sub,.chart-wrapper,.sankey-container{border:none!important;box-shadow:none!important;background:transparent!important}svg{border:none!important;outline:none!important}.convo-card-copy:hover{border-color:#5b7c99!important;color:#5b7c99!important;background:rgba(91,124,153,.15)!important}.convo-focus-btn.active{background:rgba(123,109,141,.2)!important;border-color:#7b6d8d!important;color:#f1eee9!important}.convo-focus-btn.active .sub-bullet{background:#7b6d8d!important}.pipeline-modal .modal-btn-primary{background:#e07a5f!important;border-color:#e07a5f!important;color:#f1eee9!important}.pipeline-modal .modal-btn-primary:hover{background:#f18b70!important;transform:translateY(-1px)}.pipeline-results-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:1rem;margin-bottom:1.5rem;width:100%}.pipeline-stat{background:var(--bg-card);border:1px solid var(--border);border-radius:4px;padding:1.25rem 1rem;display:flex;flex-direction:column;justify-content:center;min-width:0;transition:transform .2s ease,border-color .2s ease}.pipeline-stat:hover{border-color:var(--accent-light);transform:translateY(-2px)}.pipeline-stat-label{font-size:.7rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:.5rem}.pipeline-stat-label,.pipeline-stat-value{font-family:JetBrains Mono,monospace;font-weight:700}.pipeline-stat-value{font-size:1.5rem;color:#f1eee9;margin-bottom:.35rem;line-height:1}.pipeline-stat-sub{font-size:.75rem;color:var(--text-primary);opacity:.6;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}@media (max-width:900px){.pipeline-results-grid{grid-template-columns:1fr 1fr}}@media (max-width:600px){.pipeline-results-grid{grid-template-columns:1fr}}.steps-list li:first-child:before{background-color:#5b7c99!important;color:#f1eee9!important;box-shadow:0 0 0 2px #0e1111}.steps-list li:nth-child(2):before{background-color:#7b6d8d!important;color:#f1eee9!important;box-shadow:0 0 0 2px #0e1111}.steps-list li:nth-child(3):before{background-color:#e07a5f!important;color:#f1eee9!important;box-shadow:0 0 0 2px #0e1111}.footer-copyright{font-family:JetBrains Mono,monospace;font-size:.65rem;color:var(--text);letter-spacing:.5px;margin-top:1rem;text-align:center}#bubbleChartPanel{background:var(--bg-card);border:1px solid var(--border);border-radius:8px;padding:.75rem;margin-bottom:1.5rem;overflow:hidden}#bubbleChartPanel .bubble-header{font-family:JetBrains Mono,monospace;font-size:.6rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:.5rem}#bubbleChartContainer{width:100%;min-height:420px;position:relative}#bubbleChartContainer svg,#subBubbleContainer svg{width:100%;height:100%;display:block}.bubble-node{cursor:pointer;transition:opacity .15s ease}.bubble-node:hover{opacity:.85!important}.bubble-label{fill:#f1eee9;dominant-baseline:central}.bubble-amount-label,.bubble-label{font-family:JetBrains Mono,monospace;pointer-events:none;text-anchor:middle}.bubble-amount-label{fill:rgba(241,238,233,.7)}.bubble-tooltip{position:absolute;background:rgba(22,27,24,.95);border:1px solid var(--border);border-radius:6px;padding:.75rem 1rem;font-family:JetBrains Mono,monospace;font-size:.75rem;color:var(--text-primary);pointer-events:none;z-index:50;white-space:nowrap;backdrop-filter:blur(8px);box-shadow:0 4px 12px rgba(0,0,0,.4);opacity:0;transition:opacity .15s ease}.bubble-tooltip.visible{opacity:1}.bubble-tooltip-name{font-weight:700;color:#f1eee9;margin-bottom:4px}.bubble-tooltip-amount{color:var(--accent-light);font-size:.85rem;font-weight:700}.bubble-tooltip-meta{color:var(--text-muted);font-size:.65rem;margin-top:4px}.bubble-toggle-row{display:flex;gap:.5rem;margin-bottom:1rem}.bubble-toggle-btn{padding:.35rem .75rem;font-family:JetBrains Mono,monospace;font-size:.65rem;font-weight:700;text-transform:uppercase;letter-spacing:.5px;border:1px solid var(--border);border-radius:4px;background:transparent;color:var(--text-muted);cursor:pointer;transition:all .15s ease}.bubble-toggle-btn.active{background:var(--accent);border-color:var(--accent);color:#f1eee9}.bubble-toggle-btn:hover:not(.active){border-color:var(--accent);color:var(--accent-light)}@media (max-width:600px){#bubbleChartContainer{min-height:320px}}.bubble-bc-item{display:inline-flex;align-items:center;gap:4px;padding:.2rem .5rem;border-radius:4px;color:var(--text-muted);font-family:JetBrains Mono,monospace;font-size:.7rem;cursor:pointer;transition:all .15s ease;white-space:nowrap}.bubble-bc-item:hover{color:var(--accent-light);background:hsla(0,0%,100%,.05)}.bubble-bc-item.active{color:#f1eee9;font-weight:700;cursor:default}.bubble-bc-item.active:hover{background:transparent}.bubble-bc-sep{color:var(--text-subtle);font-size:.55rem}.presentation-mode #bubbleChartPanel,.presentation-mode #sankeyPanel,.presentation-mode #subBubblePanel,.presentation-mode #subcontractingPanel{background:#fff!important;border-color:#e0e0e0!important}.presentation-mode #bubbleChartPanel *,.presentation-mode #sankeyPanel *,.presentation-mode #subBubblePanel *,.presentation-mode #subcontractingPanel *{--text-primary:#1a1a1a;--text-muted:#666;--text-subtle:#999;--border:rgba(0,0,0,0.12)}.presentation-mode #bubble-stat-agencies,.presentation-mode #bubble-stat-count,.presentation-mode #bubble-stat-entities,.presentation-mode #bubble-stat-vendors,.presentation-mode #bubble-stat-vol,.presentation-mode #stat-agencies,.presentation-mode #stat-count,.presentation-mode #stat-vendors,.presentation-mode #stat-vol,.presentation-mode #sub-bubble-stat-primes,.presentation-mode #sub-bubble-stat-records,.presentation-mode #sub-bubble-stat-shown,.presentation-mode #sub-bubble-stat-subs,.presentation-mode #sub-bubble-stat-vol,.presentation-mode #sub-stat-count,.presentation-mode #sub-stat-primes,.presentation-mode #sub-stat-subs,.presentation-mode #sub-stat-vol{color:#1a1a1a!important}.presentation-mode #bubbleChartSubtitle,.presentation-mode #sankeySubtitle,.presentation-mode #subBubbleSubtitle,.presentation-mode .bubble-header{color:#666!important}.presentation-mode #bubbleChartPanel span[style*="text-transform: uppercase"],.presentation-mode #sankeyPanel span[style*="text-transform: uppercase"],.presentation-mode #subBubblePanel span[style*="text-transform: uppercase"],.presentation-mode #subcontractingPanel span[style*="text-transform: uppercase"]{color:#888!important}.presentation-mode #bubbleChartPanel div[style*=border-left],.presentation-mode #bubbleChartPanel div[style*=border-top],.presentation-mode #sankeyPanel div[style*=border-left],.presentation-mode #sankeyPanel div[style*=border-top],.presentation-mode #subBubblePanel div[style*=border-left],.presentation-mode #subBubblePanel div[style*=border-top],.presentation-mode #subcontractingPanel div[style*=border-left],.presentation-mode #subcontractingPanel div[style*=border-top]{border-color:#e0e0e0!important}.presentation-mode #bubbleChartPanel>div:last-child,.presentation-mode #sankeyPanel>div:last-child,.presentation-mode #subBubblePanel>div:last-child{color:#999!important}.presentation-mode .bubble-label{fill:#1a1a1a!important}.presentation-mode .bubble-amount-label{fill:rgba(26,26,26,.65)!important}.presentation-mode .bubble-bc-item{color:#666}.presentation-mode .bubble-bc-item:hover{color:var(--accent);background:rgba(0,0,0,.05)}.presentation-mode .bubble-bc-item.active{color:#1a1a1a}.presentation-mode .bubble-bc-sep{color:#ccc}.presentation-mode #bubbleBreadcrumb,.presentation-mode #subBubbleBreadcrumb{background:rgba(0,0,0,.03)!important;border-color:#e0e0e0!important}.presentation-mode .bubble-tooltip{background:hsla(0,0%,100%,.96)!important;border-color:#ddd!important;color:#1a1a1a!important;box-shadow:0 4px 16px rgba(0,0,0,.12)}.presentation-mode .bubble-tooltip-name{color:#1a1a1a!important}.presentation-mode .bubble-tooltip-amount{color:var(--accent)!important}.presentation-mode .bubble-tooltip-meta{color:#666!important}.presentation-mode .bubble-toggle-btn{border-color:#ddd!important;color:#888!important}.presentation-mode .bubble-toggle-btn.active{background:var(--accent)!important;border-color:var(--accent)!important;color:#fff!important}.presentation-mode .bubble-toggle-btn:hover:not(.active){border-color:var(--accent)!important;color:var(--accent)!important}.icon-btn-pres{background:#e07a5f!important;color:#f1eee9!important}.icon-btn-pres:hover{background:#f18b70!important;transform:translateY(-1px)}.icon-btn-pres.active{background:#f18b70!important;color:#f1eee9!important}
</style>
</head>
<body>

<div id="heroView" class="hero-view">
  <div class="terminal-logo"><span style="color: var(--accent);">>_</span>Govhoo</div>
  <p class="hero-subtitle" style="padding-left: 1.25em;">Follow the Money. For Free.</p>
  
  <div class="search-box-container">
  <input type="text" id="mainSearchInput" class="main-input" placeholder="Keywords, company, or agency..." autocomplete="off">
  <button class="input-clear" onclick="document.getElementById('mainSearchInput').value=''; document.getElementById('mainSearchInput').focus();" aria-label="Clear search">Ã—</button>
    <div class="btn-row">
      <button id="searchBtn" class="btn-primary" data-action="search" style="flex: none; width: 100%; background-color: var(--accent); color: #F1EEE9;">
        SEARCH
      </button>
    </div>
  </div>

  <!-- Quick Start Chips -->
  <div style="width: 100%; max-width: 500px; margin-top: 1.5rem;">
    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; justify-content: center;">
      <a href="?q=Cloud" style="text-decoration: none; padding: 0.4rem 0.75rem; border: 1px solid var(--border); border-radius: 4px; font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; color: var(--text-muted); transition: all 0.15s; background: rgba(255,255,255,0.02);" onmouseover="this.style.borderColor='var(--accent)';this.style.color='var(--accent)';this.style.background='var(--accent-dim)'" onmouseout="this.style.borderColor='var(--border)';this.style.color='var(--text-muted)';this.style.background='rgba(255,255,255,0.02)'">Cloud</a>
      <a href="?q=Cyber" style="text-decoration: none; padding: 0.4rem 0.75rem; border: 1px solid var(--border); border-radius: 4px; font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; color: var(--text-muted); transition: all 0.15s; background: rgba(255,255,255,0.02);" onmouseover="this.style.borderColor='var(--accent)';this.style.color='var(--accent)';this.style.background='var(--accent-dim)'" onmouseout="this.style.borderColor='var(--border)';this.style.color='var(--text-muted)';this.style.background='rgba(255,255,255,0.02)'">Cyber</a>
      <a href="?q=DevSecOps" style="text-decoration: none; padding: 0.4rem 0.75rem; border: 1px solid var(--border); border-radius: 4px; font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; color: var(--text-muted); transition: all 0.15s; background: rgba(255,255,255,0.02);" onmouseover="this.style.borderColor='var(--accent)';this.style.color='var(--accent)';this.style.background='var(--accent-dim)'" onmouseout="this.style.borderColor='var(--border)';this.style.color='var(--text-muted)';this.style.background='rgba(255,255,255,0.02)'">DevSecOps</a>
      <a href="?q=DHS" style="text-decoration: none; padding: 0.4rem 0.75rem; border: 1px solid var(--border); border-radius: 4px; font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; color: var(--text-muted); transition: all 0.15s; background: rgba(255,255,255,0.02);" onmouseover="this.style.borderColor='var(--accent)';this.style.color='var(--accent)';this.style.background='var(--accent-dim)'" onmouseout="this.style.borderColor='var(--border)';this.style.color='var(--text-muted)';this.style.background='rgba(255,255,255,0.02)'">DHS</a>
      <a href="?q=541512" style="text-decoration: none; padding: 0.4rem 0.75rem; border: 1px solid var(--border); border-radius: 4px; font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; color: var(--text-muted); transition: all 0.15s; background: rgba(255,255,255,0.02);" onmouseover="this.style.borderColor='var(--accent)';this.style.color='var(--accent)';this.style.background='var(--accent-dim)'" onmouseout="this.style.borderColor='var(--border)';this.style.color='var(--text-muted)';this.style.background='rgba(255,255,255,0.02)'">NAICS 541512</a>
    </div>
  </div>
<footer class="hero-footer">
  <div class="footer-grid">

    <!-- GETTING STARTED -->
    <div class="footer-section">
      <div class="footer-label mono text-xs accent upper">Getting Started</div>

      <div style="margin-bottom: 1rem;">
        <ol class="steps-list" style="list-style: none; padding-left: 0;">

          <li style="margin-bottom: 1rem;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
              <strong style="color: var(--text-primary);">Search Literally</strong>
            </div>
            <div style="font-size: 0.75rem; color: var(--text-primary); opacity: 0.7; line-height: 1.5;">
              Type a keyword, company, or category (e.g. "Splunk", "Dell", "Cloud Hosting"). Results rely on exact text matching. If something returns zero results, broaden the term or use PSC or NAICS codes like 
              <a href="?q=541512" style="color: var(--accent-light); text-decoration: underline; background: none !important; border: none !important; padding: 0 !important; display: inline !important; box-shadow: none !important;">541512</a>.
            </div>
          </li>

          <li style="margin-bottom: 1rem;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
              <strong style="color: var(--text-primary);">Follow the Money</strong>
            </div>
            <div style="font-size: 0.75rem; color: var(--text-primary); opacity: 0.7; line-height: 1.5;">
              Click the bars to see how dollars move from agencies to primes and subs. Patterns show up quickly, including incumbents, teaming behavior, and upcoming recompetes.
            </div>
          </li>

          <li style="margin-bottom: 0;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
              <strong style="color: var(--text-primary);">Find Decision Makers</strong>
            </div>
            <div style="font-size: 0.75rem; color: var(--text-primary); opacity: 0.7; line-height: 1.5;">
              Use the LinkedIn links and conversation starters to go from data to a real conversation without overthinking it.
            </div>
          </li>

        </ol>
      </div>
    </div>

    <!-- WHY GOVHOO -->
    <div class="footer-section">
      <div class="footer-label mono text-xs accent upper">Why Govhoo</div>

      <div class="use-cases">

        <div class="use-case">
          <div class="use-case-title">
            Defend Your Base
          </div>
          <div class="use-case-desc">
            Spot expiring contracts early so recompetes donâ€™t catch you by surprise.
          </div>
        </div>

        <div class="use-case">
          <div class="use-case-title">
            Find the Right Partners
          </div>
          <div class="use-case-desc">
            See who is winning work in your space and where subcontracting actually happens.
          </div>
        </div>

        <div class="use-case">
          <div class="use-case-title">
            Validate Your Pipeline
          </div>
          <div class="use-case-desc">
            Identify agencies where your competitors are already active and decide where it makes sense to engage.
          </div>
        </div>

      </div>
    </div>

    <!-- BUILT BY -->
    <div class="footer-section">
      <div class="footer-label mono text-xs accent upper">Built by a Sales Guy</div>

      <p class="footer-text">
        <img src="https://govhoo.com/images/oldmark.jpg" alt="Mark Flournoy" class="tip-bio-img">
    Hi, Iâ€™m Mark, a retired federal sales guy, former COTR, and Marine. At AWS, F5, and Red Hat, I spent hours every month digging through USASpending data, SAM.gov listings, and industry days just to understand who actually held the contract workshare.
        <br><br>
        I built Govhoo to make that part simple. It uses live award data to show whoâ€™s winning the work so you can focus on the right conversations at the right time. And it's free to use.
        <br><br>
        If you want help applying this to your pipeline or planning your next move, Iâ€™m happy to talk it through. You can also reach me on 
        <a href="https://www.linkedin.com/in/markflournoy/" target="_blank" class="footer-link">
          <i class="fab fa-linkedin" style="margin-right: 4px;"></i>LinkedIn
        </a>.
      </p>

      <div style="padding: 1rem; margin-top: 1.2rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px;">
        <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; font-weight: 700; color: #F1EEE9; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 0.5rem;">
          Need a Second Set of Eyes?
        </div>
        <div style="font-size: 0.7rem; color: var(--text-primary); opacity: 0.7; line-height: 1.4; margin-bottom: 1rem;">
          If youâ€™re stuck or deciding where to focus next, letâ€™s spend 30 minutes diving into the data.
        </div>
        <a href="https://calendly.com/markflournoy/govhoo" target="_blank" style="text-decoration:none;">
          <button class="btn-primary" style="width: 100%; padding: 0.6rem; font-size: 0.75rem; justify-content: center;">
            <i class="fas fa-mug-hot"></i> Book a 30-minute session
          </button>
        </a>
      </div>
    </div>
  </div>
  <div class="footer-bottom">
    <div class="footer-copyright">Â© 2026 <span style="color: #5f8055;">>_</span>GOVHOO.COM â€” DATA VIA USASPENDING.GOV</div>
  </div>
</footer>
</div>

<div id="appView" style="display:none;">
  <header class="app-header">
    <div class="header-left">
      <span class="logo-btn" data-action="showHero"><span style="color: var(--accent);">>_</span>Govhoo</span>
      <div class="mini-search-wrapper">
  <input type="text" id="miniSearch" class="mini-search" placeholder="New search...">
</div>
    </div>
    <div class="header-actions">
<button class="icon-btn icon-btn-slack" data-action="shareBrief" title="Share Link">
  <i class="fa-regular fa-paper-plane"></i>
</button>
<button class="icon-btn icon-btn-csv" title="Download CSV" data-action="exportCSV">
  <i class="fas fa-arrow-down"></i>
</button>
<button class="icon-btn icon-btn-pres" id="presToggleBtn" onclick="App.togglePresentationMode()" title="Light Mode">
  <i class="fas fa-rainbow"></i>
</button>
    </div>
  </header>

  <div id="dashboardContainer" class="dashboard-container">
    
    <div id="searchModeView" class="view-section active">
      
      <!-- Drill Navigation Controls -->
      <div id="drillControlsBar" class="drill-controls-bar" style="display: none; margin-bottom: 1rem; padding: 0.75rem 1rem; background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 6px; overflow: hidden;">
        <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 0.5rem;">
          <div id="drillBreadcrumb" class="drill-breadcrumb" style="display: flex; margin: 0; flex-wrap: wrap; min-width: 0;">
            <div class="breadcrumb-item" data-action="resetDrill">
              <i class="fas fa-globe breadcrumb-icon"></i>
              <span>All Agencies</span>
            </div>
          </div>
          <div style="display: flex; align-items: center; gap: 0.5rem;">
            <span id="drillLevelBadge" class="drill-level-indicator">
              <i class="fas fa-layer-group"></i>
              <span id="drillLevelText">Level 1</span>
            </span>
            <div id="filterBadge" class="filter-badge" data-action="clearFilter">
              <span id="filterName">FILTER</span> <i class="fas fa-times"></i>
            </div>
          </div>
        </div>
      </div>

      <!-- Agency Award Flow Sankey -->
      <div id="sankeyPanel" class="sankey-panel" style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; padding: 1.25rem; margin-bottom: 1rem; overflow: hidden;">
        
        <div style="margin-bottom: 1rem;">
          <div id="sankeySubtitle" style="font-family: 'JetBrains Mono', monospace; font-size: 0.6rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 0.5rem;">Top 100 Active Contracts Â· Lifetime Funded Value</div>
          <div style="display: flex; align-items: baseline; gap: 1.5rem; flex-wrap: wrap;">
            <div id="stat-vol" style="font-family: 'JetBrains Mono', monospace; font-size: clamp(1.75rem, 5vw, 2.5rem); font-weight: 800; color: var(--text-primary); line-height: 1;">-</div>
            <div id="searchStatsCompact" style="display: flex; gap: 1.25rem; align-items: baseline; flex-wrap: wrap; margin-left: 0.5rem; padding-left: 1.5rem; border-left: 1px solid var(--border);">
              <div style="display: flex; align-items: baseline; gap: 0.35rem;">
                <span id="stat-agencies" style="font-family: 'JetBrains Mono', monospace; font-size: 1rem; font-weight: 700; color: var(--text-primary);">-</span>
                <span style="font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase;">Agencies</span>
              </div>
              <div style="display: flex; align-items: baseline; gap: 0.35rem;">
                <span id="stat-count" style="font-family: 'JetBrains Mono', monospace; font-size: 1rem; font-weight: 700; color: var(--text-primary);">-</span>
                <span style="font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase;">Contracts</span>
              </div>
              <div style="display: flex; align-items: baseline; gap: 0.35rem;">
                <span id="stat-vendors" style="font-family: 'JetBrains Mono', monospace; font-size: 1rem; font-weight: 700; color: var(--text-primary);">-</span>
                <span style="font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase;">Vendors</span>
              </div>
            </div>
          </div>
        </div>

        <div class="chart-wrapper" style="border: none; padding: 0; background: transparent; overflow-x: auto; overflow-y: visible;">
          <div id="chartContainer" class="chart-container"></div>
        </div>
        <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 1rem; padding-top: 0.75rem; border-top: 1px solid var(--border); font-size: 0.65rem; color: var(--text-muted);">
          <span>Data: USASpending.gov</span>
          <span style="font-family: 'JetBrains Mono', monospace;"><span style="color: var(--accent);">>_</span>Govhoo.com</span>
        </div>
      </div>

      <!-- Data Explainer: Prime Contracts -->
      <div id="primeExplainerBox" style="background: linear-gradient(135deg, rgba(99,102,241,0.08), rgba(99,102,241,0.03)); border: 1px solid rgba(99,102,241,0.2); border-radius: 8px; padding: 1rem 1.25rem; margin-bottom: 1rem; display: none;">
        <div style="display: flex; align-items: flex-start; gap: 0.75rem;">
          <div style="flex: 1; font-size: 0.75rem; color: var(--text-muted); line-height: 1.6;">
            <strong style="color: var(--text-primary); font-size: 0.8rem;">How to read these numbers</strong><br>
            Every contract shown here had funding activity in the past 12 months. The dollar amounts represent <strong style="color: var(--text-primary);">Total Obligations to Date</strong>â€”the government's cumulative financial commitment to the contract. The start date simply shows when the work began.<br><br>
            
            <strong style="color: var(--text-primary);">A note on resellers:</strong> If you search for a specific brand or product (like "AWS" or "Amazon"), you may see companies like Carahsoft or Four Points listed as the vendor. This is because the chart displays the prime contractor who directly holds the award. The government frequently purchases goods and services through resellers, systems integrators, or small business partners rather than buying directly from the OEM.<br><br>
            <strong style="color: var(--text-primary);">What to look for:</strong> A recent start date with a high dollar amount highlights a new, active program. An older start date indicates sustained spending on an established vehicle. The obligation shows the scale, and the start date helps you gauge where it is in its lifecycle. <em>(Note: Click any node in the chart above to drill down into specific sub-agencies and vendors).</em><br><br>
            <strong style="color: var(--text-primary);">How to use this:</strong> This view is designed to help you map active, historically funded work. Use it to size an addressable market, see which specific vendors and contract vehicles are actively being utilized, and identify upcoming recompetes based on their age and expiration timelines.
          </div>
        </div>
      </div>

      <!-- Bubble Chart: Market Landscape (synced with Sankey drill state) -->
      <div id="bubbleChartPanel" style="display: none;">
        
        <div style="margin-bottom: 1rem;">
          <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 0.5rem;">
            <div id="bubbleChartSubtitle" style="font-family: 'JetBrains Mono', monospace; font-size: 0.6rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1.5px;">Top Active Vendors & Agencies Â· Lifetime Funded Value</div>
            <div class="bubble-toggle-row" style="margin-bottom: 0;" id="bubbleToggleRow">
              <button class="bubble-toggle-btn active" onclick="App.setBubbleMode('vendors')" id="bubbleToggleVendors">Vendors</button>
              <button class="bubble-toggle-btn" onclick="App.setBubbleMode('agencies')" id="bubbleToggleAgencies">Agencies</button>
              <button class="bubble-toggle-btn" onclick="App.setBubbleMode('subagencies')" id="bubbleToggleSubAgencies" style="display:none;">Sub-Agencies</button>
            </div>
          </div>
          <div style="display: flex; align-items: baseline; gap: 1.5rem; flex-wrap: wrap;">
            <div id="bubble-stat-vol" style="font-family: 'JetBrains Mono', monospace; font-size: clamp(1.75rem, 5vw, 2.5rem); font-weight: 800; color: var(--text-primary); line-height: 1;">-</div>
            <div style="display: flex; gap: 1.25rem; align-items: baseline; flex-wrap: wrap; margin-left: 0.5rem; padding-left: 1.5rem; border-left: 1px solid var(--border);">
              <div style="display: flex; align-items: baseline; gap: 0.35rem;">
                <span id="bubble-stat-agencies" style="font-family: 'JetBrains Mono', monospace; font-size: 1rem; font-weight: 700; color: var(--text-primary);">-</span>
                <span style="font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase;">Agencies</span>
              </div>
              <div style="display: flex; align-items: baseline; gap: 0.35rem;">
                <span id="bubble-stat-count" style="font-family: 'JetBrains Mono', monospace; font-size: 1rem; font-weight: 700; color: var(--text-primary);">-</span>
                <span style="font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase;">Contracts</span>
              </div>
              <div style="display: flex; align-items: baseline; gap: 0.35rem;">
                <span id="bubble-stat-vendors" style="font-family: 'JetBrains Mono', monospace; font-size: 1rem; font-weight: 700; color: var(--text-primary);">-</span>
                <span style="font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase;">Vendors</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Bubble breadcrumb (mirrors and syncs with the Sankey breadcrumb) -->
        <div id="bubbleBreadcrumb" style="display:none; margin-bottom: 0.75rem; padding: 0.5rem 0.75rem; background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 6px; font-size: 0.7rem; overflow-x: auto;">
          <div id="bubbleBreadcrumbInner" style="display: flex; align-items: center; gap: 0.35rem; flex-wrap: wrap;"></div>
        </div>
        <div id="bubbleChartContainer">
          <div class="bubble-tooltip" id="bubbleTooltip"></div>
        </div>
        <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid var(--border); font-size: 0.6rem; color: var(--text-muted);">
          <span><i class="fas fa-circle" style="color: var(--accent); font-size: 0.5rem;"></i> Bubble size = total award value Â· Click to drill down</span>
          <span style="font-family: 'JetBrains Mono', monospace;"><span style="color: var(--accent);">>_</span>Govhoo.com</span>
        </div>
      </div>
      
      <div id="drillHint" class="drill-hint" style="display:none;">
        <i class="fas fa-mouse-pointer"></i>
        <span>Click an <strong>agency bar</strong> to drill into sub-agencies</span>
      </div>

      <div id="searchJobPanel" style="margin: 0 0 1.5rem 0; padding: 0; position: relative;">
  <div class="intel-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem 1.5rem;">
    
    <div>
      <div class="section-header" style="margin: 0 0 0.75rem 0;">
        <div class="section-title-group">
          <span class="section-title mono bold upper text-xs" style="color: var(--info);">Agencies</span>
        </div>
      </div>
      <div class="analysis-panel" style="min-height: auto;">
        <div class="analysis-panel-body intel-stagger-1" id="searchTopBuyersBody" style="padding: 0.75rem;">
          <div class="muted text-xs" style="text-align:center;">Agencies awarding contracts will appear here</div>
        </div>
      </div>
    </div>
    
    <div>
      <div class="section-header" style="margin: 0 0 0.75rem 0;">
        <div class="section-title-group">
          <span class="section-title mono bold accent upper text-xs">Winners</span>
        </div>
      </div>
      <div class="analysis-panel" style="min-height: auto;">
        <div class="analysis-panel-body intel-stagger-2" id="searchTopWinnersBody" style="padding: 0.75rem;">
          <div class="muted text-xs" style="text-align:center;">Prime contractors winning awards will appear here</div>
        </div>
      </div>
    </div>

    <div>
      <div class="section-header" style="margin: 0 0 0.75rem 0;">
        <div class="section-title-group">
          <span class="section-title mono bold upper text-xs" style="color: var(--text-muted);">Locations</span>
        </div>
      </div>
      <div class="analysis-panel" style="min-height: auto;">
        <div class="analysis-panel-body intel-stagger-3" id="searchLocationsBody" style="padding: 0.75rem;">
          <div class="muted text-xs" style="text-align:center;">Where the work happens will appear here</div>
        </div>
      </div>
    </div>

    <div>
      <div class="section-header" style="margin: 0 0 0.75rem 0;">
        <div class="section-title-group">
          <span class="section-title mono bold upper text-xs" style="color: var(--text-muted);">Key Terms</span>
        </div>
      </div>
      <div class="analysis-panel" style="min-height: auto;">
        <div class="analysis-panel-body intel-stagger-4" id="searchSkillsBody" style="padding: 0.75rem;">
          <div class="muted text-xs" style="text-align:center;">Key terms from results will appear here</div>
        </div>
      </div>
    </div>

  </div>
</div>

<div id="actionBar" style="display: flex; gap: 0.75rem; margin: 0 0 1.5rem 0; flex-wrap: wrap; align-items: stretch; padding: 1.25rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; position: relative;">
        <div class="action-bar-label">Toolbox</div>
       <button class="btn-primary" data-action="openConvoStarters" id="convoStartersBtn" style="width: 100%; padding: 0.6rem; font-size: 0.75rem; justify-content: center; flex: 1; min-width: 130px;">
    Ice Breakers
  </button>
  
  <button class="btn-primary" id="gtmPlanBtn" data-action="openSalesPlan" style="display: none; width: 100%; padding: 0.6rem; font-size: 0.75rem; justify-content: center; flex: 1; min-width: 130px;">
    GTM Plan
  </button>
  
  <button class="btn-primary" id="pipelineBtn" data-action="openPipelineBuilder" style="display: none; width: 100%; padding: 0.6rem; font-size: 0.75rem; justify-content: center; flex: 1; min-width: 130px;">
    Pipeline Builder
  </button>
      </div>

      <div id="recompetesList" style="margin-bottom: 1.5rem;"></div>

      <div class="section-header">
        <div class="section-title-group">
          <span class="section-title">Recent Awards</span>
        </div>
      </div>
      <div id="feedGrid" class="feed-grid"></div>

      <div id="subawardWrapper" style="display: none;">      
        <div style="margin-top: 1.5rem;">
          <div id="subcontractingPanel" style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; padding: 0.75rem; overflow: hidden;">
            <div id="subcontractingStats" style="margin-bottom: 1rem;">
  <div id="subSankeySubtitle" style="font-family: 'JetBrains Mono', monospace; font-size: 0.6rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 0.5rem;">Top 100 Subcontracts Â· Individual Transaction Value</div>
  <div style="display: flex; align-items: baseline; gap: 1.5rem; flex-wrap: wrap;">
    <div id="sub-stat-vol" style="font-family: 'JetBrains Mono', monospace; font-size: clamp(1.75rem, 5vw, 2.5rem); font-weight: 800; color: var(--text-primary); line-height: 1;">-</div>
    
    <div style="display: flex; gap: 1.25rem; align-items: baseline; flex-wrap: wrap; margin-left: 0.5rem; padding-left: 1.5rem; border-left: 1px solid var(--border);">
      <div style="display: flex; align-items: baseline; gap: 0.35rem;">
        <span id="sub-stat-primes" style="font-family: 'JetBrains Mono', monospace; font-size: 1rem; font-weight: 700; color: var(--text-primary);">-</span>
        <span style="font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase;">Primes</span>
      </div>
      <div style="display: flex; align-items: baseline; gap: 0.35rem;">
        <span id="sub-stat-subs" style="font-family: 'JetBrains Mono', monospace; font-size: 1rem; font-weight: 700; color: var(--text-primary);">-</span>
        <span style="font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase;">Subs</span>
      </div>
      <div style="display: flex; align-items: baseline; gap: 0.35rem;">
        <span id="sub-stat-count" style="font-family: 'JetBrains Mono', monospace; font-size: 1rem; font-weight: 700; color: var(--text-primary);">-</span>
        <span style="font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase;">Contracts</span>
      </div>
    </div>
  </div>
</div>
            <div class="chart-wrapper" style="border: none; padding: 0; background: transparent; overflow-x: auto; overflow-y: visible;">
              <div id="subcontractingBody" style="min-height: 350px;"></div>
            </div>
          </div>
        </div>

        <!-- Data Explainer: Subcontracts -->
        <div id="subExplainerBox" style="background: linear-gradient(135deg, rgba(99,102,241,0.08), rgba(99,102,241,0.03)); border: 1px solid rgba(99,102,241,0.2); border-radius: 8px; padding: 1rem 1.25rem; margin-top: 1rem; display: none;">
          <div style="display: flex; align-items: flex-start; gap: 0.75rem;">
            <div style="flex: 1; font-size: 0.75rem; color: var(--text-muted); line-height: 1.6;">
              <strong style="color: var(--text-primary); font-size: 0.8rem;">How to read these numbers</strong><br>
              This shows subcontracting activity matching your search from the past 12 months. Unlike prime contracts, the dollar amounts here represent <strong style="color: var(--text-primary);">individual subcontract transactions</strong>, rather than cumulative obligations over the life of the contract.<br><br>
              
              <strong style="color: var(--text-primary);">What to look for:</strong> The chart maps how funds flow from the agency, through the Prime contractor, down to the Subcontractor. A thick line between a specific Prime and Subcontractor indicates an established teaming relationship for this type of work. <em>(Note: Click any bar to filter the view down to a specific company).</em><br><br>
              
              <strong style="color: var(--text-primary);">How to use this:</strong> This view reveals who is actually executing the work on the ground. Use it to see which Primes actively use subcontractors in your market, see who they already prefer to team with, and identify potential partners for your own pipeline.
            </div>
          </div>
        </div>

        <!-- Subaward Bubble Chart (synced with subaward Sankey drill state) -->
        <div id="subBubblePanel" style="display: none; margin-top: 1rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; padding: 1.25rem; overflow: hidden;">
          <div style="margin-bottom: 1rem;">
            <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 0.5rem;">
              <div id="subBubbleSubtitle" style="font-family: 'JetBrains Mono', monospace; font-size: 0.6rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1.5px;">Top Primes & Subcontractors Â· Individual Transaction Value</div>
              <div class="bubble-toggle-row" style="margin-bottom: 0;">
                <button class="bubble-toggle-btn active" onclick="App.setSubBubbleMode('primes')" id="subBubbleTogglePrimes">Primes</button>
                <button class="bubble-toggle-btn" onclick="App.setSubBubbleMode('subs')" id="subBubbleToggleSubs">Subs</button>
              </div>
            </div>
            <div style="display: flex; align-items: baseline; gap: 1.5rem; flex-wrap: wrap;">
              <div id="sub-bubble-stat-vol" style="font-family: 'JetBrains Mono', monospace; font-size: clamp(1.75rem, 5vw, 2.5rem); font-weight: 800; color: var(--text-primary); line-height: 1;">-</div>
              <div style="display: flex; gap: 1.25rem; align-items: baseline; flex-wrap: wrap; margin-left: 0.5rem; padding-left: 1.5rem; border-left: 1px solid var(--border);">
                <div style="display: flex; align-items: baseline; gap: 0.35rem;">
                  <span id="sub-bubble-stat-primes" style="font-family: 'JetBrains Mono', monospace; font-size: 1rem; font-weight: 700; color: var(--text-primary);">-</span>
                  <span style="font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase;">Primes</span>
                </div>
                <div style="display: flex; align-items: baseline; gap: 0.35rem;">
                  <span id="sub-bubble-stat-subs" style="font-family: 'JetBrains Mono', monospace; font-size: 1rem; font-weight: 700; color: var(--text-primary);">-</span>
                  <span style="font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase;">Subs</span>
                </div>
                <div style="display: flex; align-items: baseline; gap: 0.35rem;">
                  <span id="sub-bubble-stat-records" style="font-family: 'JetBrains Mono', monospace; font-size: 1rem; font-weight: 700; color: var(--text-primary);">-</span>
                  <span style="font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase;">Contracts</span>
                </div>
                
              </div>
            </div>
          </div>
          <!-- Subaward bubble breadcrumb -->
          <div id="subBubbleBreadcrumb" style="display:none; margin-bottom: 0.75rem; padding: 0.5rem 0.75rem; background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 6px; font-size: 0.7rem; overflow-x: auto;">
            <div id="subBubbleBreadcrumbInner" style="display: flex; align-items: center; gap: 0.35rem; flex-wrap: wrap;"></div>
          </div>
          <div id="subBubbleContainer" style="width: 100%; min-height: 380px; position: relative;">
            <div class="bubble-tooltip" id="subBubbleTooltip"></div>
          </div>
          <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid var(--border); font-size: 0.6rem; color: var(--text-muted);">
            <span><i class="fas fa-circle" style="color: var(--accent); font-size: 0.5rem;"></i> Bubble size = subaward value Â· Click to drill</span>
            <span style="font-family: 'JetBrains Mono', monospace;"><span style="color: var(--accent);">>_</span>Govhoo.com</span>
          </div>
        </div>

      </div>

      <div id="subConvoStartersPanel" style="margin: 1.5rem 0; padding: 1.25rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; display: none; align-items: center; justify-content: space-between; gap: 1rem;">
  <button class="convo-starters-btn" data-action="openSubConvoStarters" id="subConvoStartersBtn">
    Conversation Starters
  </button>
</div>

<div id="searchSubcontractPanel" style="margin: 1.5rem 0; padding: 0;">
  <div class="intel-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
    
    <div>
      <div class="section-header" style="margin: 0 0 0.75rem 0;">
        <div class="section-title-group">
          <span class="section-title mono bold upper text-xs" style="color: var(--info);">Primes</span>
        </div>
      </div>
      <div class="analysis-panel" style="min-height: auto;">
        <div class="analysis-panel-body" id="searchTopPrimesBody" style="padding: 0.75rem;">
          <div class="muted text-xs" style="text-align:center;">Primes subcontracting work will appear here</div>
        </div>
      </div>
    </div>
    
    <div>
      <div class="section-header" style="margin: 0 0 0.75rem 0;">
        <div class="section-title-group">
          <span class="section-title mono bold accent upper text-xs">Subs</span>
        </div>
      </div>
      <div class="analysis-panel" style="min-height: auto;">
        <div class="analysis-panel-body" id="searchTopSubsBody" style="padding: 0.75rem;">
          <div class="muted text-xs" style="text-align:center;">Subcontractors receiving work will appear here</div>
        </div>
      </div>
    </div>
    
  </div>
</div>

      <div id="subFeedWrapper" style="display: none; margin-top: 1.5rem;">
        <div class="section-header">
          <div class="section-title-group">
            <span class="section-title">Recent Subcontracts</span>
          </div>
        </div>
        <div id="subFeedGrid" class="feed-grid"></div>
      </div>

    </div> </div>
</div>
<div id="loader" class="loader">
  <div class="spinner"></div>
  <p id="loaderText" style="margin-top:1rem; font-family:'JetBrains Mono'; color:var(--accent);">RETRIEVING DATA...</p>
  <p id="loaderSubtext" style="color:var(--text-subtle); font-size:0.8rem; margin-top:0.5rem;"></p>
</div>

<div id="salesPlanModal" class="channel-marking-modal">
  <div class="channel-modal-content" style="max-width: 900px;">
    <div class="channel-modal-header">
      <div class="channel-modal-title"><span class="sub-bullet orange"><i class="fas fa-rocket"></i></span> GTM PLAN PROMPT</div>
      <button class="channel-modal-close" data-action="closeSalesPlan"><i class="fas fa-times"></i></button>
    </div>
    
    <div class="channel-modal-body" style="flex:1; overflow-y:auto; padding:0;">
      
      <div id="spIntentBanner"></div>
      
      <div class="modal-step-section">
        <div class="modal-step-label">
         Step 1: Define Plan Scope
        </div>
        <div class="modal-step-grid step-grid">
          <div>
            <label class="modal-form-label">
              PLAN SCOPE / SECTOR
            </label>
            <select id="spScope" class="main-input modal-select">
              <option value="all">Entire Market (All Results)</option>
              <option value="defense">Defense (DoD & Branches)</option>
              <option value="civilian">Federal Civilian (Non-DoD)</option>
              <optgroup label="Specific Agencies" id="spSpecificAgencies"></optgroup>
            </select>
          </div>
          <div>
            <label class="modal-form-label">
              STRATEGIC GOAL
              <span style="cursor:help; margin-left:4px;" title="Growth = New business pursuit&#10;Retention = Defend existing contracts&#10;Partnership = Channel/partner optimization">â“˜</span>
            </label>
            <select id="spFocus" class="main-input modal-select">
              <option value="Growth">Aggressive Growth (New Business)</option>
              <option value="Retention">Retention (Defend Incumbency)</option>
              <option value="Partnership">Partner/Channel Strategy</option>
            </select>
          </div>
        </div>
      </div>

      <div class="modal-body-section">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
          <div class="modal-step-label" style="margin-bottom:0;">
            Step 2: Classify Vendors
          </div>
          <div id="spBulkActionContainer"></div>
        </div>
        


        <div id="spVendorList"></div>
      </div>
      
      <div id="spPreviewSection" style="display:none; border-top: 1px solid var(--border);">
        <div class="modal-step-section" style="padding: 1rem 1.5rem;">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:0.75rem;">
            <div class="modal-step-label" style="margin-bottom:0;">
              <i class="fas fa-eye"></i> Prompt Preview
            </div>
            <span style="font-size:0.7rem; color:var(--text-muted); font-family:'JetBrains Mono',monospace;" id="spPreviewStats"></span>
          </div>
          <pre id="spPreviewContent" style="background:var(--bg-app); border:1px solid var(--border); border-radius:4px; padding:1rem; font-size:0.75rem; color:var(--text-muted); font-family:'JetBrains Mono',monospace; max-height:300px; overflow-y:auto; white-space:pre-wrap; word-wrap:break-word; line-height:1.5;"></pre>
        </div>
      </div>
    </div>

    <div class="channel-modal-footer">
      <div class="modal-footer-buttons">
        <button id="btnCopyPrompt" class="modal-btn modal-btn-primary" data-action="copyPrompt">
          <i class="fas fa-copy"></i> Copy Prompt
        </button>
        <div class="modal-footer-secondary">
          <button class="modal-btn modal-btn-secondary" onclick="SalesPlanManager.togglePreview()" title="Preview the prompt before copying">
            <i class="fas fa-eye"></i> Preview
          </button>
          <button class="modal-btn modal-btn-secondary" data-action="generateDownload" title="Save prompt as a .txt file for offline use">
            <i class="fas fa-download"></i> Save
          </button>
          <button class="modal-btn modal-btn-cancel" data-action="closeSalesPlan">Cancel</button>
        </div>
      </div>
      <div id="spDataStatus" class="modal-status-line"></div>
    </div>
  </div>
</div>

<div id="pipelineBuilderModal" class="pipeline-modal">
  <div class="pipeline-modal-content">
    <div class="channel-modal-header">
      <div class="channel-modal-title"><span class="sub-bullet"><i class="fas fa-chart-line"></i></span> ANNUAL PIPELINE BUILDER</div>
      <button class="channel-modal-close" data-action="closePipelineBuilder"><i class="fas fa-times"></i></button>
    </div>
    
    <div class="channel-modal-body" style="flex:1; overflow-y:auto; padding:1.5rem;">
      <div class="modal-info-box success">
        <strong><i class="fas fa-info-circle" style="color:var(--success);"></i> How it works:</strong> 
        This tool analyzes historical USAspending data to identify cyclic spending patterns and generates pipeline opportunities for the upcoming fiscal year. Defaults are tuned for most searches â€” just hit Generate, then adjust if needed.
      </div>
      
      <div class="pipeline-config-row">
        <div class="pipeline-config-item">
          <label>Target Fiscal Year</label>
          <select id="pipelineTargetFY"></select>
        </div>
        <div class="pipeline-config-item">
          <label>Historical Years to Analyze</label>
          <select id="pipelineHistoryYears">
            <option value="2">2 Years</option>
            <option value="3" selected>3 Years</option>
            <option value="4">4 Years</option>
            <option value="5">5 Years</option>
          </select>
        </div>
        <div class="pipeline-config-item">
          <label>Probability Multiplier</label>
          <select id="pipelineProbMultiplier">
            <option value="0.5">Conservative (50%)</option>
            <option value="0.7" selected>Moderate (70%)</option>
            <option value="0.9">Aggressive (90%)</option>
            <option value="1.0">Full Historical (100%)</option>
          </select>
        </div>
      </div>
      
      <div class="pipeline-config-row">
        <div class="pipeline-config-item">
          <label>Minimum Deal Size</label>
          <select id="pipelineMinDeal">
            <option value="0">No Minimum</option>
            <option value="25000">$25K+</option>
            <option value="50000" selected>$50K+</option>
            <option value="100000">$100K+</option>
            <option value="250000">$250K+</option>
            <option value="500000">$500K+</option>
            <option value="1000000">$1M+</option>
          </select>
        </div>
        <div class="pipeline-config-item">
          <label>Focus Agency (Optional)</label>
          <select id="pipelineFocusAgency">
            <option value="">All Agencies in Results</option>
          </select>
        </div>
      </div>
      
      <button class="pipeline-builder-btn" style="width:100%; padding: 0.85rem; font-size: 0.85rem; margin-top: 0.75rem;" data-action="generatePipeline">
        <i class="fas fa-magic"></i> Generate Pipeline
      </button>
      
      <div id="pipelineResultsArea" style="display:none;">
        <div style="display:flex; align-items:baseline; gap:1rem; margin:1.5rem 0 1rem 0; flex-wrap:wrap;">
          <span id="pipelineResultCount" style="font-family:'JetBrains Mono',monospace; font-size:clamp(1.5rem, 4vw, 2rem); font-weight:800; color:var(--text-primary); line-height:1;"></span>
          <span style="font-family:'JetBrains Mono',monospace; font-size:0.7rem; color:var(--text-muted); text-transform:uppercase; letter-spacing:1px;">opportunities ready for Salesforce</span>
        </div>
        
        <div id="pipelineStatsGrid" class="pipeline-results-grid"></div>
        <div id="pipelineTableContainer" class="pipeline-table-wrapper"></div>
      </div>
      
      <div id="pipelineLoading" class="pipeline-progress" style="display:none;">
        <div class="spinner"></div>
        <span>Analyzing historical spending patterns...</span>
      </div>
    </div>
    
    <div class="channel-modal-footer">
      <div class="modal-footer-buttons">
        <button id="btnDownloadPipeline" class="modal-btn modal-btn-primary" data-action="downloadPipelineCSV" style="background:var(--success);" disabled>
          <i class="fas fa-download"></i> Download CSV
        </button>
        <div class="modal-footer-secondary">
          <button class="modal-btn modal-btn-cancel" data-action="closePipelineBuilder">Close</button>
        </div>
      </div>
      <div id="pipelineDataStatus" class="modal-status-line">Configure options and click Generate to build your pipeline.</div>
    </div>
  </div>
</div>

<div id="convoStartersModal" class="convo-modal">
  <div class="convo-modal-content">
    <div class="channel-modal-header">
      <div class="channel-modal-title"><span class="sub-bullet blue"><i class="fas fa-comments"></i></span> CONVERSATION STARTERS</div>
      <button class="channel-modal-close" data-action="closeConvoStarters"><i class="fas fa-times"></i></button>
    </div>
    
    <div class="channel-modal-body" style="flex:1; overflow-y:auto; padding:1.25rem;">
      <div class="convo-focus-toggle">
        <button class="convo-focus-btn active" data-convo-focus="agencies" onclick="ConvoStarters.setFocus('agencies')">
          <span class="sub-bullet sm blue"><i class="fas fa-landmark"></i></span> Agencies
        </button>
        <button class="convo-focus-btn" data-convo-focus="vendors" onclick="ConvoStarters.setFocus('vendors')">
          <span class="sub-bullet sm"><i class="fas fa-building"></i></span> Vendors
        </button>
        <button class="convo-focus-btn" data-convo-focus="both" onclick="ConvoStarters.setFocus('both')">
          <span class="sub-bullet sm gray"><i class="fas fa-users"></i></span> Both
        </button>
      </div>
      
      <div id="convoResultsArea" class="convo-results-scroll">
        <div class="convo-empty">
          <i class="fas fa-spinner fa-spin"></i>
          <p>Generating talking points...</p>
        </div>
      </div>
    </div>
    
    <div class="channel-modal-footer">
      <div class="modal-footer-buttons">
        <button class="modal-btn modal-btn-primary" data-action="copyAllConvo" style="background: var(--info);">
          <i class="fas fa-copy"></i> Copy
        </button>
        <button class="modal-btn modal-btn-primary" data-action="downloadConvoPDF" style="background: var(--accent);" title="Save as .txt to AirDrop or email to your phone before the event">
          <i class="fas fa-mobile-alt"></i> Download
        </button>
        <div class="modal-footer-secondary">
          <button class="modal-btn modal-btn-cancel" data-action="closeConvoStarters">Close</button>
        </div>
      </div>
      <div id="convoDataStatus" class="modal-status-line">Based on <span id="convoAwardCount">0</span> awards from your search.</div>
    </div>
  </div>
</div>
<script>
const US_STATES={AL:"Alabama",AK:"Alaska",AZ:"Arizona",AR:"Arkansas",CA:"California",CO:"Colorado",CT:"Connecticut",DE:"Delaware",FL:"Florida",GA:"Georgia",HI:"Hawaii",ID:"Idaho",IL:"Illinois",IN:"Indiana",IA:"Iowa",KS:"Kansas",KY:"Kentucky",LA:"Louisiana",ME:"Maine",MD:"Maryland",MA:"Massachusetts",MI:"Michigan",MN:"Minnesota",MS:"Mississippi",MO:"Missouri",MT:"Montana",NE:"Nebraska",NV:"Nevada",NH:"New Hampshire",NJ:"New Jersey",NM:"New Mexico",NY:"New York",NC:"North Carolina",ND:"North Dakota",OH:"Ohio",OK:"Oklahoma",OR:"Oregon",PA:"Pennsylvania",RI:"Rhode Island",SC:"South Carolina",SD:"South Dakota",TN:"Tennessee",TX:"Texas",UT:"Utah",VT:"Vermont",VA:"Virginia",WA:"Washington",WV:"West Virginia",WI:"Wisconsin",WY:"Wyoming",DC:"Washington DC",PR:"Puerto Rico",GU:"Guam",VI:"Virgin Islands"},LibLoader={d3Loaded:!1,loading:{d3:null},async loadD3(){return this.d3Loaded&&window.d3&&window.d3.sankey?Promise.resolve():(this.loading.d3||(this.loading.d3=new Promise(((e,t)=>{const n=document.createElement("script");n.src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js",n.onload=()=>{const n=document.createElement("script");n.src="https://cdnjs.cloudflare.com/ajax/libs/d3-sankey/0.12.3/d3-sankey.min.js",n.onload=()=>{this.d3Loaded=!0,e()},n.onerror=t,document.head.appendChild(n)},n.onerror=t,document.head.appendChild(n)}))),this.loading.d3)},async ensureAll(){await this.loadD3()},preloadWhenIdle(){"requestIdleCallback"in window?requestIdleCallback((()=>this.ensureAll()),{timeout:2e3}):setTimeout((()=>this.ensureAll()),100)}},Utils={copyDealToClipboard(e,t){const n=App.searchData.active[e];if(!n)return;const a=n.generated_internal_id;let r="";a&&(r=`https://www.usaspending.gov/award/${a}`);const s=VehicleDetector.detect(n["Award ID"]),o=VehicleDetector.getSetAsideLabel(n["Type of Set Aside"]),i=[`Agency: ${n["Awarding Agency"]||"N/A"}`,n["Awarding Sub Agency"]&&n["Awarding Sub Agency"]!==n["Awarding Agency"]?`Sub-Agency: ${n["Awarding Sub Agency"]}`:null,`Vendor: ${n["Recipient Name"]||"N/A"}`,`Total Obligations: ${Utils.money(n["Award Amount"])}${n["Start Date"]?" (since "+n["Start Date"].substring(0,4)+")":""}`,`Description: ${(n.Description||"N/A").substring(0,200)}`,`Start: ${n["Start Date"]||"N/A"}`,`End: ${n["End Date"]||"N/A"}`,n["Award ID"]?`Award ID: ${n["Award ID"]}`:null,s?`Vehicle: ${s.vehicle}`:null,o?`Set-Aside: ${o}`:null,n["NAICS Code"]?`NAICS: ${n["NAICS Code"]} - ${n["NAICS Description"]||""}`:null,n["PSC Code"]?`PSC: ${n["PSC Code"]} - ${n["PSC Description"]||""}`:null,r?`Link: ${r}`:null].filter(Boolean).join("\n");navigator.clipboard.writeText(i).then((()=>{t&&(t.innerHTML='<i class="fas fa-check"></i>',t.style.color="var(--accent)",setTimeout((()=>{t.innerHTML='<i class="fas fa-copy"></i>',t.style.color=""}),1500))}))},copySubDealToClipboard(e,t){try{const n=JSON.parse(decodeURIComponent(e)),a=n.prime_award_generated_internal_id?`https://www.usaspending.gov/award/${n.prime_award_generated_internal_id}`:"",r=["Type: Subcontract",`Agency: ${n["Awarding Agency"]||"N/A"}`,`Prime: ${n["Prime Recipient Name"]||"N/A"}`,`Subcontractor: ${n["Sub-Awardee Name"]||"N/A"}`,`Amount: ${Utils.money(parseFloat(n["Sub-Award Amount"])||0)}`,`Date: ${n["Sub-Award Date"]||"N/A"}`,a?`Prime Award: ${a}`:null].filter(Boolean).join("\n");navigator.clipboard.writeText(r).then((()=>{t&&(t.innerHTML='<i class="fas fa-check"></i>',t.style.color="var(--accent)",setTimeout((()=>{t.innerHTML='<i class="fas fa-copy"></i>',t.style.color=""}),1500))}))}catch(e){console.error("Copy failed",e)}},copyRecompeteToClipboard(e,t,n,a,r,s,o,i,l,c,d,p,u,m,g){const h=VehicleDetector.detect(l),y=VehicleDetector.getSetAsideLabel(m),b=["EXPIRING CONTRACT",`Agency: ${t||"N/A"}`,n&&n!==t?`Sub-Agency: ${n}`:null,`Incumbent: ${a||"N/A"}`,`Amount: ${r}`,`Description: ${s||"N/A"}`,`Start: ${o||"N/A"}`,`Expires: ${i||"N/A"}`,l?`Award ID: ${l}`:null,h?`Vehicle: ${h.vehicle}`:null,y?`Set-Aside: ${y}`:null,p?`NAICS: ${p} - ${u||""}`:null,c?`PSC: ${c} - ${d||""}`:null,g?`Link: ${g}`:null].filter(Boolean).join("\n");navigator.clipboard.writeText(b).then((()=>{e&&(e.innerHTML='<i class="fas fa-check"></i>',e.style.color="var(--accent)",setTimeout((()=>{e.innerHTML='<i class="fas fa-copy"></i>',e.style.color=""}),1500))}))},money:e=>e||0===e?e>=1e9?"$"+(e/1e9).toFixed(1)+"B":e>=1e6?"$"+(e/1e6).toFixed(1)+"M":e>=1e3?"$"+(e/1e3).toFixed(0)+"K":"$"+Math.round(e).toLocaleString():"-",trunc:(e,t)=>e&&e.length>t?e.substring(0,t)+"...":e||"No Description",date:e=>e?new Date(e).toLocaleDateString():"â€”",formatDateISO:e=>e.toISOString().split("T")[0],getCurrentFY:()=>{const e=new Date;return e.getMonth()>=9?e.getFullYear()+1:e.getFullYear()},getCurrentQuarter:()=>{const e=(new Date).getMonth();return e>=9?1:e<=2?2:e<=5?3:4},getColor:(()=>{const e=["#466D5C","#7B6D8D","#5B7C99","#E07A5F","#D98895","#3D405B","#F2E8CF","#81B29A","#778DA9","#606C38"],t=new Map;let n=0;const a=a=>a?a.includes("Other")||a.includes("Unknown")?"#353A40":(t.has(a)||t.set(a,n++),e[t.get(a)%e.length]):"#4A4A4A";return a.reset=()=>{t.clear(),n=0},a})(),queryAliases:{aws:"Amazon",gcp:"Google Cloud",msft:"Microsoft",ibm:"International Business Machines",hp:"Hewlett Packard",hpe:"Hewlett Packard Enterprise",dell:"Dell Technologies",gd:"General Dynamics",gdit:"General Dynamics Information Technology",lmco:"Lockheed Martin",ngc:"Northrop Grumman",bah:"Booz Allen Hamilton",saic:"Science Applications International",dod:"Department of Defense",doj:"Department of Justice",dhs:"Department of Homeland Security",hhs:"Health and Human Services",dot:"Department of Transportation",doe:"Department of Energy",doi:"Department of the Interior",dol:"Department of Labor",doc:"Department of Commerce",dos:"Department of State",ed:"Department of Education",hud:"Housing and Urban Development",usda:"Department of Agriculture",va:"Veterans Affairs",army:"Department of the Army",navy:"Department of the Navy",usaf:"Department of the Air Force",ussf:"Space Force",usmc:"Marine Corps",cia:"Central Intelligence Agency",nsa:"National Security Agency",nga:"National Geospatial-Intelligence Agency",nro:"National Reconnaissance Office",dia:"Defense Intelligence Agency",disa:"Defense Information Systems Agency",darpa:"Defense Advanced Research Projects Agency",dcsa:"Defense Counterintelligence and Security Agency",dla:"Defense Logistics Agency",mda:"Missile Defense Agency",socom:"Special Operations Command",cybercom:"Cyber Command",stratcom:"Strategic Command",transcom:"Transportation Command",centcom:"Central Command",eucom:"European Command",indopacom:"Indo-Pacific Command",northcom:"Northern Command",southcom:"Southern Command",africom:"Africa Command",gsa:"General Services Administration",nasa:"National Aeronautics and Space Administration",fbi:"Federal Bureau of Investigation",dea:"Drug Enforcement Administration",atf:"Bureau of Alcohol Tobacco Firearms and Explosives",usps:"Postal Service",irs:"Internal Revenue Service",epa:"Environmental Protection Agency",fda:"Food and Drug Administration",cdc:"Centers for Disease Control and Prevention",nih:"National Institutes of Health",cms:"Centers for Medicare and Medicaid Services",ssa:"Social Security Administration",opm:"Office of Personnel Management",sba:"Small Business Administration",fema:"Federal Emergency Management Agency",tsa:"Transportation Security Administration",cbp:"Customs and Border Protection",ice:"Immigration and Customs Enforcement",uscis:"Citizenship and Immigration Services",usss:"Secret Service",cisa:"Cybersecurity and Infrastructure Security Agency",faa:"Federal Aviation Administration",fhwa:"Federal Highway Administration",fra:"Federal Railroad Administration",fta:"Federal Transit Administration",noaa:"National Oceanic and Atmospheric Administration",nist:"National Institute of Standards and Technology",census:"Census Bureau",ita:"International Trade Administration",blm:"Bureau of Land Management",nps:"National Park Service",usfs:"Forest Service",fws:"Fish and Wildlife Service",usgs:"Geological Survey",bia:"Bureau of Indian Affairs",boem:"Bureau of Ocean Energy Management",bor:"Bureau of Reclamation",ferc:"Federal Energy Regulatory Commission",nnsa:"National Nuclear Security Administration",sec:"Securities and Exchange Commission",ftc:"Federal Trade Commission",fcc:"Federal Communications Commission",nlrb:"National Labor Relations Board",eeoc:"Equal Employment Opportunity Commission",gao:"Government Accountability Office",omb:"Office of Management and Budget",cbo:"Congressional Budget Office",nara:"National Archives and Records Administration",pbgc:"Pension Benefit Guaranty Corporation",usaid:"Agency for International Development",amtrak:"Amtrak",fdic:"Federal Deposit Insurance Corporation",ncua:"National Credit Union Administration",cfpb:"Consumer Financial Protection Bureau",exim:"Export-Import Bank"},normalizeQuery(e){const t=e.toLowerCase().trim();return this.queryAliases[t]||e},missionGapRisk(e){const t=new Date(e["End Date"]),n=Math.ceil((t-new Date)/864e5),a=parseFloat(e["Award Amount"])||0,r=(e.Description||"").toLowerCase(),s=(e["PSC Description"]||"").toLowerCase(),o=(e["NAICS Description"]||"").toLowerCase(),i=(e["PSC Code"]||"").toUpperCase(),l=`${r} ${s} ${o}`,c=["operations","o&m","maintenance","sustainment","help desk","service desk","support services","managed services","hosting","cloud","network","cyber","security","monitoring","soc","continuity","backup","dr","patch","infrastructure","enterprise","mission","critical","24/7","production"].filter((e=>l.includes(e))),d=c.length>=2,p=["D","R","J"].includes(i.slice(0,1));return n<=180&&(d||p)&&a>=25e4?{level:"high",daysUntil:n,reasons:c.slice(0,4)}:n<=365&&(d||p)&&a>=1e5?{level:"medium",daysUntil:n,reasons:c.slice(0,3)}:{level:"low",daysUntil:n,reasons:c.slice(0,2)}},parseSearchTerms(e){const t=/^[A-Z]\d{1,3}$|^\d{1,2}[A-Z]\d{0,2}$/i,n=/^\d{6}$/,a=e.split(",").map((e=>e.trim())).filter((e=>e.length>0));return{pscCodes:a.filter((e=>t.test(e))).map((e=>e.toUpperCase())),naicsCodes:a.filter((e=>n.test(e))),keywordTerms:a.filter((e=>!t.test(e)&&!n.test(e))),allTerms:a}},buildFilters(e,t){const{pscCodes:n,naicsCodes:a,keywordTerms:r}=this.parseSearchTerms(e),s={time_period:t,award_type_codes:["A","B","C","D"]};return n.length>0&&(s.psc_codes=n),a.length>0&&(s.naics_codes=a),r.length>0&&(s.keywords=r),s.psc_codes||s.naics_codes||s.keywords||(s.keywords=[e]),s}},ModalUtils={activeModal:null,previousFocus:null,_boundKeydown:null,_boundClick:null,open(e){const t=document.getElementById(e);if(!t)return;this.activeModal&&this.activeModal!==t&&this.close(),this.previousFocus=document.activeElement,document.body.style.overflow="hidden",requestAnimationFrame((()=>{t.classList.add("active")})),this.activeModal=t;const n=t.querySelector("input, select, textarea, button:not(.modal-close)");n&&setTimeout((()=>{n.focus({preventScroll:!0})}),50),this._boundKeydown=this.handleKeydown.bind(this),this._boundClick=this.handleClick.bind(this),document.addEventListener("keydown",this._boundKeydown),t.addEventListener("click",this._boundClick)},close(){if(!this.activeModal)return;const e=this.activeModal;e.classList.remove("active"),document.body.style.overflow="",document.removeEventListener("keydown",this._boundKeydown),e.removeEventListener("click",this._boundClick),this.previousFocus&&"function"==typeof this.previousFocus.focus&&this.previousFocus.focus({preventScroll:!0}),this.activeModal=null,this.previousFocus=null},handleClick(e){e.target!==this.activeModal?(e.target.closest(".modal-close")||e.target.closest(".modal-btn-cancel"))&&this.close():this.close()},handleKeydown(e){if("Escape"!==e.key){if("Tab"===e.key&&this.activeModal){const t=this.activeModal.querySelectorAll('button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])');if(0===t.length)return;const n=t[0],a=t[t.length-1];e.shiftKey&&document.activeElement===n?(e.preventDefault(),a.focus()):e.shiftKey||document.activeElement!==a||(e.preventDefault(),n.focus())}}else this.close()}},VehicleDetector={patterns:[{prefix:/^GS-35F/i,vehicle:"GSA Schedule",short:"GSA"},{prefix:/^GS-00F/i,vehicle:"GSA Schedule",short:"GSA"},{prefix:/^GS-07F/i,vehicle:"GSA Schedule",short:"GSA"},{prefix:/^GS-\d{2}F/i,vehicle:"GSA Schedule",short:"GSA"},{prefix:/^47Q[A-Z]{2}A/i,vehicle:"OASIS+",short:"OASIS+"},{prefix:/^47QTCA/i,vehicle:"OASIS",short:"OASIS"},{prefix:/^47QTCK/i,vehicle:"OASIS SB",short:"OASIS SB"},{prefix:/^GS-06F/i,vehicle:"ALLIANT 2",short:"ALLIANT"},{prefix:/^HC102[89]/i,vehicle:"CIO-SP3",short:"CIO-SP3"},{prefix:/^HC1013/i,vehicle:"CIO-SP4",short:"CIO-SP4"},{prefix:/^W15QKN/i,vehicle:"Army ITES",short:"ITES"},{prefix:/^W52P1J/i,vehicle:"Army CHESS",short:"CHESS"},{prefix:/^FA870[12]/i,vehicle:"NETCENTS",short:"NETCENTS"},{prefix:/^N0017[89]/i,vehicle:"SeaPort",short:"SEAPORT"},{prefix:/^N00189/i,vehicle:"SeaPort-NxG",short:"SEAPORT"},{prefix:/^47QFCA/i,vehicle:"8(a) STARS III",short:"STARS III"},{prefix:/^47QFSA/i,vehicle:"8(a) STARS III",short:"STARS III"},{prefix:/^HHSN/i,vehicle:"NIH CIO-SP",short:"NIH"},{prefix:/^75N98/i,vehicle:"NIH NITAAC",short:"NITAAC"},{prefix:/^VA118/i,vehicle:"VA T4NG",short:"T4NG"},{prefix:/^36C10X/i,vehicle:"VA VETS 2",short:"VETS 2"}],detect(e){if(!e)return null;for(const t of this.patterns)if(t.prefix.test(e))return t;return null},setAsideLabels:{SBA:"8(a)","8A":"8(a)","8AN":"8(a)",HZC:"HUBZone",HZS:"HUBZone",WOSB:"WOSB",EDWOSB:"EDWOSB",SDVOSBC:"SDVOSB",SDVOSBS:"SDVOSB",SBP:"Small Biz",SMP:"Small Biz",VSA:"VOSB",VSB:"VOSB",HS2:"HUBZone SB",HS3:"HUBZone/8(a)",ISBEE:"Econ. Disadv.",IEE:"Econ. Disadv."},getSetAsideLabel(e){return e?this.setAsideLabels[e]||(e.length<=10?e:null):null}},VendorRelationships={_map:{},get(e){return this._map[e.toUpperCase()]||null},cycle(e){const t=e.toUpperCase(),n=[null,"mine","partner","competitor"],a=this._map[t]||null,r=n.indexOf(a),s=n[(r+1)%n.length];return s?this._map[t]=s:delete this._map[t],s},getIcon:e=>"mine"===e?{icon:"fas fa-building",color:"var(--accent)",label:"My Company",bg:"rgba(95,128,85,0.15)"}:"partner"===e?{icon:"fas fa-handshake",color:"var(--info)",label:"Partner",bg:"rgba(141,160,203,0.15)"}:"competitor"===e?{icon:"fas fa-crosshairs",color:"#A64438",label:"Competitor",bg:"rgba(166,68,56,0.15)"}:{icon:"fas fa-tag",color:"var(--text-muted)",label:"Tag vendor",bg:"transparent"},getTagged(){const e={mine:[],partner:[],competitor:[]};return Object.entries(this._map).forEach((([t,n])=>{e[n]&&e[n].push(t)})),e}},Autocomplete={activeInput:null,dropdown:null,debounceTimer:null,selectedIndex:-1,results:{agencies:[],recipients:[]},init(e){const t=document.getElementById(e);if(!t)return;if(!t.parentElement.classList.contains("autocomplete-wrapper")){const e=document.createElement("div");e.className="autocomplete-wrapper",t.parentNode.insertBefore(e,t),e.appendChild(t)}const n=document.createElement("div");n.className="autocomplete-dropdown",n.id=`${e}-dropdown`,t.parentElement.appendChild(n),t.addEventListener("input",(t=>this.handleInput(t,e))),t.addEventListener("keydown",(t=>this.handleKeydown(t,e))),t.addEventListener("focus",(t=>this.handleFocus(t,e))),t.addEventListener("blur",(()=>setTimeout((()=>this.hide(e)),200)))},handleInput(e,t){const n=e.target.value.trim();clearTimeout(this.debounceTimer),n.length<2?this.hide(t):this.debounceTimer=setTimeout((()=>this.search(n,t)),250)},handleFocus(e,t){e.target.value.trim().length>=2&&this.hasResults()&&this.show(t)},handleKeydown(e,t){const n=document.getElementById(`${t}-dropdown`);if(!n||!n.classList.contains("active"))return void("ArrowDown"===e.key&&e.target.value.length>=2&&this.search(e.target.value.trim(),t));const a=n.querySelectorAll(".autocomplete-item");"ArrowDown"===e.key?(e.preventDefault(),this.selectedIndex=Math.min(this.selectedIndex+1,a.length-1),this.updateSelection(a)):"ArrowUp"===e.key?(e.preventDefault(),this.selectedIndex=Math.max(this.selectedIndex-1,0),this.updateSelection(a)):"Enter"===e.key&&this.selectedIndex>=0?(e.preventDefault(),a[this.selectedIndex]?.click()):"Escape"===e.key&&this.hide(t)},updateSelection(e){e.forEach(((e,t)=>{e.classList.toggle("selected",t===this.selectedIndex)})),e[this.selectedIndex]?.scrollIntoView({block:"nearest"})},async search(e,t){try{const[n,a]=await Promise.all([API.autocompleteAgency(e),API.autocompleteRecipient(e)]);this.results={agencies:n,recipients:a},this.selectedIndex=-1,this.render(t)}catch(e){console.error("Autocomplete error:",e)}},hasResults(){return this.results.agencies.length>0||this.results.recipients.length>0},render(e){const t=document.getElementById(`${e}-dropdown`);if(!t)return;const{agencies:n,recipients:a}=this.results;if(!this.hasResults())return t.innerHTML='<div class="autocomplete-empty">No matches found</div>',void this.show(e);let r="";n.length>0&&(r+=`<div class="autocomplete-section">\n        <div class="autocomplete-section-label mono muted upper"><i class="fas fa-landmark"></i> Agencies</div>\n        ${n.slice(0,5).map((e=>`\n          <div class="autocomplete-item" data-type="agency" data-value="${this.escapeHtml(e.subtier_agency?.name||e.toptier_agency?.name||"")}">\n            <i class="fas fa-building muted"></i>\n            <div class="autocomplete-item-text">\n              <div class="autocomplete-item-main truncate">${this.escapeHtml(e.subtier_agency?.name||e.toptier_agency?.name||"Unknown")}</div>\n              ${e.toptier_agency?.name&&e.subtier_agency?.name?`<div class="autocomplete-item-sub muted">${this.escapeHtml(e.toptier_agency.name)}</div>`:""}\n            </div>\n          </div>\n        `)).join("")}\n      </div>`),a.length>0&&(r+=`<div class="autocomplete-section">\n        <div class="autocomplete-section-label mono muted upper"><i class="fas fa-briefcase"></i> Vendors & Keywords</div>\n        ${a.slice(0,5).map((e=>`\n          <div class="autocomplete-item" data-type="recipient" data-value="${this.escapeHtml(e.recipient_name||"")}">\n            <i class="fas fa-briefcase muted"></i>\n            <div class="autocomplete-item-text">\n              <div class="autocomplete-item-main truncate">${this.escapeHtml(e.recipient_name||"Unknown")}</div>\n              ${e.uei?`<div class="autocomplete-item-sub muted">UEI: ${e.uei}</div>`:""}\n            </div>\n          </div>\n        `)).join("")}\n      </div>`),t.innerHTML=r,t.querySelectorAll(".autocomplete-item").forEach((t=>{t.addEventListener("click",(()=>{const n=document.getElementById(e);n&&(n.value=t.dataset.value,n.focus()),this.hide(e)}))})),this.show(e)},show(e){const t=document.getElementById(`${e}-dropdown`);t&&t.classList.add("active")},hide(e){const t=document.getElementById(`${e}-dropdown`);t&&t.classList.remove("active"),this.selectedIndex=-1},escapeHtml:e=>e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"):""},API={baseUrl:"https://api.usaspending.gov/api/v2",async searchAwards(e){const t=new Date,n=new Date;n.setFullYear(t.getFullYear()-1);const a={start_date:Utils.formatDateISO(n),end_date:Utils.formatDateISO(t)},{pscCodes:r,naicsCodes:s,keywordTerms:o}=Utils.parseSearchTerms(e),i=[...r.map((e=>({type:"psc",value:e}))),...s.map((e=>({type:"naics",value:e}))),...o.map((e=>({type:"keyword",value:e})))].map((({type:e,value:t})=>{const n={time_period:[a],award_type_codes:["A","B","C","D"]};return"psc"===e?n.psc_codes=[t]:"naics"===e?n.naics_codes=[t]:n.keywords=[t],fetch(`${this.baseUrl}/search/spending_by_award/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filters:n,fields:["Award ID","Recipient Name","Awarding Agency","Awarding Sub Agency","Award Amount","Description","generated_internal_id","Start Date","End Date","NAICS Code","NAICS Description","PSC Code","PSC Description","Type of Set Aside"],limit:100,sort:"Award Amount",order:"desc"})}).then((e=>e.json()))})),l=await Promise.all(i);let c=[];l.forEach((e=>{e.results&&(c=c.concat(e.results))}));const d=new Map;return c.forEach((e=>{d.has(e["Award ID"])||d.set(e["Award ID"],e)})),Array.from(d.values()).sort(((e,t)=>t["Award Amount"]-e["Award Amount"]))},async getSpendingOverTime(e,t=3){const n=Utils.getCurrentFY(),a=[];for(let e=n-t;e<=n;e++)a.push({start_date:e-1+"-10-01",end_date:`${e}-09-30`});const r=Utils.buildFilters(e,a),s=await fetch(`${this.baseUrl}/search/spending_over_time/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({group:"quarter",filters:r})});return(await s.json()).results||[]},async getAgencyData(e,t=3){const n=Utils.getCurrentFY(),a=[{start_date:n-t-1+"-10-01",end_date:`${n}-09-30`}],r=Utils.buildFilters(e,a),s=await fetch(`${this.baseUrl}/search/spending_by_category/awarding_agency`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({category:"awarding_agency",filters:r,limit:100})});return(await s.json()).results||[]},async getAwardsForForecast(e){const t=new Date,n=new Date;n.setFullYear(t.getFullYear()-1);const a={start_date:Utils.formatDateISO(n),end_date:Utils.formatDateISO(t)},r=Utils.buildFilters(e,[a]),s=await fetch(`${this.baseUrl}/search/spending_by_award/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filters:r,fields:["Award ID","Recipient Name","Description","Start Date","End Date","Award Amount","Potential Total Value of Award","Awarding Agency","Awarding Sub Agency","generated_internal_id","NAICS Code","NAICS Description","PSC Code","PSC Description","Type of Set Aside"],limit:100,sort:"Award Amount",order:"desc"})});return(await s.json()).results||[]},async autocompleteAgency(e){if(!e||e.length<2)return[];const t=await fetch(`${this.baseUrl}/autocomplete/awarding_agency/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({search_text:e,limit:8})});return(await t.json()).results||[]},async fetchOfficesForSubAgency(e){try{const t=await fetch(`${this.baseUrl}/autocomplete/awarding_agency_office/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({search_text:e,limit:50})}),n=await t.json(),a=[];return n.results&&n.results.forEach((t=>{t.subtier_agency&&t.subtier_agency.name===e&&t.subtier_agency.offices&&t.subtier_agency.offices.forEach((e=>{a.push({code:e.code,name:e.name})})),t.toptier_agency&&t.toptier_agency.offices&&t.toptier_agency.offices.forEach((e=>{a.push({code:e.code,name:e.name})})),t.office&&a.push({code:t.office.code,name:t.office.name})})),a}catch(e){return console.error("Error fetching offices:",e),[]}},async autocompleteRecipient(e){if(!e||e.length<2)return[];const t=await fetch(`${this.baseUrl}/autocomplete/recipient/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({search_text:e,limit:8})});return(await t.json()).results||[]},async getSpendingByGeography(e,t="state"){const n=Utils.getCurrentFY(),a=[{start_date:n-1+"-10-01",end_date:`${n}-09-30`}],r=Utils.buildFilters(e,a),s=await fetch(`${this.baseUrl}/search/spending_by_geography/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({scope:"place_of_performance",geo_layer:t,filters:r})});return(await s.json()).results||[]},async getSubawards(e){const t=new Date,n=new Date;n.setFullYear(t.getFullYear()-1);const a={time_period:[{start_date:Utils.formatDateISO(n),end_date:Utils.formatDateISO(t)}],award_type_codes:["A","B","C","D"]},{pscCodes:r,naicsCodes:s,keywordTerms:o}=Utils.parseSearchTerms(e);r.length>0&&(a.psc_codes=r),s.length>0&&(a.naics_codes=s),o.length>0&&(a.keywords=o),a.psc_codes||a.naics_codes||a.keywords||(a.keywords=[e]);const i=await fetch(`${this.baseUrl}/search/spending_by_award/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subawards:!0,filters:a,fields:["Sub-Award ID","Sub-Awardee Name","Sub-Award Amount","Prime Award ID","Prime Recipient Name","Sub-Award Date","Awarding Agency","Awarding Sub Agency","prime_award_generated_internal_id"],limit:100,sort:"Sub-Award Amount",order:"desc"})});return(await i.json()).results||[]}},ForecastEngine={analyze(e,t,n){const a=this.organizeByQuarter(e),r=this.filterOutliers(a),s=this.detectRecompetes(t),o=this.analyzeMarketConcentration(n),i=this.calculateVolatilityMetrics(r);return{recompetes:s,marketStatus:o.level,hhi:o.hhi,byFY:a.byFY,volatility:i}},organizeByQuarter(e){const t={byFY:{},byQuarter:{},totalByFY:{},allAmounts:[]};return e.forEach((e=>{const n=parseInt(e.time_period?.quarter),a=parseInt(e.time_period?.fiscal_year),r=e.aggregated_amount||0;n&&a&&(t.byFY[a]||(t.byFY[a]={1:0,2:0,3:0,4:0}),t.byFY[a][n]=r,t.byQuarter[n]||(t.byQuarter[n]=[]),t.byQuarter[n].push({fy:a,amt:r}),t.totalByFY[a]=(t.totalByFY[a]||0)+r,t.allAmounts.push({fy:a,q:n,amt:r}))})),t},filterOutliers(e){const t={byFY:{},byQuarter:{},totalByFY:{},allAmounts:[]};Object.keys(e.byFY).forEach((e=>t.byFY[e]={}));for(let n=1;n<=4;n++){const a=e.byQuarter[n]||[],r=a.map((e=>e.amt));if(r.length<3){a.forEach((e=>{t.byQuarter[n]=t.byQuarter[n]||[],t.byQuarter[n].push(e),t.byFY[e.fy][n]=e.amt,t.totalByFY[e.fy]=(t.totalByFY[e.fy]||0)+e.amt}));continue}const s=r.reduce(((e,t)=>e+t),0)/r.length,o=r.reduce(((e,t)=>e+Math.pow(t-s,2)),0)/r.length,i=Math.sqrt(o),l=s+2*i;a.forEach((e=>{e.amt<=l&&(t.byQuarter[n]=t.byQuarter[n]||[],t.byQuarter[n].push(e),t.byFY[e.fy][n]=e.amt,t.totalByFY[e.fy]=(t.totalByFY[e.fy]||0)+e.amt)}))}return t},calculateVolatilityMetrics(e){const t=Utils.getCurrentFY(),n=Object.keys(e.totalByFY).map(Number).filter((e=>e<t)).sort();if(n.length<2)return{stdDev:0,coeffVar:0,score:.5};const a=n.map((t=>e.totalByFY[t])),r=a.reduce(((e,t)=>e+t),0)/a.length,s=a.reduce(((e,t)=>e+Math.pow(t-r,2)),0)/(a.length-1),o=Math.sqrt(s),i=r>0?o/r:0;return{stdDev:o,coeffVar:i,score:Math.min(2.5*i,1)}},analyzeMarketConcentration(e){const t=e.reduce(((e,t)=>e+t.amount),0);let n=0,a=0;if(t>0){e.forEach((e=>{const a=e.amount/t*100;n+=a*a}));a=[...e].sort(((e,t)=>t.amount-e.amount)).slice(0,4).reduce(((e,n)=>e+n.amount/t*100),0)}let r="Competitive",s="Low";return n>2500?(r="Concentrated",s="High"):n>1500&&(r="Moderate",s="Medium"),{hhi:Math.round(n),level:r,cr4:Math.round(a),buyerPower:s,agencyCount:e.length}},detectRecompetes(e){const t=new Date,n=new Date;return n.setFullYear(t.getFullYear()+2),e.filter((e=>{const a=new Date(e["End Date"]);return a>t&&a<n&&e["Award Amount"]>5e4})).sort(((e,t)=>new Date(e["End Date"])-new Date(t["End Date"]))).slice(0,15)}},KnownVendors={vars:new Set(["CARAHSOFT TECHNOLOGY CORP","CARAHSOFT TECHNOLOGY CORPORATION","CDW GOVERNMENT LLC","CDW-G","SHI INTERNATIONAL CORP","SHI GOVERNMENT SOLUTIONS","INSIGHT PUBLIC SECTOR INC","INSIGHT DIRECT USA INC","GOVPLACE, LLC","GOVPLACE LLC","IMMIX GROUP INC","IMMIXGROUP INC","DLT SOLUTIONS LLC","DLT SOLUTIONS","THUNDERCAT TECHNOLOGY, LLC","THUNDERCAT TECHNOLOGY LLC","WORLD WIDE TECHNOLOGY LLC","WWT GOVERNMENT SERVICES","PRESIDIO NETWORKED SOLUTIONS","PRESIDIO GOVERNMENT SOLUTIONS","CONNECTION","PC CONNECTION","PCMG INC","EN POINTE TECHNOLOGIES","STERLING COMPUTERS CORPORATION","STERLING COMPUTERS","MERLIN INTERNATIONAL","RED RIVER TECHNOLOGY","MYTHICS INC","MYTHICS LLC","FOUR POINTS TECHNOLOGY","FOUR POINTS TECHNOLOGY LLC","SILOTECH GROUP INC","DECISIVE COMMUNICATIONS INC","FCN INC","FCN, INC.","SOFTCHOICE CORPORATION","SOFTCHOICE","TRACE3","OPTIV SECURITY INC","OPTIV SECURITY","FEDSTORE CORPORATION","FEDSTORE","GOVSMART INC","GOVSMART, INC.","NEW TECH SOLUTIONS","NEW TECH SOLUTIONS, INC.","PANAMERICA COMPUTERS","PANAMERICA COMPUTERS, INC.","SOFTWARE INFORMATION RESOURCE CORP","ACCESSAGILITY LLC","BLUE TECH INC","BLUE TECH INC.","DH TECHNOLOGIES","DH TECHNOLOGIES, INC.","IT1 SOURCE LLC","ENTERPRISE TECHNOLOGY SOLUTIONS","ENTERPRISE TECHNOLOGY SOLUTIONS, INC.","DISTRIBUTED TECHNOLOGY GROUP LLC","ARCHITECHTURE SOLUTIONS LLC","ADVANCED COMPUTER CONCEPTS","ADVANCED COMPUTER CONCEPTS, INC.","4 STAR TECHNOLOGIES","4 STAR TECHNOLOGIES, INC.","THREE WIRE SYSTEMS","THREE WIRE SYSTEMS, LLC","C & C INTERNATIONAL COMPUTERS"]),primes:new Set(["BOOZ ALLEN HAMILTON","BOOZ ALLEN HAMILTON INC","GENERAL DYNAMICS INFORMATION TECHNOLOGY","GENERAL DYNAMICS IT","GDIT","LEIDOS INC","LEIDOS HOLDINGS","LEIDOS","SAIC","SCIENCE APPLICATIONS INTERNATIONAL","NORTHROP GRUMMAN","RAYTHEON","LOCKHEED MARTIN","LOCKHEED MARTIN CORPORATION","BAE SYSTEMS","L3HARRIS TECHNOLOGIES","CACI INTERNATIONAL","CACI INC","MANTECH INTERNATIONAL","MANTECH","PERATON INC","PERATON","ACCENTURE FEDERAL SERVICES","ACCENTURE","DELOITTE CONSULTING","DELOITTE","IBM CORPORATION","IBM","KPMG","CGI FEDERAL","CGI TECHNOLOGIES","MAXIMUS INC","MAXIMUS FEDERAL","ICF INTERNATIONAL","ICF INC","SERCO INC","SERCO","PAE INCORPORATED","AMENTUM","JACOBS TECHNOLOGY","KBR INC"]),classify(e){const t=e.toUpperCase().trim();if(this.vars.has(t))return"var";if(this.primes.has(t))return"prime";for(const e of this.vars)if(t.includes(e)||e.includes(t))return"var";for(const e of this.primes)if(t.includes(e)||e.includes(t))return"prime";const n=[/\b(TECHNOLOGY|TECHNOLOGIES)\s*(CORP|LLC|INC)/i,/\b(COMPUTERS?|COMPUTING)\s*(CORP|LLC|INC)/i,/\bSOLUTIONS?\s*(CORP|LLC|INC)/i,/\bGOV(PLACE|SMART|STORE)/i,/\bFEDERAL\s*(SOLUTIONS|TECHNOLOGY)/i];for(const e of n)if(e.test(t))return"likely_var";return"unknown"}},JobLinks={knownBrands:["KBR","SAIC","CACI","LEIDOS","SERCO","AECOM","JACOBS","PARSONS","MAXIMUS","ICF","CGI","IBM","DELL","HP","CISCO","ORACLE","GOOGLE","AMAZON WEB","MICROSOFT","ACCENTURE FEDERAL","DELOITTE","KPMG","PWC","EY","PERATON","AMENTUM","MANTECH","BAE SYSTEMS","RAYTHEON","BOEING","AIRBUS","HONEYWELL","HARRIS","TEXTRON","VERIZON","ATT","AT&T","SPRINT","PALANTIR","ANDURIL","CROWDSTRIKE","SPLUNK","VMWARE","SALESFORCE","SERVICENOW","SNOWFLAKE","DATABRICKS","ELASTIC","GITLAB","ATLASSIAN"],brandAliases:{"BOOZ ALLEN":"BAH","GENERAL DYNAMICS":"GDIT","NORTHROP GRUMMAN":"NGC","LOCKHEED MARTIN":"LMCO",L3HARRIS:"L3 HARRIS","L3 HARRIS":"L3HARRIS","WORLD WIDE TECHNOLOGY":"WWT","RED HAT":"REDHAT","PALO ALTO":"PANW"},cleanVendorName(e){let t=e.replace(/,?\s*(LLC|INC|CORP|CORPORATION|INCORPORATED|L\.L\.C\.|L\.P\.|LP|LTD|LIMITED|CO\.)\.?\s*$/gi,"").replace(/\s+/g," ").trim();const n=t.toUpperCase();for(const e of this.knownBrands)if(n===e||n.startsWith(e+" "))return e;for(const[e,t]of Object.entries(this.brandAliases))if(n.startsWith(e))return e;return t},getLinkedInUrl(e){const t=this.cleanVendorName(e);return`https://www.linkedin.com/jobs/search/?keywords=${encodeURIComponent(t)}&f_C=`},getLinkedInPeopleUrl(e,t=""){const n=this.cleanVendorName(e);return`https://www.linkedin.com/search/results/people/?keywords=${encodeURIComponent(t?`"${n}" ${t}`:n)}&origin=GLOBAL_SEARCH_HEADER`},getLinkedInNewsUrl(e){const t="string"==typeof e?this.cleanVendorName(e):e;return`https://www.linkedin.com/search/results/content/?keywords=${encodeURIComponent(t)}`}},SkillsExtractor={_stop:new Set(["the","and","for","that","this","with","from","are","was","were","will","has","have","had","not","but","all","can","her","his","its","our","they","been","each","which","their","said","use","may","than","other","into","some","could","them","only","then","also","over","such","after","before","these","more","would","about","between","through","under","being","during","services","service","support","provide","providing","provides","provided","including","include","includes","based","related","various","shall","must","per","using","used","non","new","work","contract","contractor","government","agency","federal","award","acquisition","task","order","option","period","base","year","years","fiscal","fy24","fy25","fy23","fy22","fy26","igf","igt","igf::ot::igf","igf::ct::igf","continued","continue","exercise","modification","inc","llc","corp","ltd","company","group","systems","solutions","technologies","total","amount","funded","funding","obligated","estimated","approximately","pursuant","addition","additional","added","update","updated","existing","current","ensure","management","operations","operational","program","project","specific","require","required","requirements","department","office","national","center","united","states","necessary","needed","resources","within","without","above","below","following","general","activities","activity","efforts","effort","performance","mission","critical","executive"]),extract(e){const t={},n={},a=e.length;if(!a)return[];e.forEach((e=>{const a=`${(e.Description||"").toLowerCase()} ${(e["PSC Description"]||"").toLowerCase()} ${(e["NAICS Description"]||"").toLowerCase()}`.replace(/:+/g," ").replace(/[^a-z0-9\-]+/g," ").split(/\s+/).filter((e=>e.length>2&&!this._stop.has(e))),r=new Set;a.forEach((e=>{e.length>=8&&!this._stop.has(e)&&r.add(e)}));for(let e=0;e<a.length-1;e++){const t=`${a[e]} ${a[e+1]}`;this._stop.has(a[e])||this._stop.has(a[e+1])||r.add(t)}for(let e=0;e<a.length-2;e++){const t=`${a[e]} ${a[e+1]} ${a[e+2]}`;this._stop.has(a[e])||this._stop.has(a[e+2])||r.add(t)}r.forEach((a=>{t[a]=(t[a]||0)+1,n[a]||(n[a]=(e.Description||"").substring(0,100))}))}));const r=Math.max(2,Math.ceil(.03*a));let s=Object.entries(t).filter((([e,t])=>t>=Math.min(r,2))).map((([e,t])=>{const n=e.split(" ").length;return{phrase:e,count:t,score:t*(n>=3?1.5:2===n?1.2:1)}})).sort(((e,t)=>t.score-e.score));const o=[];new Set;for(const e of s){if(o.length>=5)break;let t=!1;for(const n of o)if((n.phrase.includes(e.phrase)||e.phrase.includes(n.phrase))&&e.count<=1.3*n.count){t=!0;break}t||o.push(e)}return o.map((e=>({skill:e.phrase.toUpperCase(),count:e.count,percentage:Math.round(e.count/a*100),example:n[e.phrase]||""})))}},SalesPlanManager={channels:new Set,currentVendors:[],detectedIntent:null,init(){try{const e=new URLSearchParams(window.location.search).get("ch");if(e){const t=decodeURIComponent(atob(e));this.channels=new Set(JSON.parse(t))}}catch(e){}},isChannel(e){return this.channels.has(e)},detectIntent(e){const t=App.currentQuery||"",n={};let a=0;e.forEach((e=>{const t=e["Recipient Name"]||"Unknown",r=parseFloat(e["Award Amount"])||0;n[t]=(n[t]||0)+r,a+=r}));const r=Object.entries(n).map((([e,t])=>({name:e,spend:t,share:t/a}))).sort(((e,t)=>t.spend-e.spend));let s=0,o=0;r.forEach((e=>{this.isChannel(e.name)&&(s+=e.spend,o++)}));const i=a>0?s/a:0;if(i>.7&&o>=3)return{type:"product_oem",icon:"fa-box",title:"PRODUCT / OEM CHANNEL",description:`${(100*i).toFixed(1)}% of revenue flows through ${o} channel partners`,focusAreas:["Channel performance & rankings","Partner enablement priorities","Recompete defense by partner","Agency coverage gaps"],suggestedGoal:"Partnership"};const l=r[0];if(l&&t.toLowerCase().includes(l.name.toLowerCase().split(" ")[0]))return{type:"own_company",icon:"fa-building",title:"YOUR COMPANY ANALYSIS",description:`Analyzing your market position: ${Utils.money(l.spend)} (${(100*l.share).toFixed(1)}% share)`,focusAreas:["Defend existing contracts","Identify growth opportunities","Competitive threats to your position","Recompete calendar & defense"],suggestedGoal:"Retention"};return["department","agency","administration","commission","bureau"].some((e=>t.toLowerCase().includes(e)))?{type:"agency",icon:"fa-landmark",title:"AGENCY PENETRATION",description:"Analyzing how to enter or expand within this customer",focusAreas:["Agency mission & budget priorities","Current vendor landscape","Entry points & opportunities","Key contracting vehicles"],suggestedGoal:"Growth"}:{type:"market_keyword",icon:"fa-chart-line",title:"MARKET ANALYSIS",description:`Analyzing the "${t}" market landscape`,focusAreas:["Market size & growth trends","Competitive landscape","Top agencies & opportunities","Entry strategy recommendations"],suggestedGoal:"Growth"}},open(){const e=App.forecastData.awards||App.searchData.raw||[];if(!e.length)return void alert("No award data loaded. Please run a search or forecast first.");this.detectedIntent=this.detectIntent(e);const t={};e.forEach((e=>{const n=e["Awarding Agency"];n&&(t[n]=(t[n]||0)+1)}));const n=Object.entries(t).sort(((e,t)=>t[1]-e[1])).map((([e,t])=>`<option value="${e}">${e} (${t} awards)</option>`)).join("");document.getElementById("spSpecificAgencies").innerHTML=n,document.getElementById("spScope").value="all",document.getElementById("spFocus").value=this.detectedIntent.suggestedGoal,this.prepareVendorList(e),this.renderIntentBanner(),this.updateStatus(e.length,"Entire Market"),this.renderSmartVendorList();const a=document.getElementById("spScope");a&&!a._spBound&&(a._spBound=!0,a.addEventListener("change",(()=>{try{const{filteredAwards:e,scopeName:t}=SalesPlanManager.getFilteredData();SalesPlanManager.prepareVendorList(e),SalesPlanManager.renderSmartVendorList(),SalesPlanManager.updateStatus(e.length,t)}catch(e){document.getElementById("spDataStatus").textContent="No awards match this scope."}}))),ModalUtils.open("salesPlanModal")},close(){ModalUtils.close();const e=document.getElementById("copySuccessModal");e&&e.classList.remove("active")},renderIntentBanner(){const e=document.getElementById("spIntentBanner");if(!e||!this.detectedIntent)return;const t=this.detectedIntent;e.innerHTML=`\n      <div class="intent-banner-content">\n        <div class="intent-banner-icon"><i class="fas ${t.icon}"></i></div>\n        <div class="intent-banner-text">\n          <div class="intent-banner-title">${t.title}</div>\n          <div class="intent-banner-desc">${t.description}</div>\n          <div class="intent-banner-focus">\n            ${t.focusAreas.map((e=>`<span class="focus-tag">${e}</span>`)).join("")}\n          </div>\n        </div>\n      </div>\n    `,e.style.display="block"},getFilteredData(){const e=document.getElementById("spScope").value,t=document.getElementById("spFocus").value,n=App.forecastData.awards||App.searchData.raw||[];let a=[],r="Entire Market";if("all"===e?a=n:"defense"===e?(a=n.filter((e=>/defense|army|navy|air force|marine|space force/i.test(e["Awarding Agency"]))),r="Defense Sector"):"civilian"===e?(a=n.filter((e=>!/defense|army|navy|air force|marine|space force/i.test(e["Awarding Agency"]))),r="Federal Civilian Sector"):(a=n.filter((t=>t["Awarding Agency"]===e)),r=e),0===a.length)throw new Error("No awards found for the selected scope.");return{filteredAwards:a,scopeName:r,focus:t}},generate(){App.showLoader("GENERATING PLAN...","Filtering data & packaging prompt..."),setTimeout((()=>{try{const{filteredAwards:e,scopeName:t,focus:n}=this.getFilteredData(),a=App.forecastData&&App.forecastData.analysis?App.forecastData.analysis:null,r=PromptPackageGenerator.buildPackage(e,a,{scope:t,focus:n});PromptPackageGenerator.downloadPackage(r),this.close()}catch(e){console.error(e),alert(e.message||"Error generating plan")}finally{App.hideLoader()}}),500)},async copyPrompt(){const e=document.getElementById("btnCopyPrompt");if(!e)return;const t=e.innerHTML;e.innerHTML='<i class="fas fa-spinner fa-spin"></i> Generating...',e.style.opacity="0.7",e.style.pointerEvents="none";try{const{filteredAwards:n,scopeName:a,focus:r}=this.getFilteredData(),s=App.forecastData&&App.forecastData.analysis?App.forecastData.analysis:null,o=PromptPackageGenerator.buildPackage(n,s,{scope:a,focus:r});await navigator.clipboard.writeText(o),this.showCopySuccessModal(o.length),e.innerHTML=t,e.style.opacity="1",e.style.pointerEvents="auto"}catch(n){console.error(n),alert(n.message||"Error copying prompt"),e.innerHTML=t,e.style.opacity="1",e.style.pointerEvents="auto"}},showCopySuccessModal(e){let t=document.getElementById("copySuccessModal");t||(t=document.createElement("div"),t.id="copySuccessModal",t.className="channel-marking-modal",document.body.appendChild(t));const n=Math.round(e/4);t.innerHTML=`\n    <div class="channel-modal-content" style="max-width: 420px; height: auto; border-top: 4px solid var(--accent) !important; background: var(--bg-card);">\n      <div class="channel-modal-header" style="border-bottom: 1px solid var(--border);">\n        <div class="channel-modal-title mono" style="font-size: 1rem; color: #F1EEE9;">\n          <i class="fas fa-check-circle" style="color: var(--accent); margin-right: 8px;"></i> PROMPT COPIED\n        </div>\n        <button class="channel-modal-close" onclick="SalesPlanManager.closeSuccessModal()">\n          <i class="fas fa-times"></i>\n        </button>\n      </div>\n      \n      <div class="channel-modal-body" style="padding: 1.5rem; background: var(--bg-card);">\n        <div style="margin-bottom: 1.5rem; border-left: 2px solid var(--accent); padding-left: 1rem;">\n          <div style="font-size: 0.9rem; color: #F1EEE9; font-weight: 600; margin-bottom: 0.25rem; font-family: 'JetBrains Mono', monospace;">Ready to Paste</div>\n          <div style="font-size: 0.7rem; color: var(--text-muted); font-family: 'JetBrains Mono', monospace; text-transform: uppercase; letter-spacing: 1px;">\n            ${e.toLocaleString()} chars Â· ~${n.toLocaleString()} tokens\n          </div>\n        </div>\n        \n        <div style="font-size: 0.6rem; color: var(--accent); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 1rem; font-family: 'JetBrains Mono', monospace; font-weight: 700;">\n          Launch AI Workspace\n        </div>\n        \n      <div style="display: flex; flex-direction: column; gap: 0.75rem; margin-bottom: 1.5rem;">\n  <a href="https://claude.ai/new" target="_blank" rel="noopener" class="btn-primary" style="padding: 0.6rem; font-size: 0.75rem; justify-content: center; text-decoration: none; background-color: #E07A5F !important; border-color: #E07A5F !important;">\n    <i class="fas fa-robot"></i> Open Claude\n  </a>\n\n  <a href="https://chat.openai.com" target="_blank" rel="noopener" class="btn-primary" style="padding: 0.6rem; font-size: 0.75rem; justify-content: center; text-decoration: none; background-color: #5B7C99 !important; border-color: #5B7C99 !important;">\n    <i class="fas fa-bolt"></i> Open ChatGPT\n  </a>\n\n  <a href="https://gemini.google.com/app" target="_blank" rel="noopener" class="btn-primary" style="padding: 0.6rem; font-size: 0.75rem; justify-content: center; text-decoration: none; background-color: #7B6D8D !important; border-color: #7B6D8D !important;">\n    <i class="fas fa-stars"></i> Open Gemini\n  </a>\n</div>\n        \n        <div style="font-size: 0.75rem; color: var(--text-muted); line-height: 1.6; font-style: italic; border-top: 1px dashed var(--border); padding-top: 1rem;">\n          Paste this prompt into your preferred AI to generate a full tactical sales plan based on the live data from your search.\n        </div>\n      </div>\n      \n      <div class="channel-modal-footer" style="background: rgba(0,0,0,0.2); border-top: 1px solid var(--border);">\n        <button class="btn-secondary" onclick="SalesPlanManager.closeSuccessModal()" style="padding: 0.5rem 1rem; font-size: 0.7rem; min-width: 80px; flex: none;">\n          Close\n        </button>\n      </div>\n    </div>\n  `,ModalUtils.open("copySuccessModal")},togglePreview(){const e=document.getElementById("spPreviewSection"),t=document.getElementById("spPreviewContent"),n=document.getElementById("spPreviewStats");if(!e||!t)return;if("none"!==e.style.display)e.style.display="none";else try{const{filteredAwards:a,scopeName:r,focus:s}=this.getFilteredData(),o=App.forecastData&&App.forecastData.analysis?App.forecastData.analysis:null,i=PromptPackageGenerator.buildPackage(a,o,{scope:r,focus:s});if(t.textContent=i.substring(0,3e3)+(i.length>3e3?"\n\n... [truncated â€” full prompt is "+i.length.toLocaleString()+" chars]":""),n){const e=Math.round(i.length/4);n.textContent=i.length.toLocaleString()+" chars Â· ~"+e.toLocaleString()+" tokens"}e.style.display="block",e.scrollIntoView({behavior:"smooth",block:"nearest"})}catch(n){t.textContent="Error generating preview: "+n.message,e.style.display="block"}},closeSuccessModal(){ModalUtils.close(),document.getElementById("salesPlanModal").classList.remove("active"),document.body.style.overflow=""},prepareVendorList(e){const t={};let n=0;e.forEach((e=>{const a=e["Recipient Name"]||"Unknown",r=parseFloat(e["Award Amount"])||0;t[a]=(t[a]||0)+r,n+=r})),this.currentVendors=Object.entries(t).map((([t,a])=>({vendor:t,spend:a,marketShare:n>0?(a/n*100).toFixed(2):"0.00",contractCount:e.filter((e=>e["Recipient Name"]===t)).length,classification:KnownVendors.classify(t)}))).sort(((e,t)=>t.spend-e.spend)).slice(0,30)},updateStatus(e,t){const n=document.getElementById("spDataStatus");if(!n)return;const a=this.currentVendors.filter((e=>this.isChannel(e.vendor))).length,r=this.currentVendors.length;n.innerHTML=`\n      <span style="color:var(--success);"><i class="fas fa-check-circle"></i></span>\n      Ready Â· ${e} awards Â· ${a}/${r} channels\n    `},toggleChannel(e){this.channels.has(e)?this.channels.delete(e):this.channels.add(e),this.save(),this.updateStatus(App.forecastData.awards?.length||App.searchData.raw?.length||0,"all"===document.getElementById("spScope")?.value?"Entire Market":document.getElementById("spScope")?.value)},toggleAll(){this.currentVendors.every((e=>this.isChannel(e.vendor)))?this.currentVendors.forEach((e=>this.channels.delete(e.vendor))):this.currentVendors.forEach((e=>this.channels.add(e.vendor))),this.save(),this.renderSmartVendorList(),this.updateStatus(App.forecastData.awards?.length||App.searchData.raw?.length||0,"all"===document.getElementById("spScope")?.value?"Entire Market":document.getElementById("spScope")?.value)},acceptSuggested(){this.currentVendors.forEach((e=>{"var"!==e.classification&&"likely_var"!==e.classification||this.channels.add(e.vendor)})),this.save(),this.renderSmartVendorList(),this.updateStatus(App.forecastData.awards?.length||App.searchData.raw?.length||0,"all"===document.getElementById("spScope")?.value?"Entire Market":document.getElementById("spScope")?.value)},save(){try{const e=new URL(window.location);if(this.channels.size>0){const t=btoa(encodeURIComponent(JSON.stringify([...this.channels])));e.searchParams.set("ch",t)}else e.searchParams.delete("ch");window.history.replaceState({},"",e)}catch(e){}},renderSmartVendorList(){const e=document.getElementById("spVendorList"),t=document.getElementById("spBulkActionContainer");if(!e||!t)return;const n=this.currentVendors.filter((e=>("var"===e.classification||"likely_var"===e.classification)&&!this.isChannel(e.vendor))),a=this.currentVendors.filter((e=>"prime"===e.classification)),r=this.currentVendors.filter((e=>"unknown"===e.classification&&!this.isChannel(e.vendor))),s=this.currentVendors.filter((e=>this.isChannel(e.vendor))),o=this.currentVendors.length>0&&this.currentVendors.every((e=>this.isChannel(e.vendor)));if(t.innerHTML=`\n      <div style="display: flex; gap: 0.5rem;">\n        ${n.length>0?`\n          <button onclick="SalesPlanManager.acceptSuggested()" style="background: rgba(76, 175, 80, 0.1); border: 1px solid var(--success); color: var(--success); padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 0.7rem; font-family: 'JetBrains Mono'; display: flex; align-items: center; gap: 6px;">\n            <i class="fas fa-magic"></i> ACCEPT SUGGESTIONS (${n.length})\n          </button>\n        `:""}\n        <button onclick="SalesPlanManager.toggleAll()" style="background: transparent; border: 1px solid var(--border); color: var(--accent); padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 0.7rem; font-family: 'JetBrains Mono'; display: flex; align-items: center; gap: 6px;">\n          <i class="far ${o?"fa-square":"fa-check-square"}"></i> ${o?"UNMARK ALL":"MARK ALL"}\n        </button>\n      </div>\n    `,0===this.currentVendors.length)return void(e.innerHTML='<div style="text-align:center; padding:1rem; color:var(--text-subtle);">No vendors found in this scope.</div>');let i="";s.length>0&&(i+=this.renderVendorSection("MARKED AS CHANNELS","These vendors are already marked as your channel partners",s,"success")),n.length>0&&(i+=this.renderVendorSection("SUGGESTED CHANNELS","We detected these as likely resellers/VARs based on known patterns",n,"accent")),r.length>0&&(i+=this.renderVendorSection("â“ NEEDS REVIEW","We couldn't automatically classify these vendors",r,"muted")),a.length>0&&(i+=this.renderVendorSection("LIKELY PRIMES/SIs","These appear to be system integrators or large primes",a,"muted")),e.innerHTML=i},renderVendorSection(e,t,n,a){const r={success:"var(--success)",accent:"var(--accent)",muted:"var(--text-subtle)"}[a]||"var(--text-subtle)";return`\n      <div style="margin-bottom: 1.5rem;">\n        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">\n          <span style="font-size: 0.8rem; font-weight: 700; color: ${r}; text-transform: uppercase; letter-spacing: 0.5px;">\n            ${e}\n          </span>\n          <span style="font-size: 0.7rem; color: var(--text-subtle);">(${n.length})</span>\n        </div>\n        <div style="font-size: 0.75rem; color: #888; margin-bottom: 0.75rem;">${t}</div>\n        <div style="border: 1px solid var(--border); border-radius: 6px; overflow: hidden; border-left: 3px solid ${r};">\n          ${n.map((e=>this.renderVendorRow(e))).join("")}\n        </div>\n      </div>\n    `},renderVendorRow(e){const t=this.isChannel(e.vendor);return`\n      <div class="vendor-list-item" style="border-bottom: 1px solid var(--border); padding: 0.6rem 0.75rem;">\n        <div class="vendor-info" style="flex: 1;">\n          <div class="vendor-name" style="font-size: 0.85rem; font-weight: 600; color: #F1EEE9;">${e.vendor}</div>\n          <div class="vendor-stats" style="font-size: 0.7rem; color: #888;">\n            ${e.contractCount} contracts â€¢ ${Utils.money(e.spend)} â€¢ ${e.marketShare}% share\n          </div>\n        </div>\n        <div class="vendor-toggle" style="display: flex; align-items: center; gap: 0.5rem;">\n          <div class="toggle-switch ${t?"active":""}" onclick="SalesPlanManager.toggleItem('${e.vendor.replace(/'/g,"\\'")}', this)">\n            <div class="toggle-slider"></div>\n          </div>\n          <div class="toggle-label" style="font-size: 0.7rem; width: 70px; color: ${t?"var(--success)":"#888"};">\n            ${t?"Channel":"Competitor"}\n          </div>\n        </div>\n      </div>\n    `},toggleItem(e,t){this.toggleChannel(e),this.renderSmartVendorList()}},App={mode:"search",currentQuery:"",searchData:{raw:[],active:[],filter:null,loaded:!1},forecastData:{spending:null,agencies:null,awards:null,analysis:null,loaded:!1},drillState:{level:0,path:[],currentAgency:null,currentSubAgency:null},subawardDrillState:{level:0,path:[],filter:null,filterType:null},activeFeedSource:"prime",onlyHighMissionGap:!1,init(){let e;SalesPlanManager.init(),Autocomplete.init("mainSearchInput"),Autocomplete.init("miniSearch"),this.setupEventDelegation(),document.getElementById("mainSearchInput").addEventListener("keypress",(e=>{"Enter"===e.key&&App.runSearch()})),document.getElementById("miniSearch").addEventListener("keypress",(e=>{"Enter"===e.key&&(document.getElementById("mainSearchInput").value=e.target.value,App.runSearch(e.target.value))})),document.getElementById("mainSearchInput").addEventListener("focus",(function(){this.select()})),document.getElementById("miniSearch").addEventListener("focus",(function(){this.select()})),function(e,t){const n=document.getElementById(e),a=document.querySelector("."+t);if(!n||!a)return;const r=n.closest(".autocomplete-wrapper");r&&a.parentNode!==r&&r.appendChild(a);const s=()=>a.classList.toggle("visible",n.value.length>0);n.addEventListener("input",s),n.addEventListener("change",s),s()}("mainSearchInput","input-clear"),window.addEventListener("resize",(()=>{clearTimeout(e),e=setTimeout((()=>{if(document.querySelector(".channel-marking-modal.active, .pipeline-modal.active, .convo-modal.active"))return;"search"===App.mode&&App.searchData?.active?.length>0&&App.renderSankey();const e=document.getElementById("subawardWrapper");App.forecastData?.subawards&&e&&"none"!==e.style.display&&App.renderSubawardSankey(App.forecastData.subawards)}),250)})),LibLoader.preloadWhenIdle();const t=new URLSearchParams(window.location.search),n=t.get("q");t.get("mode");n&&(document.getElementById("mainSearchInput").value=n,App.runSearch(n))},setupEventDelegation(){document.addEventListener("click",(e=>{const t=e.target.closest("[data-action]");if(!t)return;const n=t.dataset.action,a={search:()=>this.runSearch(),forecast:()=>this.runForecast(),showHero:()=>this.showHero(),toggleMode:()=>{},setModeSearch:()=>{},setModeForecast:()=>{},resetDrill:()=>this.resetDrill(),clearFilter:()=>this.resetDrill(),shareLink:()=>this.shareLink(t),shareBrief:()=>this.shareBrief(t),exportCSV:()=>this.exportCSV(t),openSalesPlan:()=>SalesPlanManager.open(),closeSalesPlan:()=>SalesPlanManager.close(),copyPrompt:()=>SalesPlanManager.copyPrompt(),generateDownload:()=>SalesPlanManager.generate(),closeSuccessModal:()=>SalesPlanManager.closeSuccessModal(),resetSubawardDrill:()=>this.resetSubawardDrill(),toggleChannel:()=>{const e=t.dataset.vendor;e&&SalesPlanManager.toggleChannel(e)},openPipelineBuilder:()=>PipelineBuilder.open(),closePipelineBuilder:()=>PipelineBuilder.close(),generatePipeline:()=>PipelineBuilder.generate(),downloadPipelineCSV:()=>PipelineBuilder.downloadCSV(),openConvoStarters:()=>ConvoStarters.open("prime"),openSubConvoStarters:()=>ConvoStarters.open("sub"),closeConvoStarters:()=>ConvoStarters.close(),copyAllConvo:()=>ConvoStarters.copyAll(),downloadConvoPDF:()=>ConvoStarters.downloadForPhone()};a[n]&&(e.preventDefault(),a[n]())}))},showHero(){document.getElementById("appView").style.display="none";const e=document.getElementById("heroView");e.style.display="flex",e.classList.remove("hidden"),setTimeout((()=>e.classList.remove("slide-up")),10)},setMode(e){App.mode="search";const t=document.getElementById("searchModeView");t&&t.classList.add("active")},toggleMode(){},async runSearch(e){let t=e||document.getElementById("mainSearchInput").value;if(t){t=Utils.normalizeQuery(t),document.getElementById("mainSearchInput").value=t,document.title=`Govhoo | ${t.toUpperCase()}`,t!==App.currentQuery&&(App.searchData={raw:[],active:[],filter:null,loaded:!1},App.forecastData={loaded:!1},App.searchGeoData=null,App.resetDrill(),App.subawardDrillState={level:0,path:[],filter:null,filterType:null}),App.currentQuery=t,App.mode="search",App.showLoader("SCANNING "+t.toUpperCase(),"Pulling live awards from USASpending.gov");try{await LibLoader.loadD3(),App.searchData.raw=await API.searchAwards(t),App.searchData.active=App.searchData.raw,App.searchData.loaded=!0,App.transitionToApp(),App.setMode("search"),App.updateSearchDashboard(),this.loadSubcontractingData(t),this.loadGeoDataForSearch(t),requestAnimationFrame((()=>App.renderSankey())),this.loadForecastInBackground(t)}catch(e){console.error(e),alert("Error retrieving data.")}finally{App.hideLoader()}}},async loadGeoDataForSearch(e){const t=document.getElementById("searchLocationsBody"),n=setTimeout((()=>{t&&t.textContent.includes("Loading")&&(t.innerHTML=`<div class="muted text-xs" style="text-align:center;">\n          <i class="fas fa-exclamation-circle" style="color:var(--danger);"></i> Location data unavailable.\n          <br><a href="#" onclick="App.loadGeoDataForSearch('${e.replace(/'/g,"\\'")}'); return false;" style="color:var(--accent); text-decoration:underline;">Retry</a>\n        </div>`)}),15e3);try{const t=await API.getSpendingByGeography(e,"state");clearTimeout(n),App.searchGeoData=t,App.renderSearchLocations()}catch(a){clearTimeout(n),console.warn("Could not load geo data:",a),t&&(t.innerHTML=`<div class="muted text-xs" style="text-align:center;">\n          <i class="fas fa-exclamation-circle" style="color:var(--danger);"></i> Location data unavailable.\n          <br><a href="#" onclick="App.loadGeoDataForSearch('${e.replace(/'/g,"\\'")}'); return false;" style="color:var(--accent); text-decoration:underline;">Retry</a>\n        </div>`)}},async loadForecastInBackground(e){if(e)try{await LibLoader.ensureAll();const[t,n,a]=await Promise.all([API.getSpendingOverTime(e),API.getAgencyData(e),API.getAwardsForForecast(e)]);App.forecastData={spending:t,agencies:n,awards:a,analysis:ForecastEngine.analyze(t,a,n),subawards:App.forecastData?.subawards||null,loaded:!0},App.renderStrategyTools()}catch(e){console.warn("Background forecast load failed:",e)}},renderStrategyTools(){const e=App.forecastData&&App.forecastData.analysis;if(!e)return;const t=document.getElementById("gtmPlanBtn"),n=document.getElementById("pipelineBtn");t&&(t.style.display="flex"),n&&(n.style.display="flex");const a=e.recompetes||[],r=App.drillState||{};let s=a;r.level>=1&&r.currentAgency&&(s=a.filter((e=>e["Awarding Agency"]===r.currentAgency)),r.level>=2&&r.currentSubAgency&&(s=s.filter((e=>e["Awarding Sub Agency"]===r.currentSubAgency)))),this.renderRecompetes(s)},updateSearchDashboard(){const e=App.searchData.active;document.getElementById("stat-vol").innerText=Utils.money(e.reduce(((e,t)=>e+(t["Award Amount"]||0)),0)),document.getElementById("stat-count").innerText=e.length,document.getElementById("stat-vendors").innerText=new Set(e.map((e=>e["Recipient Name"]))).size,document.getElementById("stat-agencies").innerText=new Set(e.map((e=>e["Awarding Agency"]))).size,App.renderFeed(),App.updateDrillUI(),App.renderSearchTopWinners(e),App.renderSearchTopBuyers(e),App.renderSearchSkills(e),App.renderSearchLocations(),App.renderBubbleChart(),App.renderStrategyTools();const t=document.getElementById("sankeySubtitle");t&&App.currentQuery&&(t.textContent='"'+App.currentQuery.toUpperCase()+'" Â· TOP 100 ACTIVE CONTRACTS Â· LIFETIME FUNDED VALUE');const n=document.getElementById("primeExplainerBox");n&&(n.style.display="block");const a=document.getElementById("subExplainerBox");a&&(a.style.display="block");const r=document.getElementById("sankeyPanel");r&&r.classList.add("sankey-loaded");const s=document.getElementById("convoStartersBtn");s&&(s.disabled=0===App.searchData.raw.length)},resetDrill(){App.drillState={level:0,path:[],currentAgency:null,currentSubAgency:null},App.searchData.filter=null,App.searchData.active=App.searchData.raw,App.activeFeedSource="prime",App.bubbleMode="auto";const e=document.getElementById("officesPanel");e&&(e.style.display="none"),App.updateSearchDashboard(),App.renderSankey()},updateDrillUI(){const e=document.getElementById("drillBreadcrumb"),t=document.getElementById("drillHint"),n=document.getElementById("drillLevelBadge"),a=document.getElementById("drillLevelText"),r=document.getElementById("officesPanel"),s=document.getElementById("drillControlsBar"),o=document.getElementById("filterBadge");if(0===App.drillState.level){s&&(s.style.display="none"),t.style.display="none";const e=document.getElementById("subagencyPanel");e&&(e.style.display="none"),r&&(r.style.display="none"),o&&(o.style.display="none")}else{s&&(s.style.display="block"),e.style.display="flex",n.style.display="inline-flex",o&&App.searchData.filter?(o.style.display="inline-flex",document.getElementById("filterName").innerText=Utils.trunc(App.searchData.filter,20)):o&&(o.style.display="none"),1===App.drillState.level?a.innerText="Agency View":2===App.drillState.level?a.innerText="Sub-Agency View":3===App.drillState.level&&(a.innerText="Vendor Perspective");let i='<div class="breadcrumb-item" data-action="resetDrill"><i class="fas fa-globe breadcrumb-icon"></i><span>All Agencies</span></div>';if(App.drillState.path.forEach(((e,t)=>{const n=t===App.drillState.path.length-1;i+=`\n        <span class="breadcrumb-separator"><i class="fas fa-chevron-right"></i></span>\n        <div class="breadcrumb-item ${n?"active":""}" onclick="${n?"":`App.drillToLevel(${t+1})`}">\n          <span>${Utils.trunc(e.name,25)}</span>\n        </div>`})),e.innerHTML=i,1===App.drillState.level)t.innerHTML='<i class="fas fa-layer-group"></i><span>Click a <strong>sub-agency</strong> or <strong>vendor</strong> to refine</span>',App.renderSubAgencyPanel(),r&&(r.style.display="none");else if(2===App.drillState.level)App.renderSubAgencyPanel(),r&&(r.style.display="none"),t.innerHTML='<i class="fas fa-check-circle" style="color:var(--success)"></i><span>Viewing <strong>sub-agency</strong> breakdown</span>';else{const e=document.getElementById("subagencyPanel");e&&(e.style.display="none"),r&&(r.style.display="none"),t.innerHTML='<i class="fas fa-check-circle" style="color:var(--success)"></i><span>Viewing filtered breakdown</span>'}}},renderSubAgencyPanel(){},drillToAgency(e){App.drillState={level:1,currentAgency:e,currentSubAgency:null,path:[{type:"agency",name:e}]},App.searchData.active=App.searchData.raw.filter((t=>t["Awarding Agency"]===e)),App.searchData.filter=e,App.activeFeedSource="prime","vendors"!==App.bubbleMode&&"agencies"!==App.bubbleMode&&(App.bubbleMode="auto"),App.updateSearchDashboard(),App.renderSankey()},drillToSubAgency(e){App.drillState.level=2,App.drillState.currentSubAgency=e,App.drillState.path=[{type:"agency",name:App.drillState.currentAgency},{type:"sub",name:e}],App.searchData.active=App.searchData.raw.filter((t=>t["Awarding Agency"]===App.drillState.currentAgency&&t["Awarding Sub Agency"]===e)),App.searchData.filter=e,App.activeFeedSource="prime","vendors"!==App.bubbleMode&&"agencies"!==App.bubbleMode&&(App.bubbleMode="auto"),App.updateSearchDashboard(),App.renderSankey()},async loadOfficesForSubAgency(e){const t=document.getElementById("officesPanel"),n=document.getElementById("officesList");t.style.display="block",document.getElementById("officesSubAgencyName").innerText=Utils.trunc(e,40),n.innerHTML='<div style="text-align:center; padding:1rem; color:var(--text-muted);"><i class="fas fa-spinner fa-spin"></i> Loading offices...</div>';try{const t=await API.fetchOfficesForSubAgency(e);if(0===t.length)return n.innerHTML='<div style="text-align:center; padding:1rem; color:var(--text-muted);">No contracting offices found for this sub-agency</div>',document.getElementById("officesCount").innerText="0",void(document.getElementById("officesTotalAmount").innerText="$0");const a=[],r=new Set;t.forEach((e=>{r.has(e.code)||(r.add(e.code),a.push(e))})),document.getElementById("officesCount").innerText=a.length,document.getElementById("officesTotalAmount").innerText=Utils.money(App.searchData.active.reduce(((e,t)=>e+(t["Award Amount"]||0)),0)),n.innerHTML=a.slice(0,15).map(((e,t)=>`\n        <div class="subagency-item" style="cursor: default;">\n          <div class="subagency-item-left">\n            <div class="subagency-rank ${t<3?"top-3":""}">${t+1}</div>\n            <div class="subagency-info">\n              <div class="subagency-name">${Autocomplete.escapeHtml(e.name)}</div>\n              <div class="subagency-contracts" style="font-family: 'JetBrains Mono', monospace; font-size: 0.7rem;">${Autocomplete.escapeHtml(e.code||"N/A")}</div>\n            </div>\n          </div>\n          <div class="subagency-item-right">\n            <i class="fas fa-briefcase" style="color: var(--text-muted); opacity: 0.5;"></i>\n          </div>\n        </div>\n      `)).join("")}catch(e){console.error("Error loading offices:",e),n.innerHTML='<div style="text-align:center; padding:1rem; color:var(--text-muted);">Error loading offices</div>'}},drillToLevel(e){App.searchData.active=App.searchData.raw,0===e?App.resetDrill():1===e?App.drillToAgency(App.drillState.path[0].name):2===e&&App.drillToSubAgency(App.drillState.path[1].name)},drillDown(e){const t=App.searchData.raw,n=t.find((t=>t["Awarding Agency"]===e)),a=t.find((t=>t["Awarding Sub Agency"]===e)),r=t.find((t=>t["Recipient Name"]===e));if(App.searchData.active=t,n&&!a)App.drillToAgency(e);else if(a){const t=a["Awarding Agency"];App.drillState.currentAgency=t,App.drillToSubAgency(e)}else r&&(3===App.drillState.level&&App.drillState.path.pop(),App.drillState.level=3,App.drillState.path.push({type:"vendor",name:e}),App.searchData.filter=`Vendor: ${e}`,App.activeFeedSource="prime",App.searchData.active=t.filter((t=>t["Recipient Name"]===e)),App.updateSearchDashboard(),App.renderSankey())},clearFilter(){App.drillState.level>0?App.resetDrill():(App.searchData.filter=null,App.searchData.active=App.searchData.raw,App.activeFeedSource="prime",App.updateSearchDashboard(),App.renderSankey())},renderSankey(){const e=document.getElementById("chartContainer");e.innerHTML="";const t=App.searchData.active;if(!t||0===t.length)return void(e.innerHTML='<div style="text-align:center; padding:4rem; color:var(--text-subtle)">No data available for this view.</div>');const n=0===App.drillState.level,a={};t.forEach((e=>{if(e["Award Amount"]>0){const t=((n?e["Awarding Agency"]:e["Awarding Sub Agency"])||e["Awarding Agency"]||"Unknown Agency")+"|||"+(e["Recipient Name"]||"Unknown Vendor");a[t]=(a[t]||0)+e["Award Amount"]}}));const r=Object.entries(a).sort(((e,t)=>t[1]-e[1])),s=App.drillState.level>0?50:25,o=r.slice(0,s),i=r.slice(s),l=new Set,c=[];if(o.forEach((([e,t])=>{const[n,a]=e.split("|||");l.add(n),l.add(a),c.push({source:n,target:a,value:t})})),i.length>0){const e={};i.forEach((([t,n])=>{const[a]=t.split("|||");l.has(a)&&(e[a]=(e[a]||0)+n)})),Object.entries(e).forEach((([e,t])=>{const n=`Other (${i.length} Vendors)`;l.add(n),c.push({source:e,target:n,value:t})}))}const d=Array.from(l).map((e=>({name:e}))),p=new Map(d.map(((e,t)=>[e.name,t]))),u=c.map((e=>({source:p.get(e.source),target:p.get(e.target),value:e.value}))),m=((e.parentElement?e.parentElement.offsetWidth:e.offsetWidth)||800)-2,g=Math.max(500,28*d.length),h=d3.select(e).append("svg").attr("id","sankeySvg").attr("viewBox",`0 0 ${m} ${g}`).attr("preserveAspectRatio","xMidYMid meet").style("width","100%").style("height","auto").style("display","block"),y=d3.sankey().nodeId((e=>e.index)).nodeWidth(20).nodePadding(20).extent([[1,1],[m-1,g-6]]),{nodes:b,links:f}=y({nodes:d.map((e=>Object.assign({},e))),links:u.map((e=>Object.assign({},e)))});Utils.getColor.reset();const v=h.append("defs");f.forEach(((e,t)=>{const n="prime-grad-"+t,a=v.append("linearGradient").attr("id",n).attr("gradientUnits","userSpaceOnUse").attr("x1",e.source.x1).attr("x2",e.target.x0);a.append("stop").attr("offset","0%").attr("stop-color",Utils.getColor(e.source.name)),a.append("stop").attr("offset","100%").attr("stop-color",Utils.getColor(e.target.name))}));h.append("g").attr("fill","none").selectAll("path").data(f).join("path").attr("d",d3.sankeyLinkHorizontal()).attr("stroke",((e,t)=>"url(#prime-grad-"+t+")")).attr("stroke-width",(e=>Math.max(1,e.width))).attr("stroke-opacity",.4).attr("stroke-linecap","butt").attr("fill","none").style("transition","stroke-opacity 0.2s").on("mouseover",(function(){d3.select(this).attr("stroke-opacity",.8)})).on("mouseout",(function(){d3.select(this).attr("stroke-opacity",.4)})).append("title").text((e=>`${e.source.name} â†’ ${e.target.name}\n${Utils.money(e.value)}`));const A=e=>!(!e||e.startsWith("Other")||e.includes("Unknown")||"No Description"===e)&&App.searchData.raw.some((t=>t["Awarding Agency"]===e||t["Awarding Sub Agency"]===e||t["Recipient Name"]===e)),S=e=>{if(0===App.drillState.level)return!1;const t=App.drillState.path[App.drillState.path.length-1];return t&&t.name===e};h.append("g").selectAll("rect").data(b).join("rect").attr("x",(e=>e.x0)).attr("y",(e=>e.y0)).attr("height",(e=>Math.max(1,e.y1-e.y0))).attr("width",(e=>e.x1-e.x0)).attr("fill",(e=>Utils.getColor(e.name))).attr("opacity",(e=>S(e.name)?1:.8)).attr("stroke",(e=>S(e.name)?"#F1EEE9":"none")).attr("stroke-width",(e=>(S(e.name),0))).style("cursor",(e=>A(e.name)?"pointer":"default")).on("click",((e,t)=>{A(t.name)&&(S(t.name)?App.drillState.level<=1?App.resetDrill():App.drillToLevel(App.drillState.level-1):App.drillDown(t.name))})).on("mouseover",(function(e,t){A(t.name)&&d3.select(this).attr("opacity",1)})).on("mouseout",(function(e,t){d3.select(this).attr("opacity",S(t.name)?1:.8)})).append("title").text((e=>{if(!A(e.name))return`${e.name}\n${Utils.money(e.value)}`;const t=S(e.name)?"â† Click to drill out":"Click to drill down â†’";return`${e.name}\n${Utils.money(e.value)}\n${t}`}));const w=m<600;h.append("g").selectAll("text").data(b).join("text").attr("x",(e=>e.x0<m/2?e.x1+6:e.x0-6)).attr("y",(e=>(e.y1+e.y0)/2)).attr("dy",(e=>e.y1-e.y0>30?e.x0<m/2?"-0.5em":"1.1em":"0.35em")).attr("text-anchor",(e=>e.x0<m/2?"start":"end")).text((e=>Utils.trunc(e.name,w?25:40))).style("font-size","11px").style("font-weight",(e=>e.y1-e.y0>30?"700":"400")).style("fill",App.presentationMode?"#1A1A1A":"#F1EEE9").style("pointer-events","none")},renderFeed(e){const t=document.getElementById("feedGrid"),n=App.searchData.active;if(0===n.length)return void(t.innerHTML='<div style="text-align:center; padding:2rem; color:var(--text-subtle)">No contracts found.</div>');const a=e?n:n.slice(0,3),r=!e&&n.length>3,s=a.map(((e,t)=>{const n=e.generated_internal_id;let a="#";n?a=`https://www.usaspending.gov/award/${n}`:e["Award ID"]&&(a=`https://www.usaspending.gov/search/?hash=&filters=${encodeURIComponent(JSON.stringify({keyword:e["Award ID"]}))}`);let r="";e["NAICS Code"]&&(r+=`<span class="meta-tag naics" title="${Autocomplete.escapeHtml(e["NAICS Description"]||"")}">NAICS: ${Autocomplete.escapeHtml(e["NAICS Code"])}</span>`),e["PSC Code"]&&(r+=`<span class="meta-tag psc" title="${Autocomplete.escapeHtml(e["PSC Description"]||"")}">PSC: ${Autocomplete.escapeHtml(e["PSC Code"])}</span>`);const s=VehicleDetector.detect(e["Award ID"]);s&&(r+=`<span class="meta-tag" style="background:rgba(95,128,85,0.15);border-color:rgba(95,128,85,0.3);color:var(--accent);" title="${s.vehicle}">${s.short}</span>`);const o=VehicleDetector.getSetAsideLabel(e["Type of Set Aside"]);o&&(r+=`<span class="meta-tag" style="background:rgba(229,192,123,0.15);border-color:rgba(229,192,123,0.3);color:var(--accent);" title="Set-Aside: ${o}">${o}</span>`);const i=e["Awarding Sub Agency"],l=i&&i!==e["Awarding Agency"]?`${Utils.trunc(e["Awarding Agency"],20)} â†’ ${Utils.trunc(i,20)}`:Utils.trunc(e["Awarding Agency"],35),c=e["Recipient Name"]||"Unknown Vendor",d=Autocomplete.escapeHtml(c),p=Autocomplete.escapeHtml(Utils.trunc(e.Description,100)),u=Autocomplete.escapeHtml(l),m=JobLinks.getLinkedInUrl(c),g=JobLinks.getLinkedInPeopleUrl(c),h=JobLinks.getLinkedInNewsUrl(c);return`<div class="deal-card">\n    <div class="deal-header"><span class="deal-agency">${u}</span><span class="deal-amount">${Utils.money(e["Award Amount"])}${e["Start Date"]?' <span style="font-size:0.6rem;opacity:0.6;">since '+e["Start Date"].substring(0,4)+"</span>":""}</span></div>\n    <div class="deal-desc">${p}</div>\n    <div class="deal-vendor">${d} <a href="${g}" target="_blank" class="job-link" style="margin-left:6px;" title="Find contacts at this company"><i class="fab fa-linkedin"></i> People</a> <a href="${m}" target="_blank" class="job-link" title="Search jobs at this company"><i class="fab fa-linkedin"></i> Jobs</a> <a href="${h}" target="_blank" class="job-link" title="LinkedIn posts about this company"><i class="fas fa-newspaper"></i> News</a></div>\n    ${r?`<div class="deal-meta">${r}</div>`:""}\n    <div class="deal-footer"><span class="deal-date">Start: ${Utils.date(e["Start Date"])}${e["End Date"]?" â†’ "+Utils.date(e["End Date"]):""}</span><div style="display:flex;gap:0.5rem;align-items:center;"><button onclick="Utils.copyDealToClipboard(${t}, this)" class="action-btn" style="font-size:0.7rem; padding:0.35rem 0.6rem; cursor:pointer; background:transparent;" title="Copy for CRM"><i class="fas fa-copy"></i></button><a href="${a}" target="_blank" class="action-btn">VIEW <i class="fas fa-external-link-alt"></i></a></div></div>\n  </div>`})).join(""),o=r?`<button onclick="App.renderFeed(true)" style="width: 100%; padding: 0.875rem; background: var(--bg-card); border: 1px dashed var(--border); border-radius: 4px; color: var(--accent); font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; cursor: pointer; transition: all 0.2s; text-transform: uppercase; letter-spacing: 1px;" onmouseover="this.style.borderColor='var(--accent)';this.style.background='var(--accent-dim)'" onmouseout="this.style.borderColor='var(--border)';this.style.background='var(--bg-card)'"><i class="fas fa-chevron-down" style="margin-right: 0.5rem;"></i>Show All ${n.length} Contracts</button>`:"";t.innerHTML=s+o},renderSubawardFeed(e,t){const n=e||document.getElementById("subFeedGrid"),a=document.getElementById("subFeedWrapper");if(!n)return;let r=App.forecastData.subawards||[];const s=App.subawardDrillState;if(s.level>0&&s.path&&s.path.length>0&&s.path.forEach((e=>{"agency"===e.type?r=r.filter((t=>(t["Awarding Agency"]||"Unknown Agency")===e.name)):"subagency"===e.type?r=r.filter((t=>(t["Awarding Sub Agency"]||"Unknown Sub Agency")===e.name)):"prime"===e.type?r=r.filter((t=>(t["Prime Recipient Name"]||"Unknown Prime")===e.name)):"sub"===e.type&&(r=r.filter((t=>(t["Sub-Awardee Name"]||"Unknown Sub")===e.name)))})),0===r.length)return n.innerHTML='<div style="text-align:center; padding:2rem; color:var(--text-subtle)">No subcontracts found.</div>',void(a&&(a.style.display="none"));a&&(a.style.display="block"),r=[...r].sort(((e,t)=>(parseFloat(t["Sub-Award Amount"])||0)-(parseFloat(e["Sub-Award Amount"])||0)));const o=t?r.slice(0,50):r.slice(0,3),i=!t&&r.length>3,l=o.map((e=>{const t=e["Prime Recipient Name"]||"Unknown Prime",n=e["Sub-Awardee Name"]||"Unknown Sub",a=parseFloat(e["Sub-Award Amount"])||0,r=e["Sub-Award Date"],s=e["Awarding Agency"]||e["Awarding Sub Agency"]||"",o=e.prime_award_generated_internal_id||"";let i="";o&&(i=`https://www.usaspending.gov/award/${o}`);const l=Autocomplete.escapeHtml(Utils.trunc(t,25)),c=Autocomplete.escapeHtml(Utils.trunc(n,25)),d=JobLinks.getLinkedInPeopleUrl(t),p=JobLinks.getLinkedInPeopleUrl(n),u=encodeURIComponent(JSON.stringify({"Awarding Agency":s,"Prime Recipient Name":t,"Sub-Awardee Name":n,"Sub-Award Amount":e["Sub-Award Amount"],"Sub-Award Date":r,prime_award_generated_internal_id:o}));return`<div class="deal-card" style="border-left-color: var(--accent);">\n        <div class="deal-header">\n          <span class="deal-agency" style="color: var(--accent);">SUBCONTRACT</span>\n          <span class="deal-amount">${Utils.money(a)}</span>\n        </div>\n        <div class="deal-desc" style="font-size: 0.8rem;">\n          <strong>${l}</strong> <i class="fas fa-arrow-right" style="margin: 0 6px; opacity: 0.5;"></i> <strong>${c}</strong>\n        </div>\n        <div class="deal-vendor" style="font-size: 0.75rem; color: var(--text-muted);">\n          ${s?`Agency: ${Autocomplete.escapeHtml(Utils.trunc(s,30))}`:""}\n        </div>\n        <div class="deal-footer">\n          <span class="deal-date">${r?Utils.date(r):"Date N/A"}</span>\n          <div style="display: flex; gap: 0.5rem; align-items: center;">\n            <button onclick="Utils.copySubDealToClipboard('${u}', this)" class="action-btn" style="font-size:0.65rem; padding:0.25rem 0.5rem; cursor:pointer; background:transparent;" title="Copy for CRM"><i class="fas fa-copy"></i></button>\n            <a href="${d}" target="_blank" class="job-link" title="Find contacts at prime"><i class="fab fa-linkedin"></i> Prime</a>\n            <a href="${p}" target="_blank" class="job-link" title="Find contacts at sub"><i class="fab fa-linkedin"></i> Sub</a>\n            ${i?`<a href="${i}" target="_blank" class="action-btn" style="font-size: 0.65rem; padding: 0.25rem 0.5rem;">VIEW <i class="fas fa-external-link-alt"></i></a>`:""}\n          </div>\n        </div>\n      </div>`})).join(""),c=i?`<button onclick="App.renderSubawardFeed(null, true)" style="width: 100%; padding: 0.875rem; background: var(--bg-card); border: 1px dashed var(--border); border-radius: 4px; color: var(--accent); font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; cursor: pointer; transition: all 0.2s; text-transform: uppercase; letter-spacing: 1px;" onmouseover="this.style.borderColor='var(--accent)';this.style.background='rgba(229,192,123,0.08)'" onmouseout="this.style.borderColor='var(--border)';this.style.background='var(--bg-card)'"><i class="fas fa-chevron-down" style="margin-right: 0.5rem;"></i>Show All ${Math.min(r.length,50)} Subcontracts</button>`:"";n.innerHTML=l+c},renderSearchTopBuyers(e){const t=document.getElementById("searchTopBuyersBody"),n=document.querySelector("#searchJobPanel .section-title-group .section-title"),a=document.querySelector("#searchJobPanel .section-title-group .section-subtitle");if(!t)return;if(!e||0===e.length)return void(t.innerHTML='<div class="muted text-xs" style="text-align:center;">No agency data available</div>');const r=App.drillState||{},s=r.level>=1&&r.currentAgency;if(n&&(n.textContent=s?`${Utils.trunc(r.currentAgency,22)} Offices`:"Top Agency Buyers"),a&&(a.textContent=s?"Sub-agencies":"Who buys"),s){const n={};e.forEach((e=>{const t=e["Awarding Sub Agency"]||e["Awarding Agency"]||"Unknown";n[t]||(n[t]={name:t,spend:0,count:0}),n[t].spend+=parseFloat(e["Award Amount"])||0,n[t].count++}));const a=Object.values(n).sort(((e,t)=>t.spend-e.spend)),r=a.slice(0,7);t.innerHTML=`\n      <div class="compact-winner-list">\n        ${r.map(((e,t)=>{const n=JobLinks.getLinkedInPeopleUrl(e.name),a="https://www.usajobs.gov/Search/Results?k="+encodeURIComponent(e.name),r=JobLinks.getLinkedInNewsUrl(e.name);return`\n          <div class="compact-winner-item" style="cursor:pointer;" onclick="App.drillToSubAgency('${e.name.replace(/'/g,"\\'")}')">\n            <div class="compact-winner-rank" >${t+1}</div>\n            <div class="compact-winner-info">\n              <div class="compact-winner-name">${Utils.trunc(e.name,28)}</div>\n              <div class="compact-winner-count">${e.count} awards</div>\n              <div class="job-links" style="margin-top:4px;" onclick="event.stopPropagation();">\n                <a href="${n}" target="_blank" class="job-link" title="Find contacts"><i class="fab fa-linkedin"></i> People</a>\n                <a href="${a}" target="_blank" class="job-link" title="Federal jobs"><i class="fas fa-flag-usa"></i> Jobs</a>\n                <a href="${r}" target="_blank" class="job-link" title="News"><i class="fas fa-newspaper"></i> News</a>\n              </div>\n            </div>\n            <div class="compact-winner-amount">${Utils.money(e.spend)}</div>\n          </div>`})).join("")}\n      </div>\n      ${a.length>7?`<div class="text-xs muted" style="text-align:center; margin-top:0.5rem;">+${a.length-7} more offices</div>`:""}\n    `}else{const n={};e.forEach((e=>{const t=e["Awarding Agency"]||"Unknown";n[t]||(n[t]={name:t,spend:0,count:0}),n[t].spend+=parseFloat(e["Award Amount"])||0,n[t].count++}));const a=Object.values(n).sort(((e,t)=>t.spend-e.spend)),r=a.slice(0,5);t.innerHTML=`\n      <div class="compact-winner-list">\n        ${r.map(((e,t)=>{const n=JobLinks.getLinkedInPeopleUrl(e.name),a="https://www.usajobs.gov/Search/Results?k="+encodeURIComponent(e.name),r=JobLinks.getLinkedInNewsUrl(e.name);return`\n          <div class="compact-winner-item" style="cursor:pointer;" onclick="App.drillToAgency('${e.name.replace(/'/g,"\\'")}')">\n            <div class="compact-winner-rank" >${t+1}</div>\n            <div class="compact-winner-info">\n              <div class="compact-winner-name">${Utils.trunc(e.name,24)}</div>\n              <div class="compact-winner-count">${e.count} awards</div>\n              <div class="job-links" style="margin-top:4px;" onclick="event.stopPropagation();">\n                <a href="${n}" target="_blank" class="job-link" title="Find contacts at this agency"><i class="fab fa-linkedin"></i> People</a>\n                <a href="${a}" target="_blank" class="job-link" title="Federal jobs at this agency"><i class="fas fa-flag-usa"></i> Jobs</a>\n                <a href="${r}" target="_blank" class="job-link" title="LinkedIn posts about this agency"><i class="fas fa-newspaper"></i> News</a>\n              </div>\n            </div>\n            <div class="compact-winner-amount">${Utils.money(e.spend)}</div>\n          </div>`})).join("")}\n      </div>\n      ${a.length>5?`<div class="text-xs muted" style="text-align:center; margin-top:0.5rem;">+${a.length-5} more agencies</div>`:""}\n    `}},renderSearchTopWinners(e){const t=document.getElementById("searchTopWinnersBody");if(!t)return;if(!e||0===e.length)return void(t.innerHTML='<div class="muted text-xs" style="text-align:center;">No vendor data available</div>');const n={};e.forEach((e=>{const t=e["Recipient Name"]||"Unknown";n[t]||(n[t]={name:t,spend:0,count:0}),n[t].spend+=parseFloat(e["Award Amount"])||0,n[t].count++}));const a=Object.values(n).sort(((e,t)=>t.spend-e.spend)),r=a.slice(0,5);t.innerHTML=`\n    <div class="compact-winner-list">\n      ${r.map(((e,t)=>{const n=JobLinks.getLinkedInUrl(e.name),a=JobLinks.getLinkedInPeopleUrl(e.name),r=JobLinks.getLinkedInNewsUrl(e.name),s=VendorRelationships.get(e.name),o=VendorRelationships.getIcon(s);return`\n        <div class="compact-winner-item">\n          <div class="compact-winner-rank">${t+1}</div>\n          <div class="compact-winner-info">\n            <div class="compact-winner-name" style="display:flex;align-items:center;gap:6px;">\n              ${Utils.trunc(e.name,28)}\n              <button onclick="VendorRelationships.cycle('${e.name.replace(/'/g,"\\'")}'); App.renderSearchTopWinners(App.searchData.active);" \n                style="background:${o.bg};border:1px solid ${s?o.color:"var(--border)"};color:${o.color};width:22px;height:22px;border-radius:4px;display:inline-flex;align-items:center;justify-content:center;cursor:pointer;font-size:0.55rem;flex-shrink:0;transition:all 0.15s;padding:0;" \n                title="${o.label}"><i class="${o.icon}"></i></button>\n              ${s?`<span style="font-size:0.55rem;color:${o.color};font-family:'JetBrains Mono',monospace;text-transform:uppercase;letter-spacing:0.5px;">${o.label}</span>`:""}\n            </div>\n            <div class="compact-winner-count">${e.count} awards</div>\n            <div class="job-links" style="margin-top:4px;">\n              <a href="${a}" target="_blank" class="job-link" title="Find contacts at this company"><i class="fab fa-linkedin"></i> People</a>\n              <a href="${n}" target="_blank" class="job-link" title="Search jobs on LinkedIn"><i class="fab fa-linkedin"></i> Jobs</a>\n              <a href="${r}" target="_blank" class="job-link" title="LinkedIn posts about this company"><i class="fas fa-newspaper"></i> News</a>\n            </div>\n          </div>\n          <div class="compact-winner-amount">${Utils.money(e.spend)}</div>\n        </div>`})).join("")}\n    </div>\n    ${a.length>5?`<div class="text-xs muted" style="text-align:center; margin-top:0.5rem;">+${a.length-5} more vendors in results</div>`:""}\n  `},renderSearchTopPrimes(e){const t=document.getElementById("searchTopPrimesBody");if(!t)return;if(!e||0===e.length)return void(t.innerHTML='<div class="muted text-xs" style="text-align:center;">No subcontract data available</div>');let n=e;const a=App.subawardDrillState;a.level>0&&a.path&&a.path.length>0&&a.path.forEach((e=>{"agency"===e.type?n=n.filter((t=>(t["Awarding Agency"]||"Unknown Agency")===e.name)):"subagency"===e.type?n=n.filter((t=>(t["Awarding Sub Agency"]||"Unknown Sub Agency")===e.name)):"prime"===e.type?n=n.filter((t=>(t["Prime Recipient Name"]||"Unknown Prime")===e.name)):"sub"===e.type&&(n=n.filter((t=>(t["Sub-Awardee Name"]||"Unknown Sub")===e.name)))}));const r={};n.forEach((e=>{const t=e["Prime Recipient Name"]||"Unknown";r[t]||(r[t]={name:t,spend:0,count:0}),r[t].spend+=parseFloat(e["Sub-Award Amount"])||0,r[t].count++}));const s=Object.values(r).sort(((e,t)=>t.spend-e.spend)),o=s.slice(0,5);t.innerHTML=`\n      <div class="compact-winner-list">\n        ${o.map(((e,t)=>{const n=JobLinks.getLinkedInUrl(e.name),a=JobLinks.getLinkedInPeopleUrl(e.name),r=JobLinks.getLinkedInNewsUrl(e.name);return`\n          <div class="compact-winner-item">\n            <div class="compact-winner-rank" >${t+1}</div>\n            <div class="compact-winner-info">\n              <div class="compact-winner-name">${Utils.trunc(e.name,28)}</div>\n              <div class="compact-winner-count">${e.count} subawards</div>\n              <div class="job-links" style="margin-top:4px;">\n                <a href="${a}" target="_blank" class="job-link" title="Find contacts at this company"><i class="fab fa-linkedin"></i> People</a>\n                <a href="${n}" target="_blank" class="job-link" title="Search jobs on LinkedIn"><i class="fab fa-linkedin"></i> Jobs</a>\n                <a href="${r}" target="_blank" class="job-link" title="LinkedIn posts about this company"><i class="fas fa-newspaper"></i> News</a>\n              </div>\n            </div>\n            <div class="compact-winner-amount">${Utils.money(e.spend)}</div>\n          </div>`})).join("")}\n      </div>\n      ${s.length>5?`<div class="text-xs muted" style="text-align:center; margin-top:0.5rem;">+${s.length-5} more primes in results</div>`:""}\n    `},renderSearchTopSubs(e){const t=document.getElementById("searchTopSubsBody");if(!t)return;if(!e||0===e.length)return void(t.innerHTML='<div class="muted text-xs" style="text-align:center;">No subcontract data available</div>');let n=e;const a=App.subawardDrillState;a.level>0&&a.path&&a.path.length>0&&a.path.forEach((e=>{"agency"===e.type?n=n.filter((t=>(t["Awarding Agency"]||"Unknown Agency")===e.name)):"subagency"===e.type?n=n.filter((t=>(t["Awarding Sub Agency"]||"Unknown Sub Agency")===e.name)):"prime"===e.type?n=n.filter((t=>(t["Prime Recipient Name"]||"Unknown Prime")===e.name)):"sub"===e.type&&(n=n.filter((t=>(t["Sub-Awardee Name"]||"Unknown Sub")===e.name)))}));const r={};n.forEach((e=>{const t=e["Sub-Awardee Name"]||"Unknown";r[t]||(r[t]={name:t,spend:0,count:0}),r[t].spend+=parseFloat(e["Sub-Award Amount"])||0,r[t].count++}));const s=Object.values(r).sort(((e,t)=>t.spend-e.spend)),o=s.slice(0,5);t.innerHTML=`\n      <div class="compact-winner-list">\n        ${o.map(((e,t)=>{const n=JobLinks.getLinkedInUrl(e.name),a=JobLinks.getLinkedInPeopleUrl(e.name),r=JobLinks.getLinkedInNewsUrl(e.name);return`\n          <div class="compact-winner-item">\n            <div class="compact-winner-rank">${t+1}</div>\n            <div class="compact-winner-info">\n              <div class="compact-winner-name">${Utils.trunc(e.name,28)}</div>\n              <div class="compact-winner-count">${e.count} subawards</div>\n              <div class="job-links" style="margin-top:4px;">\n                <a href="${a}" target="_blank" class="job-link" title="Find contacts at this company"><i class="fab fa-linkedin"></i> People</a>\n                <a href="${n}" target="_blank" class="job-link" title="Search jobs on LinkedIn"><i class="fab fa-linkedin"></i> Jobs</a>\n                <a href="${r}" target="_blank" class="job-link" title="LinkedIn posts about this company"><i class="fas fa-newspaper"></i> News</a>\n              </div>\n            </div>\n            <div class="compact-winner-amount">${Utils.money(e.spend)}</div>\n          </div>`})).join("")}\n      </div>\n      ${s.length>5?`<div class="text-xs muted" style="text-align:center; margin-top:0.5rem;">+${s.length-5} more subcontractors in results</div>`:""}\n    `},renderSearchSkills(e){const t=document.getElementById("searchSkillsBody");if(!t)return;if(!e||0===e.length)return void(t.innerHTML='<div class="muted text-xs" style="text-align:center;">No description data available</div>');const n=SkillsExtractor.extract(e);if(0===n.length)return void(t.innerHTML='<div class="muted text-xs" style="text-align:center;">No recurring terms detected in award descriptions</div>');const a=n[0]?.percentage||100;t.innerHTML=`\n      ${n.slice(0,5).map((e=>`\n        <div class="skill-bar-container">\n          <div class="skill-bar-label">\n            <span class="skill-bar-name">${e.skill}</span>\n            <span class="skill-bar-pct">${e.percentage}%</span>\n          </div>\n          <div class="skill-bar">\n            <div class="skill-bar-fill" style="width: ${e.percentage/a*100}%"></div>\n          </div>\n        </div>\n      `)).join("")}\n      <div class="text-xs" style="margin-top: 0.75rem; color: var(--text-muted); font-style: italic;">\n        <i class="fas fa-lightbulb" style="color: var(--accent);"></i> \n        Top terms extracted from Award Descriptions\n      </div>\n    `},renderSearchLocations(){const e=document.getElementById("searchLocationsBody");if(!e)return;const t=App.searchGeoData;if(!t||0===t.length)return void(e.innerHTML='<div class="muted text-xs" style="text-align:center;">Loading location data...</div>');const n=t.sort(((e,t)=>t.aggregated_amount-e.aggregated_amount)).slice(0,5),a=t.reduce(((e,t)=>e+t.aggregated_amount),0);e.innerHTML=`\n      <div class="compact-location-list">\n        ${n.map(((e,t)=>{const n=e.state_code||e.shape_code||"XX";return`\n          <div class="compact-location-item">\n            <div class="compact-location-rank">${t+1}</div>\n            <div class="compact-location-info">\n              <div class="compact-location-name">${US_STATES[n]||n}</div>\n              <div class="compact-location-count">${a>0?Math.round(e.aggregated_amount/a*100):0}%</div>\n            </div>\n            <div class="compact-location-amount">${Utils.money(e.aggregated_amount)}</div>\n          </div>`})).join("")}\n      </div>\n      ${t.length>5?`<div class="text-xs muted" style="text-align:center; margin-top:0.5rem;">+${t.length-5} more states</div>`:""}\n    `},runForecast:async e=>App.runSearch(e),renderForecastDashboard(){App.forecastData&&App.forecastData.loaded&&App.renderStrategyTools()},async loadSubcontractingData(e){const t=document.getElementById("subcontractingBody");document.getElementById("subcontractingStats");if(!t)return;t.innerHTML='<div style="text-align:center; padding:2rem; color:var(--text-muted);"><i class="fas fa-spinner fa-spin"></i> Loading subaward flow...</div>';const n=setTimeout((()=>{t.querySelector(".fa-spinner")&&(t.innerHTML=`<div style="text-align:center; padding:1rem; color:var(--text-muted); font-size:0.85rem;">\n          <i class="fas fa-exclamation-circle" style="color:var(--danger);"></i> Subaward data is taking too long to load.\n          <br><a href="#" onclick="App.loadSubcontractingData('${e.replace(/'/g,"\\'")}'); return false;" style="color:var(--accent); text-decoration:underline; font-size:0.8rem;">Retry</a>\n        </div>`)}),15e3);try{const t=await API.getSubawards(e);clearTimeout(n),App.forecastData.subawards=t,this.renderSubawardSankey(t),this.renderSearchTopPrimes(t),this.renderSearchTopSubs(t),this.renderSubawardFeed(),App.renderSubBubbleChart()}catch(a){clearTimeout(n),console.error(a),t.innerHTML=`<div style="text-align:center; padding:1rem; color:var(--text-muted); font-size:0.85rem;">\n        <i class="fas fa-exclamation-circle" style="color:var(--danger);"></i> Unable to load subaward data.\n        <br><a href="#" onclick="App.loadSubcontractingData('${e.replace(/'/g,"\\'")}'); return false;" style="color:var(--accent); text-decoration:underline; font-size:0.8rem;">Retry</a>\n      </div>`}},renderSubawardSankey(e){const t=document.getElementById("subawardWrapper"),n=document.getElementById("subcontractingBody"),a=document.getElementById("subcontractingStats"),r=document.getElementById("subcontractingLegend"),s=document.getElementById("subConvoStartersPanel");if(!t||!n)return;if(r&&(r.style.display="none"),!e||0===e.length){if(t.style.display="none",s&&(s.style.display="none"),a){const e=document.getElementById("sub-stat-vol");e&&(e.innerText="-")}return}t.style.display="block",s&&(s.style.display="flex");const o=document.getElementById("subSankeySubtitle");o&&App.currentQuery&&(o.textContent='"'+App.currentQuery.toUpperCase()+'" Â· TOP 100 SUBCONTRACTS Â· INDIVIDUAL TRANSACTION VALUE');let i=e;const l=App.subawardDrillState;l.level>0&&l.path.length>0&&(l.path.forEach((e=>{"agency"===e.type?i=i.filter((t=>(t["Awarding Agency"]||"Unknown Agency")===e.name)):"subagency"===e.type?i=i.filter((t=>(t["Awarding Sub Agency"]||"Unknown Sub Agency")===e.name)):"prime"===e.type?i=i.filter((t=>(t["Prime Recipient Name"]||"Unknown Prime")===e.name)):"sub"===e.type&&(i=i.filter((t=>(t["Sub-Awardee Name"]||"Unknown Sub")===e.name)))})),l.filter=l.path[l.path.length-1].name,l.filterType=l.path[l.path.length-1].type);const c={};let d=0;const p=l.path.some((e=>"agency"===e.type)),u=l.path.some((e=>"subagency"===e.type));if(i.forEach((e=>{const t=e["Awarding Agency"]||"Unknown Agency",n=e["Awarding Sub Agency"]||t,a=e["Prime Recipient Name"]||"Unknown Prime",r=e["Sub-Awardee Name"]||"Unknown Sub",s=parseFloat(e["Sub-Award Amount"])||0;if(s>0){let e;if(e=p?u?a:n:t,p&&!u){const t=`${e}|||${a}`;c[t]=(c[t]||0)+s;const n=`${a}|||${r}`;c[n]=(c[n]||0)+s}else if(u){const e=`${a}|||${r}`;c[e]=(c[e]||0)+s}else{const e=`${t}|||${a}`;c[e]=(c[e]||0)+s;const n=`${a}|||${r}`;c[n]=(c[n]||0)+s}d+=s}})),a){const e=document.getElementById("sub-stat-vol"),t=document.getElementById("sub-stat-primes"),n=document.getElementById("sub-stat-subs"),a=document.getElementById("sub-stat-count"),r=new Set(i.map((e=>e["Prime Recipient Name"]||"Unknown"))).size,s=new Set(i.map((e=>e["Sub-Awardee Name"]||"Unknown"))).size;e&&(e.innerText=Utils.money(d)),t&&(t.innerText=r),n&&(n.innerText=s),a&&(a.innerText=i.length)}const m=Object.entries(c).sort(((e,t)=>t[1]-e[1])).slice(0,40),g=new Set,h=[];if(m.forEach((([e,t])=>{const[n,a]=e.split("|||");g.add(n),g.add(a),h.push({source:n,target:a,value:t})})),0===h.length)return void(t.style.display="none");const y=Array.from(g).map((e=>({name:e}))),b=new Map(y.map(((e,t)=>[e.name,t]))),f=h.map((e=>({source:b.get(e.source),target:b.get(e.target),value:e.value})));let v="";if(l.level>0&&l.path.length>0){const e={agency:"fa-landmark",subagency:"fa-sitemap",prime:"fa-building",sub:"fa-handshake"},t={agency:"Agency",subagency:"Sub-Agency",prime:"Prime",sub:"Sub"};let n='<div class="breadcrumb-item" onclick="App.resetSubawardDrill()" style="cursor:pointer;">\n        <i class="fas fa-stream breadcrumb-icon"></i>\n        <span>All Subawards</span>\n      </div>';l.path.forEach(((a,r)=>{const s=r===l.path.length-1,o=e[a.type]||"fa-circle";n+='<span class="breadcrumb-separator"><i class="fas fa-chevron-right"></i></span>',n+=s?`<div class="breadcrumb-item active">\n            <i class="fas ${o} breadcrumb-icon"></i>\n            <span>${Utils.trunc(a.name,30)}</span>\n            <span style="font-size:0.65rem; color:var(--text-muted); margin-left:6px;">(${t[a.type]||a.type})</span>\n          </div>`:`<div class="breadcrumb-item" onclick="App.drillSubawardToLevel(${r})" style="cursor:pointer;">\n            <i class="fas ${o} breadcrumb-icon"></i>\n            <span>${Utils.trunc(a.name,25)}</span>\n          </div>`})),v=`<div class="drill-breadcrumb" style="display: flex; margin-bottom: 0.75rem;">${n}</div>`}n.innerHTML=`\n      ${v}\n      <div id="subawardDrillHint" class="drill-hint" style="margin-bottom: 0.5rem; ${l.level>0?"display:none;":""}">\n        <i class="fas fa-mouse-pointer"></i>\n        <span>Click any bar to drill down Â· click the active bar to drill back up</span>\n      </div>\n      <svg id="subawardSankeySvg"></svg>\n    `;const A=((n.parentElement?n.parentElement.offsetWidth:n.offsetWidth)||800)-2,S=Math.max(350,20*y.length),w=d3.select("#subawardSankeySvg").attr("viewBox",`0 0 ${A} ${S}`).attr("preserveAspectRatio","xMidYMid meet").style("width","100%").style("height","auto").style("display","block"),C=d3.sankey().nodeId((e=>e.index)).nodeWidth(20).nodePadding(20).extent([[1,1],[A-1,S-6]]),{nodes:I,links:E}=C({nodes:y.map((e=>Object.assign({},e))),links:f.map((e=>Object.assign({},e)))}),$=new Set(i.map((e=>e["Prime Recipient Name"]||"Unknown Prime"))),T=new Set(i.map((e=>e["Sub-Awardee Name"]||"Unknown Sub"))),D=new Set(i.map((e=>e["Awarding Agency"]||"Unknown Agency"))),k=new Set(i.map((e=>e["Awarding Sub Agency"]||e["Awarding Agency"]||"Unknown Agency")));I.forEach((e=>{p&&!u&&k.has(e.name)&&!$.has(e.name)?e.nodeType="subagency":p||!D.has(e.name)||$.has(e.name)?$.has(e.name)&&!T.has(e.name)?e.nodeType="prime":T.has(e.name)?e.nodeType="sub":$.has(e.name)?e.nodeType="prime":e.nodeType="sub":e.nodeType="agency"})),Utils.getColor.reset();const x=w.append("defs");E.forEach(((e,t)=>{const n=Utils.getColor(e.source.name),a=Utils.getColor(e.target.name),r=x.append("linearGradient").attr("id",`sub-gradient-${t}`).attr("gradientUnits","userSpaceOnUse").attr("x1",e.source.x1).attr("x2",e.target.x0);r.append("stop").attr("offset","0%").attr("stop-color",n),r.append("stop").attr("offset","100%").attr("stop-color",a)})),w.append("g").attr("fill","none").selectAll("path").data(E).join("path").attr("d",d3.sankeyLinkHorizontal()).attr("stroke",((e,t)=>`url(#sub-gradient-${t})`)).attr("stroke-width",(e=>Math.max(1,e.width))).attr("stroke-opacity",.4).on("mouseover",(function(){d3.select(this).attr("stroke-opacity",.8)})).on("mouseout",(function(){d3.select(this).attr("stroke-opacity",.4)})).append("title").text((e=>`${e.source.name} â†’ ${e.target.name}\n${Utils.money(e.value)}`));const N=e=>l.path.length>0&&l.path[l.path.length-1].name===e;w.append("g").selectAll("rect").data(I).join("rect").attr("x",(e=>e.x0)).attr("y",(e=>e.y0)).attr("height",(e=>Math.max(1,e.y1-e.y0))).attr("width",(e=>e.x1-e.x0)).attr("fill",(e=>Utils.getColor(e.name))).attr("opacity",(e=>N(e.name)?1:.8)).attr("stroke",(e=>N(e.name)?"#F1EEE9":"none")).attr("stroke-width",(e=>(N(e.name),0))).style("cursor",(e=>e.name.startsWith("Other")?"default":"pointer")).on("click",(function(e,t){t.name.startsWith("Other")||t.name.includes("Unknown")||(N(t.name)?l.path.length<=1?App.resetSubawardDrill():App.drillSubawardToLevel(l.path.length-2):App.drillSubaward(t.name,t.nodeType))})).on("mouseover",(function(e,t){d3.select(this).attr("opacity",1),N(t.name)&&d3.select(this).attr("stroke","var(--danger)").attr("stroke-width",0)})).on("mouseout",(function(e,t){d3.select(this).attr("opacity",N(t.name)?1:.8),d3.select(this).attr("stroke",N(t.name)?"#F1EEE9":"none").attr("stroke-width",(N(t.name),0))})).append("title").text((e=>{const t=N(e.name)?"â† Click to drill out":"Click to drill down â†’";return`${e.name}\n${Utils.money(e.value)}\n${e.name.startsWith("Other")?"":t}`}));const L=A<600;w.append("g").selectAll("text").data(I).join("text").attr("x",(e=>e.x0<A/2?e.x1+6:e.x0-6)).attr("y",(e=>(e.y1+e.y0)/2)).attr("dy",(e=>e.y1-e.y0>30?e.x0<A/2?"-0.5em":"1.1em":"0.35em")).attr("text-anchor",(e=>e.x0<A/2?"start":"end")).text((e=>Utils.trunc(e.name,L?25:40))).style("font-size","11px").style("font-weight",(e=>e.y1-e.y0>30?"700":"400")).style("fill",App.presentationMode?"#1A1A1A":"#F1EEE9").style("pointer-events","none")},drillSubaward(e,t){const n=App.subawardDrillState;if(n.path.push({type:t,name:e}),n.level=n.path.length,n.filter=e,n.filterType=t,App.activeFeedSource="sub",App.forecastData.subawards){const e=window.scrollY;App.renderSubawardSankey(App.forecastData.subawards),App.renderSearchTopPrimes(App.forecastData.subawards),App.renderSearchTopSubs(App.forecastData.subawards),App.renderSubawardFeed(),App.renderSubBubbleChart(),requestAnimationFrame((()=>window.scrollTo(0,e)))}},drillSubawardToLevel(e){const t=App.subawardDrillState;if(e<0)App.resetSubawardDrill();else if(t.path=t.path.slice(0,e+1),t.level=t.path.length,t.path.length>0?(t.filter=t.path[t.path.length-1].name,t.filterType=t.path[t.path.length-1].type):(t.filter=null,t.filterType=null),App.activeFeedSource="sub",App.forecastData.subawards){const e=window.scrollY;App.renderSubawardSankey(App.forecastData.subawards),App.renderSearchTopPrimes(App.forecastData.subawards),App.renderSearchTopSubs(App.forecastData.subawards),App.renderSubawardFeed(),App.renderSubBubbleChart(),requestAnimationFrame((()=>window.scrollTo(0,e)))}},resetSubawardDrill(){if(App.subawardDrillState={level:0,path:[],filter:null,filterType:null},App.activeFeedSource="sub",App.forecastData.subawards){const e=window.scrollY;App.renderSubawardSankey(App.forecastData.subawards),App.renderSearchTopPrimes(App.forecastData.subawards),App.renderSearchTopSubs(App.forecastData.subawards),App.renderSubawardFeed(),App.renderSubBubbleChart(),requestAnimationFrame((()=>window.scrollTo(0,e)))}},renderTopBuyers(e){const t=document.getElementById("topBuyersBody");if(!t)return;const n={};e.forEach((e=>{const t=e["Awarding Agency"]||"Unknown";n[t]||(n[t]={name:t,spend:0,count:0}),n[t].spend+=parseFloat(e["Award Amount"])||0,n[t].count++}));const a=Object.values(n).sort(((e,t)=>t.spend-e.spend)),r=a.reduce(((e,t)=>e+t.spend),0);if(0===a.length)return void(t.innerHTML='<div style="text-align:center; color:var(--text-muted); padding:1rem;">No agency data available</div>');const s=a.slice(0,8);t.innerHTML=`\n      <div class="buyer-list">\n        ${s.map(((e,t)=>{const n=r>0?e.spend/r*100:0;return`\n          <div class="buyer-item">\n            <div class="buyer-rank">${t+1}</div>\n            <div class="buyer-info">\n              <div class="buyer-name">${Utils.trunc(e.name,30)}</div>\n              <div class="buyer-stats">${e.count} awards Â· ${n.toFixed(0)}%</div>\n            </div>\n            <div class="buyer-amount">\n              <div class="buyer-spend">${Utils.money(e.spend)}</div>\n            </div>\n          </div>`})).join("")}\n      </div>\n      ${a.length>8?`<div style="text-align:center; color:var(--text-muted); font-size:0.75rem; margin-top:0.75rem;">+${a.length-8} more agencies</div>`:""}\n    `},renderTopWinners(e){const t=document.getElementById("topWinnersBody");if(!t)return;const n={};e.forEach((e=>{const t=e["Recipient Name"]||"Unknown";n[t]||(n[t]={name:t,spend:0,count:0,agencies:new Set}),n[t].spend+=parseFloat(e["Award Amount"])||0,n[t].count++,n[t].agencies.add(e["Awarding Agency"]||"Unknown")}));const a=Object.values(n).map((e=>({...e,agencies:e.agencies.size}))).sort(((e,t)=>t.spend-e.spend)),r=a.reduce(((e,t)=>e+t.spend),0);if(0===a.length)return void(t.innerHTML='<div style="text-align:center; color:var(--text-muted); padding:1rem;">No vendor data available</div>');const s=a.slice(0,8);t.innerHTML=`\n      <div class="buyer-list">\n        ${s.map(((e,t)=>{r>0&&e.spend;return`\n          <div class="buyer-item">\n            <div class="buyer-rank">${t+1}</div>\n            <div class="buyer-info">\n              <div class="buyer-name">${Utils.trunc(e.name,26)}</div>\n              <div class="buyer-stats">${e.count} awards Â· ${e.agencies} ${1===e.agencies?"agency":"agencies"}</div>\n            </div>\n            <div class="buyer-amount">\n              <div class="buyer-spend">${Utils.money(e.spend)}</div>\n            </div>\n          </div>`})).join("")}\n      </div>\n      ${a.length>8?`<div style="text-align:center; color:var(--text-muted); font-size:0.75rem; margin-top:0.75rem;">+${a.length-8} more vendors</div>`:""}\n    `},renderRecompetes(e,t=!1){const n=document.getElementById("recompetesList");if(!n)return;if(!e||0===e.length)return void(n.innerHTML="");const a=e.map((e=>({...e,risk:Utils.missionGapRisk(e)}))),r=a.reduce(((e,t)=>e+(parseFloat(t["Award Amount"])||0)),0),s=a.filter((e=>"high"===e.risk.level)),o=s.reduce(((e,t)=>e+(parseFloat(t["Award Amount"])||0)),0),i=App.onlyHighMissionGap?a.filter((e=>"high"===e.risk.level)):a,l=t?i:i.slice(0,3),c=!t&&i.length>3;let d=`${Utils.money(r)} in ${e.length} contracts expiring within 24 months`;s.length>0&&(d+=` Â· <span style="color:var(--danger); font-weight:600;">${s.length} high-risk (${Utils.money(o)})</span>`);let p=`\n    <div class="section-header">\n      <div class="section-title-group">\n        <span class="section-title">Expiring Contracts</span>\n      </div>\n      <div class="mission-gap-filter">\n        <span class="section-subtitle">${d}</span>\n        ${s.length>0?`\n          <button class="mission-gap-toggle ${App.onlyHighMissionGap?"active":""}"\n        onclick="App.toggleMissionGapFilter()"\n        title="Show only contracts with high mission continuity risk">\n  <i class="fa-solid fa-sort"></i>\n</button>\n        `:""}\n      </div>\n    </div>`;0===i.length?p+='<div style="text-align:center; padding:2rem; color:var(--text-muted);">No contracts match the current filter. <a href="#" onclick="App.toggleMissionGapFilter(); return false;" style="color:var(--accent); margin-left:0.5rem;">Show all</a></div>':(p+=l.map((e=>{if(!e["End Date"])return"";const t=e.generated_internal_id,n=t?`https://www.usaspending.gov/award/${t}`:e["Award ID"]?`https://www.usaspending.gov/search/?hash=&filters=${encodeURIComponent(JSON.stringify({keyword:e["Award ID"]}))}`:null,a=new Date(e["End Date"]),r=a.getMonth(),s=a.getFullYear();let o=1;r>=0&&r<=2?o=2:r>=3&&r<=5?o=3:r>=6&&r<=8&&(o=4);const i=`FY${String(r>=9?s+1:s).slice(-2)} Q${o}`,l=new Date,c=Math.ceil((a-l)/864e5),d=c<180?"urgent":c<365?"soon":"later",p=e.risk,u="high"===p.level?"Mission Gap: High":"medium"===p.level?"Mission Gap: Medium":"Mission Gap: Low",m=e=>Autocomplete.escapeHtml(e);return`\n      <div class="deal-card" style="margin-bottom:1rem; ${"high"===p.level?"border-left: 3px solid var(--danger);":"medium"===p.level?"border-left: 3px solid #FDD835;":""}">\n        <div class="deal-header">\n          <span class="deal-agency">${m(Utils.trunc(e["Awarding Agency"],40))}</span>\n          <span class="deal-amount">${Utils.money(e["Award Amount"])}</span>\n        </div>\n        <div class="deal-desc">${m(Utils.trunc(e.Description,100))}</div>\n        <div class="deal-meta">\n          <span class="meta-tag" style="color:var(--accent); border-color:var(--accent);">${i}</span>\n          <span class="meta-tag mission-gap ${p.level}">${u}</span>\n          ${e["PSC Code"]?`<span class="meta-tag psc">PSC: ${m(e["PSC Code"])}</span>`:""}\n        </div>\n        ${p.reasons.length>0&&"low"!==p.level?`<div class="mission-gap-signals">Signals: ${m(p.reasons.join(", "))}</div>`:""}\n        <div class="deal-footer">\n          <div>\n            <div style="font-size:0.8rem; color:${"urgent"===d?"var(--danger)":"soon"===d?"#FDD835":"var(--text-muted)"}">\n              Expires: ${Utils.date(e["End Date"])} (${c} days)\n            </div>\n            <div style="font-size:0.75rem; color:var(--text-subtle)">Incumbent: ${m(Utils.trunc(e["Recipient Name"],35))}</div>\n          </div>\n          <div style="display:flex;gap:0.5rem;align-items:center;">\n            <button onclick="Utils.copyRecompeteToClipboard(this, '${m(e["Awarding Agency"]||"")}', '${m(e["Awarding Sub Agency"]||"")}', '${m(e["Recipient Name"]||"")}', '${Utils.money(e["Award Amount"])}', '${m(Utils.trunc(e.Description||"",200))}', '${e["Start Date"]||""}', '${e["End Date"]||""}', '${m(e["Award ID"]||"")}', '${m(e["PSC Code"]||"")}', '${m(e["PSC Description"]||"")}', '${m(e["NAICS Code"]||"")}', '${m(e["NAICS Description"]||"")}', '${e["Type of Set Aside"]||""}', '${n||""}')" class="action-btn"><i class="fas fa-copy"></i></button>\n            ${n?`<a href="${n}" target="_blank" class="action-btn">VIEW</a>`:""}\n          </div>\n        </div>\n      </div>`})).join(""),c&&(p+=`\n        <button onclick="App.renderRecompetes(App.forecastData.analysis.recompetes, true)" style="width: 100%; padding: 0.875rem; background: var(--bg-card); border: 1px dashed var(--border); border-radius: 4px; color: var(--accent); font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; cursor: pointer; transition: all 0.2s; text-transform: uppercase; letter-spacing: 1px;" onmouseover="this.style.borderColor='var(--accent)';this.style.background='var(--accent-dim)'" onmouseout="this.style.borderColor='var(--border)';this.style.background='var(--bg-card)'">\n          <i class="fas fa-chevron-down" style="margin-right: 0.5rem;"></i>Show All ${i.length} Expiring Contracts\n        </button>`)),n.innerHTML=p},toggleMissionGapFilter(){App.onlyHighMissionGap=!App.onlyHighMissionGap,App.forecastData.analysis&&App.forecastData.analysis.recompetes&&this.renderRecompetes(App.forecastData.analysis.recompetes)},calculateRollingForecast(e,t,n,a){const r=[];let s=t,o=n;for(let n=0;n<4;n++){const n=[];Object.keys(e).map(Number).sort().reverse().forEach((a=>{a<t&&e[a]&&e[a][o]>0&&n.length<3&&n.push({fy:a,amount:e[a][o]})}));let i=0;if(n.length>0){const e=[.5,.3,.2];let t=0;n.forEach(((n,a)=>{const r=e[a]||.1;i+=n.amount*r,t+=r})),i/=t}const l=e[t-1]&&e[t-1][o]?e[t-1][o]:0,c=e[t-2]&&e[t-2][o]?e[t-2][o]:0;let d=0;c>0&&l>0?d=(l-c)/c:a&&(d=a/100),d=Math.max(-.5,Math.min(.5,d));const p=1+d;let u=0;l>0?u=l*p:i>0&&(u=i*p),r.push({period:`FY${String(s).slice(-2)} Q${o}`,quarter:o,fiscalYear:s,historicalAvg:i,lastYear:l,priorYear:c,quarterGrowth:100*d,projection:u,dataPoints:n.length}),o++,o>4&&(o=1,s++)}return r},renderForecastTable(e,t,n,a,r,s){const o=document.getElementById("forecastTableBody");if(!o)return;const i=Utils.getCurrentFY(),l=Utils.getCurrentQuarter(),c=r.byFY&&r.byFY[i]?r.byFY[i]:{},d=Object.values(c).reduce(((e,t)=>e+(t||0)),0);let p=0;for(let t=1;t<=4;t++){const n=c[t]||0,a=e.find((e=>e.fiscalYear===i&&e.quarter===t)),r=a?a.projection:0;p+=t<l?n:t===l?Math.max(n,r):r}o.innerHTML=e.map((e=>{const t=e.dataPoints>0,n=e.quarterGrowth||0,a=n>=0?"trend-up":"trend-down",r=n>=0?"â–²":"â–¼",s=c[e.quarter]||0,o=e.fiscalYear===i&&e.quarter<l,d=e.fiscalYear===i&&e.quarter===l;let p="";return p=o?`<span style="color:var(--text-primary); font-weight:700; border-bottom:1px dotted var(--text-muted); cursor:help;" title="Actual Obligation (Final)">${Utils.money(s)}</span>`:d?`<span style="color:var(--accent); font-weight:600;" title="Proj: ${Utils.money(e.projection)} / Actual: ${Utils.money(s)}">${Utils.money(Math.max(s,e.projection))}</span>`:`<span style="color:var(--accent); font-weight:600;">${e.projection>0?Utils.money(e.projection):"-"}</span>`,`\n      <tr>\n        <td>\n          <strong>${e.period}</strong> \n          ${o?'<i class="fas fa-lock" style="font-size:0.6rem; color:var(--text-muted); margin-left:4px;" title="Closed Quarter"></i>':""}\n          ${d?'<i class="fas fa-clock" style="font-size:0.6rem; color:var(--accent); margin-left:4px;" title="Active Quarter"></i>':""}\n        </td>\n        <td style="color:var(--text-muted);">\n          ${t?Utils.money(e.historicalAvg):'<span style="opacity:0.5">No data</span>'}\n        </td>\n        <td style="color:var(--text-muted);">${e.lastYear>0?Utils.money(e.lastYear):"-"}</td>\n        <td style="white-space: nowrap;">\n          <div style="display: inline-flex; align-items: center; gap: 0.5rem;">\n            ${p}\n            ${!o&&e.lastYear>0?`<span class="trend-pill ${a}" style="font-size:0.65rem;">${r} ${Math.abs(n).toFixed(0)}%</span>`:""}\n          </div>\n        </td>\n      </tr>\n    `})).join("");const u=document.getElementById("projectionSummary");if(u&&p>0){const n=t>0?(p-t)/t*100:0,a=n>=0?"var(--success)":"var(--danger)",o=`FY${String(i).slice(-2)}`,l=p>0?d/p*100:0,c=Math.max(0,p-d),m=s&&s[0]&&s[0]["Awarding Agency"]?s[0]["Awarding Agency"]:"the primary agency";let g="";g=r.hhi>2500?"teaming with established primes to bypass high barriers to entry.":r.hhi>1500?"a targeted account-entry strategy focusing on under-served sub-agencies.":`an aggressive displacement strategy targeting the ${m} incumbent base.`;const h=r.recompetes.reduce(((e,t)=>e+(parseFloat(t["Award Amount"])||0)),0),y=e.length>0&&Number(e.reduce(((e,t)=>e+(t.dataPoints||0)),0)/e.length)||0,b=Number(r.volatility?.score)||.5;let f=y/3*70+30*(1-b);f=Math.max(0,Math.min(100,Number(f)||0));let v=f>=75?"HIGH":f>=45?"MEDIUM":"LOW",A=v.toLowerCase();u.innerHTML=`\n      <div class="hero-growth-label">Projected ${o} Forecast</div>\n      <div style="display: flex; align-items: baseline; gap: 1.5rem; flex-wrap: wrap; margin-bottom: 0.5rem;">\n        <div class="hero-growth-value">${Utils.money(p)}</div>\n        <div style="color:${a}; font-size: 1.5rem; font-weight: 700; font-family: 'JetBrains Mono';">\n          ${n>=0?"â–²":"â–¼"} ${Math.abs(n).toFixed(0)}% <span style="font-size:0.8rem; opacity:0.7">YoY Growth</span>\n        </div>\n      </div>\n      \n      <div style="margin-bottom: 1.5rem; font-size: 0.7rem; color: var(--text-muted);">\n        <div style="display:flex; justify-content:space-between; margin-bottom:4px;">\n          <span>Obligations YTD: <strong style="color:var(--text-primary)">${Utils.money(d)}</strong></span>\n          <span>Forecast (To-Go): ${Utils.money(c)}</span>\n        </div>\n        <div style="height:6px; width:100%; background:rgba(255,255,255,0.1); border-radius:3px; overflow:hidden;">\n          <div style="height:100%; width:${l}%; background:var(--text-primary); opacity:0.8;"></div>\n        </div>\n      </div>\n      \n      <div class="strategic-narrative-card">\n        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">\n          <div style="color:var(--accent); font-weight:700; font-size:0.7rem; text-transform:uppercase; letter-spacing:1px;">\n            <i class="fas fa-robot"></i> Data Insights\n          </div>\n          <div style="font-size:0.6rem; color:var(--text-muted); text-transform:uppercase; letter-spacing:1px;">\n            Model Confidence: <span class="analysis-panel-badge ${A}">${v} (${f.toFixed(0)}%)</span>\n          </div>\n        </div>\n\n        <strong>Market Dynamics:</strong> This is a <strong>${r.marketStatus}</strong> market (HHI: ${r.hhi}). \n        With a ${n>=0?"bullish":"softening"} <strong>${n.toFixed(0)}% ${o} growth forecast</strong>, \n        the model recommends ${g}\n        ${r.recompetes.length>5?` High recompete volume (${Utils.money(h)}) in the next 24 months signals a prime capture window.`:""}\n        \n        <div style="margin-top: 15px; padding: 10px; background: rgba(0,0,0,0.2); border: 1px solid var(--border); border-radius: 4px;">\n          <div style="font-size: 0.6rem; color: var(--accent); text-transform: uppercase; margin-bottom: 5px; font-weight: 700;">Confidence Logic</div>\n          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.65rem; color: var(--text-muted);">\n            <div>\n              <strong>Density:</strong> ${y.toFixed(1)}/3.0 Years \n              <div style="height:3px; width:100%; background:#333; margin-top:3px;">\n                <div style="height:100%; width:${y/3*100}%; background:var(--accent);"></div>\n              </div>\n            </div>\n            <div>\n              <strong>Stability:</strong> ${(100-100*b).toFixed(0)}% Stable\n              <div style="height:3px; width:100%; background:#333; margin-top:3px;">\n                <div style="height:100%; width:${100*(1-b)}%; background:var(--accent);"></div>\n              </div>\n            </div>\n          </div>\n          <div style="font-size: 0.6rem; margin-top: 8px; font-style: italic; opacity: 0.8;">\n            Note: High volatility or <1 year of data reduces projection reliability.\n          </div>\n        </div>\n      </div>\n      \n      <div class="disclaimer-text" style="margin-top: 1.5rem; padding: 1rem; border-top: 1px solid var(--border); font-size: 0.7rem; color: var(--text-muted); line-height: 1.5;">\n  \n  <strong style="color: var(--accent); text-transform: uppercase; letter-spacing: 0.5px; display: block; margin-bottom: 0.5rem;">\n    <i class="fas fa-info-circle"></i> How to Read This Data\n  </strong>\n\n  <ul style="padding-left: 1rem; margin-bottom: 1rem; list-style-type: disc;">\n    <li style="margin-bottom: 0.5rem;">\n      <strong>What You're Seeing:</strong> The top 100 contracts (by total obligations) that had any funding action within the past 12 months. This is one API call to USASpending.gov's award search with a 12-month time filter â€” no estimates, no transformations. Data is sourced from <code>api/v2/search/spending_by_award</code>.\n    </li>\n    <li style="margin-bottom: 0.5rem;">\n      <strong>What "Total Obligations" Means:</strong> The dollar amounts are <em>Total Obligations to Date</em> â€” the cumulative amount the government has obligated on each contract over its entire life. This is the standard metric used on USASpending.gov. A contract showing "$2B since 2008" means $2B has been obligated since 2008, not in the last year. Check the start date for context.\n    </li>\n    <li style="margin-bottom: 0.5rem;">\n      <strong>How to Use This:</strong> Use total obligations to gauge program scale and government commitment. Use the start date to understand contract age. Use the end date to identify upcoming recompetes. Recently started contracts with large obligations indicate high-priority, fast-moving programs.\n    </li>\n    <li style="margin-bottom: 0.25rem;">\n      <strong>Obligations vs. Ceiling:</strong> We show <em>Obligated Funds</em> (cash the government has committed), not Ceiling (maximum contract value). Obligations represent real money committed.\n    </li>\n    <li style="margin-bottom: 0.25rem;">\n      <strong>Seasonality Model:</strong> Forecasts account for the "Q4 Spending Spree" (July-Sept). Agencies historically concentrate spending at fiscal year-end.\n    </li>\n    <li style="margin-bottom: 0.25rem;">\n      <strong>Market Lock (HHI):</strong> Incumbency strength indicator. <span style="color:#ddd;">Low (&lt;1,500)</span> = competitive. <span style="color:#ddd;">High (&gt;2,500)</span> = concentrated, consider teaming.\n    </li>\n    <li style="margin-bottom: 0.25rem;">\n      <strong>Reporting Lag:</strong> Defense agencies (DoD) often delay reporting by 90 days. Recent awards may not appear immediately.\n    </li>\n  </ul>\n\n  <div style="font-style: italic; opacity: 0.8; border-top: 1px dashed var(--border); padding-top: 0.5rem;">\n    <strong>Disclaimer:</strong> Govhoo is a free intelligence tool. All data sourced directly from USASpending.gov with no modifications to dollar amounts. Always verify opportunities on SAM.gov.\n  </div>\n\n</div>\n    `}else u&&(u.innerHTML="")},exportCSV(e){const t="search"===App.mode?App.searchData.active:App.forecastData.awards||[];if(!t.length){if(e){const t=e.innerHTML;e.style.color="var(--danger)",e.style.borderColor="var(--danger)",e.innerHTML='<i class="fas fa-times"></i>',setTimeout((()=>{e.style.color="",e.style.borderColor="",e.innerHTML=t}),2e3)}return}const n=t.map((e=>{let t="N/A";if(e["Start Date"]){const n=new Date(e["Start Date"]),a=n.getMonth(),r=n.getFullYear();let s;s=a>=9?1:a<=2?2:a<=5?3:4,t=`FY${String(a>=9?r+1:r).slice(-2)} Q${s}`}const n=e.generated_internal_id;let a="";return n?a=`https://www.usaspending.gov/award/${n}`:e["Award ID"]&&(a=`https://www.usaspending.gov/search/?hash=&filters=${encodeURIComponent(JSON.stringify({keyword:e["Award ID"]}))}`),[`"${t}"`,`"${(e["Recipient Name"]||"").replace(/"/g,'""')}"`,`"${(e["Awarding Agency"]||"").replace(/"/g,'""')}"`,`"${(e["Awarding Sub Agency"]||"").replace(/"/g,'""')}"`,e["Award Amount"]||0,`"${(e.Description||"").replace(/"/g,'""')}"`,e["Start Date"]||"",e["End Date"]||"",e["Award ID"]||"",a]})),a=[["Fiscal Period","Recipient","Agency","Sub-Agency","Total Obligations","Description","Start Date","End Date","Award ID","Award Link"].join(","),...n.map((e=>e.join(",")))].join("\n"),r=new Blob([a],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(r),o=document.createElement("a");if(o.setAttribute("href",s),o.setAttribute("download",`govhoo_${App.mode}_${App.currentQuery}.csv`),document.body.appendChild(o),o.click(),document.body.removeChild(o),e){const t=e.innerHTML;e.style.color="var(--success)",e.style.borderColor="var(--success)",e.innerHTML='<i class="fas fa-check"></i>',setTimeout((()=>{e.style.color="",e.style.borderColor="",e.innerHTML=t}),2e3)}},showLoader(e,t){document.getElementById("loaderText").innerText=e,document.getElementById("loaderSubtext").innerText=t||"",document.getElementById("loader").style.display="flex"},hideLoader(){document.getElementById("loader").style.display="none"},transitionToApp(){const e=document.getElementById("heroView");e.classList.add("slide-up"),document.getElementById("appView").style.display="block",document.getElementById("miniSearch").value=App.currentQuery,document.getElementById("dashboardContainer").classList.add("active");const t=document.getElementById("dashboardContainer");if(!t.querySelector(".hero-footer")){const n=e.querySelector(".hero-footer");if(n){const e=n.cloneNode(!0);e.removeAttribute("id"),t.appendChild(e)}}setTimeout((()=>{e.style.display="none",e.classList.add("hidden")}),500)},shareLink(e){const t=new URL(window.location);t.searchParams.set("q",App.currentQuery),t.searchParams.set("mode",App.mode),navigator.clipboard.writeText(t.toString()).then((()=>{if(e){const t=e.innerHTML;e.style.color="var(--success)",e.style.borderColor="var(--success)",e.innerHTML='<i class="fas fa-check"></i>',setTimeout((()=>{e.style.color="",e.style.borderColor="",e.innerHTML=t}),2e3)}}))},shareBrief(e){const t=App.searchData.active,n=App.currentQuery||"Unknown",a=t.reduce(((e,t)=>e+(parseFloat(t["Award Amount"])||0)),0),r=new Set(t.map((e=>e["Awarding Agency"])).filter(Boolean)),s=new Set(t.map((e=>e["Recipient Name"])).filter(Boolean)),o=new Date,i=new Date(o.getTime()+7776e6);let l=0,c=0;t.forEach((e=>{if(e["End Date"]){const t=new Date(e["End Date"]);t>=o&&t<=i&&(l++,c+=parseFloat(e["Award Amount"])||0)}}));const d=t.filter((e=>e["Type of Set Aside"])).length,p=new URL(window.location);p.searchParams.set("q",n),p.searchParams.set("mode",App.mode);let u=`ðŸ”ï¸ Govhoo Search: "${n}"\n`;if(u+=`ðŸ’° ${Utils.money(a)} across ${r.size} agencies, ${s.size} vendors\n`,l>0&&(u+=`ðŸ”¥ ${l} contracts expiring in 90 days (${Utils.money(c)})\n`),d>0&&(u+=`ðŸ·ï¸ ${d} set-aside awards in results\n`),App.forecastData?.subawards?.length){const e=App.forecastData.subawards.reduce(((e,t)=>e+(parseFloat(t["Sub-Award Amount"])||0)),0);u+=`ðŸ’¸ ${App.forecastData.subawards.length} subcontracts tracked (${Utils.money(e)})\n`}u+=`ðŸ‘‰ ${p.toString()}`,navigator.clipboard.writeText(u).then((()=>{if(e){const t=e.innerHTML;e.style.color="var(--success)",e.style.borderColor="var(--success)",e.innerHTML='<i class="fas fa-check"></i>',setTimeout((()=>{e.style.color="",e.style.borderColor="",e.innerHTML=t}),2e3)}}))}},PromptPackageGenerator={calculateMetrics(e,t){const n=e.reduce(((e,t)=>e+(parseFloat(t["Award Amount"])||0)),0),a=e.length,r=a>0?n/a:0,s=e.map((e=>parseFloat(e["Award Amount"])||0)).filter((e=>e>0)).sort(((e,t)=>e-t));let o=0;if(s.length>0){const e=Math.floor(s.length/2);o=s.length%2!=0?s[e]:(s[e-1]+s[e])/2}const i=s.filter((e=>e>=1e6)).length,l=s.filter((e=>e>=1e5&&e<1e6)).length,c=s.filter((e=>e<1e5)).length,d=new Date,p=e.filter((e=>{const t=(new Date(e["End Date"])-d)/2592e6;return t>0&&t<=18}));return{totalValue:n,contractCount:a,avgDealSize:r,medianDealSize:o,largeDeals:i,midDeals:l,smallDeals:c,expiringValue:p.reduce(((e,t)=>e+(parseFloat(t["Award Amount"])||0)),0),expiringCount:p.length}},buildVendorIntel(e){const t={},n=new Date;e.forEach((e=>{const a=e["Recipient Name"]||"Unknown";t[a]||(t[a]={spend:0,count:0,agencies:new Set,contracts:[],expiring:0});const r=parseFloat(e["Award Amount"])||0;t[a].spend+=r,t[a].count++,t[a].agencies.add(e["Awarding Agency"]),t[a].contracts.push(e);const s=(new Date(e["End Date"])-n)/2592e6;s>0&&s<=18&&(t[a].expiring+=r)}));const a=Object.values(t).reduce(((e,t)=>e+t.spend),0);return Object.entries(t).map((([e,t])=>({name:e,spend:t.spend,share:a>0?t.spend/a*100:0,contracts:t.count,agencies:t.agencies.size,expiring:t.expiring,avgDeal:t.count>0?t.spend/t.count:0,isChannel:SalesPlanManager.isChannel(e)}))).sort(((e,t)=>t.spend-e.spend))},buildAgencyIntel(e){const t={},n=new Date;e.forEach((e=>{const a=e["Awarding Agency"]||"Unknown",r=e["Awarding Sub Agency"]||"Unknown";t[a]||(t[a]={spend:0,count:0,subs:{},vendors:{},vehicles:new Set,setAsides:new Set,expiring:0,expiringCount:0});const s=parseFloat(e["Award Amount"])||0;t[a].spend+=s,t[a].count++,t[a].subs[r]||(t[a].subs[r]={spend:0,count:0,vendors:{}}),t[a].subs[r].spend+=s,t[a].subs[r].count++;const o=e["Recipient Name"]||"Unknown";t[a].vendors[o]||(t[a].vendors[o]=0),t[a].vendors[o]+=s,t[a].subs[r].vendors[o]||(t[a].subs[r].vendors[o]=0),t[a].subs[r].vendors[o]+=s;const i=VehicleDetector.detect(e["Award ID"]);i&&t[a].vehicles.add(i.short);const l=VehicleDetector.getSetAsideLabel(e["Type of Set Aside"]);l&&t[a].setAsides.add(l);const c=(new Date(e["End Date"])-n)/2592e6;c>0&&c<=18&&(t[a].expiring+=s,t[a].expiringCount++)}));const a=Object.values(t).reduce(((e,t)=>e+t.spend),0);return Object.entries(t).map((([e,t])=>{const n=Object.entries(t.vendors).sort(((e,t)=>t[1]-e[1])).slice(0,5).map((([e,n])=>({name:e,spend:n,share:t.spend>0?n/t.spend*100:0}))),r=Object.entries(t.subs).sort(((e,t)=>t[1].spend-e[1].spend)).slice(0,5).map((([e,t])=>{const n=Object.entries(t.vendors).sort(((e,t)=>t[1]-e[1]))[0];return{name:e,spend:t.spend,count:t.count,topVendor:n?n[0]:"Unknown"}}));return{name:e,spend:t.spend,share:a>0?t.spend/a*100:0,contracts:t.count,topVendors:n,topSubs:r,incumbent:n[0]?.name||"Unknown",vehicles:[...t.vehicles],setAsides:[...t.setAsides],expiring:t.expiring,expiringCount:t.expiringCount}})).sort(((e,t)=>t.spend-e.spend))},generatePrompt(e,t){const n=e=>Utils.money(e),a=e=>e&&!isNaN(e)?e.toFixed(1)+"%":"0.0%",r=e.query.toUpperCase(),s=`FY${String(Utils.getCurrentFY()).slice(-2)}`,o=Utils.getCurrentFY(),i=e.vendors.filter((e=>!e.isChannel)),l=e.vendors.filter((e=>e.isChannel)),c=e.agencies.slice(0,6),d=e.metrics,p=VendorRelationships.getTagged(),u=p.mine.length||p.partner.length||p.competitor.length,m=e.analysis||{},g=d.expiringValue,h=[...new Set(c.flatMap((e=>e.vehicles||[])))],y=[...new Set(c.flatMap((e=>e.setAsides||[])))],b=c.flatMap((e=>(e.topSubs||[]).map((t=>`| ${e.name} | ${t.name} | ${n(t.spend)} | ${t.count} | ${t.topVendor} |`)))).slice(0,15),f=(m.recompetes||[]).slice(0,10).map((e=>{const t=e["End Date"]?new Date(e["End Date"]):null,a=t?Math.ceil((t-new Date)/864e5):0,r=Utils.missionGapRisk?Utils.missionGapRisk(e):{level:"unknown"};return`| ${(e["Awarding Sub Agency"]||e["Awarding Agency"]||"Unknown").substring(0,30)} | ${(e["Recipient Name"]||"Unknown").substring(0,25)} | ${n(e["Award Amount"])} | ${Utils.date(e["End Date"])} | ${a}d | ${r.level||"â€”"} |`}));return`\n<SYSTEM_INSTRUCTIONS_INTERNAL>\n- ROLE: Senior Federal Sales Director at a Tier-1 CSP/Defense Prime.\n- DATA INTEGRITY: Use ONLY the provided data below. Every table, vendor, and dollar figure comes from live USASpending.gov awards.\n- CLOSED UNIVERSE: Do not hallucinate outside companies, placeholder vendors, or market stats.\n- ACTIONABILITY: Every recommendation must tie to a specific agency, vendor, vehicle, or contract from the data.\n- START RESPONSE IMMEDIATELY with the # Title. Do not include meta-commentary.\n</SYSTEM_INSTRUCTIONS_INTERNAL>\n\n# Federal Go-To-Market Plan: ${r}\n\n**Scope**: Fiscal Year ${o} (${s}). Total addressable: ${n(d.totalValue)} across ${d.contractCount} contracts.\n**Median Deal**: ${n(d.medianDealSize)} Â· **Recompete Signal**: ${n(g)} across ${d.expiringCount} expiring contracts.\n${h.length>0?`**Active Vehicles**: ${h.join(", ")}`:""}\n${y.length>0?`**Set-Aside Types**: ${y.join(", ")}`:""}\n${u?`\n**User's Vendor Relationships** (use these to personalize ALL recommendations):\n${p.mine.length?`- MY COMPANY: ${p.mine.join(", ")}`:""}\n${p.partner.length?`- PARTNERS: ${p.partner.join(", ")}`:""}\n${p.competitor.length?`- COMPETITORS: ${p.competitor.join(", ")}`:""}\n`:""}\n\n---\n\n## EXECUTIVE SUMMARY\nOne high-density paragraph stating the ${s} target revenue range (calculated as a percentage of the ${n(g)} recompete signal), primary competitive risk, top 3 accounts by priority, and the recommended go-to-market motion (direct, partner-led, or hybrid). ${u?"Frame the summary around displacing COMPETITORS and leveraging PARTNERS.":""}\n\n## MARKET DYNAMICS\nFour sentences explaining how revenue flows in the ${r} market. Specifically address: incumbency lock-in, contract vehicle gatekeeping, and the role of set-aside requirements (${y.length>0?y.join(", "):"none identified"}) in shaping capture strategy.\n\n## SUB-AGENCY ACCOUNT MAP\nThis is the granular view. These are the buying offices â€” the people your users met at conferences like AFCEA West.\n\n| Parent Agency | Sub-Agency / Command | Spend | Contracts | Top Incumbent |\n|---|---|---:|---:|---|\n${b.length>0?b.join("\n"):"> No sub-agency data available."}\n\nFor each sub-agency above:\n- Identify the specific incumbent vulnerability (single-vendor dependency, expiring contracts, set-aside mismatch)\n- Recommend whether to pursue direct or through a partner, and name the specific partner from the data\n- Assign priority (Tier 1 = pursue now, Tier 2 = develop, Tier 3 = monitor)\n\n## COMPETITIVE LANDSCAPE\n| Vendor | Spend | Market Share | Contracts | Agencies | Expiring | Dominance Risk |\n|---|---:|---:|---:|---:|---:|---|\n${i.slice(0,8).map((e=>{const t=e.share>40?"HIGH â€” single-vendor lock":e.share>20?"MEDIUM â€” strong position":"LOW â€” fragmented",r=VendorRelationships.get(e.name),s="mine"===r?" MY CO":"partner"===r?" PARTNER":"competitor"===r?" TARGET":"";return`| ${e.name}${s} | ${n(e.spend)} | ${a(e.share)} | ${e.contracts} | ${e.agencies} | ${n(e.expiring)} | ${t} |`})).join("\n")}\n\nAnalysis requirements:\n* For each vendor with >20% share: identify their specific lock-in mechanism and the conditions under which they can be displaced\n* For vendors with high expiring values: these are the immediate pipeline opportunities â€” recommend specific displacement actions\n* ${u&&p.competitor.length?`Specifically detail how to displace ${p.competitor.join(" and ")} using data above`:"Identify the top 2 displacement targets"}\n\n## CHANNEL & PARTNER LANDSCAPE\n${0===l.length?"> No channel partners identified. Mark resellers in the Sales Plan modal to populate this section.":`\n| Partner | Spend | Share | Contracts | Agencies | Expiring |\n|---|---:|---:|---:|---:|---:|\n${l.slice(0,6).map((e=>`| ${e.name} | ${n(e.spend)} | ${a(e.share)} | ${e.contracts} | ${e.agencies} | ${n(e.expiring)} |`)).join("\n")}\n\nFor each partner above: where do they provide "speed to contract" via established vehicles? Which sub-agencies above should be pursued through each partner vs. direct?`}\n\n## CONTRACT VEHICLE STRATEGY\n${h.length>0?`The following vehicles are active in this market: **${h.join(", ")}**.\n\nFor each vehicle:\n- Which agencies/sub-agencies are buying through it?\n- Who holds positions on it that could serve as teaming partners?\n- What is the competitive dynamic on each vehicle?`:"No specific contract vehicles detected in award IDs. Analyze the agencies above and recommend the most likely vehicles needed for market entry (e.g., GSA Schedule, OASIS+, SeaPort-NxG, CIO-SP4)."}\n\n${y.length>0?`### Set-Aside Strategy\nActive set-asides in this market: **${y.join(", ")}**. \n- Which opportunities require small business teaming vs. can be pursued full-and-open?\n- Recommend specific set-aside teaming arrangements based on the partner data above.`:""}\n\n## EXPIRING CONTRACTS â€” IMMEDIATE PIPELINE\n${f.length>0?`These contracts are expiring within 24 months. Each represents a real, funded recompete opportunity.\n\n| Sub-Agency | Incumbent | Value | End Date | Days Out | Mission Risk |\n|---|---|---:|---|---:|---|\n${f.join("\n")}\n\nFor the top 5 expiring contracts:\n- Is the incumbent likely to be sole-sourced or will this be competed?\n- What is the recommended capture action (bid direct, team, or monitor)?\n- What is the 30/60/90 day action plan for each?`:"> No expiring contracts detected in current data window. Consider expanding search timeframe."}\n\n## PARTNER-TO-INCUMBENT ATTACK MAP\nMap the most logical displacement paths using the agency, vehicle, and partner data above.\n\n| Target Incumbent | Sub-Agency | Vehicle | Vulnerability | Recommended Path | Why Now |\n|---|---|---|---|---|---|\n${i.slice(0,4).map(((e,t)=>{const a=l.length>0?l[t%l.length].name:"DIRECT",r=h.length>0?h[t%h.length]:"TBD";return`| ${e.name} | ${c[t%c.length]?.topSubs?.[0]?.name||"Primary"} | ${r} | ${n(e.expiring)} expiring | ${a} | Recompete window |`})).join("\n")}\n\n## PIPELINE TARGETS\nBased on the data:\n- **Addressable recompete pipeline**: ${n(g)} (${d.expiringCount} contracts)\n- **Median deal size**: ${n(d.medianDealSize)}\n- **Deal mix**: ${d.largeDeals} large ($1M+), ${d.midDeals} mid ($100K-$1M), ${d.smallDeals} small (<$100K)\n\nCalculate a realistic ${s} revenue target as a range (conservative/moderate/aggressive) based on win rates of 15%/25%/35% against the recompete pipeline. State the required number of active pursuits to hit each target.\n\n## GO-TO-MARKET MOTION\nState clearly whether execution is Partner-Led, Direct-Led, or Hybrid. Base this on:\n- Vehicle access (do you hold the vehicles above or need a partner?)\n- Set-aside requirements (do contracts require SB teaming?)\n- Incumbent concentration (are there openings or is the market locked?)\n\n## NEXT 30 DAYS: EXECUTION SPRINT\n| Day | Action | Owner | Deliverable | Kill/Go Gate |\n|---|---|---|---|---|\n| 1-5 | | BD Lead | | |\n| 6-15 | | Capture Mgr | | |\n| 16-25 | | BD + Technical | | |\n| 26-30 | | BD Lead | Pipeline Review | Kill/No-Go |\n\nFill this table with specific actions tied to the sub-agencies, incumbents, and vehicles from the data above. Every action must reference a real entity from this plan.\n\n## RISKS AND MITIGATION\n| Risk | Likelihood | Impact | Mitigation |\n|---|---|---|---|\n| Vehicle lock-out | | | |\n| Incumbent protest | | | |\n| Set-aside mismatch | | | |\n| Funding uncertainty | | | |\n| Partner dependency | | | |\n\n## APPENDIX: DATA SOURCES\nAll data sourced from USASpending.gov via Govhoo.com. Search query: "${r}". ${d.contractCount} contracts analyzed across ${c.length} agencies. Generated ${(new Date).toISOString().split("T")[0]}.`},buildPackage(e,t,n={}){const a=this.calculateMetrics(e,t),r=this.buildVendorIntel(e),s=this.buildAgencyIntel(e);return this.generatePrompt({query:App.currentQuery,metrics:a,vendors:r,agencies:s,analysis:t},n)},downloadPackage(e){const t=new Blob([e],{type:"text/plain;charset=utf-8"}),n=document.createElement("a");n.href=URL.createObjectURL(t);const a=Utils.getCurrentFY();n.download=`Territory_Plan_FY${a}_${App.currentQuery.replace(/\s+/g,"_")}.txt`,document.body.appendChild(n),n.click(),document.body.removeChild(n)}},PipelineBuilder={generatedPipeline:[],historicalData:null,init(){const e=document.getElementById("pipelineTargetFY");if(e){const t=Utils.getCurrentFY();e.innerHTML=`\n        <option value="${t}" selected>FY${t} (Current)</option>\n        <option value="${t+1}">FY${t+1} (Next)</option>\n      `}},open(){const e=document.getElementById("pipelineBuilderModal");e&&(this.init(),this.populateAgencyDropdown(),e.classList.add("active"),document.body.style.overflow="hidden",document.getElementById("pipelineResultsArea").style.display="none",document.getElementById("pipelineLoading").style.display="none",document.getElementById("btnDownloadPipeline").disabled=!0,document.getElementById("pipelineDataStatus").textContent="Configure options and click Generate to build your pipeline.")},close(){const e=document.getElementById("pipelineBuilderModal");e&&(e.classList.remove("active"),document.body.style.overflow="")},populateAgencyDropdown(){const e=document.getElementById("pipelineFocusAgency");if(!e)return;const t=App.forecastData.awards||App.searchData.raw||[],n=[...new Set(t.map((e=>e["Awarding Agency"])).filter(Boolean))].sort();e.innerHTML='<option value="">All Agencies in Results</option>'+n.map((e=>`<option value="${e}">${Utils.trunc(e,50)}</option>`)).join("")},async generate(){const e=parseInt(document.getElementById("pipelineTargetFY").value),t=parseInt(document.getElementById("pipelineHistoryYears").value),n=parseFloat(document.getElementById("pipelineProbMultiplier").value),a=parseFloat(document.getElementById("pipelineMinDeal").value),r=document.getElementById("pipelineFocusAgency").value;document.getElementById("pipelineLoading").style.display="flex",document.getElementById("pipelineResultsArea").style.display="none",document.getElementById("pipelineDataStatus").textContent="Fetching historical spending data...";try{const s=await this.fetchHistoricalData(t);if(!s||0===s.length)throw new Error("No historical data found for this search.");this.historicalData=s,document.getElementById("pipelineDataStatus").textContent="Analyzing spending patterns and qualifying opportunities...";const o=this.buildPipelineFromHistory(s,{targetFY:e,historyYears:t,probMultiplier:n,minDeal:a,focusAgency:r});this.generatedPipeline=o,this.renderResults(o,e),document.getElementById("pipelineLoading").style.display="none",document.getElementById("pipelineResultsArea").style.display="block",document.getElementById("btnDownloadPipeline").disabled=0===o.length,document.getElementById("pipelineDataStatus").textContent=`Generated ${o.length} qualified opportunities totaling ${Utils.money(o.reduce(((e,t)=>e+t.Amount),0))}`}catch(e){console.error("Pipeline generation error:",e),document.getElementById("pipelineLoading").style.display="none",document.getElementById("pipelineDataStatus").textContent=`Error: ${e.message}`}},async fetchHistoricalData(e){const t=App.currentQuery;if(!t)throw new Error("No search query found. Please run a search first.");const n=Utils.getCurrentFY(),a=[];for(let r=0;r<e;r++){const e=n-r,s=e-1+"-10-01",o=`${e}-09-30`,i=Utils.buildFilters(t,[{start_date:s,end_date:o}]);try{const t=await fetch(`${API.baseUrl}/search/spending_by_award/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filters:i,fields:["Award ID","Recipient Name","Description","Start Date","End Date","Award Amount","Awarding Agency","Awarding Sub Agency","NAICS Code","NAICS Description","PSC Code","PSC Description","generated_internal_id","Type of Set Aside"],limit:100,sort:"Award Amount",order:"desc"})}),n=await t.json();n.results&&n.results.length>0&&(n.results.forEach((t=>{t._fiscalYear=e,t._quarter=this.getQuarterFromDate(t["Start Date"])})),a.push(...n.results))}catch(t){console.warn(`Failed to fetch FY${e} data:`,t)}}return a},getQuarterFromDate(e){if(!e)return 1;const t=new Date(e).getMonth();return t>=9?1:t<=2?2:t<=5?3:4},getFYQuarterDates:(e,t)=>({1:{start:e-1+"-10-01",end:e-1+"-12-31"},2:{start:`${e}-01-01`,end:`${e}-03-31`},3:{start:`${e}-04-01`,end:`${e}-06-30`},4:{start:`${e}-07-01`,end:`${e}-09-30`}}[t]),scoreOpportunity(e,t,n){let a=0;const r=[],s=e.historicalAmounts.reduce(((e,t)=>e+t),0)/e.historicalAmounts.length;s>=1e6?(a+=25,r.push("$1M+ historical budget")):s>=25e4?(a+=20,r.push("$250K+ historical budget")):s>=5e4?(a+=15,r.push("$50K+ historical budget")):a+=5,e.subAgency&&e.subAgency!==e.agency&&(a+=10,r.push("Sub-agency identified"));const o=[...new Set(e.historicalYears)],i=o.length/t;return i>=.8?(a+=25,r.push(`Recurring ${o.length}/${t} years`)):i>=.5?(a+=15,r.push(`Observed ${o.length}/${t} years`)):(a+=5,r.push(`Seen ${o.length}/${t} years`)),e.historicalAmounts.length>=5?(a+=10,r.push(`${e.historicalAmounts.length} historical awards`)):e.historicalAmounts.length>=3&&(a+=5,r.push(`${e.historicalAmounts.length} historical awards`)),n&&(a+=25,r.push(`Expiring contract: ${Utils.money(n.amount)} ends ${n.endDate}`)),e.setAsides.size>0&&(a+=5,r.push(`Set-aside: ${[...e.setAsides].join(", ")}`)),e.vehicles.size>0&&(a+=5,r.push(`Vehicle: ${[...e.vehicles].join(", ")}`)),{score:Math.min(a,100),signals:r,recurrence:i}},buildPipelineFromHistory(e,t){const{targetFY:n,historyYears:a,probMultiplier:r,minDeal:s,focusAgency:o}=t,i=[];let l=e;o&&(l=e.filter((e=>e["Awarding Agency"]===o))),s>0&&(l=l.filter((e=>(e["Award Amount"]||0)>=s)));const c=(App.forecastData?.analysis?.recompetes||[]).filter((e=>e["End Date"])),d={};return l.forEach((e=>{const t=e["Awarding Agency"]||"Unknown",n=e["Awarding Sub Agency"]||t,a=e["NAICS Code"]||"",r=e["PSC Code"]||"",s=r||a||"_general",o=e._quarter||1,i=`${n}|${s}`;d[i]||(d[i]={agency:t,subAgency:n,naicsCode:a,pscCode:r,naicsDesc:e["NAICS Description"]||"",pscDesc:e["PSC Description"]||"",historicalAmounts:[],historicalYears:[],quarterCounts:{1:0,2:0,3:0,4:0},descriptions:[],vendors:[],sourceAwardMap:new Map,setAsides:new Set,vehicles:new Set});const l=d[i];l.historicalAmounts.push(e["Award Amount"]||0),l.historicalYears.push(e._fiscalYear),l.quarterCounts[o]=(l.quarterCounts[o]||0)+1,e.Description&&l.descriptions.push(e.Description),e["Recipient Name"]&&l.vendors.push(e["Recipient Name"]),!l.naicsCode&&a&&(l.naicsCode=a,l.naicsDesc=e["NAICS Description"]||""),!l.pscCode&&r&&(l.pscCode=r,l.pscDesc=e["PSC Description"]||"");const c=e.generated_internal_id||e["Award ID"]||`${e["Recipient Name"]}_${e["Award Amount"]}`;l.sourceAwardMap.has(c)||l.sourceAwardMap.set(c,{id:e.generated_internal_id||null,awardId:e["Award ID"]||"",amount:e["Award Amount"]||0,vendor:e["Recipient Name"]||"",fy:e._fiscalYear,endDate:e["End Date"]||""});const p=VehicleDetector.getSetAsideLabel(e["Type of Set Aside"]);p&&l.setAsides.add(p);const u=VehicleDetector.detect(e["Award ID"]);u&&l.vehicles.add(u.short)})),Object.values(d).forEach((e=>{const t=[...e.sourceAwardMap.values()];if(t.length<1)return;const o=[...e.historicalAmounts].sort(((e,t)=>e-t)),l=o.length%2==0?(o[o.length/2-1]+o[o.length/2])/2:o[Math.floor(o.length/2)],d=e.historicalAmounts.reduce(((e,t)=>e+t),0)/e.historicalAmounts.length,p=l*r;if(p<s)return;const u=Object.entries(e.quarterCounts).sort(((e,t)=>t[1]-e[1]))[0],m=parseInt(u[0]),g=c.find((t=>{const n=t["Awarding Sub Agency"]||t["Awarding Agency"]||"",a=t["Awarding Agency"]||"";if(!(n===e.subAgency||a===e.agency))return!1;if(e.pscCode&&t["PSC Code"]===e.pscCode)return!0;if(e.naicsCode&&t["NAICS Code"]===e.naicsCode)return!0;if(!e.pscCode&&!e.naicsCode){const n=(t.Description||"").toLowerCase();return e.descriptions.map((e=>e.toLowerCase())).some((e=>e.split(/\s+/).filter((e=>e.length>4)).filter((e=>n.includes(e))).length>=2))}return!1})),h=g?{amount:g["Award Amount"]||0,endDate:Utils.date(g["End Date"]),vendor:g["Recipient Name"]||"",awardId:g["Award ID"]||""}:null,y=this.scoreOpportunity(e,a,h);if(y.score<20)return;const b=[...new Set(e.historicalYears)],f=this.getFYQuarterDates(n,m),v={};e.descriptions.forEach((e=>{const t=e.substring(0,120);v[t]=(v[t]||0)+1}));const A=Object.entries(v).sort(((e,t)=>t[1]-e[1]))[0],S={};e.vendors.forEach((e=>{S[e]=(S[e]||0)+1}));const w=Object.entries(S).sort(((e,t)=>t[1]-e[1]))[0],C=w?Math.round(w[1]/e.vendors.length*100):0,I=Utils.getCurrentQuarter(),E=Utils.getCurrentFY();let $="Prospecting";(h||n===E&&m<=I+1)&&($="Qualification");const T=Utils.trunc(e.subAgency,25);let D=e.pscDesc||e.naicsDesc||"";!D&&A&&(D=A[0].split(/[,;.]/)[0].substring(0,40)),D||(D=App.currentQuery);const k=`${T} â€” ${Utils.trunc(D,35)} â€” FY${n}`,x=t.sort(((e,t)=>t.amount-e.amount)).slice(0,3).map((e=>({url:e.id?`https://www.usaspending.gov/award/${e.id}`:"",label:`FY${e.fy} ${Utils.money(e.amount)} (${Utils.trunc(e.vendor,20)})`,awardId:e.awardId}))),N=w?VendorRelationships.get(w[0]):null;i.push({OpportunityName:k,AccountName:e.agency,SubAgency:e.subAgency,Amount:Math.round(p),CloseDate:f.end,StageName:$,Probability:Math.round(y.score*r),Type:h?"Existing Business - Recompete":"New Business",LeadSource:"USAspending Historical Analysis",Description:A?A[0]:`Projected from ${b.length}yr history`,NextStep:this.getNextStep($,h,N),QualScore:y.score,QualSignals:y.signals,FiscalYear:`FY${n}`,FiscalQuarter:`Q${m}`,NAICSCode:e.naicsCode,NAICSDescription:e.naicsDesc,PSCCode:e.pscCode,PSCDescription:e.pscDesc,Incumbent:w?w[0]:"",IncumbentWins:w?w[1]:0,IncumbentDominance:C,VendorRelationship:N||"",HistoricalAverage:Math.round(d),HistoricalMedian:Math.round(l),HistoricalYearsObserved:b.join(", "),RecurrenceRate:`${Math.round(100*y.recurrence)}%`,SourceAwards:x,SourceAwardCount:t.length,ContractVehicle:[...e.vehicles].join(", "),SetAside:[...e.setAsides].join(", "),RecompeteFlag:!!h,RecompeteEndDate:h?h.endDate:"",RecompeteIncumbent:h?h.vendor:"",DataSource:"USAspending.gov",GeneratedDate:(new Date).toISOString().split("T")[0],SearchKeyword:App.currentQuery})})),i.sort(((e,t)=>e.RecompeteFlag!==t.RecompeteFlag?t.RecompeteFlag?1:-1:e.QualScore!==t.QualScore?t.QualScore-e.QualScore:t.Amount-e.Amount)),i},getNextStep:(e,t,n)=>t?"mine"===n?`Defend: Incumbent contract expires ${t.endDate}. Engage CO and confirm recompete timeline.`:"partner"===n?`Support partner: Contract expires ${t.endDate}. Align on recompete teaming strategy.`:`Pursue recompete: Current incumbent contract expires ${t.endDate}. Research RFP timeline and engage agency.`:"Qualification"===e?"Validate requirement with agency contacts. Confirm funding and acquisition timeline.":"Research agency contacts and identify program office. Determine if requirement is funded.",renderResults(e,t){const n=e.reduce(((e,t)=>e+t.Amount),0),a=e.length>0?n/e.length:0,r=e.filter((e=>e.RecompeteFlag)).length,s=e.filter((e=>e.RecompeteFlag)).reduce(((e,t)=>e+t.Amount),0),o=e.length>0?Math.round(e.reduce(((e,t)=>e+t.QualScore),0)/e.length):0;document.getElementById("pipelineStatsGrid").innerHTML=`\n      <div class="pipeline-stat">\n        <div class="pipeline-stat-label">Total Pipeline</div>\n        <div class="pipeline-stat-value">${Utils.money(n)}</div>\n        <div class="pipeline-stat-sub">${e.length} qualified opps</div>\n      </div>\n      <div class="pipeline-stat">\n        <div class="pipeline-stat-label">Recompete Opps</div>\n        <div class="pipeline-stat-value" style="color:var(--danger);">${r}</div>\n        <div class="pipeline-stat-sub">${Utils.money(s)} linked to expiring</div>\n      </div>\n      <div class="pipeline-stat">\n        <div class="pipeline-stat-label">Avg Deal Size</div>\n        <div class="pipeline-stat-value">${Utils.money(a)}</div>\n        <div class="pipeline-stat-sub">Weighted by history</div>\n      </div>\n      <div class="pipeline-stat">\n        <div class="pipeline-stat-label">Avg Qual Score</div>\n        <div class="pipeline-stat-value">${o}/100</div>\n        <div class="pipeline-stat-sub">BANT-based scoring</div>\n      </div>\n    `,document.getElementById("pipelineResultCount").textContent=e.length,0!==e.length?document.getElementById("pipelineTableContainer").innerHTML=`\n      <table class="pipeline-table">\n        <thead>\n          <tr>\n            <th style="min-width:45px;">Score</th>\n            <th>Opportunity</th>\n            <th>Sub-Agency</th>\n            <th>Total Oblig.</th>\n            <th>Qtr</th>\n            <th>Stage</th>\n            <th>Incumbent</th>\n            <th>Vehicle</th>\n            <th>Evidence</th>\n          </tr>\n        </thead>\n        <tbody>\n          ${e.map((e=>{const t=e.QualScore>=70?"var(--success)":e.QualScore>=40?"var(--accent)":"var(--text-muted)",n=e.QualScore>=70?"Strong":e.QualScore>=40?"Medium":"Early",a=e.SourceAwards.filter((e=>e.url)).map((e=>`<a href="${e.url}" target="_blank" style="font-size:0.65rem; color:var(--link); text-decoration:none; display:block; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:180px;" title="${e.label}">${e.label}</a>`)).join(""),r="mine"===e.VendorRelationship?'<span title="My Company" style="color:var(--accent); font-size:0.6rem; font-weight:700; border:1px solid var(--accent); padding:1px 4px; border-radius:2px; margin-right:3px;">MINE</span>':"partner"===e.VendorRelationship?'<span title="Partner" style="color:var(--info); font-size:0.6rem; font-weight:700; border:1px solid var(--info); padding:1px 4px; border-radius:2px; margin-right:3px;">PTR</span>':"competitor"===e.VendorRelationship?'<span title="Competitor" style="color:var(--danger); font-size:0.6rem; font-weight:700; border:1px solid var(--danger); padding:1px 4px; border-radius:2px; margin-right:3px;">COMP</span>':"";return`\n            <tr style="${e.RecompeteFlag?"border-left:3px solid var(--danger);":""}">\n              <td style="text-align:center;">\n                <div style="font-family:'JetBrains Mono',monospace; font-size:0.85rem; font-weight:700; color:${t};">${e.QualScore}</div>\n                <div style="font-size:0.55rem; color:${t}; text-transform:uppercase;">${n}</div>\n              </td>\n              <td>\n                <div title="${e.OpportunityName}" style="font-weight:600; font-size:0.8rem;">${Utils.trunc(e.OpportunityName,40)}</div>\n                ${e.RecompeteFlag?`<span style="font-size:0.6rem; color:var(--danger); background:rgba(166,68,56,0.15); padding:1px 5px; border-radius:2px;">RECOMPETE â€” ends ${e.RecompeteEndDate}</span>`:""}\n                ${e.SetAside?`<span style="font-size:0.6rem; color:var(--accent); background:rgba(229,192,123,0.15); padding:1px 5px; border-radius:2px; margin-left:4px;">${e.SetAside}</span>`:""}\n              </td>\n              <td style="font-size:0.8rem;" title="${e.SubAgency}">${Utils.trunc(e.SubAgency,22)}</td>\n              <td class="amount">${Utils.money(e.Amount)}</td>\n              <td><span class="pipeline-quarter-badge">${e.FiscalQuarter}</span></td>\n              <td><span class="stage ${e.StageName.toLowerCase()}">${e.StageName}</span></td>\n              <td style="font-size:0.75rem;">\n                ${r}${Utils.trunc(e.Incumbent||"â€”",18)}\n                ${e.IncumbentWins>1?`<div style="font-size:0.6rem; color:var(--text-muted);">${e.IncumbentWins} awards Â· ${e.IncumbentDominance}% share</div>`:""}\n              </td>\n              <td style="font-size:0.75rem;">${e.ContractVehicle||"â€”"}</td>\n              <td style="font-size:0.7rem;">\n                <div style="font-size:0.6rem; color:var(--text-muted); margin-bottom:2px;">${e.SourceAwardCount} source awards</div>\n                ${a||'<span style="color:var(--text-muted); font-size:0.6rem;">No direct links</span>'}\n              </td>\n            </tr>`})).join("")}\n        </tbody>\n      </table>\n      <div style="padding:0.75rem 1rem; border-top:1px solid var(--border); font-size:0.7rem; color:var(--text-muted); display:flex; justify-content:space-between; align-items:center;">\n        <span>Score = BANT qualification (Budget + Authority + Need + Timeline)</span>\n        <span style="color:var(--danger); font-weight:600;">Red border = linked to expiring contract</span>\n      </div>\n    `:document.getElementById("pipelineTableContainer").innerHTML='\n        <div style="text-align:center; padding:2rem; color:var(--text-muted);">\n          <i class="fas fa-search" style="font-size:2rem; margin-bottom:1rem; opacity:0.5;"></i>\n          <p>No qualified opportunities generated. Try adjusting the minimum deal size or historical years.</p>\n        </div>'},downloadCSV(){if(0===this.generatedPipeline.length)return void alert("No pipeline data to download. Please generate a pipeline first.");const e=this.generatedPipeline.map((e=>[e.OpportunityName,e.AccountName,e.SubAgency,e.Amount,e.CloseDate,e.StageName,e.Probability,e.QualScore,e.Type,e.LeadSource,e.Description,e.NextStep,e.FiscalYear,e.FiscalQuarter,e.NAICSCode,e.NAICSDescription,e.PSCCode,e.PSCDescription,e.ContractVehicle,e.SetAside,e.Incumbent,e.IncumbentWins,e.IncumbentDominance,e.RecompeteFlag?"Yes":"",e.RecompeteEndDate,e.RecompeteIncumbent,e.HistoricalAverage,e.HistoricalMedian,e.HistoricalYearsObserved,e.RecurrenceRate,e.SourceAwardCount,e.SourceAwards[0]?e.SourceAwards[0].url:"",e.SourceAwards[1]?e.SourceAwards[1].url:"",e.SourceAwards[2]?e.SourceAwards[2].url:"",e.QualSignals.join("; "),e.DataSource,e.GeneratedDate,e.SearchKeyword])),t=e=>{if(null==e)return"";const t=String(e);return t.includes(",")||t.includes('"')||t.includes("\n")?`"${t.replace(/"/g,'""')}"`:t},n=[["Opportunity Name","Account Name","Sub-Agency","Total Obligations","Close Date","Stage","Probability (%)","Qualification Score","Type","Lead Source","Description","Next Step","Fiscal Year","Fiscal Quarter","NAICS Code","NAICS Description","PSC Code","PSC Description","Contract Vehicle","Set-Aside","Incumbent","Incumbent Wins","Incumbent Dominance (%)","Recompete Flag","Recompete End Date","Recompete Incumbent","Historical Average","Historical Median","Historical Years Observed","Recurrence Rate","Source Award Count","Source Award 1","Source Award 2","Source Award 3","Qualification Signals","Data Source","Generated Date","Search Keyword"].map(t).join(","),...e.map((e=>e.map(t).join(",")))].join("\n"),a=new Blob([n],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a");r.href=URL.createObjectURL(a);const s=document.getElementById("pipelineTargetFY").value;r.download=`Pipeline_FY${s}_${App.currentQuery.replace(/[^a-zA-Z0-9]/g,"_")}_${(new Date).toISOString().split("T")[0]}.csv`,document.body.appendChild(r),r.click(),document.body.removeChild(r),document.getElementById("pipelineDataStatus").textContent="CSV downloaded! Includes source award links, qualification scores, and recompete flags."}},ConvoStarters={currentFocus:"agencies",currentMode:"prime",generatedStarters:[],open(e="prime"){const t=document.getElementById("convoStartersModal");if(!t)return;if(this.currentMode=e,"sub"===e){if(0===(App.forecastData.subawards||[]).length)return void alert("No subcontract data available. Please run a search first.")}else{if(0===(App.searchData.active||[]).length)return void alert("Please run a search first to generate conversation starters.")}t.classList.add("active"),document.body.style.overflow="hidden";const n=t.querySelector(".channel-modal-title");n&&(n.innerHTML="sub"===e?'<span class="sub-bullet"><i class="fas fa-handshake"></i></span> TEAMING CONVERSATION STARTERS':'<i class="fas fa-comments" style="color: var(--info);"></i> CONVERSATION STARTERS');const a=t.querySelector(".convo-focus-toggle");a&&("sub"===e?(a.innerHTML='\n          <button class="convo-focus-btn active" data-convo-focus="primes" onclick="ConvoStarters.setFocus(\'primes\')" style="border-color: var(--accent);">\n            <span class="sub-bullet sm blue"><i class="fas fa-building"></i></span> Primes\n          </button>\n          <button class="convo-focus-btn" data-convo-focus="subs" onclick="ConvoStarters.setFocus(\'subs\')" style="border-color: var(--accent);">\n            <span class="sub-bullet sm"><i class="fas fa-user-friends"></i></span> Subs\n          </button>\n          <button class="convo-focus-btn" data-convo-focus="both" onclick="ConvoStarters.setFocus(\'both\')" style="border-color: var(--accent);">\n            <span class="sub-bullet sm gray"><i class="fas fa-users"></i></span> Both\n          </button>\n        ',this.setFocus("primes")):(a.innerHTML='\n          <button class="convo-focus-btn active" data-convo-focus="agencies" onclick="ConvoStarters.setFocus(\'agencies\')">\n            <span class="sub-bullet sm blue"><i class="fas fa-landmark"></i></span> Agencies\n          </button>\n          <button class="convo-focus-btn" data-convo-focus="vendors" onclick="ConvoStarters.setFocus(\'vendors\')">\n            <span class="sub-bullet sm"><i class="fas fa-building"></i></span> Vendors\n          </button>\n          <button class="convo-focus-btn" data-convo-focus="both" onclick="ConvoStarters.setFocus(\'both\')">\n            <span class="sub-bullet sm gray"><i class="fas fa-users"></i></span> Both\n          </button>\n        ',this.setFocus("agencies"))),this.updateContext()},updateContext(){const e=document.getElementById("convoDataStatus");if("sub"===this.currentMode){let t=App.forecastData.subawards||[];const n=App.subawardDrillState||{};n.level>0&&n.filter&&("prime"===n.filterType?t=t.filter((e=>(e["Prime Recipient Name"]||"Unknown Prime")===n.filter)):"sub"===n.filterType&&(t=t.filter((e=>(e["Sub-Awardee Name"]||"Unknown Sub")===n.filter))));let a=[];n.level>0&&n.filter&&a.push(`Filtered to: ${n.filter}`),App.currentQuery&&a.push(`Search: "${App.currentQuery}"`),e&&(a.length>0?e.innerHTML=`Based on <span id="convoAwardCount">${t.length}</span> subcontracts. ${a.join(" Â· ")}`:e.innerHTML=`Based on <span id="convoAwardCount">${t.length}</span> subcontracts from your search.`)}else{const t=App.searchData.active||[],n=App.drillState||{},a=App.searchData.filter;let r=[];if(n.path&&n.path.length>0){const e=n.path.map((e=>"object"==typeof e?e.name:e)).filter(Boolean);e.length>0&&r.push(`Filtered to: ${e.join(" â†’ ")}`)}else a&&r.push(`Filtered to: ${a}`);App.currentQuery&&r.push(`Search: "${App.currentQuery}"`),e&&(r.length>0?e.innerHTML=`Based on <span id="convoAwardCount">${t.length}</span> awards. ${r.join(" Â· ")}`:e.innerHTML=`Based on <span id="convoAwardCount">${t.length}</span> awards from your search.`)}},close(){const e=document.getElementById("convoStartersModal");e&&(e.classList.remove("active"),document.body.style.overflow="")},setFocus(e){this.currentFocus=e,document.querySelectorAll(".convo-focus-btn").forEach((t=>{t.classList.toggle("active",t.dataset.convoFocus===e)})),this.generate()},generate(){const e=document.getElementById("convoResultsArea");e&&(e.innerHTML='<div class="convo-empty"><i class="fas fa-spinner fa-spin"></i><p>Generating talking points...</p></div>');const t=[],n=App.currentQuery||"this market";if("sub"===this.currentMode){let e=App.forecastData.subawards||[];if(0===e.length)return;const a=App.subawardDrillState||{};a.level>0&&a.filter&&("prime"===a.filterType?e=e.filter((e=>(e["Prime Recipient Name"]||"Unknown Prime")===a.filter)):"sub"===a.filterType&&(e=e.filter((e=>(e["Sub-Awardee Name"]||"Unknown Sub")===a.filter))));const r={prime:"prime"===a.filterType?a.filter:null,sub:"sub"===a.filterType?a.filter:null},s=this.analyzePrimes(e),o=this.analyzeSubs(e);"primes"!==this.currentFocus&&"both"!==this.currentFocus||t.push(...this.generatePrimeStarters(s,o,n,r)),"subs"!==this.currentFocus&&"both"!==this.currentFocus||t.push(...this.generateSubStarters(o,s,n,r))}else{const e=App.searchData.active||[];if(0===e.length)return;const a=App.drillState||{},r=a.path&&a.path.length>0?a.path[a.path.length-1]:null,s={agency:a.currentAgency||null,subAgency:a.currentSubAgency||null,vendor:3===a.level&&r?"object"==typeof r?r.name:r:null,level:a.level||0},o=this.analyzeAgencies(e),i=this.analyzeVendors(e),l=this.findRecompetes(e);"agencies"!==this.currentFocus&&"both"!==this.currentFocus||t.push(...this.generateAgencyStarters(o,i,l,n,s)),"vendors"!==this.currentFocus&&"both"!==this.currentFocus||t.push(...this.generateVendorStarters(i,o,n,s))}this.generatedStarters=t,this.render(t)},analyzePrimes(e){const t={};return e.forEach((e=>{const n=e["Prime Recipient Name"]||"Unknown Prime",a=e["Sub-Awardee Name"]||"Unknown Sub",r=parseFloat(e["Sub-Award Amount"])||0,s=e["Awarding Agency"]||e["Awarding Sub Agency"]||"";t[n]||(t[n]={name:n,totalSubbed:0,subCount:0,subs:{},agencies:{}}),t[n].totalSubbed+=r,t[n].subCount++,t[n].subs[a]=(t[n].subs[a]||0)+r,s&&(t[n].agencies[s]=(t[n].agencies[s]||0)+r)})),Object.values(t).map((e=>{const t=Object.entries(e.subs).sort(((e,t)=>t[1]-e[1]));e.topSub=t[0]?{name:t[0][0],amount:t[0][1]}:null,e.subVendorCount=t.length;const n=Object.entries(e.agencies).sort(((e,t)=>t[1]-e[1]));return e.topAgency=n[0]?{name:n[0][0],amount:n[0][1]}:null,e})).sort(((e,t)=>t.totalSubbed-e.totalSubbed))},analyzeSubs(e){const t={};return e.forEach((e=>{const n=e["Prime Recipient Name"]||"Unknown Prime",a=e["Sub-Awardee Name"]||"Unknown Sub",r=parseFloat(e["Sub-Award Amount"])||0,s=e["Awarding Agency"]||e["Awarding Sub Agency"]||"";t[a]||(t[a]={name:a,totalReceived:0,awardCount:0,primes:{},agencies:{}}),t[a].totalReceived+=r,t[a].awardCount++,t[a].primes[n]=(t[a].primes[n]||0)+r,s&&(t[a].agencies[s]=(t[a].agencies[s]||0)+r)})),Object.values(t).map((e=>{const t=Object.entries(e.primes).sort(((e,t)=>t[1]-e[1]));return e.topPrime=t[0]?{name:t[0][0],amount:t[0][1]}:null,e.primeCount=t.length,e})).sort(((e,t)=>t.totalReceived-e.totalReceived))},generatePrimeStarters(e,t,n,a={}){const r=[],s=e.slice(0,5),o=[(e,t)=>`I noticed ${e} subs out a lot of ${t} work. Is that by design, or do you just have more opportunities than bandwidth?`,(e,t)=>`How does ${e} usually find teaming partners for ${t} workâ€”do you use capability briefs, or is it mostly through relationships?`,(e,t)=>`I'm a small shop with ${t} expertise. What would make someone like me actually useful to ${e} on a proposal?`,(e,t)=>`${e} works with ${t} different subsâ€”that's impressive. How do you manage that many teaming relationships?`,(e,t)=>`Is ${e} actively looking to expand your ${t} bench, or are you pretty locked in with your current teammates?`],i=[(e,t)=>`I see you work a lot with ${t}. How'd that teaming relationship get started?`,(e,t)=>`${t} seems to be your go-to sub. What makes that partnership work so well?`,(e,t)=>`What's the best way to get on ${e}'s radar for future ${t} opportunities?`,e=>`Does ${e} prefer working with the same subs repeatedly, or do you mix it up based on the opportunity?`,(e,t)=>`I heard ${e} has some ${t} bids coming up. Are you already teamed, or still building your roster?`];return s.forEach(((e,t)=>{const s=e.name.split(" ").slice(0,2).join(" "),l=o[t%o.length];if((t<3||e.subVendorCount>2)&&r.push({type:"prime",target:e.name,icon:"fa-handshake",text:l(s,n,e.subVendorCount)}),e.topSub&&e.topSub.name!==a.sub){const a=e.topSub.name.split(" ").slice(0,2).join(" "),o=i[t%i.length];r.push({type:"prime",target:e.name,icon:"fa-user-friends",text:o(s,a,n)})}e.totalSubbed>1e6&&r.push({type:"prime",target:e.name,icon:"fa-chart-bar",text:`${s} subs out about ${Utils.money(e.totalSubbed)} in ${n} work. Is that a growing part of your business, or pretty stable?`})})),r.push({type:"prime",target:"General",icon:"fa-coffee",text:`I'm looking for primes who need ${n} support. Any advice on how to approach these conversations without sounding desperate?`}),r.push({type:"prime",target:"General",icon:"fa-lightbulb",text:"What makes a capability brief actually get read? I've sent a bunch out but never hear back."}),r},generateSubStarters(e,t,n,a={}){const r=[],s=e.slice(0,5),o=[(e,t)=>`I see you do a lot of ${n} work for ${t}. How'd you get on their team?`,(e,t)=>`You're teaming with ${t} different primesâ€”do you have a favorite, or is it all the same?`,(e,t)=>`Are you looking to expand your prime relationships for ${t} work, or are you pretty maxed out?`,(e,t)=>`Is ${t} good to work with as a prime? I'm thinking about approaching them.`,(e,t)=>`What's your sweet spot in ${t}? I'm trying to figure out where there might be teaming synergies.`],i=[(e,t)=>`We might be going after similar ${t} work. Any interest in teaming instead of competing?`,e=>`I've seen ${e} on a few proposal teams. Do you mostly sub, or do you prime stuff too?`,(e,t)=>`How's the ${t} market treating you? Feels like there's more competition than ever.`,e=>"Do you prefer being a sub or going after prime contracts directly? I'm still figuring out my strategy."];return s.forEach(((e,t)=>{const s=e.name.split(" ").slice(0,2).join(" ");if(e.topPrime&&e.topPrime.name!==a.prime){const a=e.topPrime.name.split(" ").slice(0,2).join(" "),i=o[t%o.length];r.push({type:"sub",target:e.name,icon:"fa-link",text:i(s,a,e.primeCount,n)})}e.primeCount>1&&r.push({type:"sub",target:e.name,icon:"fa-network-wired",text:`${s} teams with ${e.primeCount} different primes. How do you balance those relationships without stepping on toes?`});const l=i[t%i.length];r.push({type:"sub",target:e.name,icon:"fa-users",text:l(s,n)})})),r.push({type:"sub",target:"General",icon:"fa-question-circle",text:"How do you find out about teaming opportunities before the RFP drops? I feel like I'm always late to the party."}),r.push({type:"sub",target:"General",icon:"fa-handshake",text:`Anyone here looking for ${n} teammates? I've got capacity and I'm tired of chasing primes who ghost me.`}),r},analyzeAgencies(e){const t={},n=App.drillState||{},a=n.level>=2&&n.currentSubAgency;return e.forEach((e=>{const n=a?e["Awarding Sub Agency"]||e["Awarding Agency"]||"Unknown":e["Awarding Agency"]||"Unknown",r=e["Awarding Sub Agency"]||"",s=parseFloat(e["Award Amount"])||0,o=e["Recipient Name"]||"",i=e.Description||"",l=e["PSC Description"]||"",c=e["End Date"];if(t[n]||(t[n]={name:n,totalSpend:0,count:0,vendors:{},subAgencies:{},descriptions:[],pscDescs:[],expiringSoon:[]}),t[n].totalSpend+=s,t[n].count++,t[n].vendors[o]=(t[n].vendors[o]||0)+s,r&&(t[n].subAgencies[r]=(t[n].subAgencies[r]||0)+s),i&&t[n].descriptions.push(i),l&&!t[n].pscDescs.includes(l)&&t[n].pscDescs.push(l),c){const e=new Date(c),a=(e-new Date)/2592e6;a>0&&a<18&&s>5e4&&t[n].expiringSoon.push({vendor:o,amount:s,endDate:e,desc:i})}})),Object.values(t).map((e=>{const t=Object.entries(e.vendors).sort(((e,t)=>t[1]-e[1]));return e.topVendor=t[0]?{name:t[0][0],spend:t[0][1]}:null,e.vendorCount=t.length,e})).sort(((e,t)=>t.totalSpend-e.totalSpend))},analyzeVendors(e){const t={},n=App.drillState||{},a=n.level>=2&&n.currentSubAgency;return e.forEach((e=>{const n=e["Recipient Name"]||"Unknown",r=a?e["Awarding Sub Agency"]||e["Awarding Agency"]||"":e["Awarding Agency"]||"",s=parseFloat(e["Award Amount"])||0,o=e.Description||"";t[n]||(t[n]={name:n,totalSpend:0,count:0,agencies:{},descriptions:[]}),t[n].totalSpend+=s,t[n].count++,r&&(t[n].agencies[r]=(t[n].agencies[r]||0)+s),o&&t[n].descriptions.push(o)})),Object.values(t).map((e=>{const t=Object.entries(e.agencies).sort(((e,t)=>t[1]-e[1]));return e.topAgency=t[0]?{name:t[0][0],spend:t[0][1]}:null,e.agencyCount=t.length,e})).sort(((e,t)=>t.totalSpend-e.totalSpend))},findRecompetes(e){const t=new Date,n=new Date;return n.setMonth(t.getMonth()+18),e.filter((e=>{const a=new Date(e["End Date"]);return a>t&&a<n&&(parseFloat(e["Award Amount"])||0)>1e5})).sort(((e,t)=>new Date(e["End Date"])-new Date(t["End Date"]))).slice(0,10)},generateAgencyStarters(e,t,n,a,r={}){const s=[],o=e.slice(0,5),i=e.reduce(((e,t)=>e+t.totalSpend),0),l=["I've been trying to learn more about","I'm curious about","I was reading up on","Someone mentioned that","I've heard that"];if(r.vendor){const e=r.vendor,t=e.split(" ").slice(0,2).join(" ");o.forEach((n=>{const r=n.name.replace("Department of ","").replace("Department of the ","");(n.vendors[e]||0)>0&&s.push({type:"agency",target:n.name,icon:"fa-coffee",text:`How's the ${a} world treating ${r} these days? I know ${t} has been pretty active there.`})}))}if(o.forEach(((e,t)=>{const n=(e.totalSpend/i*100).toFixed(0),o=e.name.replace("Department of ","").replace("Department of the ",""),c=l[t%l.length];if(e.pscDescs.length>0){const t=e.pscDescs[0].toLowerCase();s.push({type:"agency",target:e.name,icon:"fa-comments",text:`${c} ${o}'s ${t} initiatives. What's been the most interesting project you've seen come through lately?`})}if(e.topVendor&&e.topVendor.spend>1e6&&e.topVendor.name!==r.vendor){const t=e.topVendor.name.split(" ").slice(0,2).join(" ");s.push({type:"agency",target:e.name,icon:"fa-user-friends",text:`Do you ever work with the ${t} folks? I've seen them around ${o} a lotâ€”curious what that world is like from the inside.`})}e.expiringSoon.slice(0,1).length>0&&s.push({type:"agency",target:e.name,icon:"fa-calendar",text:`Sounds like ${o} has some ${a} work coming up for bid. Is that something people are already talking about, or still too early?`}),n>15&&s.push({type:"agency",target:e.name,icon:"fa-lightbulb",text:`${o} seems to be doing a lot in the ${a} space. What's driving thatâ€”new mission requirements, or modernization stuff?`})})),o.length>0){const e=o[0].name.replace("Department of ","").replace("Department of the ","");s.push({type:"agency",target:"General",icon:"fa-question-circle",text:`I'm still learning the ${a} landscape. Any advice on how smaller companies can actually get in front of ${e}?`}),s.push({type:"agency",target:"General",icon:"fa-users",text:"Is this your first time at this conference, or are you a regular? I'm trying to figure out which sessions are actually worth attending."})}return s},generateVendorStarters(e,t,n,a={}){const r=[],s=e.slice(0,5),o=[(e,t,n)=>`How's the ${t} account treating ${e} these days? Seems like a busy shop.`,(e,t,n)=>`${e} and ${t}â€”that's a solid pairing. How'd you all originally get your foot in the door there?`,(e,t,n)=>`I've heard ${t} can be tough to work with. Has that been your experience at ${e}, or is it overblown?`,(e,t,n)=>`What's ${t} like as a customer? I'm trying to figure out if they're worth pursuing for ${n} work.`,(e,t,n)=>`Is ${t} one of those "good revenue, painful delivery" accounts, or do they actually make it easy to do good work?`];if(a.agency||a.subAgency){const e=a.subAgency||a.agency,t=e.replace("Department of ","").replace("Department of the ","");s.forEach(((a,s)=>{const i=a.name.split(" ").slice(0,2).join(" ");if((a.agencies[e]||0)>0){const e=o[s%o.length];r.push({type:"vendor",target:a.name,icon:"fa-building",text:e(i,t,n)})}}))}return s.forEach(((e,t)=>{const s=e.name.split(" ").slice(0,2).join(" ");if(e.agencyCount>1&&!a.agency){const a=e.topAgency?.name?.replace("Department of ","").replace("Department of the ","")||"different agencies";0===t?r.push({type:"vendor",target:e.name,icon:"fa-map",text:`${s} seems to be the big dog in ${n} right now. Is ${a} where most of that work is, or is it spread out?`}):1===t?r.push({type:"vendor",target:e.name,icon:"fa-compass",text:`How does ${s} decide which agencies to go after? Is it opportunistic, or do you have a real strategy around ${n}?`}):r.push({type:"vendor",target:e.name,icon:"fa-map",text:`You all work across ${e.agencyCount} agenciesâ€”that's impressive. How do you keep up with that many different customers?`})}if(e.totalSpend>5e6&&(0===t?r.push({type:"vendor",target:e.name,icon:"fa-handshake",text:`For a company like ${s}, do small businesses ever actually add value as subs, or is it mostly a compliance thing?`}):t<3?r.push({type:"vendor",target:e.name,icon:"fa-graduation-cap",text:`I'm trying to break into ${n}. What would make someone like me actually useful to ${s} on a proposal?`}):r.push({type:"vendor",target:e.name,icon:"fa-door-open",text:`What's the best way to get on ${s}'s radar for teaming? Cold emails, conferences like this, or something else?`})),e.topAgency&&e.topAgency.name!==a.agency){const a=e.topAgency.name.replace("Department of ","").replace("Department of the ","");t%3==0?r.push({type:"vendor",target:e.name,icon:"fa-coffee",text:`${a} seems to love you guys. What's the secretâ€”great past performance, or do you just know the right people?`}):t%3==1?r.push({type:"vendor",target:e.name,icon:"fa-lightbulb",text:`How'd ${s} originally land the ${a} work? Was it a big competitive win, or did it grow from something smaller?`}):r.push({type:"vendor",target:e.name,icon:"fa-star",text:`Is ${a} a good customer to have? I'm trying to figure out where to focus my energy in the ${n} space.`})}e.count>=3&&(t%2==0?r.push({type:"vendor",target:e.name,icon:"fa-chart-line",text:`${s} has been winning a lot lately. Is it the same BD team, or did you guys hire some secret weapon?`}):r.push({type:"vendor",target:e.name,icon:"fa-trophy",text:`What's driving the ${n} wins for ${s}? Better pricing, better tech, or just better relationships?`}))})),r.push({type:"vendor",target:"General",icon:"fa-beer",text:"Long day on the floor? I'm about ready for whatever's open. Know if there's a good happy hour spot nearby?"}),r.push({type:"vendor",target:"General",icon:"fa-route",text:"Been to any good sessions? I feel like I've just been wandering the expo hall all day."}),r.push({type:"vendor",target:"General",icon:"fa-id-badge",text:"First time hereâ€”any tips? Like which booths have the best swag, or which panels are actually worth sitting through?"}),r},render(e){const t=document.getElementById("convoResultsArea");t&&(0!==e.length?t.innerHTML=e.map(((e,t)=>`\n      <div class="convo-card" data-index="${t}">\n        <div class="convo-card-label">\n          <i class="fas ${e.icon}"></i>\n          <span>${"agency"===e.type?"Agency":"Vendor"}: ${Utils.trunc(e.target,35)}</span>\n        </div>\n        <div class="convo-card-text">${e.text}</div>\n        <button class="convo-card-copy" onclick="ConvoStarters.copyOne(${t})" title="Copy this talking point">\n          <i class="fas fa-copy"></i>\n        </button>\n      </div>\n    `)).join(""):t.innerHTML='\n        <div class="convo-empty">\n          <i class="fas fa-comments"></i>\n          <p>No conversation starters could be generated. Try a different search or focus.</p>\n        </div>\n      ')},copyOne(e){const t=this.generatedStarters[e];t&&navigator.clipboard.writeText(t.text).then((()=>{const t=document.querySelector(`.convo-card[data-index="${e}"] .convo-card-copy`);t&&(t.classList.add("copied"),t.innerHTML='<i class="fas fa-check"></i>',setTimeout((()=>{t.classList.remove("copied"),t.innerHTML='<i class="fas fa-copy"></i>'}),1500))}))},copyAll(){if(0===this.generatedStarters.length)return;const e=this.generatedStarters.map(((e,t)=>`[${e.type.toUpperCase()}: ${e.target}]\n${e.text}`)).join("\n\n---\n\n"),t=`CONVERSATION STARTERS: ${App.currentQuery.toUpperCase()}\nGenerated ${(new Date).toLocaleDateString()} via Govhoo.com\n${"=".repeat(50)}\n\n`;navigator.clipboard.writeText(t+e).then((()=>{const e=document.getElementById("convoDataStatus");e&&(e.textContent="All talking points copied to clipboard!",setTimeout((()=>this.updateContext()),2e3))}))},downloadForPhone(){if(0===this.generatedStarters.length)return;const e=this.generatedStarters.map(((e,t)=>`[${e.type.toUpperCase()}: ${e.target}]\n${e.text}`)).join("\n\n---\n\n"),t=`CONVERSATION STARTERS\n${App.currentQuery.toUpperCase()}\n${(new Date).toLocaleDateString()}\nvia Govhoo.com\n${"=".repeat(30)}\n\n`,n=new Blob([t+e],{type:"text/plain;charset=utf-8;"}),a=document.createElement("a");a.href=URL.createObjectURL(n),a.download=`TalkingPoints_${App.currentQuery.replace(/[^a-zA-Z0-9]/g,"_")}_${(new Date).toISOString().split("T")[0]}.txt`,document.body.appendChild(a),a.click(),document.body.removeChild(a);const r=document.getElementById("convoDataStatus");r&&(r.textContent="Downloaded! Send to your phone or print for the event.")}};App.bubbleMode="auto",App.setBubbleMode=function(e){App.bubbleMode=e,document.getElementById("bubbleToggleVendors").classList.toggle("active","vendors"===e),document.getElementById("bubbleToggleAgencies").classList.toggle("active","agencies"===e),document.getElementById("bubbleToggleSubAgencies").classList.toggle("active","subagencies"===e),App.renderBubbleChart()},App.getEffectiveBubbleMode=function(){if("auto"!==App.bubbleMode)return App.bubbleMode;const e=App.drillState||{};return 0===e.level?"agencies":1===e.level?"subagencies":"vendors"},App.updateBubbleToggles=function(){const e=App.drillState||{},t=document.getElementById("bubbleToggleVendors"),n=document.getElementById("bubbleToggleAgencies"),a=document.getElementById("bubbleToggleSubAgencies");a&&(a.style.display=e.level>=1?"inline-block":"none");const r=App.getEffectiveBubbleMode();t.classList.toggle("active","vendors"===r),n.classList.toggle("active","agencies"===r),a&&a.classList.toggle("active","subagencies"===r);const s=document.getElementById("bubbleChartSubtitle");if(s){const e={agencies:"Top Active Agencies Â· Lifetime Funded Value",subagencies:"Top Active Sub-Agencies Â· Lifetime Funded Value",vendors:"Top Active Vendors Â· Lifetime Funded Value"};s.textContent=e[r]||"Top Active Vendors & Agencies Â· Lifetime Funded Value"}},App.renderBubbleBreadcrumb=function(){const e=document.getElementById("bubbleBreadcrumb"),t=document.getElementById("bubbleBreadcrumbInner");if(!e||!t)return;const n=App.drillState||{};if(0===n.level)return void(e.style.display="none");e.style.display="block";let a='<div class="bubble-bc-item" onclick="App.resetDrill()"><i class="fas fa-globe" style="font-size:0.6rem;"></i> All</div>';n.path&&n.path.length>0&&n.path.forEach(((e,t)=>{const r=t===n.path.length-1,s="agency"===e.type?"fa-landmark":"sub"===e.type?"fa-sitemap":"fa-building",o=r?"":`onclick="App.drillToLevel(${t+1})"`;a+='<span class="bubble-bc-sep"><i class="fas fa-chevron-right"></i></span>',a+=`<div class="bubble-bc-item ${r?"active":""}" ${o}><i class="fas ${s}" style="font-size:0.55rem;"></i> ${Utils.trunc(e.name,30)}</div>`})),t.innerHTML=a},App.renderBubbleChart=function(){const e=document.getElementById("bubbleChartContainer"),t=document.getElementById("bubbleChartPanel");if(!e||!t)return;const n=App.searchData.active;if(!n||0===n.length)return void(t.style.display="none");t.style.display="block",App.updateBubbleToggles(),App.renderBubbleBreadcrumb();const a=App.drillState||{},r=App.getEffectiveBubbleMode(),s={};let o=0;n.forEach((e=>{let t;t="agencies"===r?e["Awarding Agency"]||"Unknown":"subagencies"===r?e["Awarding Sub Agency"]||e["Awarding Agency"]||"Unknown":e["Recipient Name"]||"Unknown";const n=parseFloat(e["Award Amount"])||0;s[t]||(s[t]={name:t,spend:0,count:0,agencies:new Set,subAgencies:new Set,vendors:new Set,parentAgency:null}),s[t].spend+=n,s[t].count++,s[t].agencies.add(e["Awarding Agency"]||"Unknown"),s[t].subAgencies.add(e["Awarding Sub Agency"]||""),s[t].vendors.add(e["Recipient Name"]||"Unknown"),"subagencies"===r&&(s[t].parentAgency=e["Awarding Agency"]||"Unknown"),o+=n}));let i=Object.values(s).filter((e=>e.spend>0)).sort(((e,t)=>t.spend-e.spend)).slice(0,50);if(0===i.length)return void(t.style.display="none");i.forEach((e=>{e.agencyCount=e.agencies?e.agencies.size:0,e.subAgencyCount=e.subAgencies?e.subAgencies.size:0,e.vendorCount=e.vendors?e.vendors.size:0,delete e.agencies,delete e.subAgencies,delete e.vendors}));const l=new Set(n.map((e=>e["Awarding Agency"]))).size,c=new Set(n.map((e=>e["Recipient Name"]))).size,d=document.getElementById("bubble-stat-vol"),p=document.getElementById("bubble-stat-agencies"),u=document.getElementById("bubble-stat-count"),m=document.getElementById("bubble-stat-vendors"),g=document.getElementById("bubble-stat-entities"),h=(document.getElementById("bubble-stat-entities-label"),document.getElementById("bubbleChartSubtitle"));if(d&&(d.innerText=Utils.money(o)),p&&(p.innerText=l),u&&(u.innerText=n.length),m&&(m.innerText=c),g&&(g.innerText=i.length),h){const e=App.currentQuery?'"'+App.currentQuery.toUpperCase()+'" Â· ':"",t={agencies:"Agencies",subagencies:"Sub-Agencies",vendors:"Vendors"};h.textContent=e+"Top Active "+(t[r]||"Vendors")+" Â· Lifetime Funded Value"}const y=document.getElementById("bubbleTooltip");e.querySelectorAll("svg").forEach((e=>e.remove()));const b=e.getBoundingClientRect(),f=Math.max(b.width||600,300),v=Math.max(420,Math.min(.7*f,600)),A=["#4A7A67","#5B7C99","#7B6D8D","#E07A5F","#78A890","#D1BFA7","#B87E7E","#7E9CB8","#6B8F71","#9B8EC4","#C4956A","#5F9EA0","#8FBC8F","#BDB76B","#CD853F","#708090"],S=d3.hierarchy({children:i}).sum((e=>e.spend)).sort(((e,t)=>t.value-e.value)),w=d3.pack().size([f,v]).padding(1.5)(S),C=d3.select(e).append("svg").attr("width",f).attr("height",v).attr("viewBox",`0 0 ${f} ${v}`).selectAll(".bubble-node").data(w.leaves()).join("g").attr("class","bubble-node").attr("transform",(e=>`translate(${e.x},${e.y})`));C.append("circle").attr("r",(e=>e.r)).attr("fill",((e,t)=>A[t%A.length])).attr("opacity",.85).attr("stroke","rgba(241, 238, 233, 0.1)").attr("stroke-width",1),C.filter((e=>e.r>28)).append("text").attr("class","bubble-label").attr("dy",(e=>e.r>45?"-0.4em":"0em")).attr("font-size",(e=>{const t=e.data.name.length,n=Math.min(e.r/3.5,14,2*e.r/(.6*t));return Math.max(n,7)+"px"})).attr("font-weight",(e=>e.r>50?"700":"400")).text((e=>{const t=Math.floor(e.r/4.5);return Utils.trunc(e.data.name,Math.max(t,4))})),C.filter((e=>e.r>45)).append("text").attr("class","bubble-amount-label").attr("dy","1em").attr("font-size",(e=>Math.max(Math.min(e.r/5,11),7)+"px")).text((e=>Utils.money(e.data.spend))),C.on("mouseover",(function(e,t){const n=t.data,s=o>0?(n.spend/o*100).toFixed(1):"0";let i;i="agencies"===r||"subagencies"===r?`${n.count} awards Â· ${n.vendorCount} vendors Â· ${s}%`:`${n.count} awards Â· ${n.agencyCount} agencies Â· ${s}%`;let l="";"agencies"===r?l='<div style="color:var(--accent);font-size:0.6rem;margin-top:3px;">Click to drill into sub-agencies â†’</div>':"subagencies"===r?l='<div style="color:var(--accent);font-size:0.6rem;margin-top:3px;">Click to drill into vendors â†’</div>':"vendors"===r&&a.level<3&&(l='<div style="color:var(--accent);font-size:0.6rem;margin-top:3px;">Click to focus on this vendor â†’</div>'),y.innerHTML=`\n        <div class="bubble-tooltip-name">${n.name}</div>\n        <div class="bubble-tooltip-amount">${Utils.money(n.spend)}</div>\n        <div class="bubble-tooltip-meta">${i}</div>\n        ${l}\n      `,y.classList.add("visible")})).on("mousemove",(function(t){const n=e.getBoundingClientRect();let a=t.clientX-n.left+15,r=t.clientY-n.top-10;a+260>f&&(a-=280),r+90>v&&(r-=100),y.style.left=a+"px",y.style.top=r+"px"})).on("mouseout",(function(){y.classList.remove("visible")})).on("click",(function(e,t){const n=t.data;y.classList.remove("visible"),"agencies"===r?(App.bubbleMode="auto",App.drillToAgency(n.name)):"subagencies"===r?(App.bubbleMode="auto",App.drillToSubAgency(n.name)):App.drillDown(n.name)})),C.selectAll("circle").attr("r",0).transition().duration(600).delay(((e,t)=>15*t)).ease(d3.easeCubicOut).attr("r",(e=>e.r)),C.selectAll("text").attr("opacity",0).transition().duration(400).delay(((e,t)=>300+15*t)).attr("opacity",1)},App.subBubbleMode="primes",App.setSubBubbleMode=function(e){App.subBubbleMode=e,document.getElementById("subBubbleTogglePrimes").classList.toggle("active","primes"===e),document.getElementById("subBubbleToggleSubs").classList.toggle("active","subs"===e),App.renderSubBubbleChart()},App.renderSubBubbleBreadcrumb=function(){const e=document.getElementById("subBubbleBreadcrumb"),t=document.getElementById("subBubbleBreadcrumbInner");if(!e||!t)return;const n=App.subawardDrillState||{};if(!n.level||0===n.level)return void(e.style.display="none");e.style.display="block";const a={agency:"fa-landmark",subagency:"fa-sitemap",prime:"fa-building",sub:"fa-handshake"};let r='<div class="bubble-bc-item" onclick="App.resetSubawardDrill()"><i class="fas fa-stream" style="font-size:0.6rem;"></i> All Subawards</div>';n.path&&n.path.length>0&&n.path.forEach(((e,t)=>{const s=t===n.path.length-1,o=a[e.type]||"fa-circle",i=s?"":`onclick="App.drillSubawardToLevel(${t})"`;r+='<span class="bubble-bc-sep"><i class="fas fa-chevron-right"></i></span>',r+=`<div class="bubble-bc-item ${s?"active":""}" ${i}><i class="fas ${o}" style="font-size:0.55rem;"></i> ${Utils.trunc(e.name,30)}</div>`})),t.innerHTML=r},App.renderSubBubbleChart=function(){const e=document.getElementById("subBubbleContainer"),t=document.getElementById("subBubblePanel");if(!e||!t)return;const n=App.forecastData?.subawards;if(!n||0===n.length)return void(t.style.display="none");let a=n;const r=App.subawardDrillState||{};if(r.level>0&&r.path&&r.path.length>0&&r.path.forEach((e=>{"agency"===e.type?a=a.filter((t=>(t["Awarding Agency"]||"Unknown Agency")===e.name)):"subagency"===e.type?a=a.filter((t=>(t["Awarding Sub Agency"]||"Unknown Sub Agency")===e.name)):"prime"===e.type?a=a.filter((t=>(t["Prime Recipient Name"]||"Unknown Prime")===e.name)):"sub"===e.type&&(a=a.filter((t=>(t["Sub-Awardee Name"]||"Unknown Sub")===e.name)))})),0===a.length)return void(t.style.display="none");t.style.display="block",App.renderSubBubbleBreadcrumb();const s=App.subBubbleMode||"primes",o={};let i=0;const l=new Set,c=new Set;a.forEach((e=>{const t=e["Prime Recipient Name"]||"Unknown Prime",n=e["Sub-Awardee Name"]||"Unknown Sub",a=parseFloat(e["Sub-Award Amount"])||0,r="primes"===s?t:n;l.add(t),c.add(n),o[r]||(o[r]={name:r,spend:0,count:0,partners:new Set}),o[r].spend+=a,o[r].count++,o[r].partners.add("primes"===s?n:t),i+=a}));let d=Object.values(o).filter((e=>e.spend>0)).sort(((e,t)=>t.spend-e.spend)).slice(0,40);if(0===d.length)return void(t.style.display="none");d.forEach((e=>{e.partnerCount=e.partners?e.partners.size:0,delete e.partners}));const p=document.getElementById("subBubbleSubtitle");if(p){const e=App.currentQuery?'"'+App.currentQuery.toUpperCase()+'" Â· ':"";p.textContent=e+"Top "+("primes"===s?"Primes":"Subcontractors")+" Â· Individual Transaction Value"}const u={vol:document.getElementById("sub-bubble-stat-vol"),primes:document.getElementById("sub-bubble-stat-primes"),subs:document.getElementById("sub-bubble-stat-subs"),records:document.getElementById("sub-bubble-stat-records")};u.vol&&(u.vol.innerText=Utils.money(i)),u.primes&&(u.primes.innerText=l.size),u.subs&&(u.subs.innerText=c.size),u.records&&(u.records.innerText=a.length);const m=document.getElementById("subBubbleTooltip");e.querySelectorAll("svg").forEach((e=>e.remove()));const g=e.getBoundingClientRect(),h=Math.max(g.width||600,300),y=Math.max(380,Math.min(.65*h,550)),b=["#5B7C99","#7B6D8D","#4A7A67","#E07A5F","#78A890","#D1BFA7","#B87E7E","#7E9CB8","#9B8EC4","#6B8F71","#C4956A","#5F9EA0","#8FBC8F","#BDB76B","#CD853F","#708090"],f=d3.hierarchy({children:d}).sum((e=>e.spend)).sort(((e,t)=>t.value-e.value)),v=d3.pack().size([h,y]).padding(1.5)(f),A=d3.select(e).append("svg").attr("width",h).attr("height",y).attr("viewBox",`0 0 ${h} ${y}`).selectAll(".bubble-node").data(v.leaves()).join("g").attr("class","bubble-node").attr("transform",(e=>`translate(${e.x},${e.y})`));A.append("circle").attr("r",(e=>e.r)).attr("fill",((e,t)=>b[t%b.length])).attr("opacity",.85).attr("stroke","rgba(241, 238, 233, 0.1)").attr("stroke-width",1),A.filter((e=>e.r>28)).append("text").attr("class","bubble-label").attr("dy",(e=>e.r>45?"-0.4em":"0em")).attr("font-size",(e=>{const t=e.data.name.length,n=Math.min(e.r/3.5,14,2*e.r/(.6*t));return Math.max(n,7)+"px"})).attr("font-weight",(e=>e.r>50?"700":"400")).text((e=>Utils.trunc(e.data.name,Math.max(Math.floor(e.r/4.5),4)))),A.filter((e=>e.r>45)).append("text").attr("class","bubble-amount-label").attr("dy","1em").attr("font-size",(e=>Math.max(Math.min(e.r/5,11),7)+"px")).text((e=>Utils.money(e.data.spend))),A.on("mouseover",(function(e,t){const n=t.data,a=i>0?(n.spend/i*100).toFixed(1):"0",r="primes"===s?"subs":"primes";m.innerHTML=`\n        <div class="bubble-tooltip-name">${n.name}</div>\n        <div class="bubble-tooltip-amount">${Utils.money(n.spend)}</div>\n        <div class="bubble-tooltip-meta">${n.count} subawards Â· ${n.partnerCount} ${r} Â· ${a}%</div>\n        <div style="color:var(--accent);font-size:0.6rem;margin-top:3px;">Click to drill â†’</div>\n      `,m.classList.add("visible")})).on("mousemove",(function(t){const n=e.getBoundingClientRect();let a=t.clientX-n.left+15,r=t.clientY-n.top-10;a+260>h&&(a-=280),r+90>y&&(r-=100),m.style.left=a+"px",m.style.top=r+"px"})).on("mouseout",(function(){m.classList.remove("visible")})).on("click",(function(e,t){m.classList.remove("visible");const n="primes"===s?"prime":"sub";App.drillSubaward(t.data.name,n)})),A.selectAll("circle").attr("r",0).transition().duration(600).delay(((e,t)=>15*t)).ease(d3.easeCubicOut).attr("r",(e=>e.r)),A.selectAll("text").attr("opacity",0).transition().duration(400).delay(((e,t)=>300+15*t)).attr("opacity",1)},App.presentationMode=!1,App.togglePresentationMode=function(){App.presentationMode=!App.presentationMode;const e=document.getElementById("searchModeView"),t=document.getElementById("presToggleBtn");App.presentationMode?(e.classList.add("presentation-mode"),t.classList.add("active"),t.innerHTML='<i class="fas fa-moon"></i>'):(e.classList.remove("presentation-mode"),t.classList.remove("active"),t.innerHTML='<i class="fas fa-rainbow"></i>');const n=App.presentationMode?"#1A1A1A":"#F1EEE9";d3.select("#chartContainer").selectAll("text").style("fill",n),d3.select("#subcontractingBody").selectAll("text").style("fill",n),App.renderBubbleChart(),App.forecastData?.subawards&&App.renderSubBubbleChart()},App.init();
</script>
</body>
</html>